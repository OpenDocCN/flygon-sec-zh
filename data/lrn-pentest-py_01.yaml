- en: Chapter 1. Understanding the Penetration Testing Methodology
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第1章。理解渗透测试方法论
- en: Before jumping in too quick, in this chapter, we will actually define what penetration
    testing is and is not, what the **Penetration Testing Execution Standard** (**PTES**)
    is, and the tools that would be used. This information will be useful as a guideline
    for future engagements that you may be part of. This chapter will help guide new
    assessors and organizations who want to set up their own engagements. If you want
    to jump right into the code and the nitty gritty details, I suggest jumping to
    [Chapter 2](ch02.html "Chapter 2. The Basics of Python Scripting"), *The Basics
    of Python Scripting*. I caution you though that the benefit of reading this chapter
    is that it will provide a framework and mindset that will help you to separate
    a script kiddie from a professional. So, let's start with what a penetration test
    is.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在急于行动之前，在本章中，我们将实际定义渗透测试是什么，以及不是什么，**渗透测试执行标准**（**PTES**）是什么，以及将使用的工具。这些信息将作为未来参与的指南。本章将帮助指导新的评估人员和希望建立自己参与的组织。如果你想直接进入代码和细节，我建议跳到[第2章](ch02.html
    "第2章。Python脚本的基础")，*Python脚本的基础*。不过，我要提醒你，阅读本章的好处在于它将提供一个框架和思维模式，帮助你区分一个脚本小子和一个专业人士。所以，让我们从渗透测试是什么开始。
- en: Most important, these tools and techniques should only be executed in environments
    you own or have permission to run these tools in. Never practice these techniques
    in environments in which you are not authorized to do so; remember that penetration
    testing without permission is illegal, and you can go to jail for it.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 最重要的是，这些工具和技术只能在您拥有或获得运行这些工具的许可的环境中执行。永远不要在未经授权的环境中练习这些技术；请记住，未经许可进行渗透测试是非法的，你可能会因此入狱。
- en: Note
  id: totrans-3
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To practice what is listed in the initial chapters, install a virtualization
    suite such as VMware Player ([http://www.vmware.com/products/player](http://www.vmware.com/products/player))
    or Oracle VirtualBox ([http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html](http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html)).
    Create **Virtual Machines** (**VMs**) out of the current version of Kali Linux
    ([https://www.kali.org/downloads/](https://www.kali.org/downloads/)), Samurai
    Web Testing Framework ([http://samurai.inguardians.com/](http://samurai.inguardians.com/)),
    and Metasploitable ([http://www.offensive-security.com/metasploit-unleashed/Requirements](http://www.offensive-security.com/metasploit-unleashed/Requirements)).
    You can execute tests against these by using the Metasploitable box from the Kali
    system. The last link provided has a number of tutorials and configuration notes
    related to these tools; if additional tool are necessary for each chapter, they
    will be highlighted there.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 要练习初始章节中列出的内容，请安装一个虚拟化套件，如VMware Player ([http://www.vmware.com/products/player](http://www.vmware.com/products/player))
    或 Oracle VirtualBox ([http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html](http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html))。创建当前版本的Kali
    Linux ([https://www.kali.org/downloads/](https://www.kali.org/downloads/))、Samurai
    Web Testing Framework ([http://samurai.inguardians.com/](http://samurai.inguardians.com/))和Metasploitable
    ([http://www.offensive-security.com/metasploit-unleashed/Requirements](http://www.offensive-security.com/metasploit-unleashed/Requirements))的虚拟机（VM）。您可以使用Kali系统中的Metasploitable盒子对这些进行测试。提供的最后一个链接中有许多与这些工具相关的教程和配置说明；如果每章需要额外的工具，它们将在那里进行突出显示。
- en: An overview of penetration testing
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试概述
- en: There is a huge misconception about what penetration testing is. This is common
    even among professionals who have recently entered the field. New penetration
    testers or professionals who request penetration tests often say that these tests
    prove the exploitability of vulnerabilities, the susceptibility of an environment
    to exploitation, or just the presence of vulnerabilities. This misunderstanding
    manifests itself into real impacts on engagements as they are scoped, sourced,
    and conducted. Further, this mistaken perception includes the thought that a penetration
    test will find all vulnerabilities, it will be able to find unknown zero days
    every time, and all objectives will always be met irrespective of the controls
    put in place.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 对于渗透测试的概念存在着巨大的误解。即使是最近进入该领域的专业人士也普遍存在这种误解。新的渗透测试人员或要求进行渗透测试的专业人士经常说，这些测试证明了漏洞的可利用性，环境易受攻击的程度，或者只是漏洞的存在。这种误解会在项目的范围、来源和执行中产生实际影响。此外，这种错误的看法包括认为渗透测试将找到所有的漏洞，每次都能找到未知的零日漏洞，而且无论采取了什么控制措施，所有目标都将始终得到满足。
- en: A penetration test is the practice of assessing an organization's security strategy's
    ability to protect critical data from the actions of a malicious actor. A security
    strategy is the organization's overarching information security program. It focuses
    on maintaining the confidentiality, integrity, and availability of the organization's
    critical data and resources. This is to mitigate risk to an acceptable level by
    using a combination of people, processes, and technology. The difference between
    the first and the second definition of a penetration test is night and day.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试是评估组织的安全策略保护关键数据免受恶意行为者行为影响的实践。安全策略是组织的全面信息安全计划。它侧重于维护组织关键数据和资源的机密性、完整性和可用性。这是通过使用人员、流程和技术的组合来将风险降低到可接受的水平。渗透测试的第一种和第二种定义之间的区别是天壤之别。
- en: The first definition focuses solely on vulnerabilities; this means that people
    expect the activity that an assessor will perform to be related to exploiting
    or finding vulnerabilities or simple misconfigurations. It does not take into
    account bad practices related to the policies, processes, or insecure relationships
    that the organization may have. These preconceived notions often have the following
    significant impacts for both organizations and new assessors.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个定义仅关注漏洞；这意味着人们期望评估者将执行的活动与利用或发现漏洞或简单的配置错误有关。它没有考虑到组织可能存在的与政策、流程或不安全关系相关的不良做法。这些先入为主的观念经常对组织和新评估者都产生重大影响。
- en: Organizational leadership will not create goals related to breaching access
    controls related to critical data repositories or identifying critical data locations.
    There will also be an initial belief that **Intrusion Protection Systems** (**IPS**)
    and **Intrusion Detection Systems** (**IDS**) are the linchpin to preventing a
    compromise; all experienced assessors know that this is not true. Additionally,
    assessments may not be scoped in a manner that would provide realistic results.
    The most damaging result of this misunderstanding is that the organization may
    not be able to identify when an assessor is missing the skills necessary to execute
    the required engagement.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 组织领导不会制定与突破与关键数据存储库相关的访问控制或识别关键数据位置相关的目标。最初还会有一种信念，即**入侵保护系统**（**IPS**）和**入侵检测系统**（**IDS**）是防止妥协的关键；所有经验丰富的评估者都知道这不是真的。此外，评估可能没有以提供现实结果的方式进行范围界定。这种误解最具破坏性的结果是，组织可能无法确定评估者是否缺乏执行所需的参与所必需的技能。
- en: Note
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Similarly, new assessors have the misconception that a **Vulnerability Management
    Solution** (**VMS**) such as Nexpose, Nessus, Qualys, or others will identify
    the way into an environment. These may highlight ways to get into a system, but
    there is a high rate of false positives and true negatives. A false positive means
    something was identified as vulnerable, but it is not. The opposite of a false
    positive is a true negative, which means that something was identified as secure,
    but it is instead vulnerable.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，新的评估者错误地认为**漏洞管理解决方案**（**VMS**）如Nexpose、Nessus、Qualys或其他解决方案将识别进入环境的途径。这些工具可能会突出系统的入侵途径，但误报率和真负率很高。误报是指将某物标识为有漏洞，但实际上并没有。误报的相反是真负，这意味着将某物标识为安全，但实际上是有漏洞的。
- en: If vulnerabilities are not within the database, then the system will not identify
    the vulnerability that could grant access. VMS will not highlight the chained
    attacks related to bad practices or processes, which would be classified as a
    weakness or vulnerability. The use of these tools for penetration tests makes
    them exceedingly noisy, and they encourage assessors to simulate attacks that
    are relatively outdated.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果漏洞不在数据库中，则系统将无法识别可能授予访问权限的漏洞。VMS不会突出与不良做法或流程相关的链接攻击，这将被归类为弱点或漏洞。使用这些工具进行渗透测试会使它们变得非常嘈杂，并鼓励评估者模拟相对过时的攻击。
- en: Most malicious actors take advantage of the path of least resistance, which
    usually does not relate to Remote Code Exploits such as the famous MS08-067 or
    MS06-40\. Instead, an assessor should step back and look for insecure associations
    and configurations that may provide unnoticed access. Most senior assessors do
    not use VMS tools during penetration tests, but instead focus on assessing environments
    manually.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数恶意行为者利用最容易的路径，通常与著名的MS08-067或MS06-40等远程代码利用无关。相反，评估者应该退一步，寻找可能提供不被注意的访问权限的不安全关联和配置。大多数资深评估者在渗透测试期间不使用VMS工具，而是专注于手动评估环境。
- en: Many of these misconceptions relate directly to other types of engagements.
    This comes from other security assessments being advertised as penetration tests,
    or from people either running or receiving the results of these engagements. In
    the following section, a sample of assessments that are often confused with penetration
    tests is listed. It should be enough to highlight the differences between an actual
    penetration test and other security assessments and activities.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 许多这些误解直接与其他类型的参与相关。这来自其他安全评估被宣传为渗透测试，或者来自人们运行或接收这些参与的结果。在接下来的部分中，列举了一些经常被误认为是渗透测试的评估样本。这应该足以突出实际渗透测试与其他安全评估和活动之间的差异。
- en: Understanding what penetration testing is not
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解渗透测试的本质
- en: Other types of assessments and activities are often advertised or confused as
    penetration tests. Examples of these types of engagements include vulnerability
    assessments, large-scale reverse engineering projects, and hacking. Let's address
    each of these in turn so as to understand where penetration testing fits in.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 其他类型的评估和活动经常被宣传或误认为是渗透测试。这些类型的参与包括漏洞评估、大规模逆向工程项目和黑客攻击。让我们依次讨论每一种，以便了解渗透测试的定位。
- en: Vulnerability assessments
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 漏洞评估
- en: A **Vulnerability Assessment** (**VA**) uses a VMS to scan for vulnerabilities.
    The good VAs then use an assessor to eliminate false positives, after which the
    actual risk rating of the findings may be adjusted on the basis of the business
    impact and the likelihood of exploitation. Often security consultants or penetration
    testers execute these assessments, which may require the actual exploitation of
    these vulnerabilities for a proof of concept. This type of assessment is great
    for showing how good an organization is at performing patching and deploying assets
    in a secure configuration. The key here is that these types of assessments do
    not focus on gaining access to critical data from the perspective of a malicious
    actor, but instead relate to finding vulnerabilities.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 漏洞评估（VA）使用VMS扫描漏洞。好的VA然后使用评估者消除误报，之后可以根据业务影响和利用可能性调整发现的实际风险评级。通常安全顾问或渗透测试人员执行这些评估，这可能需要实际利用这些漏洞来进行概念验证。这种类型的评估非常适合展示组织在执行修补和部署资产时的表现。关键在于这些类型的评估不是专注于从恶意行为者的角度获取对关键数据的访问权限，而是与发现漏洞相关。
- en: Reverse engineering engagements
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 逆向工程参与
- en: Reversing can be part of a penetration test, but it is much rarer today than
    in the past. [Chapter 8](ch08.html "Chapter 8. Exploit Development with Python,
    Metasploit, and Immunity"), *Exploit Development with Python, Metasploit, and
    Immunity*, will discuss this in greater detail as an actual exploit development
    will be described here. Current penetration tests may include exploit development,
    but it is done to create a proof of concept related to homegrown code and gaining
    access to a critical system where the data may reside.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 逆向可能是渗透测试的一部分，但在今天比过去要少得多。[第8章](ch08.html "第8章。使用Python、Metasploit和Immunity进行利用开发")，“使用Python、Metasploit和Immunity进行利用开发”，将更详细地讨论这一点，因为这里将描述实际的利用开发。当前的渗透测试可能包括利用开发，但这是为了创建与自制代码相关的概念验证，并获取对可能存储数据的关键系统的访问权限。
- en: In contrast, in large-scale reversing engagements, an assessor tries to prove
    the overall susceptibility of the application to being reversed and the weaknesses
    related to the source code, compilation, and associated libraries. These types
    of engagements are better suited to a reversing engineer, who spends time identifying
    common attack chains and methods to compromise an application, versus gaining
    access to critical data. The level of experience in this specific arena is extensive.
    Often, many assessors move from penetration testing to this specific skillset
    where they do reversing full time.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，在大规模的逆向工程参与中，评估者试图证明应用程序整体易受逆向工程的影响，以及与源代码、编译和相关库相关的弱点。这些类型的参与更适合逆向工程师，他们花时间识别常见的攻击链和方法来破坏应用程序，而不是获取对关键数据的访问权限。在这个特定领域的经验水平是广泛的。通常，许多评估者从渗透测试转向这种特定的技能集，他们全职从事逆向工程。
- en: Hacking
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 黑客
- en: Hacking is not an assessment, but deals directly with taking advantage of exploitable
    vulnerabilities; it could be related to malicious activity or it could be done
    for research. The purpose of hacking is not to gain access to critical data, but
    to solely crack vulnerabilities. There are many definitions of hacking, and it
    is often directly related penetration testing, but there are no specific or explicit
    goals related to hacking. Now that some of the big differences between a penetration
    test and the other activities have been delineated, the methodology related to
    achieving goals can be highlighted.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 黑客不是评估，而是直接利用可利用的漏洞；它可能与恶意活动有关，也可能是为了研究而进行。黑客的目的不是获取对关键数据的访问权限，而是纯粹破解漏洞。黑客有许多定义，通常与渗透测试直接相关，但与黑客相关的目标没有具体或明确的目标。现在已经勾勒出了渗透测试和其他活动之间的一些重大区别，可以突出实现目标的方法论。
- en: Assessment methodologies
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估方法学
- en: There is a variety of assessment methodologies related to penetration testing.
    Examples of some methodologies include the **Open Source Security Testing Methodology
    Manual** (**OSSTMM**), the **Open Web Application Security Project** (**OWASP**)
    for web assessments, the **National Institute of Standards and Technology** (**NIST**)
    Special Publication 800-115 Technical Guide to Information Security Testing and
    Assessment, and the PTES. The methodology that we will focus on in this book is
    the PTES because it is a solid resource for new assessors.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 与渗透测试相关的评估方法有多种。一些方法学的例子包括开放源代码安全测试方法手册（OSSTMM）、用于Web评估的开放Web应用安全项目（OWASP）、国家标准与技术研究所（NIST）的特别出版物800-115技术指南信息安全测试和评估，以及PTES。我们在本书中将专注于的方法学是PTES，因为它是新评估者的可靠资源。
- en: The penetration testing execution standard
  id: totrans-26
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试执行标准
- en: 'The PTES has seven different phases, namely Pre-engagement Interactions, Intelligence
    Gathering, Threat Modeling, Vulnerability Analysis, Exploitation, Post Exploitation,
    and Reporting. Each engagement will follow these phases to some extent, but an
    experienced assessor will move from one phase to the next smoothly and relatively
    seamlessly. The biggest benefit of using a methodology is that it allows assessors
    to evaluate an environment holistically and consistently. Being consistent with
    an assessment means a couple of things:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: PTES有七个不同的阶段，即预交互、情报收集、威胁建模、漏洞分析、利用、后利用和报告。每次参与都会在某种程度上遵循这些阶段，但经验丰富的评估者将会顺利且相对无缝地从一个阶段过渡到下一个。使用方法学的最大好处是允许评估者全面和一致地评估环境。一致性评估意味着几件事情：
- en: It is less likely that an assessor will miss large vulnerabilities
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估者不太可能错过重大漏洞
- en: It mitigates tunnel vision, which causes assessors to take too much time concentrating
    in regions that will not move the engagement forward
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以减轻导致评估者花费过多时间集中在不会推动参与前进的区域的隧道视野
- en: This means that irrespective of the customer or the environment, an assessor
    will not approach the engagement with preconceived notions
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这意味着无论客户或环境如何，评估者都不会带着成见去参与
- en: The assessor will provide the same level of competence to an environment each
    time
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估者每次都会提供相同水平的能力给一个环境
- en: A customer will receive a high-quality product each time with few chances of
    an assessor missing details
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每次客户都会收到高质量的产品，评估者错过细节的机会很少
- en: All methodologies or frameworks provide these benefits, but PTES like the OWASP
    has an additional benefit for new assessors. Within PTES, there are a number of
    technical guidelines that relate to the different environments that an assessor
    may encounter. In these technical guidelines, there are suggestions for how to
    address and evaluate an environment with industry standard tools.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 所有方法或框架都提供这些好处，但是PTES像OWASP一样，对于新的评估者有额外的好处。在PTES中，有许多技术指南与评估者可能遇到的不同环境相关。在这些技术指南中，有关于如何使用行业标准工具来处理和评估环境的建议。
- en: A caveat to this is that the technical guidelines are not run books; they will
    not provide an assessor the means to step into an engagement and execute it from
    start to finish. Only experience and exposure to an environment will provide an
    assessor the means to deal with most situations that he/she encounters. It should
    be noted that no two environments are identical; there are nuances to each organization,
    company, or firm. These differences mean that even a very experienced assessor
    will find moments that will stump him/her. When standard exploits do not work,
    testers can have tunnel vision; sticking to a methodology will prevent that.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，技术指南不是操作手册；它们不会为评估者提供从头到尾执行参与的手段。只有经验和对环境的接触才能为评估者提供处理他/她遇到的大多数情况的手段。应该指出，没有两个环境是相同的；每个组织、公司或企业都有细微差别。这些差异意味着即使是非常有经验的评估者也会遇到困难的时刻。当标准的利用方式不起作用时，测试人员可能会有局限性；坚持方法论将防止这种情况发生。
- en: 'In highly secure environments, assessors will often have to become creative
    and chain exploits to achieve the set goals and objectives. One of my old teammates
    eloquently defined creative and complex exploits as follows: "They are a sign
    of desperation by a penetration tester." This humorous analogy also highlights
    when an assessor will grow his/her skills.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在高度安全的环境中，评估者通常需要变得有创意，并链接利用来实现设定的目标。我的一位老队友曾经优雅地定义了创意和复杂的利用方式：“它们是渗透测试人员绝望的表现。”这个幽默的类比也突出了评估者何时会提升自己的技能。
- en: How an assessor knows when he/she needs to execute these complex exploits is
    by knowing that all the simple stuff has failed; as a real attacker uses the path
    of least resistance so should an assessor. When this fails, and only when this
    fails, should an assessor start ratcheting up the necessary skill level. You as
    an assessor are evaluating an environment's ability to resist the actions of malicious
    actors.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 评估者如何知道何时需要执行这些复杂的利用方式，是通过知道所有简单的方法都失败了；正如真正的攻击者会选择最不费力的路径，评估者也应该如此。只有在这种情况下失败时，评估者才应该开始提升必要的技能水平。作为评估者，你正在评估一个环境抵抗恶意行为的能力。
- en: These protections are bricks in a building, built up over time and result in
    a secure posture by forming a defense. Much like American Football, if an organization
    has not mastered the fundamental components of a strong defense, there is no way
    it can defend against a trick play. So, we as assessors should start from the
    bottom and work our way up, itemizing the issues.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 这些保护措施就像建筑中的砖块，随着时间的推移而建立，形成了一种安全的姿态。就像美式橄榄球一样，如果一个组织没有掌握强大防御的基本组成部分，它就无法抵御花招。因此，我们作为评估者应该从底层开始，逐步解决问题。
- en: This does not mean that if one path is found, an assessor should stop; he/she
    should identify critical data locations and prove that these can be compromised.
    The assessor should also highlight other paths that a real attacker could take
    to reach critical data. Being able to identify multiple paths and methods related
    to compromising critical data again requires a methodical approach. The seven
    phases are an example of controlling the flow of engagement.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这并不意味着一旦找到一条路径，评估者就应该停下来；他/她应该确定关键数据位置，并证明这些数据可以被破坏。评估者还应该指出真正的攻击者可能采取的其他路径来达到关键数据。能够识别与破坏关键数据相关的多条路径和方法，再次需要一种系统的方法。七个阶段是控制参与流程的一个例子。
- en: Pre-engagement interactions
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 预先交互
- en: 'The first phase of PTES is for all the pre-engagement work, and without a doubt,
    this is the most important phase for a smooth and successful engagement. Any shortcuts
    taken here or undue haste to complete this phase can have a significant impact
    on the rest of the assessment. This phase starts off typically by an organization
    creating a request for an assessment. Examples of assessments that may be requested
    usually fall into one of the following broad categories:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: PTES的第一个阶段是所有预参与工作，毫无疑问，这是一个顺利和成功参与的最重要阶段。在这个阶段采取任何捷径或过快完成这个阶段都会对评估的其余部分产生重大影响。这个阶段通常是由一个组织创建一个评估请求开始的。通常请求的评估示例可以分为以下几个广泛的类别：
- en: Web application
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络应用程序
- en: Internal network
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内部网络
- en: External network
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 外部网络
- en: Physical
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 物理
- en: Social engineering telephony
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 社会工程电话
- en: Phishing
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络钓鱼
- en: '**Voice Over Internet Protocol** (**VOIP**)'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络电话**（**VOIP**）'
- en: Wireless
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无线
- en: Mobile application
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 移动应用程序
- en: The organization may contact an assessor directory or provide a **Request for
    Proposal** (**RFP**), which will detail the type of environment, the assessment
    required, and the expectations of what it wants delivered. On the basis of this
    RFP, multiple assessment firms or individual **Limited Liability Corporations**
    (**LLCs**) will bid on the work related to the environment details. The party
    whose bid best matches the work requested, price, the associated scope, timeline,
    and capabilities will usually win the work.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 组织可能会联系评估员目录或提供**招标文件**（**RFP**），其中详细说明了环境类型、所需评估和所期望交付的内容。根据这份招标文件，多家评估公司或个人**有限责任公司**（**LLC**）将对与环境详细信息相关的工作进行竞标。通常，最符合所请求工作、价格、相关范围、时间表和能力的投标方将赢得该工作。
- en: The **Statement of Work** (**SOW**), which details the work that will be performed
    and the final products, is usually part of an **Engagement Letter** (**EL**) or
    contract that contains all the required legal details as well. Once the EL is
    signed, the fine tuning of the scope can begin. Typically, these discussions are
    the first time an assessment team will encounter the scope creep. This is where
    the client may try to add on or extend the promised level of work to get more
    than it may have promised to pay for. This is usually not intentional, but in
    rare occurrences, it is due to a miscommunication between the writers of the RFP,
    the returned answers for the questions that the assessors ask, and the final EL
    or SOW.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**工作声明**（**SOW**）通常是**参与函**（**EL**）或合同的一部分，其中详细说明将要执行的工作和最终产品，同时包含所有必要的法律细节。一旦签署了EL，就可以开始对范围进行微调。通常，这些讨论是评估团队第一次遇到范围蔓延。这是客户可能试图添加或扩展承诺的工作水平以获得比承诺支付更多的情况。这通常不是故意的，但在罕见情况下，这是由于招标文件的撰写者、评估员提出的问题的答复以及最终的EL或SOW之间的沟通不畅。'
- en: Often, small adjustments or extensions of work may be granted, but larger asks
    are pushed off as they may be perceived as working for free. The final scope is
    then documented for the portion of the engagement that is going to be executed.
    Sometimes, a single EL will cover multiple engagement portions, and more than
    one follow-on discussion may be needed. The big thing to remember in this phase
    is that as an assessor, you are working with a customer, and we should be helpful
    and flexible to aid it in reaching its goals.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，可以批准对工作进行小的调整或延伸，但较大的要求会被推迟，因为这可能被视为无偿工作。然后，最终范围将被记录下来，用于将要执行的参与部分。有时，单个EL将涵盖多个参与部分，并且可能需要进行多次后续讨论。在这个阶段要记住的重要事情是，作为评估员，你正在与客户合作，我们应该乐于助人，灵活地帮助客户实现其目标。
- en: In addition to the scope creep, which is created during the initial engagement
    scoping, there are often opportunities for the client to increase the scope during
    the engagement execution. This often comes with the client asking for work extensions
    or additional resource testing after the testing has started. Any modification
    to the scope should not only be carefully considered due to resources and timing,
    it should also be completed in some documented form, such as e-mail, signed and
    authorized letter, or other non-reputable confirmations of the request.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 除了在初始参与范围界定期间产生的范围蔓延外，在执行参与过程中通常还存在客户增加范围的机会。这通常是客户在测试开始后要求工作延期或额外资源测试。对范围的任何修改不仅应该经过仔细考虑，因为涉及资源和时间，还应该以某种书面形式完成，例如电子邮件、签署和授权的信函，或其他不可否认的请求确认。
- en: Most importantly, any scope adjustments should be done by the personnel authorized
    to make such decisions. These considerations are all part of keeping the engagement
    legal and safe. People signing these documents have to understand the risks related
    to meeting deadlines, assessing the specific environment, and keeping the stakeholders
    satisfied.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 最重要的是，任何范围调整都应由有权做出此类决定的人员完成。这些考虑都是为了保持参与的合法性和安全性。签署这些文件的人必须了解与满足截止日期、评估特定环境和使利益相关者满意相关的风险。
- en: The goals of the engagement are defined during this particular phase, along
    with approvals that may be necessary by other parties. If a company hosts its
    environment on a cloud provider infrastructure or other shared resources, an approval
    will be needed from this organization as well. All parties that approve the activity
    typically require the start and end dates of the testing, and source **Internet
    Protocol** (**IP**) addresses, so that they can validate the activity as not truly
    malicious.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个特定阶段定义了参与的目标，以及可能需要其他方面批准的审批。如果公司将其环境托管在云提供商基础设施或其他共享资源上，则还需要从该组织获得批准。通常，批准活动的所有方通常需要测试的开始和结束日期，以及源**互联网协议**（**IP**）地址，以便他们可以验证活动并非真正恶意。
- en: The other items that must be established at the beginning of the assessment
    are points of contact for both normal reporting of assessments and emergency situations.
    If a resource is thought to have been taken offline by an assessor's activity,
    the assessor needs to follow-up with the point of contact, immediately. Additionally,
    if a critical vulnerability is found, or if there is a belief that a resource
    has already been compromised by a real malicious actor, the assessor should immediately
    contact the primary point of contact if possible, and the emergency contact if
    not.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 评估开始时必须确定的其他事项是正常报告评估和紧急情况的联系人。如果评估员的活动被认为已经使某个资源下线，评估员需要立即与联系人跟进。此外，如果发现了关键漏洞，或者认为某个资源已经被真正的恶意行为者入侵，评估员应尽可能立即联系主要联系人，如果不行，则联系紧急联系人。
- en: This contact should come after the assessor has captured the necessary proof
    of concepts to show that the resource may have already been compromised or that
    there is a critical vulnerability. The reason the capturing of a proof of concept
    is completed prior to contact is that the reporting of these issues usually means
    that the resource is taken offline. Once it is offline, the assessor may have
    no ability to follow-up and prove the statements he/she makes in the final report.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这种联系应该在评估者捕获了必要的概念证明后进行，以表明资源可能已经被入侵或存在关键漏洞。在联系之前完成概念证明的原因是，报告这些问题通常意味着资源被下线。一旦资源下线，评估者可能无法跟进并证明他/她在最终报告中所做的陈述。
- en: Note
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A proof of concept is typically a screen capture of a particular data type,
    event train, exposure, exploit, or compromise.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 概念证明通常是特定数据类型、事件序列、暴露、利用或妥协的屏幕截图。
- en: In addition to reporting unforeseen and critical events, a regular status meeting
    should be scheduled. This can be weekly, daily, or more often or less often, depending
    on the client's requests. The status meeting should cover what the assessor has
    done, what they plan to do, and any deviations noted for the timeline that could
    impact the final report delivery.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 除了报告意外和关键事件外，还应安排定期状态会议。这可以是每周、每天，或更频繁或更少频繁，具体取决于客户的要求。状态会议应涵盖评估者已经完成的工作、计划要做的工作以及可能影响最终报告交付的时间表上的任何偏差。
- en: Related to product and final report delivery, there has to be a secure method
    to deliver the details of the engagement. The balance here comes from the following
    factors, the client's capabilities and knowledge level, the solutions available
    to the assessment team, how secure the data can be made, and the client's abilities
    and requests. Two of the best options are secure delivery servers, or **Pretty
    Good Privacy** (**PGP**) encryption. Sometimes, these options are not available
    or one of the parties cannot implement or use them. At this point, other forms
    of data protection should be determined.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 与产品和最终报告交付相关的是，必须有一种安全的方法来交付参与的详细信息。平衡来自以下因素，即客户的能力和知识水平、评估团队可用的解决方案、数据可以做到多安全以及客户的能力和要求。最好的两个选择是安全交付服务器或**Pretty
    Good Privacy**（**PGP**）加密。有时，这些选项不可用，或者其中一方无法实施或使用它们。在这一点上，应确定其他形式的数据保护。
- en: 'A big caveat here is that password protected documents, portable document formats,
    and zip files typically do not have strong forms of encryption, but they are better
    than nothing. These still require a password to be transmitted back and forth
    to open up the data. The password should be transmitted when possible by some
    other method, or a different channel than the actual data. For example, if the
    data is sent by e-mail, the password should be provided by a phone call, text
    message, or carrier pigeon. The actual risks related to this will be highlighted
    in the later chapters when we discuss password spray attacks against web interfaces
    and methods to crack the perimeter. The last part of the pre-engagement discussion
    relates to how the test will be conducted: White Box, Grey Box, or Black Box.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个重要的警告，即受密码保护的文档、便携式文档格式和zip文件通常没有强大的加密形式，但它们总比没有好。这些仍然需要密码来回传以打开数据。密码应尽可能通过其他方法或与实际数据不同的渠道传输，例如，如果数据通过电子邮件发送，密码应通过电话、短信或信鸽提供。在后面的章节中，当我们讨论针对网络界面的密码喷洒攻击和突破外围的方法时，将突出与此相关的实际风险。预参与讨论的最后一部分涉及测试将如何进行：白盒、灰盒或黑盒。
- en: White Box Testing
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 白盒测试
- en: White Box testing is also known as Clear Box testing or Crystal Box testing.
    The term could be any of the three, but what it basically amounts to is an informed
    attacker or informed insider. There are multiple arguments about what the appropriate
    term is, but at the end of the day, this type of assessment highlights the risk
    related to malicious insiders or attackers who have access to significantly exposed
    information. The assessor is provided intimate details related to what is on the
    network, how it operates, and even potential weaknesses, such as infrastructure
    design, IP addresses, and subnets. With extremely short timelines, this type of
    assessment is very beneficial. Stepping back from fully exposed information or
    the curtain being pulled back completely is the Grey Box format.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 白盒测试也被称为清晰盒测试或水晶盒测试。这个术语可以是这三者之一，但基本上意味着一个知情的攻击者或知情的内部人员。关于适当的术语有多种争论，但归根结底，这种类型的评估突出了与恶意内部人员或攻击者有关的风险，他们可以访问到显著暴露的信息。评估者提供了关于网络上的内容、运行方式甚至潜在弱点（如基础设施设计、IP地址和子网）的详细信息。在极短的时间内，这种类型的评估非常有益。从完全暴露的信息或完全拉开帷幕的情况中退后一步是灰盒格式。
- en: Grey Box Testing
  id: totrans-65
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 灰盒测试
- en: Assessments that follow the Grey Box format have the assessor-provided basic
    information. This includes targets, areas of acceptable testing, and operating
    systems or embedded device brands. Organizations typically also itemize what IDS/IPS
    is in place so that if the assessor starts seeing erroneous results, he/she can
    identify the cause. Grey Box assessments are the most common type of assessment,
    where organizations provide some information to improve the accuracy of the results
    and increase the timeliness of the feedback; at the end, it may reduce the cost
    of the engagement.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 遵循灰盒格式的评估者提供了基本信息。这包括目标、可接受测试的范围以及操作系统或嵌入式设备品牌。组织通常还会列出已经部署的入侵检测系统/入侵防御系统，以便如果评估者开始看到错误的结果，他/她可以确定原因。灰盒评估是最常见的评估类型，组织提供一些信息以提高结果的准确性并增加反馈的及时性；最终，这可能会降低参与成本。
- en: Black Box Testing
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 黑盒测试
- en: The number of Black Box engagements that an assessor will encounter is roughly
    the same as that of White Box engagements, and they are the exact opposite side
    of the spectrum. Assessors are provided no information other than the organization
    that they are going to assess. The assessor identifies resources, which are active
    from extensive **Open Source Intelligence** (**OSINT**) gathering. Senior assessors
    should only execute these types of engagements, as they have to identify regions
    where the targets are live on externals and be extra quiet on internals.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 评估员将遇到的黑盒接触数量大致与白盒接触相同，它们是光谱的完全相反的一面。评估员除了要评估的组织之外，不会得到任何信息。评估员将从广泛的**开源情报**（**OSINT**）收集中识别资源。只有高级评估员才能执行这些类型的接触，因为他们必须确定目标在外部是活动的区域，并且在内部要保持极度安静。
- en: Targets are always validated as authorized or owned by the requesting organization,
    prior to testing for the external assessment by the organization after initial
    research. A Black Box test is often part of a Double Blind test, which is also
    known as an assessment that is not only a test of their environment but also the
    monitoring and incident response capabilities of the organization.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 目标始终在初始研究后由请求组织验证为经授权或拥有的，然后才进行外部评估的测试。黑盒测试通常是双盲测试的一部分，双盲测试也被称为不仅是对其环境进行测试，还是对组织的监控和事件响应能力的评估。
- en: Double Blind Testing
  id: totrans-70
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 双盲测试
- en: Double Blind tests are most often part of a Black Box style engagement, but
    they can be done with Grey and White Box engagements as well. The key with Grey
    and White Box engagements is that the control of the testing period, attack vectors,
    and other information is much more difficult to keep a secret from the defensive
    teams. Engagements that are considered Double Blind must be well established prior
    to executing the engagements, which should include a post-mortem discussion and
    verification of what specific activity was detected and what should have been
    detected. The results of these types of engagements are very useful in determining
    how well the defensive teams' tools are tuned and the potential gaps in the processes.
    A Double Blind should only be executed if the organization has a mature security
    posture.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 双盲测试通常是黑盒样式接触的一部分，但它也可以与灰盒和白盒接触一起进行。灰盒和白盒接触的关键在于，测试期间的控制、攻击向量和其他信息要比从防御团队保密困难得多。被视为双盲的接触必须在执行接触之前得到很好的建立，这应该包括事后讨论和验证检测到了什么具体活动以及应该检测到了什么。这些类型的接触的结果非常有助于确定防御团队的工具调整得有多好以及流程中的潜在漏洞。只有在组织具有成熟的安全姿态时，才应执行双盲测试。
- en: Intelligence gathering
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 情报收集
- en: This is the second phase of PTES and is particularly important if the organization
    wants the assessment team to determine its external exposure. This is very common
    with the Black or Grey Box engagements related to external perimeter tests. During
    this phase of the engagement, an assessor will use registries such as the **American
    Registry of Internet Numbers** (**ARIN**) or other regional registries, information
    repositories query tools such as WhoIs, Shodan, Robtex, social media sites, and
    tools like Recon-ng and the **Google Hacking Database** (**GHDB**).
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这是PTES的第二阶段，如果组织希望评估团队确定其外部暴露，这一点尤为重要。这在与外部边界测试相关的黑盒或灰盒接触中非常常见。在接触的这个阶段，评估员将使用诸如**美国互联网编号注册处**（**ARIN**）或其他地区注册处、信息库查询工具（如WhoIs、Shodan、Robtex）、社交媒体网站以及Recon-ng和**Google黑客数据库**（**GHDB**）等注册处。
- en: In addition to external assessments, the data gathered during this phase is
    perfect for building profiles for social engineering and physical engagements.
    The components discovered about an organization and its people, would provide
    an assessor the means to interact with the employees. This is done in hope that
    employees will divulge information or pretext it so that critical data can be
    extracted. For technical engagements, research done on job sites, company websites,
    regional blogs, and campus maps can help build word lists for dictionary attacks.
    Specific data sets such as the local sports teams, player names, street names,
    and company acronyms are often very popular as passwords.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 除了外部评估，此阶段收集的数据非常适合用于建立社会工程和物理接触的档案。关于组织及其人员的发现的组件，将为评估员提供与员工互动的手段。这样做是希望员工会透露信息或以假借名义提取关键数据。对于技术接触，对工作网站、公司网站、地区博客和校园地图的研究可以帮助建立字典攻击的单词列表。特定的数据集，如当地的体育队、球员姓名、街道名称和公司首字母缩写，通常作为密码非常受欢迎。
- en: Note
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Merriam Webster defines "pretext" as an alleged purpose or motive or an appearance
    assumed in order to cloak the real intention or state of affairs.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 韦氏词典将“借口”定义为所谓的目的或动机，或者为了掩盖真正意图或事态而假装的外表。
- en: Tools like Cewl can be used to extract words on these websites, and then, the
    words can be manipulated with John the Ripper to permutate the data, with character
    substitution. These lists are very useful for dictionary attacks against login
    interfaces, or for cracking extracted hashes from the organization.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 像Cewl这样的工具可以用来从这些网站上提取单词，然后可以使用John the Ripper对数据进行排列，进行字符替换。这些列表对于针对登录界面的字典攻击或破解从组织中提取的哈希非常有用。
- en: Note
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Permutation is very common with password attacks and interface password-guessing
    attacks. Merriam Webster defines "permutation" as one of the many different ways
    or forms in which something exists or can be arranged.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 排列在密码攻击和接口密码猜测攻击中非常常见。韦氏词典将“排列”定义为某物存在或可以排列的许多不同方式或形式之一。
- en: Other details that can be advantageous to an assessor are the technology that
    the organization lists in job advertisements, employee LinkedIn profiles, technical
    partnerships, and recent news articles. This will provide the assessor intelligence
    about the types of assets he/she may encounter and the major upgrades on the horizon.
    This allows the work done on site to be better targeted and researched prior to
    execution.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 对评估者有利的其他细节包括组织在招聘广告、员工LinkedIn个人资料、技术合作伙伴和最近的新闻文章中列出的技术。这将为评估者提供关于他/她可能遇到的资产类型和即将到来的主要升级的情报。这使得现场工作可以更有针对性，并且在执行之前可以进行更深入的研究。
- en: Threat modeling
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 威胁建模
- en: The third phase of PTES is threat modeling, and for most engagements, this phase
    is skipped. Threat modeling is more often part of a separate engagement that is
    to itemize potential threats that an organization may face on the basis of a number
    of factors. This data is used to help build case studies to identify real threats
    that would take advantage of the organization's vulnerabilities to manifest into
    risks. Often, the case studies are used to quantify specific penetration tests
    over a period of time to determine how resolute the security strategy is and what
    factors had not been considered.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: PTES的第三阶段是威胁建模，对于大多数参与来说，这个阶段被跳过了。威胁建模更常见地是作为一个单独的参与的一部分，用于列举组织可能面临的潜在威胁，基于多种因素。这些数据用于帮助建立案例研究，以识别真正的威胁，这些威胁会利用组织的漏洞转化为风险。通常，这些案例研究用于量化特定的渗透测试，以确定安全策略的坚定程度以及未被考虑的因素。
- en: The components for research are expanded outside of standard intelligence gathering
    to include associated business, business models, third parties, reputation, and
    news articles related to insightful topics. In addition to what is found, there
    are always particles that an assessor will not be able to determine due to time,
    exposure, and documented facts. Threat modeling is largely theoretical, but it
    is based on the indicators found and past incidents in the market that the business
    resides in.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 研究的组成部分扩展到标准情报收集之外，包括相关业务、业务模式、第三方、声誉和与见解性主题相关的新闻文章。除了已发现的内容外，总会有一些评估者无法确定的因素，这是由于时间、暴露和已记录的事实。威胁建模在很大程度上是理论性的，但它是基于发现的指标和市场上过去的事件。
- en: 'When threat modeling is used as part of a penetration test, the details from
    the intelligence gathering phase and the threat modeling phase are rolled back
    into the pre-engagement phase. The identified details help build an engagement
    and reveal the type of malicious actor that an assessor should be impersonating.
    Common types of threats that organizations face are as follows:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 当威胁建模作为渗透测试的一部分时，情报收集阶段和威胁建模阶段的细节被回溯到预参与阶段。确定的细节有助于建立一种参与并揭示评估者应该冒充的恶意行为者的类型。组织面临的常见威胁类型如下：
- en: Nation states
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 国家
- en: Organized crime
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有组织犯罪
- en: Hackers
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 黑客
- en: Script kiddies
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 脚本小子
- en: Hacktivists
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 骇客活动分子
- en: Insiders (intentional or unintentional)
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内部人员（有意或无意）
- en: Here are a couple of things to always keep in mind when assessing threats, any
    one of these types of threats can be an insider. All it takes is a single phishing
    e-mail, or one disgruntled employee who broadcasts credentials or accesses, for
    an organization to be open to compromise. Other ways that an insider may unintentionally
    provide access include technical forums, support teams, and blogs.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在评估威胁时，始终要记住以下几点，这些威胁中的任何一种都可能是内部人员。只需一封钓鱼邮件，或者一个不满的员工公布凭据或访问，组织就可能会面临威胁。内部人员可能无意中提供访问权限的其他方式包括技术论坛、支持团队和博客。
- en: Technical and administrative support teams frequent blogs, forums, and other
    locations, where they may post configurations or settings in search of help. Anytime
    this happens, internal data is exposed to the ether, and often, these configurations
    hold encrypted or unencrypted credentials, access controls, or other security
    features.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 技术和行政支持团队经常在博客、论坛和其他地方发布配置或设置以寻求帮助。每当这种情况发生时，内部数据就会暴露给外部，而且通常这些配置包含加密或未加密的凭据、访问控制或其他安全功能。
- en: So, does this mean that every organization is threatened by insiders, and the
    range of experience may not be limited to that of the actual insider? Insiders
    are also the hardest threat to mitigate. Most penetration tests do not include
    credentials to simulate an insider. In my experience, this is only done by an
    organization that has a mature security posture. This state is typically reached
    only through a variety of security assessments to include multiple threats simulated
    through penetration tests.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，这是否意味着每个组织都受到内部人员的威胁，而经验范围可能不仅限于实际内部人员？内部人员也是最难以减轻的威胁。大多数渗透测试不包括模拟内部人员的凭证。根据我的经验，只有具有成熟安全姿态的组织才会这样做。通常只有通过多种安全评估，包括通过渗透测试模拟多种威胁，才能达到这种状态。
- en: Most organizations do not support an internal credentialed assessment, unless
    they have had a number of uncredentialed engagements, where the findings have
    been mitigated. Even then, it is only by organizations that have a strong desire
    to simulate realistic threats with a Board-level buy-in. Besides insiders, the
    rest of the threats can be evaluated by looking at multiple factors; an example
    of past incident association can be found by looking at the Verizon **Data Breach
    Investigation Report** (**DBIR**).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数组织不支持内部凭证评估，除非他们经历了多次非凭证参与，发现已经得到了缓解。即使是这样，也只有那些有强烈愿望模拟真实威胁并得到董事会支持的组织才会这样做。除了内部人员，其他威胁可以通过查看多种因素来评估；过去事件的关联可以通过查看Verizon
    **数据泄露调查报告**（**DBIR**）找到一个例子。
- en: The Verizon DBIR uses reported compromises and aggregates the results to attribute,
    by market, the types of incidents that are the most frequently identified. This
    information should be taken in context though, as this is only for incidents that
    were caught or reported. Often, the caught incident may not have been the manner
    that initially led to the follow-on compromise.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Verizon DBIR使用报告的妥协并汇总结果，按市场归因于最常见的事件类型。然而，这些信息应该放在上下文中，因为这只是针对被捕获或报告的事件。通常，被捕获的事件可能不是最初导致后续妥协的方式。
- en: Threats to market change every year, so the results of a report created in one
    year would not be useful for research the following year. As such, any reader
    interested in this information should download a current version from [http://www.verizonenterprise.com/DBIR/](http://www.verizonenterprise.com/DBIR/).
    Additionally, make sure to choose which vector to simulate on the basis of additional
    research related to exposed information, and other reports. It would be unprofessional
    to execute an assessment on the basis of assumptions from a single form of research.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 市场的威胁每年都在变化，因此，一年创建的报告的结果对于下一年的研究是没有用的。因此，任何对这些信息感兴趣的读者都应该从[http://www.verizonenterprise.com/DBIR/](http://www.verizonenterprise.com/DBIR/)下载当前版本。此外，一定要选择基于其他相关信息和报告的额外研究来模拟哪个向量。基于单一形式的研究的假设执行评估是不专业的。
- en: Most of the time, organizations already know what type of engagement they need
    or want. The interaction of this phase and the described research is typically
    what is requested from industry experts, and not from new assessors. So, do not
    be surprised if stepping into doing this work, you see few requests to do assessments
    that include this phase of work, at least initially.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数时候，组织已经知道他们需要或想要什么类型的参与。这个阶段的互动和描述的研究通常是行业专家所要求的，而不是新的评估者。因此，如果你开始做这项工作时，看到很少有要求包括这个工作阶段的评估，至少最初不要感到惊讶。
- en: Vulnerability analysis
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 漏洞分析
- en: Up until this phase, most, if not all, of the research done has not touched
    an organizational resource; instead, the details have been extracted from other
    repositories. In the fourth phase of PTES, the assessor is about to identify viable
    targets for further research Testing. This deals directly with port scans, banner
    grabs, exposed services, system and service responses, and version identification.
    These items though seemingly minute, are the fulcrum for gaining access to an
    organization.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 直到这个阶段，大多数，如果不是所有的研究都没有触及组织资源；相反，细节是从其他存储库中提取的。在PTES的第四阶段，评估者将要确定进一步研究测试的可行目标。这直接涉及端口扫描、横幅抓取、暴露的服务、系统和服务响应以及版本识别。这些项目虽然看似微小，但却是获取对组织的访问的支点。
- en: The secret to becoming a great assessor from a technical perspective lies in
    this phase. The reason for this is that the majority of an assessor's time is
    spent here, particularly early in one's career. Assessors research what is exposed,
    what vulnerabilities are viable, and what methods can be used to exploit these
    systems. Assessors who spend years doing this are the ones you will often see
    speeding through this phase because they have the experience to find methods to
    target attacks and gain access. Do not be fooled by this, as for one, they have
    spent many years cataloging this data through experience and two, there are always
    occasions where even a great assessor will spend hours in this phase because an
    organization may have a unique or hardened posture.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 从技术角度成为一名优秀的评估者的秘诀就在于这个阶段。原因是评估者大部分时间都在这里度过，特别是在职业生涯的早期。评估者研究暴露了什么，哪些漏洞是可行的，以及可以用什么方法来利用这些系统。花了多年时间做这个工作的评估者通常会在这个阶段加速，因为他们有经验找到目标攻击和获取访问的方法。不要被这个所迷惑，因为首先，他们通过经验花了很多年时间整理这些数据，其次，总会有情况，即使是一名优秀的评估者也会在这个阶段花费数小时，因为一个组织可能有独特或强化的姿态。
- en: The great secret of penetration testing, which is usually not relayed in movies,
    magazines, and/or books, is that penetration testing is primarily research, grinding,
    and report writing. If I had to gauge the average percentage of time that a good
    new assessor spends during an engagement, 70 percent would be on research or grinding
    to find applicable targets or a viable vulnerability, 15 percent on communication
    with the client, 10 percent on report writing, and 5 percent on exploitation.
    As mentioned though, these percentages shift as assessors gain more experience.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试的伟大秘密通常不会在电影、杂志和/或书籍中传达，即渗透测试主要是研究、磨砺和撰写报告。如果我必须估计一名优秀的新评估者在参与过程中花费的平均时间百分比，70%将用于研究或磨砺以找到适用的目标或可行的漏洞，15%用于与客户的沟通，10%用于撰写报告，5%用于利用。尽管如此，随着评估者获得更多经验，这些百分比会发生变化。
- en: Most assessors who fail or have a bad engagement are caused by pushing through
    the phases, and not executing competent research. The benefit of spending the
    required time here is that the next phase related to exploitation will flow very
    quickly. One thing that assessors and malicious actors both know is that once
    a foothold in the organization has been grabbed, it is basically over. [Chapter
    3](ch03.html "Chapter 3. Identifying Targets with Nmap, Scapy, and Python"), *Identifying
    Targets with Nmap, Scapy, and Python*, covers activities completed in this phase
    at length.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数失败或遭遇糟糕的评估者都是因为在各个阶段上推进，而不是执行有能力的研究。在这里花费所需的时间的好处是与利用相关的下一个阶段将非常迅速。评估者和恶意行为者都知道的一件事是，一旦在组织中占据了立足点，基本上就结束了。[第三章](ch03.html
    "第三章。使用Nmap、Scapy和Python识别目标")*使用Nmap、Scapy和Python识别目标*详细介绍了在这个阶段完成的活动。
- en: Exploitation
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 利用
- en: Phase five is the exploitation phase, and this is where the fun really begins.
    Most of the chapters focus on the previous phase's vulnerability analysis, or
    this phase. This phase is where all the previous work has led to actually gaining
    access to a system. Common terms for gaining system access are popped, shelled,
    cracked, or exploited. When you hear or read these terms, you know that you should
    be gaining access to a system.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 第五阶段是利用阶段，这才是真正开始有趣的地方。大多数章节都集中在前一阶段的漏洞分析，或者这个阶段。这个阶段是所有之前工作的结果，实际上获得对系统的访问权限。获得系统访问权限的常见术语是popped、shelled、cracked或exploited。当您听到或读到这些术语时，您就知道自己应该获得对系统的访问权限。
- en: Exploitation does not just mean access to a system via a piece of code, remote
    exploit, creation of an exploit, or bypassing antivirus. It could be as simple
    as logging into a system directly with default or weak credentials. Though many
    newer assessors look at this as less desirable, experienced assessors try and
    find ways to access hosts through native protocols and accesses. This is because
    native access is less likely to be detected and it is closer to the real activity
    that a malicious actor may be performing.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 利用不仅仅意味着通过一段代码、远程利用、创建利用程序或绕过防病毒软件来访问系统。它也可能是直接使用默认或弱凭证登录系统。尽管许多新评估者认为这不太理想，但经验丰富的评估者会尝试找到通过本机协议和访问方式访问主机的方法。这是因为本机访问不太可能被检测到，而且它更接近恶意行为者可能正在执行的真实活动。
- en: 'If you are new to penetration testing, there are some specific times during
    exploitation where you will be very excited, and these are often looked at as
    goals:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您是新手渗透测试人员，在利用过程中会有一些特定的时刻让您非常兴奋，这些通常被视为目标：
- en: The first time you gain a shell
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次获得shell
- en: The first time you exploit each of the OWASP top 10 vulnerabilities
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次利用OWASP前10名漏洞
- en: The first time you write your own exploit
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次编写自己的利用程序
- en: The first time you find a zero day
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次发现零日漏洞
- en: These so-called goals are typically measuring sticks for experience among assessors,
    and even within organizational teams. After you have achieved these first-time
    exploit goals, you will be looking to expand your skills to even higher levels.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 这些所谓的目标通常是评估者经验的衡量标准，甚至在组织团队内部也是如此。在实现了这些首次利用目标之后，您将会努力提升自己的技能水平。
- en: Once you have gained access to a system, you need to do something with that
    access. When looking at the difference between seasoned professionals and the
    new assessors in the field, the delineation is not exploitation, but post exploitation.
    The reason for this is that initial access does not get you to the data, but the
    follow-on, the pivot, and the post exploitation typically does.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您获得对系统的访问权限，您需要利用这种访问权限。在观察资深专业人员和新的评估者之间的区别时，不是利用，而是后期利用。原因在于初始访问并不能让您获得数据，而后续的枢轴和后期利用通常可以。
- en: Note
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A pivot is the method of taking advantage of a new position during an assessment
    to assess resources that are normally not accessible. Most people equate pivoting
    to setting up a route in Metasploit, but it also relates to attacking or assessing
    resources from a different compromised device.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 枢轴是在评估过程中利用新位置来评估通常无法访问的资源的方法。大多数人将枢轴等同于在Metasploit中设置路由，但它也与从不同的受损设备攻击或评估资源有关。
- en: Post exploitation
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 后期利用
- en: Out of all phases, this is where you see a shift in the time spent by assessors.
    New assessors usually spend more time in phase four or the vulnerability analysis
    phase, while seasoned assessors spend an enormous amount of time here. Phase six
    is also known as the post exploitation phase; the escalation of privileges, hunting
    for credentials, extraction of data, and pivoting are all done here.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有阶段中，这是评估者花费时间的变化。新评估者通常在第四阶段或漏洞分析阶段花费更多时间，而经验丰富的评估者在这里花费了大量时间。第六阶段也被称为后期利用阶段；权限升级、寻找凭证、提取数据和枢轴都在这里完成。
- en: This is where an assessor has the opportunity to prove risk to an organization
    by proving the level of access achieved, the amount and type of critical data
    accessed, and the security controls bypassed. All of this is typified in the post
    exploitation phase.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 这是评估者有机会通过证明所达到的访问级别、访问的关键数据的数量和类型，以及绕过的安全控制来证明对组织的风险。所有这些都是后期利用阶段的典型特征。
- en: Just like phase five, phase six has specific events that are typically goals
    for newer assessors. Just like exploitation goals, once these post exploitation
    goals have been completed, you will be shooting for even more complex achievements
    in this security specialization.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 就像第五阶段一样，第六阶段有特定的事件通常是新评估者的目标。就像利用目标一样，一旦完成了这些后期利用目标，您将会追求在这个安全专业领域中更复杂的成就。
- en: 'The following are examples of these measuring sticks between new assessors
    and competent assessors:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是新评估者和有能力的评估者之间的衡量标准的例子：
- en: The first time you manually elevate your privileges on Windows, Linux, Unix,
    or Mac Operating System
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次在Windows、Linux、Unix或Mac操作系统上手动提升权限
- en: The first time you gain Domain Administrator access
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次获得域管理员访问权限
- en: The first time you modify or generate a Metasploit module
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一次修改或生成Metasploit模块
- en: The post exploitation phase includes activities related to escalating privileges,
    extracting data, profiling, creating persistence, parsing user data and configurations,
    and clean-up. All activities performed after a system has been accessed and transitions
    to system examination relate to post exploitation. Once an engagement is over,
    all the access levels achieved, the critical data accessed, and the security controls
    bypassed are highlighted in a single document, the report.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 后期利用阶段包括与提升权限、提取数据、配置文件、创建持久性、解析用户数据和配置以及清理相关的活动。在系统被访问后执行的所有活动，并转移到系统检查阶段都与后期利用有关。一旦评估结束，所达到的所有访问级别、访问的关键数据和绕过的安全控制都会在一份报告中得到突出显示。
- en: Reporting
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 报告
- en: The most important phase related to penetration testing not just with PTES is
    reporting. At the end of the day, your client is requesting and paying for a report.
    The only thing he/she can hold in his/her hands at the end of the engagement is
    the report. The report is also what translates the risks that the assessor identified
    in the environment.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 与渗透测试相关的最重要阶段不仅仅是PTES，还有报告。在一天结束时，您的客户要求并支付的是一份报告。在参与结束时，他/她能拿到手的只有报告。报告也是将评估员在环境中确定的风险转化为语言的工具。
- en: A good report has an executive summary, which targets personnel who are part
    of the Chief suite and or the Advisory Board. It should also contain a storyline
    to explain what was done during the engagement, the actual security findings or
    weaknesses, and the positive controls that the organization has established. Each
    noted security finding should include a proof of concept when possible.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 一份好的报告应包括一份针对首席套房人员和/或咨询委员会的执行摘要。它还应包括一个故事情节，解释在参与过程中所做的事情，实际的安全发现或弱点，以及组织已建立的积极控制。每个注意到的安全发现都应在可能的情况下包括一个概念验证。
- en: A proof of concept is just that; you are proving the existence of an exception
    to a secure state through exploitation. So, each identified finding should include
    a screen capture related to the activity conducted, such as weak passwords, exploited
    systems, and critical data accessed.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 概念验证就是这样；通过利用来证明存在安全状态的例外。因此，每个确定的发现都应包括与所进行的活动相关的屏幕截图，例如弱密码、被利用的系统和访问的关键数据。
- en: Just like the security findings identified in the organization, any positive
    findings need to be noted and described. The positive findings help to tell an
    organization what has actually impacted a simulated malicious actor. It also tells
    an organization where it should keep its investments, as the report and the engagement
    provide tangible proof that it is working.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 与组织中确定的安全发现一样，任何积极的发现都需要被记录和描述。积极的发现有助于告诉组织实际上对模拟恶意行为产生了什么影响。它还告诉组织应该在哪里进行投资，因为报告和参与提供了它正在起作用的有形证据。
- en: An example engagement
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一个示例参与
- en: The following section highlights how an assessor achieves access, elevates privileges,
    and potentially gains access to critical data at a high level. This example should
    provide the context for the tools covered in the rest of this chapter and the
    following chapters. It should be noted that phases four, five, and six or the
    vulnerability analysis, exploitation, and post exploitation phases, respectively,
    of PTES are repetitive. Each one of these phases will be executed throughout an
    assessment. To better highlight this, the following scenario is a very common
    exploit train conducted by newer assessors today, which shows what tools are used.
    This is not to show how to complete the commands to complete this on your own,
    but to highlight the phase flow, and the tools used for each phase can be nebulous.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 以下部分突出了评估员如何在高层次上实现访问、提升权限，并可能获得对关键数据的访问。这个示例应该为本章和接下来的章节涵盖的工具提供背景。需要注意的是，PTES的第四、五和六阶段，即漏洞分析、利用和后利用阶段，是重复的。这些阶段中的每一个都将在评估过程中执行。为了更好地突出这一点，以下情景是今天新评估员进行的非常常见的利用训练，显示了使用了哪些工具。这不是为了展示如何自行完成这些命令，而是为了突出阶段流程，以及每个阶段使用的工具可能是模糊的。
- en: As an assessment is conducted, an assessor will identify vulnerabilities, exploit
    them as needed, and then escalate privileges and extract data after exploitation
    or post exploitation. Sometimes, a single action may be considered a combination
    of vulnerability analysis and exploitation, or exploitation and post exploitation
    phase activities. As an example of repetitive steps, after an assessor identifies
    a Windows XP host and determines whether it has the vulnerability MS08-067, the
    assessor exploits it with the associated Metasploit module called `ms08_067`.
    The assessor will escalate privileges and then extract hashes from the exploited
    system by using the `smart_hashdump` module. The assessor will then copy the local
    administrator hash from the extracted hashes, which is correlated to the **Security
    Identifier** (**SID**) of 500 stored in the `pwdump` hash format.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行评估时，评估员将识别漏洞，根据需要利用它们，然后在利用或后利用后提升权限并提取数据。有时，单个操作可能被视为漏洞分析和利用的组合，或利用和后利用阶段的活动。作为重复步骤的示例，评估员识别了一个Windows
    XP主机，并确定它是否存在漏洞MS08-067，然后使用相关的Metasploit模块`ms08_067`对其进行利用。评估员将提升权限，然后使用`smart_hashdump`模块从被利用系统中提取哈希。然后，评估员将从提取的哈希中复制本地管理员哈希，该哈希与存储在`pwdump`哈希格式中的**安全标识符**（**SID**）500相关联。
- en: The assessor will scan all the hosts in the area and determine whether the hosts
    have port 445 open by using the `nmap` tool. These may be viable targets for a
    **Pass-the-Hash** (**PtH**) attack, but the assessor has to determine whether
    these hosts have the same local administrator password. So, the assessor creates
    a list of IP addresses with the open port 445 **Server Message Block** (**SMB**)
    over IP, by parsing the output with the Unix/Linux tools cat, grep, and cut. With
    this list, the assessor executes an SMB login with the `smb_login` Metasploit
    module against all the hosts in the newly created list, with the local administrator
    hash, and the Domain set to `WORKGROUP`.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 评估员将扫描该区域的所有主机，并使用`nmap`工具确定主机是否开放端口445。这些可能是**传递哈希**（**PtH**）攻击的可行目标，但评估员必须确定这些主机是否具有相同的本地管理员密码。因此，评估员通过使用Unix/Linux工具cat、grep和cut解析输出，创建一个具有开放端口445的IP地址列表**服务器消息块**（**SMB**）通过IP。有了这个列表，评估员使用`SMB_login`
    Metasploit模块对新创建的列表中的所有主机执行SMB登录，使用本地管理员哈希，并将域设置为`WORKGROUP`。
- en: Each host that responds with a successful login would be a viable target for
    a PtH attack. The assessor has to find a host with new information or critical
    data that would be beneficial for the engagement to move forward. Since the assessor
    has a foothold on the network through the Windows XP box, he/she would just need
    to find out who the Domain Administrators are and where they are logged in.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 每个响应成功登录的主机都将是PtH攻击的可行目标。 评估员必须找到具有新信息或关键数据的主机，这将有利于推进参与。 由于评估员通过Windows XP主机在网络上建立了立足点，他/她只需要找出域管理员是谁以及他们在哪里登录。
- en: So, he/she would query members of the Domain Admins group from the Domain that
    the Windows XP host was attached to with the `enum_domain_group_users` Metasploit
    module. The assessor could then identify where the Domain Admins were logged into
    with the community Metasploit module called `loggedin_users` or the built-in modules
    called `psexec_loggedin_users or enum_domain_users`. Hosts that had responded
    with a successful login message from the `smb_login` module would be tested with
    either of the modules and the relevant domain name. The hosts that responded with
    the username of one of the Domain Administrators on it would be the best place
    to exploit. The assessor could then execute a PtH attack and drop a payload on
    the box with the `psexec` Metasploit module. This would be done with the same
    local administrator hash and domain set to `WORKGROUP`.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，他/她将使用`enum_domain_group_users` Metasploit模块从Windows XP主机所连接的域中查询域管理员组的成员。
    评估员随后可以使用名为`loggedin_users`的community Metasploit模块或名为`psexec_loggedin_users`或`enum_domain_users`的内置模块来确定域管理员登录的位置。
    通过`smb_login`模块从主机收到成功登录消息的主机将使用任一模块和相关域名进行测试。 在其中响应具有一个域管理员用户名的主机将是最佳的攻击位置。 评估员随后可以使用`psexec`
    Metasploit模块执行PtH攻击并在该主机上放置有效载荷。 这将使用相同的本地管理员哈希和域设置为`WORKGROUP`进行。
- en: Once a foothold was established on that system, the assessor can determine whether
    the Domain Administrator was logged into the system currently or had done so in
    the past. The assessor could query the system and identify the currently logged
    in users, and if they were active. If the user was currently active in the session,
    the assessor could set up a key logger with Metasploit and lock the screen with
    the smartlocker module. This used to be broken up into multiple modules in the
    past, but today, we are efficient. When the user unlocked the screen, he/she would
    enter the credentials for the account and in turn provide them to the assessor.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦在该系统上建立了立足点，评估员就可以确定域管理员当前是否已登录到系统，或者过去是否曾登录过。 评估员可以查询系统并识别当前登录的用户，以及他们是否活跃。
    如果用户当前在会话中活跃，评估员可以使用Metasploit设置键盘记录器，并使用smartlocker模块锁定屏幕。 过去，这曾被分解为多个模块，但今天，我们更加高效。
    当用户解锁屏幕时，他/她将输入帐户的凭据，然后将其提供给评估员。
- en: If the user was not currently active, the assessor could try and extract the
    credentials from memory with tools like Mimikatz, by loading the capability into
    the Meterpreter session with `load mimikatz` and running `wdigest`. If no credentials
    were in memory, the assessor could try and impersonate the user by stealing a
    token that remained in memory for the cached credentials by loading the Incognito
    tool into Meterpreter with the `load incognito` command. Using this access, the
    assessor could then create a new user on the domain and then add the user to the
    Domain Admins group on Domain Controller. To identify the applicable domain controller,
    the assessor would ping the domain name, which would respond with the IP of the
    DC.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 如果用户当前未活跃，评估员可以尝试使用Mimikatz等工具从内存中提取凭据，通过将该功能加载到Meterpreter会话中并运行`wdigest`。
    如果内存中没有凭据，评估员可以尝试通过加载Incognito工具到Meterpreter中并使用`load incognito`命令窃取仍在内存中的缓存凭据的令牌来冒充用户。
    利用这种访问权限，评估员随后可以在域上创建一个新用户，然后将该用户添加到域控制器上的域管理员组中。 为了确定适用的域控制器，评估员将ping域名，该域名将响应DC的IP地址。
- en: 'Finally, the assessor could create his/her new malicious user with the `add_user`
    command and `add_group_user` to the Domain Admins group pointed to the DC IP with
    the `-h` flag. This Domain Administrator may provide additional accesses around
    the network or have the ability to create and/or modify an additional account
    with the relevant accesses as needed. As you can see in these steps, there were
    multiple examples of the three phases that repeat. Go through the following list
    to see how each activity applies to a specific phase:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，评估员可以使用`add_user`命令和`add_group_user`将其新的恶意用户添加到指向DC IP的域管理员组中。 这个域管理员可能会在网络周围提供额外的访问权限，或者具有创建和/或修改其他帐户的能力，并根据需要提供相关访问权限。
    从这些步骤中可以看出，有多个重复的三个阶段的示例。 通过以下列表，了解每个活动如何适用于特定阶段：
- en: Identify Windows XP host (vulnerability analysis).
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别Windows XP主机（漏洞分析）。
- en: Determine whether the Windows XP host is vulnerable to MS08-067 (vulnerability
    analysis).
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定Windows XP主机是否容易受到MS08-067的攻击（漏洞分析）。
- en: Exploit the Windows XP host with Metasploit's MS08-067 exploit (exploitation).
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Metasploit的MS08-067漏洞攻击Windows XP主机（利用）。
- en: Extract hashes from Windows XP hosts (post exploitation).
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从Windows XP主机中提取哈希（后期利用）。
- en: Scan all other hosts for SMB over IP or port 445 (vulnerability analysis).
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 扫描所有其他主机，以查找SMB over IP或端口445（漏洞分析）。
- en: Execute an SMB login with the local administrator hash to identify vulnerable
    hosts (vulnerability analysis/exploitation).
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用本地管理员哈希执行SMB登录以识别易受攻击的主机（漏洞分析/利用）。
- en: Query Domain Controller for members of the Domain Admins group on the Windows
    XP system (post exploitation).
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查询域控制器，以查找Windows XP系统上域管理员组的成员（后期利用）。
- en: Identify logged in users on systems with the same local administrator hash as
    the Windows XP box, to identify where a Domain Administrator is logged in (exploitation/post
    exploitation).
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别具有与Windows XP主机相同的本地管理员哈希的系统上已登录的用户，以确定域管理员的登录位置（利用/后期利用）。
- en: Execute a PtH attack against systems with Domain Admins that are logged in (exploitation).
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对已登录的域管理员进行PtH攻击（利用）。
- en: 'Determine what state of activity the Domain Administrator is on the box (post
    exploitation):'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定域管理员在该计算机上的活动状态（后期利用）：
- en: If logged in currently, set up a key logger (post exploitation)
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果当前已登录，请设置键盘记录器（后期利用）
- en: Lock the screen (exploitation/post exploitation)
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 锁定屏幕（利用/后期利用）
- en: If the credentials are in memory, steal them with Mimikatz, which is a tool
    that we highlight below (post exploitation)
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果凭据在内存中，请使用Mimikatz窃取它们，这是我们在下面介绍的一个工具（后期利用）
- en: If tokens are in memory from a cached session steal them with Incognito (post
    exploitation)
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果令牌在内存中来自缓存会话，请使用Incognito窃取它们（后期利用）
- en: Identify Domain Controller by pinging Domain (vulnerability analysis).
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过ping域来识别域控制器（漏洞分析）。
- en: Create a new user on Domain Controller from the compromised system (post exploitation).
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从受损系统在域控制器上创建新用户（后期利用）。
- en: Add the new user to the Domain Admins group from the compromised system (post
    exploitation).
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从受损系统将新用户添加到域管理员组（后期利用）。
- en: Identify new locations of critical data that can be accessed (vulnerability
    analysis).
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别可以访问的关键数据的新位置（漏洞分析）。
- en: Now, experienced assessors will often complete the necessary activity related
    to the vulnerability analysis and catalog the data early if they can. So, creating
    lists of hosts with port 445 open, the DC IP address, and other details would
    have been done early on in the assessment. This way if the engagement is part
    of a Double Blind assessment, the assessor can move quickly to gain privileged
    access before he/she is caught. Now that the methodology and organization of an
    assessment has been laid out, we need to look at what tools are used currently.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，经验丰富的评估员通常会在可能的情况下完成与漏洞分析相关的必要活动，并及早编目数据。因此，在评估的早期阶段，会创建具有开放端口445、DC IP地址和其他详细信息的主机列表。这样，如果参与的是双盲评估的一部分，评估员可以在被发现之前迅速获得特权访问。现在，评估的方法和组织已经确定，我们需要看看目前使用的工具。
- en: Penetration testing tools
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试工具
- en: The following are some of the most common tools used during an engagement, with
    examples of how and when they are supposed to be used. Many of these tools are
    further explained, with additional examples after [Chapter 2](ch02.html "Chapter 2. The
    Basics of Python Scripting"), *The Basics of Python Scripting*. We cannot cover
    every tool in the market, and the specific occurrences for when they should be
    used, but there are enough examples here to provide a solid foundation of knowledge.
    More than one line may be needed to display command examples that are extra-long,
    in this book. These commands will have the *\* character to designate a new line.
    If these commands are copied and pasted, they will function just fine because
    in Linux and Unix, a command is continued after a carriage return.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在参与过程中使用的一些常见工具，以及它们应该如何和何时使用的示例。这些工具中的许多都有进一步的解释，在[第2章](ch02.html "第2章。Python脚本的基础")之后，*Python脚本的基础*。我们无法涵盖市场上的每个工具，以及它们应该何时使用的具体情况，但这里有足够的示例来提供扎实的知识基础。在本书中，可能需要多行来显示特别长的命令示例。这些命令将使用*\*字符来指示新行。如果这些命令被复制和粘贴，它们将正常运行，因为在Linux和Unix中，命令在回车后继续。
- en: These have also been organized on the basis of what you will most likely get
    the most use out of. After reviewing these tools, you will know what is in the
    market and see the potential gaps where custom Python scripts or tools may be
    needed. Often, these scripts are just bridging agents to parse and output the
    details needed in the correct format. Other times, they automate tedious and laborious
    processes; keep these factors in mind as you read ahead.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 这些工具也是根据您最有可能获得最大利用价值的基础进行组织的。在审查这些工具之后，您将了解市场上有什么，并看到可能需要自定义Python脚本或工具的潜在空白。通常，这些脚本只是解析和以正确格式输出所需细节的桥梁代理。其他时候，它们自动化了繁琐和费力的过程；在阅读时请记住这些因素。
- en: NMAP
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: NMAP
- en: '**Network Mapper** (**Nmap**) is one of the first tools that were created for
    administrators and security professionals. It provides some of the best capabilities
    in the industry to quickly analyze targets and determine whether they have open
    ports and services that could be exploited. Not only does the tool provide us
    as security professionals additional capabilities related to Luna scripts, which
    can act as a small VMS, but they also provide the means to exploit a system.'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络映射器**（**Nmap**）是为管理员和安全专业人员创建的第一批工具之一。它提供了行业内一些最好的功能，可以快速分析目标，并确定它们是否有可以被利用的开放端口和服务。该工具不仅为我们安全专业人员提供了与Luna脚本相关的额外功能，它们可以充当小型VMS，而且还提供了利用系统的手段。'
- en: 'As if all this was not enough to make Nmap a staple for assessors'' and engineers''
    toolkits, the Nmap Security Scanner Project and [http://insecure.org/](http://insecure.org/)
    have set up a site for people who need to run a few test scans a day at [http://scanme.nmap.org/](http://scanme.nmap.org/).
    In addition to allowing new assessors a chance to execute a couple of scans a
    day, this site is good to see what ports are accessible from within an organization.
    If you want to test this out yourself, try a standard full connection **Transmission
    Control Protocol** (**TCP**) port scan against the site. Additional details related
    to Nmap will be discussed in [Chapter 3](ch03.html "Chapter 3. Identifying Targets
    with Nmap, Scapy, and Python"), *Identifying Targets with Nmap, Scapy, and Python*.
    The following example shows how to do one against the top 10 ports open on the
    Internet (please read the advisory on their website prior to executing this scan):'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 就像这些还不足以使Nmap成为评估者和工程师工具包中的必备工具一样，Nmap安全扫描器项目和[http://insecure.org/](http://insecure.org/)已经为需要每天运行几次测试扫描的人设置了一个网站[http://scanme.nmap.org/](http://scanme.nmap.org/)。除了允许新的评估者每天执行几次扫描外，这个网站还可以查看组织内部可访问的端口。如果您想自己测试一下，请尝试对该网站进行标准的全连接**传输控制协议**（**TCP**）端口扫描。有关Nmap的其他详细信息将在[第3章](ch03.html
    "第3章。使用Nmap、Scapy和Python识别目标")中讨论，*使用Nmap、Scapy和Python识别目标*。以下示例显示了如何对互联网上开放的前10个端口进行扫描（在执行此扫描之前，请阅读他们网站上的警告）：
- en: '[PRE0]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Metasploit
  id: totrans-164
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Metasploit
- en: In 2003, H.D. Moore created the famous Metasploit Project, originally coded
    in Perl. By 2007, the framework was recoded completely in Ruby; by October 2009,
    he sold it to Rapid7, the creators of Nexpose. Many years later, the framework
    is still a freely available product thanks to stipulations of the sale made by
    H.D. Moore. From the framework, Rapid7 has created a professional product, aptly
    called Metasploit Pro.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 2003年，H.D. Moore创建了著名的Metasploit项目，最初是用Perl编写的。到2007年，该框架完全改用Ruby重新编码；到2009年10月，他将其出售给了Nexpose的创建者Rapid7。多年后，由于H.D.
    Moore的出售规定，该框架仍然是一个免费的产品。Rapid7从该框架中创建了一个专业产品，名为Metasploit Pro。
- en: The Pro solution has a number of features that the framework does not, such
    as integration into Nexpose, native **Intrusion Prevention System** (**IPS**)
    bypassing payloads, a web **Graphical User Interface** (**GUI**), and multiuser
    capability. These extra features come at a substantial price, but depending on
    your market, some customers require all tools to be paid for, so keep the Pro
    version in mind. If you have no need to pay for Metasploit, and the additional
    features are not needed, the framework will suffice.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 专业版解决方案具有一些框架没有的功能，例如与Nexpose的集成、本地**入侵防御系统**（**IPS**）绕过有效载荷、Web**图形用户界面**（**GUI**）和多用户功能。这些额外功能的价格相当昂贵，但根据您的市场，一些客户要求所有工具都需要付费，因此请记住专业版。如果您不需要为Metasploit付费，也不需要额外的功能，那么框架就足够了。
- en: Remember that the IPS bypass tool within Metasploit Pro has a number of different
    evasion methods built in. One of the features is that the structure of the exploit
    code is slightly different each time. So, if the IPS bypass fails one time, it
    may work a second time against the same host by just rerunning it. This does not
    mean that if you run it 10 different times, you are going to get it right the
    10th time if the first nine failed. So, be aware and learn the error messages
    related to `psexec` and the exploitation of systems.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，Metasploit Pro中的IPS绕过工具内置了许多不同的规避方法。其中一个特点是利用代码的结构每次略有不同。因此，如果IPS绕过一次失败，可能在同一台主机上再次运行时成功。这并不意味着如果您运行了10次，前九次失败了，第十次就一定会成功。因此，请注意并学习与`psexec`和系统利用相关的错误消息。
- en: 'An entire assessment can be run from Metasploit if needed; this is not suggested,
    but the tool is just that capable. Metasploit is modular; in fact, the components
    within Metasploit are called modules. There are broad groupings of modules, broken
    out into the following:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要的话，可以从Metasploit运行整个评估；虽然不建议这样做，但工具确实有这个能力。Metasploit是模块化的；事实上，Metasploit中的组件被称为模块。模块分为以下几类：
- en: Auxiliary modules
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 辅助模块
- en: Exploit modules
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用模块
- en: Post modules
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 后置模块
- en: Payload modules
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有效载荷模块
- en: NOP modules
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NOP模块
- en: Encoder modules
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编码器模块
- en: Auxiliary modules include scanners, brute forcers, vulnerability assessment
    tools, and server simulators. Exploits are just that, tools that can be run to
    exploit an interface service or another solution. Post modules are intended to
    elevate privileges, extract data, or interact with the current users on the system.
    Payloads provide an encapsulated delivery tool that can be used once access to
    a system is gained. When you configure an exploit module, you typically have to
    configure a payload module so that a shell will be returned.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 辅助模块包括扫描器、暴力破解器、漏洞评估工具和服务器模拟器。利用模块就是可以运行以利用接口服务或其他解决方案的工具。后置模块旨在提升权限、提取数据或与系统上的当前用户交互。有效载荷提供了一种封装的交付工具，一旦获得对系统的访问权限就可以使用。当配置利用模块时，通常需要配置有效载荷模块，以便返回一个shell。
- en: '**No Operation** (**NOP**) modules generate operations that do nothing for
    specific hardware architectures. These can be very useful when creating or modifying
    exploits. The last module type in Metasploit is the Encoder module. There is a
    huge misunderstanding with encoders and what they are used for. The reality is
    they are used to make the execution of payloads more reliable by changing the
    structure of the payload to remove certain types of characters. This reformats
    the operational codes of the original payload and makes the payload larger, sometimes
    much larger.'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '**无操作**（**NOP**）模块生成对特定硬件架构无效的操作。在创建或修改利用时，这些模块非常有用。Metasploit中的最后一种模块类型是编码器模块。对编码器的用途存在着巨大的误解。事实上，它们用于通过改变有效载荷的结构来使有效载荷的执行更加可靠，以去除某些类型的字符。这会重新格式化原始有效载荷的操作码，并使有效载荷变得更大，有时甚至更大。'
- en: Occasionally, this change in the payload structure means that it will bypass
    IPS that relies strictly on specific signatures. This causes many assessors to
    believe that the encoding was for bypass antivirus; this is just a by-product
    of encoding, not the intent. Today, encoding rarely bypasses enterprise grade
    IPS solutions. Other products like Veil provide a much more suitable solution
    to this quagmire. Since most exploits can reference external payloads, it is best
    to look to external solutions like Veil even if you are using the Pro version
    of Metasploit. There will be times when the Metasploit Pro's IPS bypassing capability
    will not work; during such times, other tools may be needed. Metasploit will be
    covered in detail in the other chapters of this book.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 偶尔，负载结构的变化意味着它将绕过严格依赖特定签名的IPS。这导致许多评估者认为编码是为了绕过防病毒软件；这只是编码的副产品，而不是意图。今天，编码很少绕过企业级IPS解决方案。像Veil这样的其他产品为这个困境提供了更合适的解决方案。由于大多数利用可以引用外部负载，最好寻求像Veil这样的外部解决方案，即使你使用的是Metasploit的专业版。在某些情况下，Metasploit
    Pro的IPS绕过能力将无法使用；在这种情况下，可能需要其他工具。Metasploit将在本书的其他章节中详细介绍。
- en: Veil
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Veil
- en: This antivirus evasion suite has multiple methods to generate payloads. These
    payload types utilize methods that experienced assessors and malicious actors
    have used manually for years. This includes encrypting payloads with **Advanced
    Encryption Standard** (**AES**), encoding them, and randomizing variable names.
    These details can then be wrapped in PowerShell or Python scripts to make life
    even easier.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 这个防病毒软件逃避套件有多种方法来生成负载。这些负载类型利用了有经验的评估者和恶意行为者多年来手动使用的方法。这包括使用**高级加密标准**（**AES**）加密负载，对它们进行编码，并随机化变量名称。然后可以将这些细节包装在PowerShell或Python脚本中，以使生活更加轻松。
- en: Veil can be launched by a **Command Line Interface** (**CLI**) or a console
    similar to Metasploit. For example, the following command shows the usage of the
    CLI that creates a PyInjector exploit, which dials back to the listening host
    on port 80; make sure that you replace "yourIP" with your actual IP if you wish
    to test this.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: Veil可以通过**命令行界面**（**CLI**）或类似于Metasploit的控制台启动。例如，以下命令显示了创建一个PyInjector利用的CLI的用法，它拨打回监听主机的80端口；如果你想测试这个，确保你用你的实际IP替换"yourIP"。
- en: '[PRE1]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Now, go ahead and launch your Metasploit console and start up a listener with
    the following commands. This will launch the console; make sure that you wait
    for it to boot up. Further, it sets up a listener on your host, so make sure that
    you replace "yourIP" with your actual IP address. The listener will run in the
    background waiting for the returned session.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，继续启动你的Metasploit控制台，并使用以下命令启动监听器。这将启动控制台；确保等待它启动。此外，它在你的主机上设置了一个监听器，所以确保你用你的实际IP地址替换"yourIP"。监听器将在后台运行，等待返回的会话。
- en: '[PRE2]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Move the payload over to a target Windows system and run the payload. You should
    see a session generated on your Kali host as long as there are no configuration
    issues, no other services running on the listening host's port 80, and nothing
    blocking the connection to port 80 between the exploited host and the listener.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 将负载移动到目标Windows系统并运行负载。只要没有配置问题，监听主机的端口80上没有其他服务运行，并且没有阻止被利用主机和监听器之间连接到端口80的任何东西，你应该会在你的Kali主机上看到一个会话生成。
- en: So, if you have these custom exploits, how do you use them with real Metasploit
    exploits? Simple, just adjust the variable to point to them. Here is an example
    using the `psexec` module in Metasploit. Make sure that you change the targetIP
    to the target Windows system. Set the username of the local administrator on the
    system and the password of the local administrator on the system. Finally, set
    the custom `EXE` path to your `python_paload.exe` and you should see a shell generated
    over your listener.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如果你有这些自定义利用，你如何将它们与真正的Metasploit利用结合使用呢？简单，只需调整变量指向它们。以下是在Metasploit中使用`psexec`模块的示例。确保将targetIP更改为目标Windows系统的IP。设置系统上的本地管理员的用户名和本地管理员的密码。最后，将自定义`EXE`路径设置为你的`python_paload.exe`，你应该会看到在你的监听器上生成一个shell。
- en: '[PRE3]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Burp Suite
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Burp Suite
- en: Burp Suite is the standard when it comes to transparent proxies, or tools used
    to directly interact and manipulate streams of web traffic sent to and from your
    browser. This tool has a pro version, which adds a decent web vulnerability scanner.
    Care should be taken when using it, as it can cause multiple submissions of forums,
    e-mails, and interactions.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: Burp Suite是透明代理或用于直接交互和操纵发送到浏览器和从浏览器发送的网络流的工具时的标准。这个工具有一个专业版，增加了一个不错的网络漏洞扫描器。在使用它时应该小心，因为它可能导致多次提交论坛、电子邮件和交互。
- en: The same can be said with its Spider tool, which interacts with scoped web applications
    and maps them similar to web crawlers like Google and Bing. Make sure that when
    you use tools like these, you disable automatic submissions and logins initially,
    till you better understand the applications. More about Burp and similar web tools
    will be covered in [Chapter 6](ch06.html "Chapter 6. Assessing Web Applications
    with Python"), *Assessing Web Applications with Python*. Other similar tools include
    **Zed Attack Proxy** (**ZAP**), which now also contains the unlinked folder and
    file researching tool called DirBuster.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 其Spider工具也是如此，它与范围内的Web应用程序交互，并将它们映射到类似于Google和Bing的Web爬虫。确保在使用这些工具时，最初禁用自动提交和登录，直到你更好地了解这些应用程序。更多关于Burp和类似的Web工具将在[第6章](ch06.html
    "第6章。使用Python评估Web应用程序")中介绍，*使用Python评估Web应用程序*。其他类似的工具包括**Zed Attack Proxy**（**ZAP**），它现在还包含了名为DirBuster的未链接文件夹和文件研究工具。
- en: Hydra
  id: totrans-190
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Hydra
- en: 'Hydra is a service or interface dictionary attack tool that can identify viable
    credentials that may provide access. Hydra is multithreaded, which means that
    it can assess services with multiple guesses in tandem, greatly speeding the attack
    and the noise generated. For example, the following command can be used for attacking
    a **Secure Shell** (**SSH**) service on a host with the IP address of `192.168.1.10`:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: Hydra是一种服务或接口字典攻击工具，可以识别可能提供访问权限的有效凭据。Hydra是多线程的，这意味着它可以同时评估多个猜测的服务，大大加快了攻击和产生的噪音。例如，以下命令可用于攻击具有IP地址`192.168.1.10`的主机上的**Secure
    Shell**（**SSH**）服务：
- en: '[PRE4]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'This command uses a username list and a password list, exits on the first success,
    and shows each login combination attempted. If you wanted to just test a single
    username and password, the command changes to use lowercase `l` and `p`, respectively.
    The corresponding command is as follows:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令使用用户名列表和密码列表，在第一次成功时退出，并显示尝试的每个登录组合。如果您只想测试单个用户名和密码，命令将更改为分别使用小写`l`和`p`。相应的命令如下：
- en: '[PRE5]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Hydra also has the ability to run brute force attacks against services and an
    authentication interface of a website. There are many other tools in the industry
    that have similar capabilities, but most assessors use Hydra because of its extensive
    capabilities and protocol support. There are occasions where Hydra will not fit
    the bill, but usually, other tools will not meet the need either. When this happens,
    we should look at creating a Python script. Additional details related to credential
    attacks are covered in [Chapter 4](ch04.html "Chapter 4. Executing Credential
    Attacks with Python"), *Executing Credential Attacks with Python*.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: Hydra还具有针对服务和网站的身份验证接口进行暴力攻击的能力。行业中有许多其他具有类似功能的工具，但大多数评估者使用Hydra，因为它具有广泛的功能和协议支持。有时Hydra不适用，但通常其他工具也无法满足需求。发生这种情况时，我们应该考虑创建一个Python脚本。有关凭据攻击的其他详细信息在[第4章](ch04.html
    "Chapter 4. Executing Credential Attacks with Python")中有所涵盖，*使用Python执行凭据攻击*。
- en: John the Ripper
  id: totrans-196
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 约翰·里波特
- en: '**John the Ripper** (**JtR**), or John as most people call it, is one of the
    best crackers on the market, which can attack salted and unsalted hashes. One
    of the biggest benefits of John is that it can be used with most hashes. John
    has the ability to identify hash types from standard outputs and file formats.
    If run natively by providing just the hash file and no arguments, John will try
    and crack the hashes with its standard methodology. This is first attempted in
    the single crack mode, then the wordlist mode, and then finally, the incremental
    mode.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 约翰·里波特（JtR），或者大多数人称之为约翰，是市场上最好的破解软件之一，可以攻击加盐和未加盐的哈希。约翰最大的好处之一是它可以与大多数哈希一起使用。约翰有能力从标准输出和文件格式中识别哈希类型。如果仅提供哈希文件而没有参数，约翰将尝试使用其标准方法破解哈希。首先尝试单一破解模式，然后是单词列表模式，最后是增量模式。
- en: Tip
  id: totrans-198
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Downloading the example code**'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '**下载示例代码**'
- en: You can download the example code files from your account at [http://www.packtpub.com](http://www.packtpub.com)
    for all the Packt Publishing books you have purchased. If you purchased this book
    elsewhere, you can visit [http://www.packtpub.com/support](http://www.packtpub.com/support)
    and register to have the files e-mailed directly to you.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从您在[http://www.packtpub.com](http://www.packtpub.com)的帐户中下载示例代码文件，用于您购买的所有Packt
    Publishing图书。如果您在其他地方购买了这本书，您可以访问[http://www.packtpub.com/support](http://www.packtpub.com/support)并注册，文件将直接通过电子邮件发送给您。
- en: Note
  id: totrans-201
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A salt is the output of a **pseudorandom number generator** (**PRNG**) that
    has been encoded to produce relatively random characters. The salt is injected
    into the process that hashes the passwords, which means that each time, a password
    is hashed, it is done so in a different format. The salt is then stored with the
    hash so that the comparison algorithm for the credentials input during authentication
    will be able to function as input credentials need to have the same salt to produce
    the same hash. This adds additional entropy to the hashing algorithm, which provides
    additional security and mitigates most rainbow table attacks.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 盐是**伪随机数生成器**（**PRNG**）的输出，已编码以产生相对随机的字符。盐被注入到散列密码的过程中，这意味着每次散列密码时，都会以不同的格式进行。然后将盐与哈希一起存储，以便在认证期间输入凭据的比较算法能够正常工作，需要相同的盐才能产生相同的哈希。这为散列算法增加了额外的熵，提供了额外的安全性，并减轻了大多数彩虹表攻击。
- en: A single crack attack takes information from the hash file, mangles the clear
    text words, and then uses the details as passwords along with some other rule
    sets. The wordlist mode is just that; it uses the default word list. Finally,
    the incremental mode runs through each character possibility in a brute force
    format attack. It is best to use a standalone cracking server running oclHashcat
    if you really need a relative incremental or brute force mode-style attack.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 单一破解攻击从哈希文件中获取信息，搅乱明文单词，然后将细节作为密码与一些其他规则集一起使用。单词列表模式就是这样；它使用默认单词列表。最后，增量模式以暴力攻击的方式运行每个字符可能性。如果您真的需要相对增量或暴力攻击模式，最好使用独立的运行oclHashcat的破解服务器。
- en: Note
  id: totrans-204
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Password crackers work in one of the following two methods: by taking the test
    password and hashing it in real time, or by taking precomputed hashes and comparing
    them against the test hash. Real-time hash attacks allow an assessor to crack
    passwords that have been salted or unsalted during the original hashing process.
    Precomputed hash attacks have the benefit of being much faster, but they fail
    against salted passwords unless the salt was known during the precomputation period.
    Precomputed attacks use chained tables called rainbow tables. Real-time password
    attacks use either dictionaries or lists of words that may be mutated in real
    time or incremented in each character positions with different character sets.
    This describes dictionary attacks and brute force attacks, respectively.'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 密码破解器以以下两种方法之一工作：通过实时对测试密码进行哈希，或者通过取预先计算的哈希并将其与测试哈希进行比较。实时哈希攻击允许评估者破解在原始哈希过程中进行盐化或未盐化的密码。预先计算的哈希攻击速度更快，但除非在预计算期间已知盐，否则无法破解盐化密码。预先计算攻击使用称为彩虹表的链接表。实时密码攻击使用字典或单词列表，这些列表可以在实时中变异或在每个字符位置上以不同的字符集递增。这分别描述了字典攻击和暴力攻击。
- en: The following is the example of running `John` against a `hash` file, from within
    the `John` folder if `hashfile` is located there.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在`John`文件夹中针对`hash`文件运行`John`的示例，如果`hashfile`位于那里。
- en: '[PRE6]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'To run `John` in the single mode against `hashfile`, run the following command:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 以单用户模式运行`John`来对`hashfile`进行破解，运行以下命令：
- en: '[PRE7]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'To run `John` as with a word list, use the following command:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用单词列表运行`John`，请使用以下命令：
- en: '[PRE8]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: You can permutate and substitute the characters natively by running rules at
    the same time.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以同时运行规则来对字符进行排列和替换。
- en: '[PRE9]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: John's real power comes from being able to be used on engagements from most
    systems, having strong permutation rules, and being very user friendly. John excels
    at cracking most standard OS password hashes. It can also easily represent the
    details in a format that is easy to match back to usernames and the original hashes.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: John的真正优势在于能够在大多数系统上使用，具有强大的排列规则，并且非常用户友好。John擅长破解大多数标准操作系统密码哈希。它还可以轻松地表示易于与用户名和原始哈希匹配的详细信息。
- en: Note
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: In comparison to John, oclHashcat does not have a native capability to match
    the cracked details with the original data in a simple format. This makes it more
    difficult to provide password cracking statistics related to unique hashes. This
    is particularly true when the supplied hashes might be extracted from multiple
    sources and tied to the same account as they may be adjusted with different salts.
    Keep this in mind as most organizations would like to have cracking statistics
    in the final report.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 与John相比，oclHashcat没有本地能力以简单格式匹配破解的详细信息与原始数据。这使得提供与唯一哈希相关的密码破解统计数据更加困难。当提供的哈希可能来自多个来源并与同一帐户关联时，这一点尤为真实，因为它们可能会使用不同的盐进行调整。请记住，大多数组织希望在最终报告中获得破解统计数据。
- en: 'The following command demonstrates how to show the password cracking results
    with John:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令演示了如何使用John显示密码破解结果：
- en: '[PRE10]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'One of John''s unique capabilities is the ability to generate permutated passwords
    from a list of words, which can help build solid cracker lists, particularly when
    used with Cewl. Here is an example of how to create a permutated password list
    with John, with only unique words:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: John的一个独特能力是能够从单词列表中生成排列密码，尤其是在与Cewl一起使用时，可以帮助构建坚实的破解列表。以下是如何使用John创建一个只包含唯一单词的排列密码列表的示例：
- en: '[PRE11]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Cracking Windows passwords with John
  id: totrans-221
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用John破解Windows密码
- en: The biggest bang for your buck using John is for cracking passwords that have
    been hashed in the **Local Area Network** (**LAN**) Manager (MAN) or (LM) format.
    LM hashes are a weak form of hashes that can store a password of up to 14 characters
    in length. The passwords are split into two components of up to seven characters
    in length each and in the uppercase format. When cracking this type of hash, you
    have to crack the LM hashes that you have in order to convert the two components
    of the uppercase password into a single password in the proper case.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 使用John破解密码最大的优势是对已经以**本地区域网络**（**LAN**）管理器（MAN）或（LM）格式进行哈希的密码进行破解。LM哈希是一种弱哈希形式，可以存储长达14个字符的密码。密码被分成两个部分，每个部分最多七个字符，并且以大写格式呈现。破解这种类型的哈希时，您必须破解LM哈希，以将大写密码的两个部分转换为正确大小写的单个密码。
- en: We do this by cracking the LM hash and then taking this cracked password and
    running it through John as a wordlist with the permutation rules enabled. This
    means that the password will be used as a word to attack the **New Technology
    LM** (**NTLM**) hash in different formats. This allows NTLM hashes, which are
    significantly stronger, to be cracked much faster. This can be done relatively
    automatically with a Perl script called `LM2NTCRACK`, but you can do it manually
    with John with great success as well.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过破解LM哈希，然后将这个破解的密码作为单词列表与启用排列规则的John一起运行。这意味着密码将被用作单词来攻击不同格式的**新技术LM**（**NTLM**）哈希。这允许更强大的NTLM哈希更快地被破解。这可以通过名为`LM2NTCRACK`的Perl脚本相对自动地完成，但您也可以使用John手动完成，并且也会取得很大成功。
- en: You can create a test hash with a password that you like from websites such
    as [http://www.tobtu.com/lmntlm.php](http://www.tobtu.com/lmntlm.php). I generated
    a pwdump format from the password of test, and changed the username to Administrator.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从网站（例如[http://www.tobtu.com/lmntlm.php](http://www.tobtu.com/lmntlm.php)）创建一个喜欢的密码的测试哈希。我从test密码生成了pwdump格式，并将用户名更改为Administrator。
- en: '[PRE12]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Make sure that you use the password that you copy as one line and place it into
    a file. The following commands are designed on the basis of the idea that the
    `hash` file is named `hashfile` and has been placed in the `John` directory, where
    the test is being run from.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您将复制的密码作为一行并将其放入文件中。以下命令是基于`hash`文件命名为`hashfile`并放置在正在运行测试的`John`目录中的想法设计的。
- en: '[PRE13]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Once the password has been cracked, you can copy it directly from the output
    and place it in a new file called `my_wordlist`. You can also show the password
    from the cracked hashes by using the command already demonstrated. An easy way
    to place the password in a file is to redirect an `echo` into it.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦密码被破解，你可以直接从输出中复制它，并将其放入一个名为`my_wordlist`的新文件中。你也可以使用已经演示过的命令显示破解哈希的密码。将密码放入文件的简单方法是将`echo`重定向到文件中。
- en: '[PRE14]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Now, use this wordlist to execute a dictionary attack with rules running against
    the input data to permutate the word. This will allow you to find the properly
    cased password.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，使用这个单词列表对输入数据执行带规则的字典攻击，以排列这个单词。这将允许你找到正确大小写的密码。
- en: '[PRE15]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The following screen capture highlights the cracking of this hash by using
    the techniques described earlier:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 以下屏幕截图突出了使用先前描述的技术来破解这个哈希：
- en: '![Cracking Windows passwords with John](img/B04315_01_01.jpg)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![使用John破解Windows密码](img/B04315_01_01.jpg)'
- en: oclHashcat
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: oclHashcat
- en: If you have a dedicated password cracker, or a system with a strong **Graphics
    Processing Unit** (**GPU**), oclHashcat is the way to go. The tool can quickly
    crack password hashes by taking advantage of the insane processing power available
    to the right audience. The big thing to keep in mind is that oclHashcat is not
    as simple or intuitive as John the Ripper, but it has strong brute force capabilities.
    The tool has the capability to be configured with wildcards, which means that
    the password dynamics for cracking can be very specific.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一个专用的密码破解器，或者一个拥有强大**图形处理单元**（**GPU**）的系统，oclHashcat是一个不错的选择。该工具可以利用适合的受众可用的强大处理能力快速破解密码哈希。需要牢记的重要一点是，oclHashcat并不像John
    the Ripper那样简单直观，但它具有强大的暴力破解能力。该工具具有配置通配符的能力，这意味着破解密码的动态可以非常具体。
- en: Tip
  id: totrans-236
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The version of oclHashcat that supports cracking without GPU is called Hashcat.
    This cracking tool is quickly surpassing John when it comes to password cracking,
    but it takes a good bit more research and training to use. As you gain experience
    you should move to cracking with Hashcat or oclHashcat.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 支持无GPU破解的oclHashcat版本称为Hashcat。这个破解工具在密码破解方面很快超过了John，但需要更多的研究和培训才能使用。随着经验的积累，你应该转向使用Hashcat或oclHashcat进行破解。
- en: Ophcrack
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Ophcrack
- en: This tool is most famous as a boot disk attack tool, but it can also be used
    as a standalone Rainbow Cracker. Ophcrack can be burned directly to a bootable
    **Universal Serial Bus** (**USB**) drive or **Compact Disk** (**CD**). When placed
    in a Windows system without **Full Disk Encryption** (**FDE**), the tool will
    extract the hashes from the OS. This is done by booting into a LiveOS or an OS
    that runs in memory. The tool will try and crack the hashes with rudimental tables.
    Most of the time, these tables fail, but the hashes themselves can be securely
    copied off the host with SSH to an attack box. These hashes can then be cracked
    offline with tools such as John or oclHashcat.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 这个工具最著名的是作为一个启动盘攻击工具，但它也可以作为一个独立的彩虹表破解器使用。Ophcrack可以直接刻录到可启动的**通用串行总线**（**USB**）驱动器或**光盘**（**CD**）中。当放置在没有**全盘加密**（**FDE**）的Windows系统中时，该工具将从操作系统中提取哈希。这是通过引导到一个LiveOS或在内存中运行的操作系统来完成的。该工具将尝试用基本的表来破解哈希。大多数情况下，这些表会失败，但哈希本身可以安全地从主机复制到攻击盒中。然后可以使用诸如John或oclHashcat之类的工具离线破解这些哈希。
- en: Mimikatz and Incognito
  id: totrans-240
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Mimikatz和Incognito
- en: These tools both can work natively within a Meterpreter session, and each provides
    a means to interact and take advantage of a session on a Windows host. Incognito
    allows an assessor to interact with a token in memory by impersonating the user's
    cached credentials. Mimikatz allows an assessor to directly extract the credentials
    stored in memory, which means that the username and password are directly exposed.
    Mimikatz has the additional ability to run against memory dumps offline produced
    with tools such as SysInternals ProcDump.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个工具都可以在Meterpreter会话中本地运行，并且每个工具都提供了与Windows主机会话交互和利用的手段。Incognito允许评估者通过模拟用户缓存的凭据来与内存中的令牌交互。Mimikatz允许评估者直接提取内存中存储的凭据，这意味着用户名和密码直接暴露出来。Mimikatz还具有针对使用诸如SysInternals
    ProcDump等工具生成的内存转储离线运行的额外功能。
- en: Tip
  id: totrans-242
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: There are many versions of Mimikatz and the one within the Meterpreter is the
    example we are covering in this book.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: Mimikatz有许多版本，我们在本书中介绍的是Meterpreter中的一个例子。
- en: SMBexec
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SMBexec
- en: This tool is a suite of tools developed in Ruby, which uses a combination of
    PtH attacks, Mimikatz, and hash dumping to take advantage of a network. SMBexec
    makes taking over a network very easy as it provides a console interface and only
    requires an initial hash and username or credential pair, and a network range.
    The tool will automatically try and access resources, extract the details about
    any credentials in memory, cached details, and stored hashes. The catch with SMBexec
    is that Ruby Gem inconsistencies can cause this tool to be temperamental, and
    it can cause other tools such as Metasploit and even entire Kali instances to
    break. If you are going to use SMBexec, always create a separate VM with the specific
    goal to run this tool.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 这个工具是一个由Ruby开发的工具套件，它利用PtH攻击、Mimikatz和哈希转储的组合来利用网络。SMBexec使接管网络变得非常容易，因为它提供了一个控制台界面，只需要一个初始哈希和用户名或凭据对，以及一个网络范围。该工具将自动尝试访问资源，提取内存中的凭据详细信息、缓存详细信息和存储的哈希。SMBexec的问题在于Ruby
    Gem的不一致可能导致这个工具表现不稳定，并且可能导致其他工具如Metasploit甚至整个Kali实例崩溃。如果要使用SMBexec，一定要创建一个专门的虚拟机来运行这个工具。
- en: Cewl
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Cewl
- en: Cewl is a web spidering tool, which parses words from a site, uniquely identifies
    their instances, and outputs them into a file. Tools like Cewl are extremely useful
    when developing custom targeted password lists. Cewl has a number of capabilities
    to include targeted searches for details and limitations for the depth that the
    tool will dig to. Cewl is Ruby based and often has the same problems that SMBexec
    and other Ruby products do with Gems.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: Cewl是一个网络爬虫工具，它从网站中解析单词，唯一地识别它们的实例，并将它们输出到文件中。像Cewl这样的工具在开发定制的目标密码列表时非常有用。Cewl具有许多功能，包括针对详细信息的定向搜索以及工具将挖掘的深度的限制。Cewl基于Ruby，通常与SMBexec和其他Ruby产品一样存在问题。
- en: Responder
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Responder
- en: Responder is a Python script that provides assessors the ability to redirect
    proxy requests to an attacker's system through a misconfiguration of **Web Proxy
    AutoDiscovery** (**WPAD**). It can also receive network NTLM or NTLMv2 challenge
    response hashes. This is done by taking advantage of the natively enabled **Local
    Link Multicast Name Request** (**LLMNR**) and **Network Basic Input Output System**
    (**NetBIOS**) **Name Service** (**NB-NS**).
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: Responder是一个Python脚本，可以让评估人员通过**Web代理自动发现**（**WPAD**）的错误配置将代理请求重定向到攻击者的系统。它还可以接收网络NTLM或NTLMv2挑战响应哈希。这是通过利用本地启用的**本地链接多播名称请求**（**LLMNR**）和**网络基本输入输出系统**（**NetBIOS**）**名称服务**（**NB-NS**）来完成的。
- en: Responder usage is very simple; all that a user has to do is be on a network
    drop within the same broadcast domain as his targets. Executing the following
    command will create a pop-up window in the user's Internet Explorer session. It
    will request his/her domain credentials to allow him/her to move forward; this
    attack also means NTLMv2 protected hashes will be provided from attacks against
    LLMNR and NB-NS requests. Make sure that you swap "yourIP" with your actual IP
    address.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: Responder的使用非常简单；用户只需在与目标相同的广播域内的网络中。执行以下命令将在用户的Internet Explorer会话中创建一个弹出窗口。它将请求他/她的域凭据以允许他/她继续；这种攻击还意味着NTLMv2受保护的哈希将从针对LLMNR和NB-NS请求的攻击中提供。确保将“yourIP”替换为您的实际IP地址。
- en: '[PRE16]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: You can also force web sessions to return basic authentication instead of NTLM
    responses. This is useful when WPAD looks like it has been mitigated in the environment.
    This means that you will typically receive NTLMv2 challenge response hashes from
    attacks against LLMNR and NB-NS requests.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以强制Web会话返回基本身份验证，而不是NTLM响应。当WPAD看起来已在环境中得到缓解时，这是有用的。这意味着您通常会从针对LLMNR和NB-NS请求的攻击中收到NTLMv2挑战响应哈希。
- en: '[PRE17]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Responder attacks have become a mainstay in most internal assessments. WPAD,
    LLMNR, and NB-NS are rampant misconfigurations in most environments and should
    be assessed when possible. These vulnerabilities are commonly manipulated by both
    assessors and malicious actors.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: Responder攻击已成为大多数内部评估的主要内容。WPAD、LLMNR和NB-NS在大多数环境中都是普遍的错误配置，应尽可能进行评估。这些漏洞通常被评估人员和恶意行为者所利用。
- en: theHarvester and Recon-NG
  id: totrans-255
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: theHarvester和Recon-NG
- en: These tools are specifically focused on identifying data related to **Open Source
    Intelligence** (**OSINT**) gathering. The theHarvester tool is Python based and
    does a decent job of finding details from search engines and social media, but
    Recon-NG is the new kid on the block. Recon-NG is a console-based framework that
    was also created in Python, which can query a number of information repositories.
    This expanded capability means that Recon-NG is often the first tool that assessors
    go to now. Recon-NG has not replaced theHarvester, but theHarvester is often not
    used unless Recon-NG has not found sufficient details.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 这些工具专门用于识别与**开源情报**（**OSINT**）收集相关的数据。theHarvester工具基于Python，可以很好地从搜索引擎和社交媒体中找到详细信息，但Recon-NG是新生力量。Recon-NG是一个基于控制台的框架，也是用Python创建的，可以查询多个信息库。这种扩展功能意味着Recon-NG现在通常是评估人员首选的工具。Recon-NG并没有取代theHarvester，但除非Recon-NG没有找到足够的细节，否则通常不会使用theHarvester。
- en: pwdump and fgdump
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: pwdump和fgdump
- en: These tools are old in comparison to most tools like Mimikatz, but they are
    well known in the industry, and many password cracking tools are based on their
    output format. In fact, Metasploit's `hashdump` and `smart_hashdump` output the
    system hashes in what is known as the `pwdump` format. These hashes can be directly
    extracted from the session placed in a file and run through `John` by using the
    native command examples provided earlier.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 与大多数像Mimikatz这样的工具相比，这些工具已经很老了，但它们在行业中非常知名，许多密码破解工具都是基于它们的输出格式。事实上，Metasploit的`hashdump`和`smart_hashdump`以所谓的`pwdump`格式输出系统哈希。这些哈希可以直接从会话中提取并放入文件中，然后通过使用前面提供的本机命令示例运行`John`。
- en: Netcat
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Netcat
- en: Netcat or network concatenate, also known as `nc`, is one of the oldest forms
    of assessment and administrative tools. It is designed to interact with ports
    and services directly by providing an IP address, a port, and a protocol. It can
    also transmit files and establish sessions from host to host. Because of all the
    capabilities of this tool, it is often known as the digital Swiss Army Knife,
    used by assessors and administrators alike.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: Netcat或网络连接，也称为`nc`，是最古老的评估和管理工具之一。它旨在通过提供IP地址、端口和协议直接与端口和服务进行交互。它还可以传输文件并建立主机之间的会话。由于这个工具的所有功能，它通常被称为数字瑞士军刀，被评估人员和管理员广泛使用。
- en: Tip
  id: totrans-261
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'SANS Institute has a fantastic cheat sheet for netcat that highlights the majority
    of its capabilities, which can be found at the following URL:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: SANS研究所有一份关于netcat的绝妙备忘录，突出了其大部分功能，可以在以下网址找到：
- en: '[http://pen-testing.sans.org/retrieve/netcat-cheat-sheet.pdf](http://pen-testing.sans.org/retrieve/netcat-cheat-sheet.pdf)'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://pen-testing.sans.org/retrieve/netcat-cheat-sheet.pdf](http://pen-testing.sans.org/retrieve/netcat-cheat-sheet.pdf)'
- en: Sysinternals tools
  id: totrans-264
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Sysinternals工具
- en: This tool suite was originally developed by Wininternals Software LP, Austin,
    Texas. These tools provide administrators and other professionals capabilities
    to handle, maintain, and control Windows systems in a large domain. The features
    that these tools provide are not natively built into Windows; Microsoft recognized
    this and purchased the company in 2006\. These tools are free and open to the
    public, and it should be noted that many hacking tools have been built on the
    concepts originally created within this suite.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 这套工具包最初由Wininternals Software LP在得克萨斯州奥斯汀开发。这些工具为管理员和其他专业人士提供了在大型域中处理、维护和控制Windows系统的能力。这些工具提供的功能并不是Windows的本机功能；微软意识到了这一点，并在2006年收购了该公司。这些工具是免费向公众开放的，值得注意的是，许多黑客工具是基于最初在这套工具包中创建的概念构建的。
- en: Some examples of tools used from this suite include `procdump` to dump memory
    and extract credentials. The `psexec` tool executes a PtH or perform remote process
    execution to establish a session with a remote host, and provides process interaction
    and listing capabilities with `pskill` or `pslist`. It should be noted that these
    tools are used by administrators and are typically white-listed. So, while many
    hacking tools are blocked by IPS, these are usually not. So, when all else fails,
    always think like a malicious administrator, because taking advantage of these
    capabilities is the crux of what most malicious actors do.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 这套工具包中使用的一些工具示例包括`procdump`用于转储内存和提取凭据。`psexec`工具执行PtH或执行远程进程以与远程主机建立会话，并提供与`pskill`或`pslist`一起的进程交互和列表功能。值得注意的是，这些工具是由管理员使用的，通常是白名单。因此，虽然许多黑客工具被IPS阻止，但这些工具通常不会。因此，当一切都失败时，始终要像一个恶意管理员一样思考，因为利用这些功能是大多数恶意行为者所做的关键。
- en: Summary
  id: totrans-267
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter focused on discussing and defining penetration testing and why
    it is needed. On the basis of this definition, the PTES framework is described,
    which provides a new assessor the means to build his/her knowledge within a context
    of what an actual engagement would look like. To validate this knowledge, we explored
    how an example engagement breaks out across the major execution phases. Finally,
    the major tools used in a variety of assessments are listed and explained, many
    of which will be further explained with realistic examples in the following chapters.
    Now that you have an understanding about penetration testing and its methodology,
    we are going to start learning how powerful Python really is and how easy it is
    to get it up and running.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 本章重点讨论和定义了渗透测试以及为什么需要它。基于这个定义，描述了PTES框架，它为新的评估者提供了在实际参与中建立知识的手段。为了验证这些知识，我们探讨了一个示例参与如何在主要执行阶段中展开。最后，列出并解释了在各种评估中使用的主要工具，其中许多将在接下来的章节中通过现实示例进一步解释。现在您已经了解了渗透测试及其方法论，我们将开始学习Python的强大之处以及启动和运行它有多么容易。
