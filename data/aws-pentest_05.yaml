- en: '*Chapter 3*: Exploring Pentesting and AWS'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第3章*：探索渗透测试和AWS'
- en: Welcome to the next portion of the journey. Here, we will begin to take the
    knowledge that we learned from the previous two chapters and start applying it
    to further our knowledge about pentesting and AWS. It is important that you understand
    the previous two chapters because we will be building more instances throughout
    this book and will be using the pentesting methodology you read about in [*Chapter
    2*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*, Pentesting and Ethical
    Hacking*.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 欢迎来到旅程的下一部分。在这里，我们将开始应用我们从前两章中学到的知识，并开始进一步了解有关渗透测试和AWS的知识。重要的是您理解前两章，因为我们将在本书中构建更多实例，并将使用您在[*第2章*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*，渗透测试和道德黑客*中阅读到的渗透测试方法。
- en: For this chapter, we are going to focus on what it means to scan and enumerate
    information from the host that we built, as well as other general systems. Scanning
    and enumerating is one of the most important steps in pentesting, so it's crucial
    that we take a trip down recon lane to understand various ways to enumerate and
    understand our enumeration tactics. We will also learn about various attack paths
    in both pentesting and adversarial assessments and mindsets. It's crucial to understand
    that reconnaissance and enumeration play a huge role in creating attack paths
    that can lead to client compromise and expose threats that may have been overlooked
    by previous administrators.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将专注于从我们构建的主机以及其他一般系统中扫描和枚举信息的含义。扫描和枚举是渗透测试中最重要的步骤之一，因此我们必须沿着侦察的道路前行，以了解各种枚举和了解我们的枚举策略。我们还将了解渗透测试和对抗性评估以及心态中的各种攻击路径。重要的是要理解，侦察和枚举在创建可能导致客户妥协并暴露之前管理员可能忽视的威胁的攻击路径中起着重要作用。
- en: 'In this chapter, we will learn about the following:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习以下内容：
- en: Reconnaissance
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 侦察
- en: Enumeration and AWS services
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 枚举和AWS服务
- en: Scanning and examining targets
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描和检查目标
- en: Creating attack paths
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建攻击路径
- en: SSH keys
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH密钥
- en: Scanning and connecting to AWS
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描和连接到AWS
- en: Learning from experience
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从经验中学习
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To follow along with the instructions in this chapter, you will need the following:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要按照本章的说明进行操作，您将需要以下内容：
- en: 'Metasploit: [https://github.com/rapid7/metasploit-framework/blob/master//modules/post/multi/gather/aws_ec2_instance_metadata.rb](https://github.com/rapid7/metasploit-framework/blob/master//modules/post/multi/gather/aws_ec2_instance_metadata.rb)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit：[https://github.com/rapid7/metasploit-framework/blob/master//modules/post/multi/gather/aws_ec2_instance_metadata.rb](https://github.com/rapid7/metasploit-framework/blob/master//modules/post/multi/gather/aws_ec2_instance_metadata.rb)
- en: 'LambdaGuard: [https://github.com/Skyscanner/LambdaGuard](https://github.com/Skyscanner/LambdaGuard)'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LambdaGuard：[https://github.com/Skyscanner/LambdaGuard](https://github.com/Skyscanner/LambdaGuard)
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/3eicsXx](https://bit.ly/3eicsXx)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频以查看代码的实际应用：[https://bit.ly/3eicsXx](https://bit.ly/3eicsXx)
- en: Exploring reconnaissance
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索侦察
- en: '**Reconnaissance**, also commonly known as **recon**, involves using tools
    that allow you to gather information about a target that can be used to gain an
    advantage on your target. Recon allows you to act like a James Bond-like figure
    and allows you to gather intelligence on a target. As mentioned in [*Chapter 2*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*,
    Pentesting and Ethical Hacking*, in a white-box test, the tester will know everything
    there is to know about the target. It is always best to use tools that search
    for information that the client may have forgotten to tell you, or that let us
    look at open source information the client may deem not "impactful." Various organizations
    will determine what is impactful and what is not – it isn''t a "one size fits
    all" type of deal. Let''s discuss a simple methodology for recon that can be applied
    to most organizations.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '**侦察**，通常也被称为**侦察**，涉及使用工具来收集有关目标的信息，这些信息可以用来对目标获得优势。侦察使您可以像詹姆斯·邦德一样行事，并允许您收集有关目标的情报。如[*第2章*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*，渗透测试和道德黑客*中所述，在白盒测试中，测试人员将了解有关目标的一切。最好使用搜索客户可能忘记告诉您的信息的工具，或者让我们查看客户可能认为不重要的开放源信息。各种组织将确定什么是重要的，什么不重要-这不是“一刀切”的交易。让我们讨论一种简单的侦察方法，可以应用于大多数组织。'
- en: Driving enumeration for recon
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 驱动枚举以进行侦察
- en: 'When performing successful recon, you must ensure that you discover as much
    information as possible. What this means is that you will need to look for things
    that you find impactful toward your client and continue searching until you have
    enough information to move forward. Results vary from pentest to pentest, so you
    have to use your best judgment on how much information is "enough." Here is a
    basic methodology of doing some basic recon and information gathering:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行成功的侦察时，您必须确保尽可能多地发现信息。这意味着您需要寻找对客户有影响的事物，并继续搜索，直到您获得足够的信息以继续前进。结果因渗透测试而异，因此您必须根据“足够”信息的判断。以下是进行基本侦察和信息收集的基本方法：
- en: Look up information on the target website. Look for email addresses, phone numbers,
    and anything that can be used to contact the client directly.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查找有关目标网站的信息。查找电子邮件地址，电话号码以及任何可用于直接联系客户的信息。
- en: Use other tools to automate processes in discovering information such as DNS,
    open S3 buckets, employee names, phone numbers, email addresses, street addresses,
    and more!
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用其他工具自动化发现信息的过程，例如DNS，开放的S3存储桶，员工姓名，电话号码，电子邮件地址，街道地址等等！
- en: Use your tool of choice to jot your notes down so that you can use them later
    in your pentest.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用您选择的工具记下笔记，以便稍后在您的渗透测试中使用。
- en: Following these steps will allow you to execute proper recon on a client or
    target and help you create a better attack path that can lead to a full system
    compromise. Now that we have discussed those steps, let's take a look at some
    tools that we can use for recon.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 按照这些步骤将允许你对客户或目标执行适当的侦察，并帮助你创建一个更好的攻击路径，从而导致对整个系统的完全妥协。现在我们已经讨论了这些步骤，让我们来看看一些我们可以用于侦察的工具。
- en: Important note
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'There are various servers'' records that you will discover during a pentest
    engagement. While it doesn''t concern this book, it is good to know different
    record types. Check out more information here: [https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html).'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试过程中，你会发现各种服务器的记录。虽然这与本书无关，但了解不同的记录类型是很有好处的。在这里查看更多信息：[https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html)。
- en: Harvesting email addresses
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 收集电子邮件地址
- en: Gathering email addresses can be extremely important during a pentest. Gathering
    email addresses allows you to see who works for the target company, and how they
    can be reached directly. Attackers use this method to phish organizations and
    try to trick a user into logging into a fake site or clicking on some type of
    malware. For pentesting, we use it to get an overall understanding of what is
    out there in the open so that we can discuss it with our client, unless the target
    specifically requests a phishing engagement.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试过程中收集电子邮件地址可能非常重要。收集电子邮件地址可以让你看到谁在目标公司工作，以及如何直接联系他们。攻击者使用这种方法来钓鱼组织，并试图诱使用户登录到一个假网站或点击某种恶意软件。对于渗透测试，我们使用它来全面了解公开的情况，以便与客户讨论，除非目标明确要求进行钓鱼。
- en: We are going to be using a tool called **theHarvester** to execute this. theHarvester
    allows us to gather various bits and pieces of information on a target by querying
    specific databases. In our case, we will target the company Packt Publishing and
    see what we can find.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个名为**theHarvester**的工具来执行这个任务。theHarvester允许我们通过查询特定的数据库来收集有关目标的各种信息。在我们的案例中，我们将以公司Packt
    Publishing为目标，看看我们能找到什么。
- en: 'To get started, follow these steps:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，请按照以下步骤操作：
- en: Turn on your Kali Linux machine.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开你的Kali Linux机器。
- en: Open a Terminal in the machine.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在机器上打开一个终端。
- en: 'Type the following command:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令：
- en: '[PRE0]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'We will use Google and Yahoo to query information:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用Google和Yahoo来查询信息：
- en: '[PRE1]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Like the previous attempt, we are using theHarvester to help us find readily
    available information that we or an attacker could use to help map an attack path.
    In this case, we are using the tool to find any potential domains and IP addresses
    that we could use to map a potential attack:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 与之前的尝试一样，我们正在使用theHarvester来帮助我们找到我们或攻击者可以用来帮助映射攻击路径的现成信息。在这种情况下，我们正在使用该工具来查找任何潜在的域和IP地址，以便映射潜在的攻击：
- en: '![Figure 3.2 – Output from theHarvester from Google and Yahoo'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.2 - 来自Google和Yahoo的theHarvester输出'
- en: '](img/Figure_3.02_B15630.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.02_B15630.jpg)'
- en: Figure 3.2 – Output from theHarvester from Google and Yahoo
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.2 - 来自Google和Yahoo的theHarvester输出
- en: As you can see, we found an email address that we can use for contact, as well
    as some hosts that we can target later. All this information will prove beneficial
    later, during your pentest, or after the pentest, during your report. Advising
    clients about information such as the data gathered from theHarvester shows what
    the outside of the organization looks like.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，我们找到了一个可以用于联系的电子邮件地址，以及一些我们以后可以攻击的主机。所有这些信息在你的渗透测试过程中或渗透测试后的报告中都会证明有益。向客户提供theHarvester收集的数据等信息，可以展示组织外部的情况。
- en: Now that we have gathered information such as names, emails, and hosts, let's
    take a look at a couple of tools that we can use to discover DNS information.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经收集了姓名、电子邮件和主机等信息，让我们来看看一些工具，我们可以用来发现DNS信息。
- en: The WHOIS command
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: WHOIS命令
- en: DNS names are assigned to IP addresses after those domain names have been registered.
    For example, `foo.com` may use a `WHOIS` command is used for discovering this
    information from a public or internal standby. Using the command reveals information
    about domain names, who those domains are registered to, ISP contacts, and other
    useful technical information that an attacker could use to create an in-depth
    attack path to their target.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: DNS名称在这些域名注册后分配给IP地址。例如，`foo.com`可能使用`WHOIS`命令来从公共或内部备用处发现这些信息。使用该命令可以揭示有关域名、注册这些域名的人、ISP联系人以及攻击者可以用来创建对目标的深入攻击路径的其他有用技术信息。
- en: 'Let''s take a quick look at how we can use WHOIS to pull up some information
    about an organization. In this case, we will target Packt Publishing to see what
    information we can discover about them. The next steps will illustrate how to
    execute this properly:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速看一下如何使用WHOIS来查找有关一个组织的一些信息。在这种情况下，我们将以Packt Publishing为目标，看看我们能发现关于他们的什么信息。接下来的步骤将说明如何正确执行这个任务：
- en: Start up your Kali Linux machine.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动你的Kali Linux机器。
- en: Open up a Terminal.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开终端。
- en: 'Type the following command:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令：
- en: '[PRE2]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'After letting the command run for a little bit, you should see results come
    up with information regarding the domain:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 让命令运行一会儿后，你应该会看到有关域的信息结果出现：
- en: '![Figure 3.3 – DNS information retrieved from WHOIS'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.3 - 从WHOIS检索的DNS信息'
- en: '](img/Figure_3.03_B15630.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.03_B15630.jpg)'
- en: Figure 3.3 – DNS information retrieved from WHOIS
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.3 - 从WHOIS检索的DNS信息
- en: WHOIS will allow pentesters to gather information regarding the client's domain
    that they could use to make attack paths that could target specific hosts such
    as web servers or even domain controllers. Additionally, you can gather AWS information
    such as AWS regions being used via the WHOIS command or using the Netcraft command
    – which we will talk about next.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: WHOIS将允许渗透测试人员收集有关客户域的信息，他们可以利用这些信息制定攻击路径，以针对特定的主机，如Web服务器或域控制器。此外，您可以通过WHOIS命令或使用Netcraft命令收集AWS区域的信息，我们将在下面讨论。
- en: Netcraft
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Netcraft
- en: '**Netcraft** is a great resource to use when trying to look up any public information
    about a particular target. The tool allows personnel to look up multiple domains
    by searching for an individual host. Some of the information that comes from the
    results of a query can be the following:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**Netcraft**是一个很好的资源，当试图查找有关特定目标的任何公共信息时使用。该工具允许人员通过搜索单个主机来查找多个域。从查询结果中得到的一些信息可能包括：'
- en: IP address
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IP地址
- en: Nameservers
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 域名服务器
- en: Reverse DNS
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 反向DNS
- en: Netblock owner
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络块所有者
- en: DNS admin
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS管理员
- en: Domain registry
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 域名注册
- en: AWS regions
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS区域
- en: I recommend always running Netcraft when pentesting an organization. It's a
    great tool that has a graphical user interface that can generate reports for you,
    unlike WHOIS. Also, when doing black-box testing, it can show you AWS information
    linked to the target domain, and also show you information that the client company
    may have overlooked.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议在对组织进行渗透测试时始终运行Netcraft。这是一个很棒的工具，它有一个图形用户界面，可以为您生成报告，不像WHOIS。此外，在进行黑盒测试时，它可以向您显示与目标域名相关的AWS信息，并向您显示客户公司可能忽视的信息。
- en: 'Check out more about Netcraft here: [https://www.netcraft.com](https://www.netcraft.com).'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里了解更多关于Netcraft的信息：[https://www.netcraft.com](https://www.netcraft.com)。
- en: Now that we have discussed some quick and effective ways we can find information
    about our target, let's start looking more at how we can start performing recon
    on AWS services.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了一些快速有效的方法，可以找到有关我们目标的信息，让我们开始更多地了解如何开始对AWS服务进行侦察。
- en: Enumerating and understanding AWS services
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 列举和理解AWS服务
- en: Enumeration is the process of gathering information that gives you valuable
    characteristics about a target during the recon of a target. Enumeration involves
    performing reconnaissance and scanning your targets. This means getting information
    about services, domain names, ports, and so on. While we have been performing
    enumeration by gathering open source information, let's take a quick look at some
    of the AWS services that we may target or encounter during an AWS pentest. Discussing
    these services allows us to understand more about our targets before we begin
    exploiting them.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 列举是在对目标进行侦察期间收集有价值的特征信息的过程。列举涉及执行侦察和扫描目标。这意味着获取有关服务、域名、端口等的信息。虽然我们一直在通过收集开源信息来进行列举，但让我们快速看一下我们可能在AWS渗透测试期间针对或遇到的一些AWS服务。讨论这些服务可以让我们在开始利用它们之前更多地了解我们的目标。
- en: Important note
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'For more information on enumeration, check out the penetration testing standard:
    [http://www.pentest-standard.org/](http://www.pentest-standard.org/).'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 有关列举的更多信息，请查看渗透测试标准：[http://www.pentest-standard.org/](http://www.pentest-standard.org/)。
- en: S3 buckets and discovering open buckets with web apps
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: S3存储桶和发现带有Web应用程序的开放存储桶
- en: S3 buckets are a great resource provided by AWS. S3 buckets act as "containers"
    that allow users to store objects, or data, in them that can be retrieved at any
    time as long as the user has the proper permissions to access the data. While
    we won't go too far into S3 in this chapter, it's good to know that doing recon
    on S3 resources is an essential part of pentesting AWS. We will take a deeper
    dive into S3 during [*Chapter 4*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171)*,
    Exploiting S3 Buckets*. However, let's take a look at how we can openly query
    S3 buckets that lack security controls.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: S3存储桶是AWS提供的一个很好的资源。S3存储桶充当“容器”，允许用户在其中存储对象或数据，并且只要用户有适当的权限访问数据，就可以随时检索数据。虽然我们在本章不会深入研究S3，但是了解对S3资源进行侦察是AWS渗透测试的一个重要部分是很有必要的。我们将在[*第4章*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171)*，利用S3存储桶*中更深入地了解S3。然而，让我们看一下如何公开查询缺乏安全控制的S3存储桶。
- en: Open S3 buckets are one of the larger issues found in AWS environments. These
    types of vulnerabilities have created stressful and negatively impactful situations
    for organizations in the past and have had some companies even compromised and
    in the news – all due to open S3 buckets. We can help prevent this for our target
    by doing a quick search using a tool called **Grayhat Warfare**.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在AWS环境中，开放的S3存储桶是发现的较大问题之一。这些类型的漏洞过去曾经给组织带来了压力和负面影响，并且有一些公司甚至因为开放的S3存储桶而遭受了损害并成为新闻头条。我们可以通过使用一个叫做**Grayhat
    Warfare**的工具来帮助我们的目标防止这种情况。
- en: Grayhat Warfare is a web application tool that allows us to query for open S3
    buckets through the web application. This makes enumerating and recon fairly simple
    and easy since everything is laid out in a simple, yet efficient graphical user
    interface.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: Grayhat Warfare是一个Web应用程序工具，它允许我们通过Web应用程序查询开放的S3存储桶。这使得列举和侦察变得非常简单和容易，因为一切都以简单而高效的图形用户界面呈现出来。
- en: Important note
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'Grayhat Warfare can be found at the following link: [https://buckets.grayhatwarfare.com/](https://buckets.grayhatwarfare.com/).'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Grayhat Warfare可以在以下链接找到：[https://buckets.grayhatwarfare.com/](https://buckets.grayhatwarfare.com/)。
- en: 'The following screenshot shows a basic illustration of us querying for any
    open buckets on [packtpub.com](http://packtpub.com). As you can see, there are
    only two files open to the internet. Inspecting the files just from the web browser
    lets you know that they are image files – allowing us to assume that no impactful
    data is in the open:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 以下屏幕截图显示了我们在[packtpub.com](http://packtpub.com)上查询任何开放存储桶的基本示例。正如您所看到的，只有两个文件对互联网开放。通过从Web浏览器检查文件，您可以知道它们是图像文件，这让我们可以假设没有重要的数据是公开的：
- en: '![Figure 3.4 – Discovering open S3 buckets with Grayhat Warfare'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.4 - 使用Grayhat Warfare发现开放的S3存储桶'
- en: '](img/Figure_3.04_B15630.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.04_B15630.jpg)'
- en: Figure 3.4 – Discovering open S3 buckets with Grayhat Warfare
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.4 - 使用Grayhat Warfare发现开放的S3存储桶
- en: Now that we understand a little more about gathering information with S3 buckets,
    let's briefly look at and discuss a couple of other services that we will see
    throughout this book.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对使用S3存储桶收集信息有了更多了解，让我们简要地查看并讨论一些在本书中将会看到的其他服务。
- en: Lambda
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Lambda
- en: Lambda is a serverless computing service that allows users to run code in responses
    to queries and/or triggering events. The code run inside of Lambda is called a
    **Lambda function**. When the Lambda function is executed, it does whatever you
    want it to. Lambda is great to use for executing code against applications you
    have running in AWS.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: Lambda是一种无服务器计算服务，允许用户对查询和/或触发事件做出响应并运行代码。在Lambda内部运行的代码称为**Lambda函数**。当执行Lambda函数时，它会执行您想要的任何操作。Lambda非常适合用于针对在AWS中运行的应用程序执行代码。
- en: Important note
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'To find out more about Lambda, look here: [https://docs.aws.amazon.com/lambda/latest/dg/welcome.html](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html)'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解有关Lambda的更多信息，请查看这里：[https://docs.aws.amazon.com/lambda/latest/dg/welcome.html](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html)
- en: We will take a deeper look at Lambda later on in this book, in [*Chapter 7*](B15630_07_Final_ASB_ePub.xhtml#_idTextAnchor309)*,
    Assessing and Pentesting*. For now, understand that Lambda is a compute service
    that lets you run code without provisioning or managing servers. We will be executing
    more hands-on techniques in the referenced chapter.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本书的后面深入了解Lambda，在[*第7章*](B15630_07_Final_ASB_ePub.xhtml#_idTextAnchor309)*，评估和渗透测试*中。现在，了解Lambda是一种计算服务，可以让您在不需要预配或管理服务器的情况下运行代码。我们将在引用章节中执行更多的实际操作技术。
- en: Now let's keep moving forward and begin discussing EC2 instances.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们继续前进，开始讨论EC2实例。
- en: EC2 instances
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: EC2实例
- en: EC2 instances act as hosts for a specific operating system to be "hosted" on.
    Think of an EC2 instance as an actual device that belongs to someone else and
    allows you to "remotely" use that hardware to store and use an operating system
    on, and then your own applications. This instance then can be used to host applications
    and other services that companies can use to execute business practices.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: EC2实例充当特定操作系统的主机。将EC2实例视为属于他人的实际设备，允许您“远程”使用该硬件来存储和使用操作系统，然后是您自己的应用程序。然后，该实例可以用于托管公司可以用来执行业务实践的应用程序和其他服务。
- en: This enables companies and other organizations the flexibility to expand and
    scale their business without having to buy physical resources. As we already have,
    we will constantly be encountering using EC2 instances throughout this book.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这使公司和其他组织能够在不必购买物理资源的情况下扩展和扩展业务。正如我们已经了解的那样，在本书中我们将不断地遇到使用EC2实例。
- en: Recon and enumeration are the first things that you start with when executing
    a penetration test. It's essential to perform successful enumeration to help you
    better understand your targets, and be able to map out what services you find.
    Now that we understand these topics, let's move forward with how we enumerate
    information with scanning techniques!
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行渗透测试时，侦察和枚举是您开始的第一步。执行成功的枚举对于帮助您更好地了解目标并能够绘制出您发现的服务非常重要。现在我们了解了这些主题，让我们继续使用扫描技术来枚举信息！
- en: Scanning and examining targets for reconnaissance
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扫描和检查目标以进行侦察
- en: Scanning is one of the essential portions of testing AWS. Scanning allows you
    to see the overall posture of your instances and their environment. Doing so will
    enable you to view open ports, vulnerabilities, and service versions that an attacker
    may be able to exploit easily. As we move through this book, we will begin to
    use more and more scanning techniques and execute them to enumerate and exploit
    services.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描是测试AWS的基本部分之一。扫描可以让您查看实例及其环境的整体状况。这样做将使您能够查看开放的端口、漏洞和服务版本，攻击者可能能够轻松利用它们。随着我们在本书中的深入，我们将开始使用更多的扫描技术并执行它们来枚举和利用服务。
- en: In a real pentesting scenario, you would typically have a list of assets that
    needed to be scanned – unless this is a black-box assessment, in which case you
    would not know any information about the network. You then take the list of assets
    and scan them with various tools. If you use a tool such as Nmap, your primary
    mission would be to discover open ports and services. Ports allow us different
    avenues into systems, and the services running on them can sometimes give us an
    easy way in if the service is vulnerable and outdated.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在真实的渗透测试场景中，您通常会有一个需要扫描的资产清单 - 除非这是一个黑盒评估，在这种情况下，您将不会知道任何关于网络的信息。然后，您会拿出资产清单，并使用各种工具对其进行扫描。如果您使用诸如Nmap之类的工具，您的主要任务将是发现开放的端口和服务。端口为我们提供了进入系统的不同途径，而运行在这些端口上的服务有时会在服务易受攻击且过时的情况下为我们提供便捷的入口。
- en: Important note
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: For a quick recap on different styles of pentesting, such as white-box testing
    and black-box testing, revisit [*Chapter 2*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*,
    Pentesting and Ethical Hacking*.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 关于不同类型的渗透测试，如白盒测试和黑盒测试的快速回顾，请参阅[*第2章*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*，渗透测试和道德黑客*。
- en: On the other hand, you may need to run a vulnerability scan against the live
    host to get all the vulnerability information about every asset. Vulnerability
    scans are a great way to give a company an overall highlight of their security
    posture because they provide every vulnerability that is live on every single
    host in their system. The caveat is that pentesters typically need to be given
    credentials to system hosts that allow the scanner to authenticate with and scan
    the host. Giving credentials to the white hats makes the engagement a little less
    holistic because the testers already have usernames and passwords without having
    to pentest.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，您可能需要对活动主机运行漏洞扫描，以获取有关每个资产的所有漏洞信息。漏洞扫描是向公司提供其安全状况的整体概述的好方法，因为它提供了系统中每个主机上存在的每个漏洞。但是，渗透测试人员通常需要提供允许扫描器进行身份验证并扫描主机的系统主机的凭据。向白帽黑客提供凭据会使参与度略微降低，因为测试人员已经拥有用户名和密码，而无需进行渗透测试。
- en: Let's move forward and take a look at some of the tools we may use for scanning.
    Be advised that the next section will not be used as an exploiting exercise, but
    will discuss certain tools that are used for scanning and gathering information.
    We will be using various tools and techniques throughout the rest of this book
    about exploiting. However, we need to learn to walk before we can run, which we
    will see quite a bit throughout this book.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续并看看我们可能用于扫描的一些工具。请注意，下一节将不会用作利用练习，而是将讨论用于扫描和收集信息的某些工具。在本书的其余部分中，我们将使用各种工具和技术来进行利用。但是，我们需要学会走路才能跑，这在本书中会看到很多次。
- en: Important note
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: It's always important to understand the theory of a tool before applying the
    knowledge.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在应用知识之前，了解工具的理论是非常重要的。
- en: Metasploit
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Metasploit
- en: While Metasploit is known for its exploit modules and automated exploiting,
    it also serves as a fantastic tool that allows scanning. Within its libraries,
    it hosts what are called "auxiliary modules." These modules serve as tools that
    allow scanning and verification for vulnerabilities. You can also use Metasploit
    to scan for ports just like you would with Nmap – more on that in just a moment
    – and probe open TCP and UDP ports.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然Metasploit以其利用模块和自动利用而闻名，但它也是一个非常好的工具，可以进行扫描。在其库中，它拥有所谓的“辅助模块”。这些模块可以用作允许扫描和验证漏洞的工具。您还可以使用Metasploit来扫描端口，就像您使用Nmap一样
    - 稍后我们会详细介绍 - 并探测开放的TCP和UDP端口。
- en: Of course, looking for open ports and vulnerabilities is great, but proper enumeration
    is still key when pentesting. Metasploit helps alleviate some of that process
    and allows you to search for versions of services and default credentials, and
    can discover open web directories that you might not normally find. We will be
    spending quite a bit of time with Metasploit throughout this book, so don't worry!
    The possibilities are endless when adding Metasploit to your arsenal. Another
    tool that has endless possibilities with scanning is Nmap.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，寻找开放端口和漏洞是很好的，但在渗透测试中，适当的枚举仍然是关键。Metasploit有助于减轻一些流程，并允许您搜索服务的版本和默认凭据，并且可以发现您通常找不到的开放Web目录。在本书中，我们将花费相当多的时间来使用Metasploit，所以不用担心！将Metasploit添加到您的工具库中会有无限的可能性。另一个具有无限扫描可能性的工具是Nmap。
- en: Nmap
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Nmap
- en: We mentioned Nmap in [*Chapter 2*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*,
    Pentesting and Ethical Hacking*, however, it should be mentioned again that Nmap
    is a great asset to add to your scanning toolset. Nmap provides many scripts that
    allow you to enumerate versions of software running on various ports on your scanned
    targets. Finding versions of services allows you to be able to attack a service
    that may be outdated and have a public exploit for it.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[*第2章*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*《渗透测试和道德黑客》*中提到了Nmap，但是需要再次提到Nmap是一个非常好的工具，可以添加到您的扫描工具集中。Nmap提供了许多脚本，允许您枚举在扫描目标上运行的各种端口上的软件版本。找到服务的版本可以让您攻击可能过时并且有公开漏洞的服务。
- en: 'Let''s use Nmap to do a scan on [packtpub.com](http://packtpub.com) and see
    what information we can discover. The following steps illustrate how we can do
    this:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用Nmap对[packtpub.com](http://packtpub.com)进行扫描，看看我们能发现什么信息。以下步骤说明了我们如何做到这一点：
- en: 'To actively scan our target, do the following:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 要积极扫描我们的目标，请执行以下操作：
- en: Open a Terminal in Kali Linux.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Kali Linux中打开终端。
- en: 'Type the following command:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令：
- en: '[PRE3]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![Figure 3.5 – Discovering open S3 buckets with Grayhat Warfare'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.5 - 使用Grayhat Warfare发现开放的S3存储桶'
- en: '](img/Figure_3.05_B15630.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.05_B15630.jpg)'
- en: Figure 3.5 – Discovering open S3 buckets with Grayhat Warfare
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.5 - 使用Grayhat Warfare发现开放的S3存储桶
- en: Notice how we got some more information, such as an IP and hops to the address.
    This lets us know the path to the host.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 注意我们获得了一些更多的信息，比如IP和到地址的跳数。这让我们知道到主机的路径。
- en: Tip
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: 'SPARTA is a Python-based tool that gives you a graphical user interface to
    interact with your targets. While we won''t use SPARTA in this book, you might
    find it useful, depending on your needs. SPARTA combines various scans and checks
    at the click of a button. You can also import Nmap scans into SPARTA – making
    the possibilities endless for attack paths and automation. To learn more about
    SPARTA, check out the link here to discover more uses for the tool: [https://tools.kali.org/information-gathering/sparta](https://tools.kali.org/information-gathering/sparta).'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: SPARTA是一个基于Python的工具，为您提供了一个图形用户界面来与您的目标进行交互。虽然我们在本书中不会使用SPARTA，但根据您的需求，您可能会发现它很有用。SPARTA可以在点击按钮时结合各种扫描和检查。您还可以将Nmap扫描导入到SPARTA中
    - 这为攻击路径和自动化提供了无限的可能性。要了解有关SPARTA的更多信息，请查看此处的链接以发现工具的更多用途：[https://tools.kali.org/information-gathering/sparta](https://tools.kali.org/information-gathering/sparta)。
- en: Now let's discuss some more about AWS service tools, tips, and tricks.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们讨论一些关于AWS服务工具、技巧和窍门。
- en: LambdaGuard
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: LambdaGuard
- en: 'Lambda is a compute service where code can be executed, meaning the code only
    executes when it is supposed to – saving resources and money for the consumer.
    However, this isn''t to say that it comes without its issues – especially since
    it''s human-created code that drives Lambda environments. LambdaGuard is a tool
    that gives a visual on auditing Lambda services and scanning for any potential
    issues that could become attack vectors. Some of the other issues it may find
    could be the following:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: Lambda是一个计算服务，可以执行代码，这意味着只有在应该执行代码时才会执行-为消费者节省资源和金钱。然而，并不是说它没有问题-特别是因为它是由人类创建的代码驱动Lambda环境。LambdaGuard是一个工具，可以对审计Lambda服务进行可视化，并扫描可能成为攻击向量的潜在问题。它可能发现的其他问题包括以下内容：
- en: Public S3 buckets are publicly available and can be found on the internet by
    anyone. What that means is that you can query the public bucket and find information
    that may or may not be sensitive. Sensitive information such as personal information,
    credit card numbers, or health records could be a potential issue found in public
    buckets.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公共S3存储桶是公开可用的，任何人都可以在互联网上找到它们。这意味着您可以查询公共存储桶并找到可能敏感的信息。在公共存储桶中可能存在个人信息、信用卡号码或健康记录等敏感信息。
- en: Public API gateways act as a gate to the internet, however, that doesn't mean
    that everyone should have access to them. AWS API gateways are used for internal
    resources, and if left public, can allow anyone potential access to a network
    if the API is unsecured. However, know that public APIs are created to also allow
    authorized personnel within an environment.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公共API网关充当互联网的门户，但这并不意味着每个人都应该有权访问它们。AWS API网关用于内部资源，如果保持公开，可能会允许任何人潜在地访问网络，如果API没有得到保护。但是，请注意，公共API也是为了允许环境内的授权人员访问而创建的。
- en: Poorly configured policies create security issues that can turn into impactful
    situations. For example, a policy may be able to let someone bypass security restrictions
    and gain access to a resource, such as S3 buckets.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置不良的策略会产生安全问题，可能会演变成影响深远的情况。例如，策略可能允许某人绕过安全限制并访问资源，如S3存储桶。
- en: 'To install the tool, use the following steps:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装该工具，请按以下步骤操作：
- en: 'Use Git to pull the code from its repo:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Git从其存储库中拉取代码：
- en: '[PRE4]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Then change into the directory:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后切换到目录：
- en: '[PRE5]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once you go into the LambdaGuard working directory, move forward with installing
    the application by running the following command:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦进入LambdaGuard工作目录，继续通过运行以下命令来安装应用程序：
- en: '[PRE6]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: You should now be set to use the tool. I highly recommend using it and getting
    familiar with it, aside from this book.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您应该可以使用该工具了。我强烈建议您使用它并熟悉它，除了本书之外。
- en: S3 scanning
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: S3扫描
- en: Misconfigured S3 buckets have become quite an issue in recent years and are
    one of the top spots to look for issues when pentesting AWS. S3 buckets come with
    security "built in," but security permissions are then edited later on after individual
    configurations.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 最近几年，配置错误的S3存储桶已经成为一个相当严重的问题，并且是渗透测试AWS时寻找问题的热门地点之一。S3存储桶具有内置的安全性，但在个别配置后安全权限被修改。
- en: We will discuss a lot of information about S3 in [*Chapter 4*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171)*,
    Exploiting S3 Buckets*; it's prudent to understand that scanning is an essential
    function of recon and information gathering in regard to ethically hacking S3\.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[*第4章*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171)*，利用S3存储桶*中讨论大量关于S3的信息；重要的是要理解扫描是对S3进行侦察和信息收集的重要功能。
- en: In this case, we will focus on a brief overview of what is typically needed
    to scan an enterprise's S3 buckets. S3 buckets act as a "container" that stores
    information such as archives, PDF statements, and other redundant information.
    Scanning S3 buckets is essential to ensure that misconfigurations are not present.
    If so, they could leak information – such as the information mentioned – which
    could get into the wrong hands.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们将重点介绍扫描企业S3存储桶通常需要的简要概述。S3存储桶充当存储桶，存储诸如档案、PDF报表和其他冗余信息等信息。扫描S3存储桶对于确保不存在配置错误至关重要。如果存在配置错误，可能会泄露信息，例如上述提到的信息，这可能会落入错误的手中。
- en: Moving forward with the information we know about AWS and its services, let's
    start to discuss some of the different types of attackers and the potential attack
    paths we emulate based on these types of attackers.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 继续利用我们对AWS及其服务的了解，让我们开始讨论一些不同类型的攻击者以及我们可以模拟的潜在攻击路径。
- en: Knowing the attacker
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解攻击者
- en: Say you are on a pentesting assignment, and your client asks you to test their
    systems. There are a couple of ways we can do this. We can do it from an outsider
    perspective, or from an insider perspective. Both offer the client a different
    return of results and return on investment based on the client's business needs.
    Let's take a quick look at what exactly an **insider** and an **outsider** are.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您正在进行渗透测试任务，您的客户要求您测试他们的系统。我们可以通过几种方式来做这件事。我们可以从外部视角或内部视角进行测试。根据客户的业务需求，这两种方式都会为客户提供不同的结果和投资回报。让我们快速看一下**内部**和**外部**究竟是什么。
- en: Insiders
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 内部人员
- en: The more common request will be from an insider perspective. Insiders are considered
    employees or someone with access to the client's systems. This means you, the
    tester, would be given the information needed to connect to the AWS environment.
    You'll be given an account ID and credentials to access the cloud environment,
    and from there can let your scripts run to find issues in S3.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 更常见的请求将来自内部视角。内部人员被认为是员工或者有权访问客户系统的人。这意味着您作为测试人员将获得连接到AWS环境所需的信息。您将获得一个帐户ID和凭据来访问云环境，然后可以让您的脚本运行以发现S3中的问题。
- en: Often, white-box pentesting will be combined with an insider perspective. What
    that translates into is the client needs the pentesting firm to check for anything
    and everything in the system. That means the scope of the pentest will lay out
    all systems and credentials required to access those systems, allowing testers
    to find anything vulnerable and exploitable.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，白盒渗透测试将与内部人员的视角相结合。这意味着客户需要渗透测试公司检查系统中的任何事物。这意味着渗透测试的范围将列出所有系统和访问这些系统所需的凭据，允许测试人员找到任何脆弱和可利用的东西。
- en: 'Now, there are different types of insiders that you may have to emulate to
    fit the specific need or goal of a client for their requested pentest. It is important
    that you understand the various types of malicious insiders that can pose a threat
    to an organization. Here is a list of a few that you should take note of:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，有不同类型的内部人员，你可能需要模拟以满足客户对其请求的渗透测试的特定需求或目标。重要的是，你了解可能对组织构成威胁的各种恶意内部人员。以下是一些你应该注意的类型：
- en: '**Emotional Attacker**: These are individuals who have let their emotions run
    rampant and take a malicious turn for the worse. Oftentimes, these attackers are
    previous and current disgruntled employees. The reasons they are disgruntled vary,
    but the mission is typically always the same: exfiltrate data for profit or a
    competing company. It would be best if you looked at the business and people processes
    when pentesting to ensure that insiders such as these are not making malicious
    or intended changes that could hurt their company.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**情绪攻击者**：这些人让自己的情绪失控，并采取了恶意的转变。通常情况下，这些攻击者是之前和现在不满的员工。他们不满的原因各不相同，但任务通常都是一样的：为了利润或竞争对手窃取数据。在进行渗透测试时，最好查看业务和人员流程，以确保这些内部人员不会做出可能伤害公司的恶意或有意的改变。'
- en: '**Unintentional and Inadvertent**: This type of insider is not so much an attacker
    as they are unaware of their own actions. For example, a database administrator
    may have accidentally dropped a table with important client information in it.
    Unaware to them, they may have just not fully understood what they did, and just
    lack training.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无意和无意的**：这种类型的内部人员并不是攻击者，他们并不知道自己的行为。例如，数据库管理员可能会意外删除了一个包含重要客户信息的表。他们可能并不知道自己做了什么，只是缺乏培训。'
- en: The difference between the event being an accident and a threat is if the individual
    persists. If they persist, then it may not be a lack of knowledge and could be
    something else. Ensuring employees are being trained and followed up with regularly
    will help alleviate the possibilities of this type of incident taking a turn for
    the worse. Also, it's essential to keep an eye on them because they are the most
    vulnerable to attackers. While we wouldn't necessarily emulate this type of insider,
    it is good knowledge to have.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 事件是意外还是威胁的区别在于个体是否持续。如果他们持续下去，那么可能不是缺乏知识，而可能是其他原因。确保员工接受培训并定期跟进将有助于减轻这种类型事件可能恶化的可能性。此外，密切关注他们是至关重要的，因为他们最容易受到攻击。虽然我们不一定会模拟这种类型的内部人员，但了解这些是很有用的。
- en: '**Persistent Insider**: One of the most dangerous threats of all is the persistent
    one. This means that this individual will do whatever it takes to get the information
    or results that they desire. Their reasoning can vary from situation to situation,
    but their thirst for exploitation or profit makes them stubborn and determined.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**持续内部人员**：最危险的威胁之一就是持续的威胁。这意味着这个人会不惜一切手段获取他们想要的信息或结果。他们的理由可能因情况而异，但他们对利用或利润的渴望使他们固执而坚定。'
- en: Outsiders
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 外部人员
- en: Outsiders are considered anyone who does not work directly with the company,
    including contractors and less privileged personnel such as visitors or third-party
    vendors. At times, some individuals can be considered **near-siders** – but in
    this book, we will stick with calling them outsiders, to keep things simple.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 外部人员包括与公司直接合作的任何人，包括承包商和特权较低的人员，如访客或第三方供应商。有时，一些人可能被认为是**近端人员**- 但在本书中，我们将坚持称他们为外部人员，以保持简单。
- en: An outsider is someone who has to have authorized access to the system and shouldn't
    have any knowledge about that target system. The critical word to remember here
    is the word "authorized" because there may be an unfortunate time when an outsider
    may have unauthorized access – which is still considered access.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 外部人员是指必须获得系统授权访问但不应该对目标系统有任何了解的人。这里要记住的关键词是“授权”，因为可能会有不幸的时候，外部人员可能会获得未经授权的访问-这仍然被视为访问。
- en: Outsiders vary in descriptions and can be anyone from a script kiddie that is
    using others' code to attempt to exploit a web server, or could be a nation-state-sponsored
    threat – typically, an **Advanced Persistent Threat** (**APT**) – that will stop
    at nothing to get hold of a system and has the power and funding from the client
    to do so. In many cases, APT clients or funding comes directly from their government.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 外部人员的描述各不相同，可以是试图利用他人代码攻击Web服务器的脚本小子，也可以是一个不惜一切代价获取系统控制权的国家支持的威胁，通常是**高级持续威胁**（**APT**）-
    他们有权力和资金来实现这一目标。在许多情况下，APT的客户或资金直接来自他们的政府。
- en: Now that we understand various attackers, let's move forward and discuss attack
    paths and how these attackers use scenarios to execute attacks.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们了解了各种攻击者，让我们继续讨论攻击路径以及这些攻击者如何使用场景来执行攻击。
- en: Creating attack paths
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建攻击路径
- en: An attack path involves using information gathered from your target to make
    a "story" or "scenario" on how you or an actual threat could leverage that information
    to exploit the target system or application. There are frameworks on the net that
    allow you to get an idea of attack paths from actual previous events.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击路径涉及使用从目标处收集的信息，制定一个关于你或实际威胁如何利用这些信息来利用目标系统或应用程序的“故事”或“场景”。网络上有一些框架可以让你从实际先前事件中获取攻击路径的想法。
- en: Tip
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: 'While it''s a little off course for this book, I would highly recommend looking
    at the MITRE ATT&CK framework for more information: [https://attack.mitre.org/](https://attack.mitre.org/).'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这与本书的主题有些偏离，但我强烈建议查看MITRE ATT&CK框架获取更多信息：[https://attack.mitre.org/](https://attack.mitre.org/)。
- en: With various attack scenarios, comes different ways to pentest. Some scenarios
    require a holistic approach, and some are more goal-oriented. It's important to
    understand what information you will need to know before even beginning to scan
    and attempting to connect to any AWS appliance, or even before testing! Some clients
    may have a more natural approach, while others will have a direct target they
    want you to attack and attempt to exploit.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的攻击场景需要不同的渗透测试方式。有些场景需要全面的方法，有些则更加目标导向。在甚至开始扫描和尝试连接到任何AWS设备之前，了解您需要知道的信息是非常重要的！一些客户可能有更自然的方法，而另一些客户则会有一个直接的目标，他们希望您攻击并尝试利用。
- en: Organic attack paths
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 有机攻击路径
- en: Organic attack paths consist of exploiting a system in a natural way. What this
    means is you – the tester – are not given a specific target and should approach
    the system in whatever **ethical** means are possible. We highlight the word ethical
    because it's paramount to ensure the safety of the client and yourself.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 有机攻击路径包括以一种自然的方式利用系统。这意味着您——测试人员——没有被给予一个特定的目标，应该以任何**道德**方式接近系统。我们强调“道德”这个词，因为确保客户和自己的安全至关重要。
- en: 'An organic attack path could look something like the following:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 有机攻击路径可能如下所示：
- en: The tester is given **rules of engagement** (**ROE**) and an overview of the
    system architecture.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员被给予**规则约束**（**ROE**）和系统架构概述。
- en: The tester sends a phishing email.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员发送钓鱼邮件。
- en: A highly privileged user clicks on a phishing email, allowing the tester to
    get admin credentials for the domain.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个权限很高的用户点击了一封钓鱼邮件，允许测试人员获取域的管理员凭据。
- en: The tester is able to pivot from machine to machine.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员能够从一台机器转移到另一台机器。
- en: After making lateral movements on the network, the tester is able to get **domain
    admin**. Once establishing as domain admin, the tester is able to perform any
    actions within the target environment.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在网络上进行横向移动后，测试人员能够获得**域管理员**。一旦建立为域管理员，测试人员就能在目标环境中执行任何操作。
- en: Getting domain admin on the **domain controller** is often sought after as the
    main goal of pentesting. Essentially, if a user has domain admin to the network,
    they own the network – the term "own" here meaning they have full control of the
    network.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 获得**域控制器**上的域管理员通常是渗透测试的主要目标。基本上，如果用户对网络拥有域管理员权限，他们就拥有了网络——这里的“拥有”意味着他们对网络拥有了完全控制权。
- en: Sometimes, getting domain admin is not the goal of pentesting. Different engagements
    will have different scopes, and a different scope could entail a different objective.
    These types of engagements are known as "goal-based" engagements.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，获得域管理员并不是渗透测试的目标。不同的项目将有不同的范围，不同的范围可能包含不同的目标。这些类型的项目被称为“目标导向”项目。
- en: Goal-based attack paths
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 目标导向攻击路径
- en: Goal-based attack paths consist of exploiting a particular target for the client
    organization while staying in scope, of course. The purpose of a goal-based assessment
    may be to test a system that is being pushed to production or could be used to
    copy the attack methods of a particular **Advanced Persistent Threat** (**APT**).
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 目标导向攻击路径包括利用客户组织的特定目标，同时保持在范围内。目标导向评估的目的可能是测试一个即将投入生产的系统，或者用于复制特定**高级持续威胁**（**APT**）的攻击方法。
- en: A client could want a system to be tested in the same way a particular adversary
    might attack them. This is common in the defence industry and is used to test
    the defense capabilities of systems. Clients may want to ensure they are up to
    date and can detect and respond – just in case something were to happen.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 客户可能希望以与特定对手可能攻击他们的方式来测试系统。这在国防工业中很常见，用于测试系统的防御能力。客户可能希望确保他们的系统是最新的，并且能够检测和响应——以防发生意外。
- en: AWS attack paths
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: AWS攻击路径
- en: AWS attacks are not so conventional in pentesting yet. Largely due to the newer
    implementations of AWS, not all pentesting and adversarial emulations have caught
    up to AWS. However, that doesn't mean that we can still use our conventional thinking
    of creating attack paths that can't be applied to AWS. The following shows a way
    we could attack an AWS instance as a pentesting engagement or exercise.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: AWS攻击在渗透测试中并不那么常见。这在很大程度上是由于AWS的新实施，不是所有的渗透测试和对抗模拟都跟得上AWS。然而，这并不意味着我们仍然可以使用我们传统的思维方式来创建攻击路径，这些路径不能应用于AWS。以下展示了我们在渗透测试或练习中可以攻击AWS实例的一种方式。
- en: 'When it comes to AWS, attack paths often look something like this:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在AWS方面，攻击路径通常如下所示：
- en: The tester scans the internet for public S3 buckets.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员在互联网上搜索公共S3存储桶。
- en: The tester scans for common bucket names and finds a match.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员搜索常见的存储桶名称并找到匹配项。
- en: The tester scans for objects in the bucket.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员在存储桶中搜索对象。
- en: The tester finds matches and exfiltrates information.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试人员找到匹配项并泄露信息。
- en: Note that you may be given credentials to access the AWS environment that will
    allow you to access the system as an insider. If given credentials to access the
    system, it's prudent to look for misconfigurations that may have been implemented
    by staff after creating the S3 buckets. It's important to look at this potential
    issue because it could lead to more adverse side effects such as information getting
    leaked, or allowing an unauthorized user to view information that they shouldn't
    be able to view.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，您可能会被提供凭据以访问AWS环境，这将允许您以内部人员的身份访问系统。如果给予访问系统的凭据，最好查找员工在创建S3存储桶后可能实施的错误配置。查看这个潜在问题很重要，因为它可能导致更严重的副作用，比如信息泄露，或者允许未经授权的用户查看他们不应该查看的信息。
- en: Pentesting attack paths
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 渗透测试攻击路径
- en: Your attack path in a real-world pentesting scenario will vary from engagement
    to engagement, with an engagement being the pentest itself, and every aspect of
    that individual pentest. It's prudent to do your homework on a client site before
    engaging in the pentest to ensure that you have enough information gathered to
    perform an efficient and effective pentest for the target organization. To start
    gathering information, you can use Google to search for various attributes of
    a target. Perhaps you can find emails and phone numbers for a target, or even
    find public S3 buckets that store important information.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在真实世界的渗透测试场景中，您的攻击路径会因参与而异，参与即为渗透测试本身，以及该渗透测试的每个方面。在进行渗透测试之前，对客户网站进行功课是明智的，以确保您已经收集到足够的信息，以便为目标组织执行高效和有效的渗透测试。要开始收集信息，您可以使用Google搜索目标的各种属性。也许您可以找到目标的电子邮件和电话号码，甚至找到存储重要信息的公共S3存储桶。
- en: Red teaming for businesses
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 企业的红队行动
- en: Red teaming isn't so much of an attack path as it is a quality assurance check
    on business processes and policies. Red teaming can involve a view of a different
    area of pentesting as well as a hybrid mix of attack paths, depending on what
    the client may need or want. Because of its flexibility and intensity, red teaming
    tests all aspects of businesses. However, it's important to understand clients
    will need to have mature business models before pentesting them.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 红队行动并不是一种攻击路径，而是对企业流程和政策的质量保证检查。红队行动可以涉及对渗透测试的不同领域的观察，以及根据客户的需求或要求，混合攻击路径。由于其灵活性和强度，红队行动测试企业的所有方面。然而，重要的是要理解客户在进行渗透测试之前需要拥有成熟的商业模式。
- en: Often, clients benefit more from a vulnerability assessment or a basic pentest
    before assessing a company with a red team engagement. Companies need to have
    a business model and security program that is mature and robust to its full potential,
    otherwise, a red team exercise will not be able to highlight the full scope of
    issues within a company.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，客户在对公司进行红队参与评估之前，会更多地从漏洞评估或基本的渗透测试中受益。公司需要拥有一个成熟和强大的商业模式和安全计划，否则，红队行动将无法突出公司内部问题的全部范围。
- en: Diving into the attacker mindset
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 深入攻击者心态
- en: This subject is a little more taboo but is something that will be mentioned
    time and time again over the course of this book. Hacking has always been taboo
    due to its usage in criminal activity such as stealing data and attacking governments.
    However, in recent years, it has become much more mainstream and is now used to
    test companies and allow them to get a real sense of what their security posture
    looks like.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 这个主题有点禁忌，但在本书的过程中会一再提到。由于黑客术被用于窃取数据和攻击政府等犯罪活动，黑客术一直是禁忌。然而，近年来，它变得更加主流，现在被用于测试公司并让它们真正了解其安全姿态。
- en: It's crucial to understand the attacker mindset because it's what sets good
    results apart from great results. Good results come from understanding systems,
    how they work, and providing a detailed report to your client on how to fix and
    remediate vulnerabilities. A white-hat hacker with an attacker mindset is able
    to provide insight on how malicious hackers would break into a system by whatever
    means necessary.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 了解攻击者的心态至关重要，因为这是优秀结果和出色结果之间的区别所在。优秀的结果来自于对系统的理解，以及向客户提供详细报告，指出如何修复和消除漏洞。具有攻击者心态的白帽黑客能够提供关于恶意黑客如何通过任何必要手段侵入系统的见解。
- en: We have now discussed quite a few different topics. We went from discussing
    recon and how we gather information and then discussed different attacker types
    to help illustrate what impact information can have on a company. Now, let's take
    a look at some hands-on exercises and apply this information. However, first,
    let's mention something important – SSH keys.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经讨论了很多不同的主题。我们从讨论侦察和信息收集开始，然后讨论了不同的攻击者类型，以帮助说明信息对公司的影响。现在，让我们来看一些实际操作的练习，并应用这些信息。不过，首先，让我们提到一些重要的东西
    - SSH密钥。
- en: Discovering SSH keys
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现SSH密钥
- en: '**SSH**, or **secure shell**, is a common login service that various system
    administrators implement in their infrastructure. The fast and secure system makes
    the service ideal for security purposes, as well as "feasibility" due to its key-like
    infrastructure. The keys make authentication seamless, much like we did back in
    [*Chapter 1*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*, Building Your
    AWS Environment*, with the keys that we downloaded from our AWS instance. Those
    keys give us "the keys to the kingdom," so to speak, and allow us access to our
    AWS instances.'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH**，或**安全外壳**，是各种系统管理员在其基础设施中实施的常见登录服务。这种快速和安全的系统使该服务成为安全目的的理想选择，同时也因其类似密钥的基础设施而具有“可行性”。密钥使身份验证变得无缝，就像我们在[*第1章*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*，构建您的AWS环境*中所做的那样，使用我们从AWS实例中下载的密钥。这些密钥给了我们“王国的钥匙”，让我们能够访问我们的AWS实例。'
- en: How the keys work
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 密钥的工作原理
- en: A private and public key must be made to use the service. When creating a key
    pair, a private key is generated and stored on the system. In this case, the keys
    are stored in our EC2 instances. Private keys are keys that should never be shared
    with anyone, ever. Recent years have shed light on private exposures and the damage
    they have caused companies.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 必须创建一个私钥和公钥来使用该服务。创建密钥对时，会生成并存储一个私钥在系统中。在这种情况下，密钥存储在我们的EC2实例中。私钥是绝对不应该与任何人分享的密钥。近年来，私钥的曝光和造成公司的损害已经引起了关注。
- en: '![Figure 3.6 – Public and private key illustration'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.6 - 公钥和私钥示意图'
- en: '](img/Figure_3.06_B15630.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.06_B15630.jpg)'
- en: Figure 3.6 – Public and private key illustration
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.6 - 公钥和私钥示意图
- en: The private key is only the first portion of the authentication relationship.
    There needs to be a public key generated that allows users to authenticate to
    the system. The public key is held by the user – in this case, us – and ensures
    that traffic is encrypted back and forth from the client and the server. If the
    public key does not match with a list of authorized keys on the server, then authentication
    will fail and the user will not be able to sign on to the server. You can find
    these keys stored in `~/.ssh` on your Linux instance.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 私钥只是认证关系的第一部分。需要生成一个公钥，允许用户对系统进行身份验证。公钥由用户持有 - 在这种情况下，是我们 - 并确保来回的流量从客户端到服务器都是加密的。如果公钥与服务器上授权密钥列表不匹配，那么身份验证将失败，用户将无法登录到服务器。您可以在Linux实例的`~/.ssh`中找到这些密钥存储。
- en: Good hygiene
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 良好的卫生习惯
- en: A good practice is to never store your private keys in an unsafe place such
    as an open web directory. An open share is a file that may be a directory that
    can be accessed via anonymous FTP. Losing a private key to a server can have serious
    consequences that may be difficult to overcome. Always remember to **never** share
    private keys and to have them stored in a place that has access controls that
    won't allow unauthorized users access to the keys.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 一个好的做法是永远不要将您的私钥存储在不安全的地方，比如一个开放的Web目录。开放共享是一个可能是可以通过匿名FTP访问的目录的文件。丢失服务器的私钥可能会带来严重的后果，可能难以克服。请记住**永远**不要分享私钥，并将它们存储在一个具有访问控制的地方，不允许未经授权的用户访问密钥。
- en: Now that we understand what these SSH keys are used for, let's put this knowledge
    to good use and connect to our EC2 instance!
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了这些SSH密钥的用途，让我们把这些知识应用到实践中，连接到我们的EC2实例！
- en: Scanning and connecting to AWS
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扫描和连接到AWS
- en: Now we are going to be scanning systems inside of AWS. This plays an important
    part in pentesting because, as we mentioned, scanning and enumeration comprise
    the first technical portion of pentesting AWS and general pentesting engagements.
    It's important to know where to start when beginning to pentest AWS environments.
    Assuming that all prerequisites have been met, and all things are in order, moving
    forward with scanning and connecting to instances should be the next logical component
    of testing AWS.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将扫描AWS内部的系统。这在渗透测试中起着重要作用，因为正如我们提到的，扫描和枚举构成了AWS和一般渗透测试的第一个技术部分。在开始对AWS环境进行渗透测试时，了解从何处开始是很重要的。假设所有先决条件都已满足，并且一切都井井有条，那么继续扫描和连接到实例应该是测试AWS的下一个逻辑组成部分。
- en: Before we begin, ensure that your Windows host is up and running. Log into the
    AWS management console and look back at [*Chapter 1*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*,
    Building Your AWS Environment*, if you need a refresher – then return back here.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，请确保您的Windows主机正在运行。登录到AWS管理控制台，回顾[*第1章*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*，构建您的AWS环境*，如果需要复习
    - 然后返回到这里。
- en: Once you're ready to go, we are going to move forward and start using Nmap to
    scan our AWS environment.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦准备好，我们将继续使用Nmap来扫描我们的AWS环境。
- en: Scanning with Nmap
  id: totrans-200
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Nmap进行扫描
- en: 'Now let''s put Nmap into action and use it to check out the Windows 2008 server
    and poke around at the open RDP port we have enabled on the system:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们让Nmap发挥作用，用它来检查Windows 2008服务器，并查看我们在系统上启用的开放RDP端口：
- en: To start, we will look at the host by scanning it with Nmap. This will allow
    us to check and see if **Remote Desktop Protocol** (**RDP**) is open. RDP will
    allow us to remotely connect to the host from our own machine.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将通过Nmap扫描主机来查看主机。这将允许我们检查并查看**远程桌面协议**（**RDP**）是否开放。RDP将允许我们从我们自己的机器远程连接到主机。
- en: 'To scan the host, use your Kali Linux host that we set up earlier on, back
    in [*Chapter 1*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*, Building Your
    AWS Environment*. Once your host is up and running, open a Terminal and fire off
    the following command:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要扫描主机，请使用我们之前设置的Kali Linux主机，在[*第1章*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*，构建您的AWS环境*。一旦您的主机正在运行，打开终端并执行以下命令：
- en: '[PRE7]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Let''s do a quick breakdown of this simple, yet effective command. The following
    switches are used:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速分解一下这个简单而有效的命令。使用了以下开关：
- en: '`-p`: Indicates what ports we want to probe for, with probe meaning send a
    request in an attempt to get a response back from the host. In this case, we are
    checking for port `3389`, which is the port that correlates with RDP. If we wanted
    to scan for more ports, we could add them by separating the ports with a comma.
    We can also scan a range, such as using the following command to scan for the
    first 100 ports:'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p`：指示我们要探测的端口，探测意味着发送请求，试图从主机获取响应。在这种情况下，我们正在检查端口`3389`，这是与RDP相关的端口。如果我们想要扫描更多端口，可以通过用逗号分隔端口来添加它们。我们还可以扫描一个范围，例如使用以下命令扫描前100个端口：'
- en: '[PRE8]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '`-Pn`: This switch disabled `ping` from the `nmap` scan. `ping` can often cause
    unwanted noise, and at times will not give you a decent output on a scanned host,
    if the host doesn''t respond to `ping`. It is important to note that if a host
    does not respond to `ping`, then it doesn''t mean the host is not alive because
    it''s common for hosts not to respond to `ping`. Especially with AWS environments,
    make sure you get used to using the `-Pn` switch with `nmap` scans.'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-Pn`：此开关禁用了`nmap`扫描的`ping`。`ping`通常会引起不必要的噪音，并且有时不会给出对扫描主机的合理输出，如果主机不响应`ping`。重要的是要注意，如果主机不响应`ping`，那么这并不意味着主机不活着，因为主机不响应`ping`是很常见的。特别是在AWS环境中，确保习惯使用`nmap`扫描的`-Pn`开关。'
- en: 'Once your scan has finished, you will be given feedback alerting you that RDP
    is open and be given output that looks like the following:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描完成后，您将收到反馈，提示RDP已开放，并给出以下类似的输出：
- en: '![Figure 3.7 – Scanning for RDP'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.7 - 扫描RDP'
- en: '](img/Figure_3.07_B15630.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.07_B15630.jpg)'
- en: Figure 3.7 – Scanning for RDP
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.7 - 扫描RDP
- en: As you can see, our instance is showing the host is in fact running and has
    port `3389`, Remote Desktop open, and will allow us to connect to it. Before we
    look at connecting to the host with RDP open, let's take a look at how we can
    use Metasploit to scan for RDP. The reason we want to try this is it is good practice
    to test various tools against a host. Ultimately, this gives you options just
    in case you need to use a specific tool.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，我们的实例显示主机实际上正在运行，并且端口`3389`，远程桌面是开放的，并且允许我们连接。在查看打开RDP的主机之前，让我们看看如何使用Metasploit来扫描RDP。我们想要尝试这样做的原因是测试针对主机的各种工具是一个很好的实践。最终，这为你提供了选择的机会，以防你需要使用特定的工具。
- en: Starting Metasploit
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动Metasploit
- en: You can use Metasploit to scan, and in this case, since we are only looking
    at RDP, we just need to use a port scanner module in Metasploit to probe for the
    open port. As we mentioned, it is good practice to be able to use different tools
    to execute in a scenario just in case one tool doesn't work and you don't have
    time to troubleshoot. The following steps will discuss the steps needed to scan
    our host with Metasploit.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用Metasploit进行扫描，在这种情况下，由于我们只关注RDP，我们只需要使用Metasploit中的端口扫描模块来探测开放的端口。正如我们提到的，能够使用不同的工具来执行场景是一个好的实践，以防一个工具不起作用，而你又没有时间进行故障排除。接下来的步骤将讨论使用Metasploit扫描我们的主机所需的步骤。
- en: 'Ensure that Metasploit is started:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 确保Metasploit已经启动：
- en: '[PRE9]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You should now have a Terminal that gives you the main background to Metasploit:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该有一个终端，可以为你提供Metasploit的主要背景：
- en: '![Figure 3.8 – Metasploit console'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.8-Metasploit控制台'
- en: '](img/Figure_3.08_B15630.jpg)'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.08_B15630.jpg)'
- en: Figure 3.8 – Metasploit console
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.8-Metasploit控制台
- en: If this were a real engagement, such as a pentest for a client, the next step
    would be to connect to the resource and begin assessing the AWS resources. It's
    important to get credentials for the host that you will interact with during an
    engagement. In this case, we already have the information we need and can grab
    our credentials from the Windows machine we set up.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这是一个真实的参与，比如为客户进行的渗透测试，下一步将是连接到资源并开始评估AWS资源。在参与过程中，获取与主机交互所需的凭据非常重要。在这种情况下，我们已经拥有了所需的信息，并可以从我们设置的Windows机器中获取我们的凭据。
- en: Now that we have Metasploit started, it's time to take a look at a few different
    scanning modules that we can use to scan RDP on the host. We will be using Metasploit
    on our local Kali instance for these next steps, however, feel free to use the
    Kali image in AWS if you choose to do so.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经启动了Metasploit，是时候看一看我们可以用来扫描主机上的RDP的几个不同的扫描模块了。在接下来的步骤中，我们将在我们本地的Kali实例上使用Metasploit，但是，如果你选择这样做，也可以在AWS中使用Kali镜像。
- en: TCP scanning with Metasploit
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Metasploit进行TCP扫描
- en: 'Next, we want to be able to scan our Windows host and check for open ports.
    Metasploit offers various modules to execute scanning your host. Each module offers
    different techniques and scans for various services. Before we launch our scan,
    let''s talk about a couple of the modules:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们想要扫描我们的Windows主机并检查开放的端口。Metasploit提供了各种模块来执行扫描你的主机。每个模块提供不同的技术和针对各种服务的扫描。在启动扫描之前，让我们谈谈其中一些模块：
- en: 'First, type the following into your Metasploit Terminal:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，在你的Metasploit终端中输入以下内容：
- en: '[PRE10]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'If you type in the command correctly, you should be given a prompt that looks
    something like the following:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正确输入命令，你应该会得到一个类似以下的提示：
- en: '![Figure 3.9 – Portscan Metasploit modules'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.9-端口扫描Metasploit模块'
- en: '](img/Figure_3.09_B15630.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.09_B15630.jpg)'
- en: Figure 3.9 – Portscan Metasploit modules
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.9-端口扫描Metasploit模块
- en: If you did not get results that look like the preceding screenshot, then please
    update your Metasploit and then come back to this portion of the chapter.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有得到类似前面截图的结果，请更新你的Metasploit，然后再回到本章的这部分。
- en: Next, we are going to use a TCP scan. A TCP scan is going to execute the full
    TCP 3-way handshake and make a full connection to the host in order to enumerate
    the host. This does not mean that our machine is going to authenticate to the
    host – more on that later. Our host is going to send a `3389` (RDP).
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将使用TCP扫描。TCP扫描将执行完整的TCP三次握手并与主机建立完整连接，以枚举主机。这并不意味着我们的机器将对主机进行身份验证-稍后会详细介绍。我们的主机将发送`3389`（RDP）。
- en: 'Moving back to using Metasploit, we are going to be using the TCP portscan
    module to perform the 3-way handshake and get the information we so desire. With
    Metasploit started, type in the following to use the TCP port scanner:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 回到使用Metasploit，我们将使用TCP端口扫描模块执行3次握手，并获取我们所需的信息。启动Metasploit后，输入以下内容使用TCP端口扫描器：
- en: '[PRE11]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'You''ll need to change a few parameters in the module before we can see whether
    port `3389` is open. First, you''ll need to type the `options` command to view
    the parameters (Metasploit labels them as options) and set those parameters to
    fit your needs. In this case, we are only going to change the following parameters:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们能够看到端口`3389`是否开放之前，你需要在模块中更改一些参数。首先，你需要输入`options`命令查看参数（Metasploit将它们标记为选项），并设置这些参数以适应你的需求。在这种情况下，我们只会更改以下参数：
- en: '`RHOSTS`: This option is set to the target that you want to test, or in this
    case, the target that we want to scan. Set the option to your AWS instance''s
    public DNS address.'
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`RHOSTS`：此选项设置为你要测试的目标，或者在这种情况下，我们要扫描的目标。将选项设置为你的AWS实例的公共DNS地址。'
- en: '`PORTS`: This option can be set to a single port, or a range – much like how
    ports are set in Nmap. In this case, we are going to use port `3389`.'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`PORTS`：此选项可以设置为单个端口或范围-就像在Nmap中设置端口一样。在这种情况下，我们将使用端口`3389`。'
- en: 'Ensure that you set those parameters correctly. If you find yourself second-guessing
    yourself, you can type the `options` command to view what your current options
    are set to. After that, you can type the `run` or `exploit` commands to execute
    the module:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 确保正确设置这些参数。如果你发现自己在犹豫不决，你可以输入`options`命令查看当前设置的选项。之后，你可以输入`run`或`exploit`命令来执行模块：
- en: '![Figure 3.11 – Using Metasploit for port scanning'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.11-使用Metasploit进行端口扫描'
- en: '](img/Figure_3.11_B15630.jpg)'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.11_B15630.jpg)'
- en: Figure 3.11 – Using Metasploit for port scanning
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.11 – 使用Metasploit进行端口扫描
- en: 'As you can see, we are provided with output telling us port `3389` is open
    on our host. This is displayed to us by the module using the following format:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，我们得到了输出，告诉我们端口`3389`在我们的主机上是开放的。这是由模块使用以下格式向我们显示的：
- en: '[PRE12]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Great news – we have successfully scanned our Windows host with Metasploit!
    Now that we know how the TCP scan module works, let's take a look at a different
    module that can be used for a less intrusive scan.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 好消息 – 我们已经成功地用Metasploit扫描了我们的Windows主机！现在我们知道了TCP扫描模块的工作原理，让我们来看看可以用于较少侵入性扫描的不同模块。
- en: ACK scanning with Metasploit
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Metasploit进行ACK扫描
- en: Next, we are going to use a scan that I like to use to see whether ports are
    filtered or not. Often, ports will be filtered to only allow specific traffic
    in, or only a particular host to use that port. This often makes pentesters use
    spoofing attacks to try and compromise the service, or just move on to something
    else.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将使用一种我喜欢用来查看端口是否被过滤的扫描。通常，端口将被过滤以仅允许特定的流量进入，或者只允许特定的主机使用该端口。这经常使渗透测试人员使用欺骗攻击来尝试破坏服务，或者只是转移到其他事物。
- en: A great way to check and see if a port is filtered or not is by using an ACK
    scan. This type of scan works by the host sending an `3389` is unfiltered or not.
    If it's unfiltered, then we can attempt to move forward on that port. In the case
    of our lab environment, the port will be open – however, if this were a real pentest
    and we were told that a port *was* filtered, it would be prudent to look at other
    ports and services that weren't filtered.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 检查端口是否被过滤的一个好方法是使用ACK扫描。这种类型的扫描是由主机发送一个`3389`是否被过滤。如果它没有被过滤，那么我们可以尝试在该端口上继续。在我们的实验环境中，该端口将是开放的
    – 然而，如果这是一个真正的渗透测试，并且我们被告知某个端口*被*过滤了，那么看看其他没有被过滤的端口和服务是明智的。
- en: 'Before we move forward, look at the following diagram, which displays a brief
    overview of how an ACK scan works. This picture is a very simple breakdown of
    how this scan works and what it could be used for:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们继续之前，看一下下面的图表，它显示了ACK扫描的简要概述。这张图片是对这种扫描如何工作以及可以用于什么的一个非常简单的分解：
- en: '![Figure 3.12 – ACK scanning'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.12 – ACK扫描'
- en: '](img/Figure_3.12_B15630.jpg)'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.12_B15630.jpg)'
- en: Figure 3.12 – ACK scanning
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.12 – ACK扫描
- en: 'Now that we have a general understanding of ACK scanning, let''s use the following
    module to get the job done:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对ACK扫描有了一个基本的理解，让我们使用以下模块来完成工作：
- en: '[PRE13]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Just like before, we are going to need to set the parameters for our module.
    We can accomplish this by setting the same parameters as we did previously for
    our TCP scan. Just as before, set your parameters and run your scan against your
    AWS host:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 就像以前一样，我们需要为我们的模块设置参数。我们可以通过设置与我们之前为TCP扫描设置的相同参数来实现这一点。就像以前一样，设置您的参数并对您的AWS主机运行扫描：
- en: '![Figure 3.13 – ACK scanning with Metasploit'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.13 – 使用Metasploit进行ACK扫描'
- en: '](img/Figure_3.13_B15630.jpg)'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.13_B15630.jpg)'
- en: Figure 3.13 – ACK scanning with Metasploit
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.13 – 使用Metasploit进行ACK扫描
- en: If the scan goes as planned, you'll be given feedback that the host has successfully
    been scanned, and the port is being unfiltered.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 如果扫描按计划进行，您将得到反馈，主机已成功被扫描，并且端口未被过滤。
- en: Now that we have used both a TCP and an ACK scan on our host, let's take a look
    at one more module to do some recon on our host. For our next scan, we are going
    to use the built-in RDP scanner available in Metasploit.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经在我们的主机上使用了TCP和ACK扫描，让我们再看看另一个模块来对我们的主机进行一些侦察。对于我们的下一个扫描，我们将使用Metasploit中提供的内置RDP扫描程序。
- en: RDP scanning with Metasploit
  id: totrans-261
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Metasploit进行RDP扫描
- en: 'We have done a good amount of recon and enumeration on our host since we started
    scanning with Metasploit. Between using Metasploit and Nmap, we now know the following
    about our target:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 自从我们开始使用Metasploit进行扫描以来，我们已经对我们的主机进行了大量的侦察和枚举。在使用Metasploit和Nmap之间，我们现在对我们的目标有了以下了解：
- en: Port `3389` is open.
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口`3389`是开放的。
- en: Port `3389` is unfiltered.
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口`3389`未被过滤。
- en: 'If this were a real test, the next course of action would be to see what operating
    system is running on the host. We can do this by using the `-O` switch in Nmap,
    but since we have Metasploit up and running, let''s go ahead and use that:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这是一个真正的测试，下一步将是查看主机上运行的操作系统。我们可以通过在Nmap中使用`-O`开关来做到这一点，但由于我们已经启动并运行了Metasploit，让我们继续使用它：
- en: 'To begin, use the following module:'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，使用以下模块：
- en: '[PRE14]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Once you set the parameters, start the scan by using the `run` command and view
    the output. If all goes well, output showing you that port `3389` is open and
    that the instance is operating on Windows should be displayed:![Figure 3.14 –
    RDP scanning with Metasploit
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置参数后，使用`run`命令开始扫描并查看输出。如果一切顺利，输出将显示端口`3389`是开放的，并且实例正在运行Windows：![图3.14 –
    使用Metasploit进行RDP扫描
- en: '](img/Figure_3.14_B15630.jpg)'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.14_B15630.jpg)'
- en: Figure 3.14 – RDP scanning with Metasploit
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.14 – 使用Metasploit进行RDP扫描
- en: If you want to see the difference in results, use the `UNSET` command to erase
    the value you put in the option. The `UNSET` command does exactly what it says
    – it unsets the parameter you just placed!
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您想看到结果的不同，使用`UNSET`命令来擦除您放入选项中的值。`UNSET`命令正是它的名字所说的 – 它取消刚刚设置的参数！
- en: Now we have successfully done some enumeration and scanned our host. Feel free
    to take a look at other modules to scan the hosts and get a feel for how Metasploit
    can be used to scan hosts in general.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经成功地进行了一些枚举并扫描了我们的主机。随意查看其他模块来扫描主机，并了解Metasploit如何通常用于扫描主机。
- en: Let's get moving forward and actually connect to our Windows host. First, we
    will use our Kali Linux image – feel free to use your local or AWS Kali machine.
    After that, we will use the Remote Desktop client to test our connection to our
    AWS host.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续前进，实际连接到我们的Windows主机。首先，我们将使用我们的Kali Linux镜像 – 随意使用您的本地或AWS Kali机器。之后，我们将使用远程桌面客户端来测试我们与AWS主机的连接。
- en: Connecting with Kali
  id: totrans-274
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Kali进行连接
- en: 'Now that we positively know that `RDP` is open, we can connect to it using
    our username and password that we got from decrypting our Windows AWS key. If
    you need to, go back and look at how you retrieve your Windows password and come
    back here:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们确切地知道“RDP”是打开的，我们可以使用我们从解密Windows AWS密钥中获得的用户名和密码连接到它。如果需要，回去看看如何检索您的Windows密码，然后再回到这里：
- en: To start, you're going to need to use a tool called `Administrator`. There is
    a parameter that allows the password to be entered in the Terminal, however, this
    is shown in plain text. It's best practice (more on that later) to not have passwords
    shown in plain text:![Figure 3.15 – Connecting over RDP via rdesktop
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，您需要使用一个名为“管理员”的工具。有一个参数允许在终端中输入密码，但是这是以明文显示的。最佳做法（稍后会详细介绍）是不要以明文显示密码：![图3.15
    - 通过rdesktop通过RDP连接
- en: '](img/Figure_3.15_B15630.jpg)'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.15_B15630.jpg)'
- en: Figure 3.15 – Connecting over RDP via rdesktop
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.15 - 通过rdesktop连接RDP
- en: 'Because the password parameter allows the password be viewed in plain text,
    you will enter your password when you are shown the login screen. Enter the password
    that your AWS key assigned to you:'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 因为密码参数允许密码以明文显示，所以当您看到登录屏幕时，您将输入您的密码。输入您的AWS密钥分配给您的密码：
- en: '![Figure 3.16 – Login screen for Windows Server'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.16 - Windows服务器的登录屏幕'
- en: '](img/Figure_3.16_B15630.jpg)'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.16_B15630.jpg)'
- en: Figure 3.16 – Login screen for Windows Server
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.16 - Windows服务器的登录屏幕
- en: Once you have successfully logged in, you can make changes just as you would
    to a regular Windows host.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦成功登录，您可以像对待常规Windows主机一样进行更改。
- en: 'If you connect properly, you should be greeted by a desktop that looks something
    like the following:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 如果连接成功，您应该会看到一个类似以下内容的桌面：
- en: '![Figure 3.17 – Windows desktop'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.17 - Windows桌面'
- en: '](img/Figure_3.17_B15630.jpg)'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.17_B15630.jpg)'
- en: Figure 3.17 – Windows desktop
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.17 - Windows桌面
- en: Feel free to take a look around and get a feel for it. It can take a little
    bit of getting used to.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 随意四处看看，感受一下。可能需要一点时间来适应。
- en: Connecting with Windows
  id: totrans-289
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连接Windows
- en: 'Now that we have used rdesktop on our Kali machine, it is time to move on to
    what is the more popular, or at least more conventional method of connecting over
    RDP. If you do not have a Windows-based host, do not fret; you can download the
    Remote Desktop for other operating systems as well:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经在我们的Kali机器上使用了rdesktop，是时候转向更受欢迎，或者至少更常规的通过RDP连接的方法了。如果您没有基于Windows的主机，不要担心；您也可以下载其他操作系统的远程桌面：
- en: To start, open up the `Remote Desktop`, and then hit *Enter*. It should automatically
    bring up your installed RDP application. If it doesn't, you'll need to troubleshoot
    the issue and then return to finish this portion of the chapter.
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，打开“远程桌面”，然后按*Enter*。它应该会自动打开您安装的RDP应用程序。如果没有，您需要解决问题，然后返回完成本章的这一部分。
- en: Just as before, we will put in the public DNS name to our AWS instance, as well
    as the username `Administrator` to start the connection:![Figure 3.18 – Remote
    Desktop application on Windows
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 就像以前一样，我们将输入我们的AWS实例的公共DNS名称，以及用户名“管理员”来开始连接：![图3.18 - Windows上的远程桌面应用程序
- en: '](img/Figure_3.18_B15630.jpg)'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.18_B15630.jpg)'
- en: Figure 3.18 – Remote Desktop application on Windows
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.18 - Windows上的远程桌面应用程序
- en: 'Once you hit the **Connect** button, you''ll be prompted to input the credentials
    for the Windows host. Go ahead and copy and paste the password into the **password**
    field and have the connection be remembered so that you don''t have to keep typing
    in the password every time you want to log in to the AWS instance:'
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦点击**连接**按钮，您将被提示输入Windows主机的凭据。继续复制并粘贴密码到**密码**字段，并记住连接，这样您就不必每次想要登录到AWS实例时都输入密码：
- en: '![Figure 3.19 – Login prompt from Remote Desktop'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: '![图3.19 - 远程桌面的登录提示'
- en: '](img/Figure_3.19_B15630.jpg)'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_3.19_B15630.jpg)'
- en: Figure 3.19 – Login prompt from Remote Desktop
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.19 - 远程桌面的登录提示
- en: Once you connect, you should have a desktop that takes up your entire desktop.
    This new desktop is the desktop of your AWS Windows instance.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 连接后，您应该会看到一个占满整个桌面的桌面。这个新桌面是您的AWS Windows实例的桌面。
- en: Congrats! You have successfully scanned and connected to your AWS instance!
    We learned quite a bit throughout this chapter and now should be comfortable with
    using some pentesting tools and starting up our very own EC2 instances with various
    operating systems. Now that we have accomplished the basics of pentesting and
    AWS – let's talk about what the lessons learned were and how they apply to moving
    forward in this book.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜！您已成功扫描并连接到您的AWS实例！在本章中，我们学到了很多东西，现在应该可以熟练使用一些渗透测试工具，并启动我们自己的带有各种操作系统的EC2实例。既然我们已经掌握了渗透测试和AWS的基础知识
    - 让我们谈谈学到的经验以及它们如何适用于本书的后续内容。
- en: Learning from experience
  id: totrans-301
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从经验中学习
- en: The lessons you learn while pentesting are among the most valuable resources
    you will gain during your time as a pentester. Whether you make a career out of
    it or do it as a side hobby, the lessons learned involve using the knowledge you
    have gained from experiences, both professional and personal, and applying them
    to your future endeavors.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 您在渗透测试中学到的经验是您在作为渗透测试人员的时间中获得的最宝贵的资源之一。无论您是否以此为职业或作为业余爱好，所学到的经验都涉及使用您从专业和个人经验中获得的知识，并将其应用于未来的努力。
- en: Using hindsight to look at your pentesting endeavors allows you to view your
    mistakes and take those mistakes as a learning experience rather than a harsh
    failure. It's about failing forward, not failing backward, which will ensure your
    growth in the knowledge of pentesting. Often, this is what makes or breaks professionals
    and hobbyists in the pentesting community.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 利用远见来审视您的渗透测试努力，让您能够查看自己的错误，并将这些错误视为一种学习经验，而不是严厉的失败。这是关于向前失败，而不是向后失败，这将确保您在渗透测试知识方面的成长。通常，这就是决定专业人士和业余爱好者在渗透测试社区中成败的关键。
- en: For this book, it's important to understand the lessons learned will require
    you to review material maybe more than once, or you may need to go back and try
    to do something a different way because it seems more suitable to you, or perhaps
    you realized you kept typing in the wrong parameter into Metasploit and now know
    that you need to police yourself before setting the parameter in the future. The
    lessons learned in this book alone will help you grow as you move through the
    material.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本书来说，重要的是要理解所学到的教训可能需要您多次复习材料，或者您可能需要回头尝试以不同的方式做某件事，因为这对您更合适，或者您意识到自己一直在错误地输入Metasploit中的参数，现在知道在将来设置参数之前需要自我约束。本书中所学到的教训将帮助您在学习过程中不断成长。
- en: In real life pentesting, giving your clients a high **return on investment**
    (**ROI**) is typically the key to ensuring you brand yourself as a pentester and
    retain professional pentesting relationships. So, it is essential to evaluate
    yourself continually to allow you and your clients to get the most out of pentesting.
    We will discuss more of this later in the book, but it's still good to understand
    that lessons learned and ROI have a bit of a correlation and causation with each
    other in regard to pentesting.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 在现实生活中的渗透测试中，为客户提供高投资回报（ROI）通常是确保您将自己定位为渗透测试人员并保持专业渗透测试关系的关键。因此，不断评估自己是至关重要的，以便您和您的客户能够充分利用渗透测试。我们将在本书的后面更多地讨论这一点，但了解到教训和投资回报与渗透测试有一定的相关性和因果关系仍然是很好的。
- en: Summary
  id: totrans-306
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: You now have the knowledge needed to move forward in this book. This chapter
    included an overview of pentesting techniques, as well different types of pentesting
    and how it's executed. It is important to briefly understand how pentesting can
    be used in different ways, such as red teaming or goal-oriented pentesting. We
    will look at more ways throughout this book and will remind you when those instances
    come up.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在已经具备了继续阅读本书所需的知识。本章包括了渗透测试技术的概述，以及不同类型的渗透测试及其执行方式。简要了解渗透测试可以以不同的方式使用，例如红队行动或目标导向型渗透测试，这一点非常重要。我们将在本书中探讨更多的方式，并在这些情况出现时提醒您。
- en: The big test in this chapter was scanning our AWS host and then connecting to
    it over RDP. We displayed both theory and practical knowledge in how we can scan
    our host to successfully enumerate and use that information to connect to the
    host. We will be using similar techniques and methods during this book – so make
    sure you keep what you've learned so far as a baseline for this book.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的重要测试是扫描我们的AWS主机，然后通过RDP连接到它。我们展示了如何在扫描主机以成功枚举并使用该信息连接主机的理论和实际知识。在本书中，我们将使用类似的技术和方法-因此，请确保您将迄今为止学到的作为本书的基准。
- en: In the next chapter, we are going to be moving forward with a much more hands-on
    topic and begin to exploit AWS services.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将继续进行更多实践性的话题，并开始利用AWS服务。
- en: Further reading
  id: totrans-310
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'Cyber frameworks: [https://www.nist.gov/cyberframework/online-learning/five-functions](https://www.nist.gov/cyberframework/online-learning/five-functions)'
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络安全框架：[https://www.nist.gov/cyberframework/online-learning/five-functions](https://www.nist.gov/cyberframework/online-learning/five-functions)
- en: 'More information on Metasploit: [https://www.offensive-security.com/metasploit-unleashed/port-scanning/](https://www.offensive-security.com/metasploit-unleashed/port-scanning/)'
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关Metasploit的更多信息：[https://www.offensive-security.com/metasploit-unleashed/port-scanning/](https://www.offensive-security.com/metasploit-unleashed/port-scanning/)
- en: 'Three-way handshake: [https://study-ccna.com/tcp-three-way-handshake/](https://study-ccna.com/tcp-three-way-handshake/)'
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 三次握手：[https://study-ccna.com/tcp-three-way-handshake/](https://study-ccna.com/tcp-three-way-handshake/)
- en: 'Port scanning: [https://resources.infosecinstitute.com/port-scanning-using-scapy/#gref](https://resources.infosecinstitute.com/port-scanning-using-scapy/#gref)'
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口扫描：[https://resources.infosecinstitute.com/port-scanning-using-scapy/#gref](https://resources.infosecinstitute.com/port-scanning-using-scapy/#gref)
- en: 'More information on Remote Desktop: [https://www.microsoft.com/en-us/p/microsoft-remote-desktop/9wzdncrfj3ps?activetab=pivot:overviewtab](https://www.microsoft.com/en-us/p/microsoft-remote-desktop/9wzdncrfj3ps?activetab=pivot:overviewtab)'
  id: totrans-315
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关远程桌面的更多信息：[https://www.microsoft.com/en-us/p/microsoft-remote-desktop/9wzdncrfj3ps?activetab=pivot:overviewtab](https://www.microsoft.com/en-us/p/microsoft-remote-desktop/9wzdncrfj3ps?activetab=pivot:overviewtab)
