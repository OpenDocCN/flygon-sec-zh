# 第九章。数据收集工具和报告

尽管可能看起来很痛苦，但渗透测试的每一步都必须得到适当的记录。这不仅可以确保准确和可重复的结果，还可以让其他人检查工作，并确保在测试过程中没有遗漏任何内容。随着渗透测试变得越来越普遍，测试团队也变得更加分段和专业化。团队中可能有一个人专门负责应用程序渗透测试，另一个人可能是后期利用的天才。从一个角色到另一个角色，需要适当的文档记录和报告。

幸运的是，社区中有可用的工具，可以减少记录每个渗透测试步骤、命令和结果的整体痛苦。正确使用这些工具，文档记录将变得自然而然。

本章介绍了可以使测试进展记录变得不那么痛苦，报告撰写变得更容易的工具和技术的使用：

+   简单的文本编辑器

+   重新审视 Dradis — 合作的时候到了

+   报告概述

在开始有趣的事情之前，我们需要复习基础知识。这些方法经过验证，很少出错。除了效率之外，这些方法都是有效的。

# 立即记录 — 以后整理

本书讨论的几乎所有内容都可以通过 BackTrack 命令行实现。现在，只需记录每个输入和输出会不会很好？显然，这不会是渗透测试记录保存的巅峰，但拥有这样的日志最终可能会为您节省麻烦。

```
# script pentest.log 

```

Linux 脚本命令将记录测试过程中使用的大部分命令。

# 老派 — 文本编辑器方法

就像网站创建爱好者一样，有一群人只使用纯文本编辑器作为数据存储库和报告生成工具。不过，不要让这种工具表面上缺乏功能的外表愚弄您。在今年的 DerbyCon 上，我有幸与一位个人交谈，他提到他已经用 vi 自动化了数据收集的每一步。通过使用自动化和脚本，来自各种工具的输出可以被处理、转换并收集到 vi 文本文件中。然后，通过宏和脚本，他能够生成完整的报告。这个初始设置可能很复杂，但最终产品的简单优雅令人印象深刻。

流行的 Linux 文本编辑器包括**vim**，需要一些练习，以及 Nano，它提供了一种方便的编辑和收集简单文件数据的方法。

## Nano

Nano 已经在本书中用于各种文本编辑需求。它快速简单，非常适合快速记录笔记或快速编辑文档。

### 注意

不要被 Nano 的表面简单所迷惑（Nano 是另一个文本编辑器）。Nano 执行强大的用户功能，如测试调整，语法高亮，强大的文本搜索等。

要从 BackTrack 启动 Nano，请键入`nano`，然后输入需要编辑或创建的文件名。Nano 将在当前工作目录中创建文件。

```
# nano test.txt 

```

![Nano](img/7744OS_09_01.jpg)

通过命令行选项或编辑`/etc/nanorc`配置文件，可以对 Nano 进行非常自定义化。使用`nanorc`可以设置的一些选项包括以下内容，等等：

+   区分大小写的搜索

+   文本文件转换选项 — 您想转换 Dos 或 Mac 文本文件吗？

+   编辑器是否应该换行您的文本？

+   自动缩进选项

如果决定在测试过程中利用 Nano，请务必查看设置，并找到最适合您的工作流程和偏好的配置。

有关 Nano 的更多信息，请访问：[`tuxradar.com/content/text-editing-nano-made-easy`](http://tuxradar.com/content/text-editing-nano-made-easy)。

## VIM — 强大用户的文本编辑器选择

VIM 是 vi 的改进版本，可作为慈善软件使用。

### 注意

如果您发现想要使用 VIM，建议您向 ICCF 捐赠。当通过`vim`命令启动编辑器时，将显示此信息。

![VIM-首选的高级文本编辑器](img/7744OS_09_02.jpg)

有一些基本命令是任何使用 VIM 的人都应该熟悉的。为了帮助那些完全不熟悉 VIM 的人，该工具提供了一个教程，可以通过在命令行输入`vimtutor`来访问。

```
# vimtutor 

```

![VIM-首选的高级文本编辑器](img/7744OS_09_03.jpg)

使用 VIM 收集测试数据的一些好处包括：

+   预装在许多 Linux 发行版中。

+   资源占用非常小，这在系统运行密集进程时非常有益。

+   使用`diff`函数比较多个文件。在您三个月前执行测试并希望快速查找差异的时候非常完美。也可用于确保网站代码在测试之间未被修改。例如，比较`test1.txt`和`test2.txt`：

```
# vim test1.txt test2.txt 

```

![VIM-首选的高级文本编辑器](img/7744OS_09_04.jpg)

+   可以使用二进制模式查看甚至编辑二进制文件。

+   可以以只读模式打开文件，以避免意外更改文件。

+   通过使用`-X`开关进行即时文件加密。如果使用最新版本的 VIM（7.3+），可以将加密设置为使用 Blowfish 作为加密类型。要加密名为`test.txt`的文件，请开始一个文件：

```
# vim -x test.txt 

```

您将被提示输入加密密钥。将来解密文件时将需要此密钥。

```
Enter Encryption Key: ThisIsATest
Enter Same Key again: ThisIsATest

```

输入一些测试内容到文件中：

![VIM-首选的高级文本编辑器](img/7744OS_09_05.jpg)

当保存并重新打开而没有正确的加密密钥时，文件中的信息是无法解读的。

```
# Vim -x test.txt 

```

![VIM-首选的高级文本编辑器](img/7744OS_09_06.jpg)

对测试期间收集的数据进行加密既有益又受到鼓励；但是，重要的是要注意，VIM 使用的对称加密类型并不适合共享文件。在这种情况下，可能更适合专注于非对称加密方法的单独解决方案。

## NoteCase

如果您更喜欢使用图形编辑器来收集和管理测试信息，那么有许多可用选项。其中一个工具是 NoteCase，可以用于在使用 BackTrack 时收集项目或测试数据。可以通过`apt-get install notecase`在 BackTrack 客户机中安装它。以下是 NoteCase 如何用于收集有关正在测试的站点的信息的示例：

![NoteCase](img/7744OS_09_07.jpg)

Notecase 允许选择**文件** | **另存为**并选择适当的下拉选择，以加密格式保存文件：

![NoteCase](img/7744OS_09_08.jpg)

# Dradis 协作框架

在进行渗透测试期间进行协作和数据共享时，很难超越 Dradis 提供的好处和选项。这是我们在第一章中讨论的两种主要数据收集工具之一，*规划和范围确定成功的渗透测试*，通常是数据收集的首选工具。与往常一样，我们需要在开始之前有一些可用的数据。在本例中，我们假设一家小企业要求我们对其仍处于开发阶段且尚未在互联网上提供的 Web 服务器进行渗透测试。根据约定，我们不允许访问除了这一个特定服务器之外的任何内容，该服务器可以在`192.168.75.0/24`子网上本地访问。我们被允许访问`192.168.75.0/24`网络的 VPN，并且可以同时进行两个连接。测试的时间有限，因此我们打算使用两个人来进行测试。

为了跟随本示例，您需要以下虚拟环境处于运行状态：

+   `192.168.75.0/24`子网（VLAN1）上的两台 BackTrack 客户机。

+   pfSense 配置为通过 DHCP 为`192.168.75.0/24`子网（VLAN1）分配地址。

+   Kioptrix Level 1 设置为连接到 VLAN1。

这个设置应该让您能够有效地跟随本章的其余部分。报告是一个非常灵活的领域，因此需要一些时间来找到您想要用于测试的“正确”模板和格式。

## 绑定到 127.0.0.1 以外的可用接口

需要对启动 Dradis 进行轻微修改，同时绑定到不同的端口。

```
# cd /pentest/misc/Dradis
# nano start.sh

```

更改第 15 行以匹配以下内容：

```
bundle exec rails server webrick $*

```

保存文件，并使用`-h`功能调用`start.sh`命令以显示可用选项：

```
# ./start.sh -h 

```

![绑定到 127.0.0.1 以外的可用接口](img/7744OS_09_09.jpg)

此时，我们可以通过输入以下内容绑定到`192.168.75.11`的 3004 端口（使用托管 Dradis 服务器的 BackTrack 机器的 IP 地址**您**）：

```
# ./start.sh -b 192.168.75.11 -p 3004 
=> Booting WEBrick
=> Rails 3.0.6 application starting in production on http://192.168.75.11:3004
=> Call with -d to detach
=> Ctrl-C to shutdown server

```

通过启动浏览器并在本地主机和其他 BackTrack 机器上键入`https://192.168.75.11:3004`来测试您的配置。请注意，在下面的屏幕截图中，我们能够确定`192.168.75.11`上的 Dradis 服务器可以被两台机器访问。

![绑定到 127.0.0.1 以外的可用接口](img/7744OS_09_10.jpg)

任一系统所做的更改都将更新，以便两个用户都能看到。当进行更改时，其他已登录用户会收到通知：

![绑定到 127.0.0.1 以外的可用接口](img/7744OS_09_11.jpg)

当出现此提示时，只需单击节点列顶部的**刷新树**图标旁边的添加分支：

![绑定到 127.0.0.1 以外的可用接口](img/7744OS_09_12.jpg)

有效地使用 Dradis 等工具将使您的团队在执行测试时更加高效和彻底。

# 报告

在渗透测试结束时，所有数据都需要转化为信息，以便业务和网络所有者采取行动。尽管渗透测试的目标可能各不相同，但将整个过程记录下来并将结果放入易于理解的格式中的需求是一样的。执行报告中应包括以下一些内容：

+   封面

+   您公司的标志

+   测试执行的标题和描述

+   保密提醒

+   测试日期和时间

封面应该既专业又吸引人眼球。如果您的标志有任何可用的图形，这是展示它们的理想地方。看看这个样本，了解典型报告封面的基本概念：

![报告](img/7744OS_09_13.jpg)

接下来的页面应提供报告中包含的材料的索引。添加索引可以让读者快速跳转到感兴趣的位置。当人们参加会议或需要快速了解报告内容时，这一点尤为重要：

![报告](img/7744OS_09_14.jpg)

接下来的页面应该是**执行摘要**，可用于快速查看发现。执行摘要可能会根据目标受众而有所不同。在我们的示例中，我们假设我们不知道报告将被呈现给谁，因此尝试涵盖所有方面——技术和非技术管理人员。

报告的这部分应该为未参与初始测试过程的人提供足够的信息，以了解测试内容和测试目标。它还应该快速概述发现的内容，以及是否发现了需要立即注意的特定内容。

看看以下示例：

![报告](img/7744OS_09_15.jpg)

正如讨论的那样，我们设法在一页内涵盖了几个主要领域。信息应该简洁明了，尽量避免技术术语，因为报告最终可能会提供给管理团队的非技术成员。

### 提示

必须有人付钱来修复你发现的所有漏洞，但如果他们不理解你的报告，他们不太可能这样做。

在不到一页的篇幅中应该包括的主要部分包括标题和简要描述、范围或介绍以及测试发生的时间表。许多人不明白，进行渗透测试的人和团队的其他部分一样，也受到资源的限制。如果破解一个密码需要两天，但你只有一天来进行测试，这并不一定意味着密码是安全的，只是你没有足够的时间来正确执行你的测试。

在执行摘要中，发现部分非常重要。大多数管理团队可能永远不会阅读所有必须采取的步骤，他们只想知道这些漏洞是什么，每种类型的优先级是什么，这样他们就可以开始制定补救策略和计划。

看看我们报告的下一页：

![报告](img/7744OS_09_16.jpg)

我们不仅清晰地定义和总结了发现，还提供了一个漂亮的图表来帮助可视化发现。通过为客户分解漏洞，你让他们的生活更轻松，也许可以避免将来再次访问，只是为了再次讨论你的发现。

从你的角度提供一个清晰定义的网络图很重要。这使客户能够理解所有适当的系统都经过了测试，并且在某些情况下暴露了客户甚至没有意识到的问题，比如网络上不一定属于的系统。理想情况下，你会有一个列出网络上所有可用服务的列表。在下面的示例中，我们只列出了端口和描述，因为我们知道只涉及一个系统。另一种方法是列出所有服务，如下所示：

| **端口** | **描述** | **系统** |
| --- | --- | --- |
| 80 | HTTP | 192.168.75.1, 192.168.75.2, 192.168.75.15 |

如果系统上存在不应该存在的服务，这样的列表就可以变得可操作。例如：一个开发服务器仍在运行一个据说几年前就关闭的 Web 服务器。

看看下面的示例页面，其中包括基本的网络图和一个虚构的端口列表，这些端口在`192.168.75.15`上是开放的。

![报告](img/7744OS_09_17.jpg)

最后，是时候提供一些详细的报告了。这是你详细列出发现并提供有关如何发现这些问题的信息的机会。通常在详细报告部分可以放置的数据量是没有限制的。一定要提供足够的信息，以便管理员可以尝试模拟测试的特定部分，以确保已经实施的缓解控制是否真正起作用。

在文档的某个地方，应该讨论使用的方法论，无论是标准方法论的子集，还是你自己想出的东西——理解你所做的事情很重要。这就是有备忘录非常方便的地方。

这是这一部分可能看起来像的一个小例子：

![报告](img/7744OS_09_18.jpg)

如果你仔细看，你会注意到有一个补救部分。所有需要补救问题的信息已经在报告中，但有时将与特定漏洞相关的脆弱系统列出来是很有用的。这样可以让企业以逻辑方式快速简单地解决漏洞。例如，管理员可以负责更新网络上的所有 SAMBA 版本，并且在报告的补救部分，他们可以直接开始处理列表上的工作。

任何与提供可操作数据无直接关系的附加信息都应该添加到附录中。这包括任何大型数据转储，如目录列表、URL、安装的软件和版本等。

# 读者的挑战

使用之前提供的实验室设置，对 Kioptrix Level 1 机器进行完全记录的测试！

在完成报告后，退一步，想象自己是一个收到这份报告的企业所有者。你的工作是否允许补救发现的任何问题？你是否提供了足够的交叉参考材料，以便文件在初始咨询完成后能够自行立足？

再次查看第一章，“规划和范围确定成功的渗透测试”，看看是否可以设置一个 HTML 模板，使你能够轻松地将详细数据导入最终报告。一旦像这样的东西被自动化，它就有潜力节省大量时间！

# 总结

在本章中，我们研究了在进行测试时安全地收集数据的几种方法，如 VIM、Nano 和 NoteCase。我们还在现有的 Dradis 知识基础上进行了扩展，配置它以供多个测试人员同时使用。

我们审查了应该包括在任何渗透测试报告中的几个关键项目。有时，你的公司所接收到的唯一可见性将基于这份报告。报告越好，你下次被要求进行渗透测试的可能性就越大。

最后，我们向读者提出了一个小挑战，要求完成并记录对本章中所审查的配置进行评估。

在下一章中，当我们继续建立一个模拟安全的虚构公司的测试实验室时，我们将有机会将所有这些信息付诸实践。
