- en: Chapter 10. Setting Up Virtual Test Lab Environments
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章。设置虚拟测试实验室环境
- en: Keeping skills up to date is extremely important in most professions; it is
    no different for penetration testing. Penetration testing skills take time to
    develop and to top it off the information security landscape changes on a daily
    basis. With this in mind, it is not difficult in this day and age to obtain a
    semi-powerful computer system with 4-16 gigs of RAM and a four or six core processor.
    Equipment such as this allows a penetration tester to build out full-fledged virtual
    networks that can be used as practice labs. In this chapter, we review building
    such environments. We will attempt to emulate the types of secured networks we
    might see in use, using limited system resources.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 保持技能更新在大多数行业中都非常重要；对于渗透测试也是如此。渗透测试技能需要时间来发展，而且信息安全领域每天都在变化。考虑到这一点，在当今这个时代，获得一台配备4-16GB
    RAM和四核或六核处理器的半强大计算机系统并不困难。这样的设备可以让渗透测试人员构建出完整的虚拟网络，用作实践实验室。在本章中，我们将审查构建这样的环境。我们将尝试使用有限的系统资源来模拟我们可能在使用中看到的受保护网络类型。
- en: 'We will discuss the following items in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章讨论以下内容：
- en: Emulating a simple network with a firewall
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模拟带有防火墙的简单网络
- en: Setting up a multi-tiered DMZ
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置多层DMZ
- en: Emulating more complex networks in a virtual environment
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在虚拟环境中模拟更复杂的网络
- en: Why bother with setting up labs?
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么要设置实验室？
- en: It may seem that experimenting in a more comprehensive testing environment will
    always be the best choice once you have your labs built out, but in fact, you
    may only be adding unnecessary complexities that may divert or completely ruin
    the test.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来，在更全面的测试环境中进行实验将始终是最佳选择，但实际上，您可能只会增加不必要的复杂性，这可能会转移或完全破坏测试。
- en: 'Let''s take a look at setting up a web server to run a simple web application.
    We will need to determine what we are testing before we choose our lab environment.
    Some of the questions that should be asked include:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看如何设置一个运行简单Web应用程序的Web服务器。在选择实验室环境之前，我们需要确定我们要测试什么。应该问的一些问题包括：
- en: Are there any specific services that are required to ensure the testing accurately
    emulates an environment as seen in real world testing?
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有没有特定的服务是必需的，以确保测试准确地模拟真实世界测试中所见的环境？
- en: Load Balancing?
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载均衡？
- en: Specific versions of software?
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 特定版本的软件？
- en: Firewalls?
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙？
- en: Are there any factors that will cause the results to be an inaccurate representation
    of what occurs in true production environments?
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有没有因素会导致结果不准确地代表真实生产环境中发生的情况？
- en: Does your lab provide you with the hands-on experience necessary to duplicate
    your findings in the real world; if not, what needs to be changed to make it so?
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的实验室是否为您提供了在真实世界中复制您的发现所需的实践经验；如果没有，需要做出哪些改变？
- en: Hopefully this quick list of basic questions will prepare you for the considerations
    that should be taken into account when choosing which type of lab is preferable
    and for which task. There are many scenarios that can be tested with a simple
    virtual guest machine speaking to another; on the other hand there are some scenarios
    that will require the usage of tens and even hundreds of systems to accurately
    represent the experience you will have in a real world environment. Regardless
    of how you choose to build out your lab it should always allow you to make modifications
    or to build upon existing systems. It should also be simple to manage and update
    as needed.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 希望这个基本问题的快速列表能为您准备好在选择哪种类型的实验室更可取以及为哪项任务考虑时应考虑的因素。有许多情景可以通过简单的虚拟客户机进行测试；另一方面，有些情景将需要使用数十甚至数百台系统来准确代表您在真实环境中的体验。无论您选择如何构建您的实验室，它都应该始终允许您进行修改或构建现有系统。它还应该简单易管理，并根据需要进行更新。
- en: Note
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Taking snapshots of systems that have been freshly built can be an effective
    and efficient method of ensuring the necessary operating system builds are ready
    when needed.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 对新构建的系统进行快照可能是确保必要的操作系统构建在需要时准备就绪的一种有效和高效的方法。
- en: Keeping it simple
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保持简单
- en: At times it is possible to set up a simple lab that meets your testing requirements.
    Many times, especially in a learning environment, keeping it simple reduces the
    learning curve and enables quick absorption of the pertinent material rather than
    being inundated with trivial facts or configuration settings that do not relate.
    Throughout this book each section attempted to use the minimum system setup required
    to review the task at hand. This option should not be taken lightly when building
    out your labs.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 有时可以建立一个满足测试要求的简单实验室。在学习环境中，保持简单通常会减少学习曲线，并使相关材料能够快速吸收，而不是被琐碎的事实或不相关的配置设置所淹没。在本书中，每个部分都试图使用最少的系统设置来审查手头的任务。在构建实验室时，不应轻率选择这种选项。
- en: No-nonsense test example
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 直截了当的测试示例
- en: 'Many of the examples of new exploits and vulnerabilities can be tested with
    a simple configuration such as:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 许多新的漏洞和漏洞的例子可以通过简单的配置进行测试，例如：
- en: '![No-nonsense test example](img/7744OS_10_01.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![直截了当的测试示例](img/7744OS_10_01.jpg)'
- en: This network is about as simple as it gets (besides simply testing from the
    target machine itself which could definitely be useful for many situations).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这个网络就是最简单的（除了直接从目标机器本身进行测试，这对于许多情况来说肯定是有用的）。
- en: We have a BackTrack machine connected on the same LAN segment as the vulnerable
    target machine. There is no inline firewall or anything else to get in the way
    of validating that exploit code works as intended. This would be a good sanity
    check if there are problems that you are running into when testing certain methodologies
    or techniques with a more complicated environment.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一台BackTrack机器连接到与易受攻击目标机器相同的LAN段。没有内联防火墙或其他任何东西会妨碍验证利用代码是否按预期工作。如果在测试某些方法或技术时遇到问题，这将是一个很好的健全检查。
- en: We will not go over setting up this type of environment as it has been covered
    repeatedly throughout the book.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会介绍设置这种类型的环境，因为它已经在整本书中多次涵盖过。
- en: Network segmentation and firewalls
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络分割和防火墙
- en: 'The addition of inline firewalls and proper network segmentation has made it
    commonplace to see the following basic network infrastructure with a gateway or
    firewall separating the testing machine from the vulnerable target. This layered
    defense is but one small step to securing a typical environment:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 内联防火墙和适当的网络分割使得以下基本网络基础设施与网关或防火墙分隔测试机器与易受攻击目标成为常见现象。这种分层防御只是保护典型环境的一小步：
- en: '![Network segmentation and firewalls](img/7744OS_10_02.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![网络分割和防火墙](img/7744OS_10_02.jpg)'
- en: 'From the outside world the system will have a publically accessible IP address
    and then on the backend it will have a real IP address (possibly using NAT non
    routable addresses). Any traffic that passes back and forth will be processed
    through the gateway or firewall. Let''s take a look at how we would emulate an
    environment such as this:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 从外部世界来看，系统将拥有一个公共可访问的IP地址，然后在后端它将拥有一个真实的IP地址（可能使用NAT不可路由的地址）。来回传输的任何流量都将通过网关或防火墙进行处理。让我们看看如何模拟这样的环境：
- en: Requirements
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 要求
- en: 'To follow along with building out this example you will require the following:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 要跟随此示例构建，您将需要以下内容：
- en: Oracle's Virtualbox Latest version
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle的Virtualbox最新版本
- en: 2 GB RAM
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2 GB RAM
- en: M0n0Wall virtual guest machine
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: M0n0Wall虚拟客户机
- en: BackTrack virtual guest machine
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BackTrack虚拟客户机
- en: Ubuntu Server 10.04 stable with LAMP (connected to MyLab2)
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu Server 10.04稳定版与LAMP（连接到MyLab2）
- en: This is all that is necessary to get started!
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是开始所需的一切！
- en: Setup
  id: totrans-38
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置
- en: 'We will begin with setting up the **M0n0Wall** firewall installation. If you
    have used pfSense in previous chapters you will notice that the setup is very
    similar. Our M0n0Wall instance will have three adapters in this case: WAN, LAN,
    OPT1\. Begin by downloading M0n0Wall at [http://m0n0.ch/wall/downloads.php](http://m0n0.ch/wall/downloads.php).
    We will be using the `cdrom-1.33.iso` release, although any future releases should
    be very similar in setup. M0n0Wall is a well established small firewall that will
    work perfectly for our needs due to the limited resources required.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从设置**M0n0Wall**防火墙安装开始。如果您在之前的章节中使用过pfSense，您会注意到设置非常相似。在这种情况下，我们的M0n0Wall实例将有三个适配器：WAN、LAN、OPT1。首先在[http://m0n0.ch/wall/downloads.php](http://m0n0.ch/wall/downloads.php)下载M0n0Wall。我们将使用`cdrom-1.33.iso`版本，尽管任何未来的版本在设置上应该非常相似。由于所需资源有限，M0n0Wall是一个成熟的小型防火墙，非常适合我们的需求。
- en: 'In VirtualBox use the following settings to set up a new guest machine:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在VirtualBox中使用以下设置来设置新的客户机：
- en: 'Name: M0n0Wall_Base_Install'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：M0n0Wall_Base_Install
- en: 'OS Type: BSD/FreeBSD'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作系统类型：BSD/FreeBSD
- en: 'Memory: 128 MB'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内存：128 MB
- en: 'Virtual Hard Disk: **Start-up Disk** checked, **Create New Hard Disk** selected'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟硬盘：**启动盘**已选中，**创建新硬盘**已选择
- en: 'Create New Virtual Disk: VDI'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建新虚拟磁盘：VDI
- en: 'Virtual Disk Storage Details: Dynamically Allocated'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟磁盘存储详细信息：动态分配
- en: 'Virtual disk file location and size: (Locate in a folder to be used for future
    labs), 200 MB in size'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟磁盘文件位置和大小：（放在用于未来实验的文件夹中），大小为200 MB
- en: This machine will need three network adapters configured using the VirtualBox
    Manager.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这台机器将需要使用VirtualBox Manager配置三个网络适配器。
- en: '**Network Adapter 1** should be configured to use **NAT** which will be our
    WAN connection'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络适配器1**应配置为使用**NAT**，这将是我们的WAN连接'
- en: '**Network Adapter 2** needs to be configured for the Internal Network name
    `MyLab1` which will represent our LAN connection and'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络适配器2**需要配置为内部网络名称`MyLab1`，它将代表我们的LAN连接并'
- en: '**Network Adapter 3** should be set up at Internal Network name `MyLab2` and
    will be tied to our internal network (the OPT device)'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络适配器3**应设置为内部网络名称`MyLab2`，并将与我们的内部网络（OPT设备）绑定'
- en: Tip
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Using the **PCnet-PCI II** adapter will reduce the chance of possible issues.
    Also, it is advised to change the MAC address of each adapter to make it simpler
    to determine which adapter you are choosing from within the server setup. For
    instance, if the current MAC for Network Adapter 1 is 0800270DD321 then changing
    it to 0800270DD31A would provide an easy to remember visual que: 1A is adapter
    1, 2B could be adapter 2, and so on.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**PCnet-PCI II**适配器将减少可能出现问题的机会。此外，建议更改每个适配器的MAC地址，以便更容易确定在服务器设置中选择的适配器。例如，如果网络适配器1的当前MAC地址为0800270DD321，则将其更改为0800270DD31A将提供一个易于记忆的视觉提示：1A是适配器1，2B可以是适配器2，依此类推。
- en: '`M0n0Wall` will need to be installed on the new VirtualBox Machine.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '`M0n0Wall`将需要安装在新的VirtualBox机器上。'
- en: Start `M0n0Wall_Base_Install` and choose the installation media downloaded from
    [http://m0n0.ch/wall/downloads.php](http://m0n0.ch/wall/downloads.php).
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`M0n0Wall_Base_Install`并选择从[http://m0n0.ch/wall/downloads.php](http://m0n0.ch/wall/downloads.php)下载的安装介质。
- en: Choose the **7) Install on Hard Drive** option:![Setup](img/7744OS_10_03.jpg)
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**7)在硬盘上安装**选项：![设置](img/7744OS_10_03.jpg)
- en: When asked which hard drive to install on, choose your hard drive (in this case
    it is `ad0)`.![Setup](img/7744OS_10_04.jpg)
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当被问及要安装在哪个硬盘时，请选择您的硬盘（在本例中是`ad0)`。![设置](img/7744OS_10_04.jpg)
- en: Reboot when prompted and ensure that the system is booting from the hard disk
    install rather than the ISO.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在提示时重新启动，并确保系统从硬盘安装而不是ISO启动。
- en: 'Now that M0n0Wall has been installed we must configure the interfaces:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 现在M0n0Wall已经安装好了，我们必须配置接口：
- en: 'Choose **1) Interfaces: assign network ports** and press *Enter*.'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**1)接口：分配网络端口**并按*Enter*。
- en: When prompted with a listing of available interfaces continue by setting up
    your VLANs. Press *y* to continue.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示可用接口列表时，继续设置您的VLAN。按*y*继续。
- en: Enter the parent interface name for the first adapter. This will be listed next
    to the MAC addresses on your display:![Setup](img/7744OS_10_05.jpg)
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入第一个适配器的父接口名称。这将显示在您的显示器上的MAC地址旁边：![设置](img/7744OS_10_05.jpg)
- en: Continue through the creation process for each adapter. In this case our `lnc0`
    adapter is assigned to VLAN 1, `lnc1` to 2, and `lnc2` to VLAN 3\. These VLANs
    can be any unused number between 1 and 4094.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 继续为每个适配器创建过程。在这种情况下，我们的`lnc0`适配器分配给VLAN 1，`lnc1`分配给2，`lnc2`分配给VLAN 3。这些VLAN可以是1到4094之间的任何未使用的数字。
- en: When determining the LAN interface name choose the adapter that is assigned
    to MyLab1, the WAN adapter should be assigned to the NAT adapter, and the MyLab2
    adapter should be assigned as the OPT device:![Setup](img/7744OS_10_06.jpg)
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定LAN接口名称时，请选择分配给MyLab1的适配器，WAN适配器应分配给NAT适配器，而MyLab2适配器应分配为OPT设备：![设置](img/7744OS_10_06.jpg)
- en: Reboot the firewall to save your changes.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新启动防火墙以保存您的更改。
- en: The firewall has been installed on our hard drive and the adapters have been
    assigned to VLANs. Now we need to set up the LAN IP address and connect to the
    web interface for further configuration. As an optional step the default password
    can be changed. For the sake of simplicity, we will continue using the default
    password for the rest of this exercise.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙已安装在我们的硬盘上，并且适配器已分配给VLAN。现在我们需要设置LAN IP地址并连接到Web界面进行进一步配置。作为可选步骤，可以更改默认密码。为了简单起见，我们将在本练习的其余部分继续使用默认密码。
- en: Select option **2) Set up LAN IP address** and press *Enter* to continue.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择选项**2）设置LAN IP地址**并按*Enter*继续。
- en: When prompted type the IP address you would like your LAN to use. We will choose
    `192.168.50.1`.![Setup](img/7744OS_10_07.jpg)
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在提示时输入您想要您的LAN使用的IP地址。我们将选择`192.168.50.1`。![设置](img/7744OS_10_07.jpg)
- en: We can now boot up a BackTrack instance on the MyLab1 internal network and connect
    to the web interface of the firewall by first obtaining a new DHCP address on
    the appropriate range and then directing our web browser to `http://192.168.50.1:`
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以在MyLab1内部网络上启动BackTrack实例，并通过首先在适当范围内获取新的DHCP地址，然后将我们的Web浏览器定向到`http://192.168.50.1:`来连接防火墙的Web界面。
- en: '![Setup](img/7744OS_10_08.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![设置](img/7744OS_10_08.jpg)'
- en: 'We need to set up our other interfaces to perform the tasks we have in mind
    which is to provide the `192.168.75.0/24` subnet with a firewalled route to our
    vulnerable host which will be located at `192.168.75.100` (connect a Ubuntu machine
    to MyLab2). Select the **OPT1 interface** from the navigation menu on the left
    of the screen and enable it by checking the appropriate box. Leave the **Bridge
    with** option as none and type the IP address for this interface: `192.168.75.1`.
    Ensure that the drop down lists `24`. Click on the **Save** button after applicable
    changes have been made.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要设置其他接口以执行我们心中的任务，即为`192.168.75.0/24`子网提供到我们的易受攻击主机的防火墙路由，该主机位于`192.168.75.100`（将Ubuntu机器连接到MyLab2）。从屏幕左侧的导航菜单中选择**OPT1接口**，通过选中适当的复选框启用它。将**桥接到**选项保留为无，并为此接口输入IP地址：`192.168.75.1`。确保下拉列表中选择`24`。在进行适用更改后，单击**保存**按钮。
- en: '![Setup](img/7744OS_10_09.jpg)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![设置](img/7744OS_10_09.jpg)'
- en: 'We can enable the DHCP server on the OPT1 interface. Choose **DHCP server**
    on the left navigation menu and chose the **OPT1** tab under **Services: DHCP
    server**. Check the box that enables the DHCP service on this port and enter the
    **Range** as `192.168.75.100` to `192.168.75.150`. After your changes have been
    selected click on the **Save** button to continue.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在OPT1接口上启用DHCP服务器。在左侧导航菜单上选择**DHCP服务器**，然后在**服务：DHCP服务器**下选择**OPT1**选项卡。选中启用此端口上的DHCP服务的复选框，并将**范围**输入为`192.168.75.100`至`192.168.75.150`。选择完您的更改后，单击**保存**按钮继续。
- en: '![Setup](img/7744OS_10_10.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![设置](img/7744OS_10_10.jpg)'
- en: There are currently no default rules set up for the OPT1 interface. Let's set
    up some basic rules to allow our system in `192.168.50.0/24` to ping those in
    `192.168.75.0/24`.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 目前还没有为OPT1接口设置默认规则。让我们设置一些基本规则，以允许我们在`192.168.50.0/24`中的系统对`192.168.75.0/24`中的系统进行ping。
- en: Click the **Firewall Rules** option in the left-hand navigation bar and select
    the OPT1 tab. Selecting the icon that looks like a plus **(+)** symbol within
    a circle will bring you to the screen that allows new rules to be configured.
    Click on this icon to continue.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 单击左侧导航栏中的**防火墙规则**选项，然后选择OPT1选项卡。选择看起来像一个加号**（+）**符号在一个圆圈内的图标，将带您到允许配置新规则的屏幕。单击此图标继续。
- en: 'In this initial rule we want to allow ICMP packets to the OPT1 interface from
    everywhere. The following settings need to be selected:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个初始规则中，我们希望允许来自任何地方的ICMP数据包到达OPT1接口。需要选择以下设置：
- en: '**Action:** Pass'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作：**通过'
- en: '**Interface:** OPT1'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**接口：**OPT1'
- en: '**Protocol:** ICMP'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议：**ICMP'
- en: '**ICMP** Type: any'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ICMP**类型：任何'
- en: 'All others: Default Settings'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有其他：默认设置
- en: Save your settings and click on the **APPLY** button to load the changes.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 保存您的设置，并单击**应用**按钮以加载更改。
- en: We can now traceroute from our **BackTrack Machine** to our **Target Machine**
    (in this case an Ubuntu Server install set up to receive a DHCP address).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以从我们的**BackTrack机器**到我们的**目标机器**（在本例中是一个设置为接收DHCP地址的Ubuntu服务器安装）进行traceroute。
- en: '![Setup](img/7744OS_10_11.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![设置](img/7744OS_10_11.jpg)'
- en: Using M0n0Wall allows us to use a lot of powerful options with very limited
    space. This can become very important when you want to place several firewalls
    in your virtual lab environment.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 使用M0n0Wall允许我们在非常有限的空间内使用许多强大的选项。当您想要在虚拟实验室环境中放置几个防火墙时，这一点就变得非常重要。
- en: Adding complexity or emulating target environments
  id: totrans-87
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 增加复杂性或模拟目标环境
- en: At times it may become beneficial to mimic a customer's network in order to
    perform offline testing prior to the real test. This practice can allow you to
    sometimes determine the path of least resistance after some simple enumeration.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 有时模仿客户的网络以进行真实测试之前的离线测试可能会有益。这种做法有时可以让您在进行一些简单的枚举后确定最小阻力路径。
- en: 'Let''s take a look at the following network example:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一下以下网络示例：
- en: '![Adding complexity or emulating target environments](img/7744OS_10_12.jpg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![增加复杂性或模拟目标环境](img/7744OS_10_12.jpg)'
- en: 'Looking at the diagram we can determine that there are at least four known
    subnets, two firewalls, and six machines that fulfill various duties. Also found
    are a web application firewall and an intrusion detection system that is located
    between `192.168.25.0/24` and `192.168.50.0/24` and the DMZ''d Web1 server. It
    would not take much of a discussion to understand what type of shop we are dealing
    with and let us assume that this client prides itself in using only the latest
    and greatest in open source community driven software. Ideally, we would try to
    emulate the customer environment as closely as possible to determine if there
    may be any security controls that are not positioned correctly or that are known
    to be frequently misconfigured. With this in mind, we will attempt to emulate
    using the following configurations:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 查看图表后，我们可以确定至少有四个已知子网、两个防火墙和六台执行各种任务的机器。还有一个位于`192.168.25.0/24`和`192.168.50.0/24`之间以及DMZ'd
    Web1服务器的Web应用防火墙和入侵检测系统。不需要太多讨论就能理解我们正在处理的是什么类型的企业，并让我们假设这个客户自豪地使用开源社区驱动的最新和最优秀的软件。理想情况下，我们将尽量模拟客户环境，以确定是否存在任何安全控制没有正确定位或已知经常配置错误的情况。考虑到这一点，我们将尝试使用以下配置进行模拟：
- en: 1 M0n0Wall firewall
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1个M0n0Wall防火墙
- en: 1 pfSense firewall with IDS and WAF modules installed and configured
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1个安装和配置了IDS和WAF模块的pfSense防火墙
- en: 5 Ubuntu server systems
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5台Ubuntu服务器系统
- en: 1 FreeBSD system running MySQL (for example, the fictional owner of the business
    let it slip that he would like to start using FreeBSD for all of his servers because
    of the great experience they have had with their FreeBSD server)
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1台运行MySQL的FreeBSD系统（例如，虚构的业务所有者透露他希望开始使用FreeBSD作为所有服务器的操作系统，因为他们在FreeBSD服务器上的良好经验）
- en: That is a total of eight virtual servers that will need to be emulated if we
    performed a direct system to system build in our lab. Looking at the diagram again
    we determine that we can make this a bit more resource friendly if we combined
    some of the servers. Each of our virtual units can have up to four network adapters
    by default.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 这总共是八台虚拟服务器，如果我们在实验室中进行直接系统构建，就需要模拟。再次查看图表后，我们确定如果合并一些服务器，可以使资源更加友好。默认情况下，我们的每个虚拟单元最多可以有四个网络适配器。
- en: Note
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: There are detailed instructions on how to configure each machine further in
    this section. Do not build out these systems until you reach the section for each
    machine. The following listing is to be used as an overview of what will be required.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中有关如何进一步配置每台机器的详细说明。在到达每台机器的部分之前，不要构建这些系统。以下清单将用作所需概述。
- en: 'With this in mind we will configure our virtual lab as follows:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这一点，我们将按以下方式配置我们的虚拟实验室：
- en: Firewall1
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Firewall1
- en: pfSense
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pfSense
- en: 256 MB RAM
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 1 GB HDD
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB HDD
- en: IDS
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IDS
- en: WAF
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WAF
- en: DHCP service
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务
- en: 'Adapter 1: 192.168.25.0/24 Internal Network Name: MyLab1'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.25.0/24 内部网络名称：MyLab1
- en: 'Adapter 2: 192.168.50.0/24 Internal Network Name: MyLab2'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.50.0/24 内部网络名称：MyLab2
- en: 'Adapter 3: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器3：192.168.75.0/24 内部网络名称：MyLab3
- en: Firewall2
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Firewall2
- en: M0n0Wall
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: M0n0Wall
- en: 128 MB RAM
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 128 MB RAM
- en: 200 MB HDD
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 200 MB HDD
- en: DHCP service
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务
- en: 'Adapter 1: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.75.0/24 内部网络名称：MyLab3
- en: 'Adapter 2: 192.168.101.0/24 Internal Network Name: MyLab4'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.101.0/24 内部网络名称：MyLab4
- en: Web1
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web1
- en: Ubuntu server
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu服务器
- en: 512 MB RAM
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 512 MB RAM
- en: 1 GB HDD
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB HDD
- en: LAMP
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP
- en: 'Adapter 1: 192.168.25.0/24 Internal Network Name: MyLab1'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.25.0/24 内部网络名称：MyLab1
- en: WordPress 3.1
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WordPress 3.1
- en: DB1
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DB1
- en: FreeBSD 8.2
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FreeBSD 8.2
- en: MySQL
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MySQL
- en: 256 MB RAM
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 6 GB HDD (Can be reduced if limited resources are a problem)
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 6 GB HDD（如果资源有限，可以减少）
- en: 'Adapter 1: 192.168.50.0/24 Internal Network Name: MyLab2'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.50.0/24 内部网络名称：MyLab2
- en: 'Adapter 2: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.75.0/24 内部网络名称：MyLab3
- en: App1
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: App1
- en: Ubuntu server
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu服务器
- en: 256 MB RAM
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 1 GB HDD
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB HDD
- en: LAMP
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP
- en: 'Adapter 1: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.75.0/24 内部网络名称：MyLab3
- en: 'Adapter 2: 192.168.101.0/24 Internal Network Name: MyLab4'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.101.0/24 内部网络名称：MyLab4
- en: WordPress 3.1
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WordPress 3.1
- en: Admin1
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Admin1
- en: Ubuntu server
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu服务器
- en: 256 MB RAM
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 1 GB HDD
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB HDD
- en: LAMP
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP
- en: 'Adapter 2: 192.168.101.0/24 Internal Network Name: MyLab4'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.101.0/24 内部网络名称：MyLab4
- en: Various administrative tools installed (Wireshark, Nmap, and so on)
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装了各种管理工具（Wireshark、Nmap等）
- en: This puts us at a total of 1664 MB of RAM and just over 10 GB of HDD. Most modern
    systems are able to handle this type of virtual network, but if your system is
    not able to, please strategically reduce the amount of RAM or HDD as needed.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这使我们总共需要1664 MB的RAM和超过10 GB的HDD。大多数现代系统能够处理这种类型的虚拟网络，但如果您的系统无法处理，请根据需要有策略地减少RAM或HDD的数量。
- en: Note
  id: totrans-147
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that this does not include any RAM or HDD space reserved for your BackTrack
    machine or the host machine. If you have 16 GB of RAM do not assign it ALL to
    your virtual machines or you may run into some issues!
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这不包括为您的BackTrack机器或主机机器保留的任何RAM或HDD空间。如果您有16 GB的RAM，请不要将所有RAM分配给虚拟机，否则可能会遇到一些问题！
- en: Configuring firewall1
  id: totrans-149
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置防火墙1
- en: 'Download and install a pfSense virtual machine using the settings determined
    above:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 下载并安装一个pfSense虚拟机，使用上述确定的设置：
- en: Firewall1
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Firewall1
- en: pfSense 2.0
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pfSense 2.0
- en: 256 MB RAM
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 300 MB HDD
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 300 MB HDD
- en: IDS
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IDS
- en: WAF
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WAF
- en: DHCP Service
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务
- en: 'Adapter 1: 192.168.25.0/24 Internal Network Name: MyLab1'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.25.0/24 内部网络名称：MyLab1
- en: 'Adapter 2: 192.168.50.0/24 Internal Network Name: MyLab2'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.50.0/24 内部网络名称：MyLab2
- en: 'Adapter 3: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器3：192.168.75.0/24 内部网络名称：MyLab3
- en: 'Be sure to use an adapter type that is compatible with FreeBSD to avoid any
    issues. We will not review setting up the pfSense base adapter configuration again
    as that has been covered extensively in previous chapters. Once the base configuration
    has been completed you should end up with something similar to the following:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 请确保使用与FreeBSD兼容的适配器类型，以避免任何问题。我们不会再次审查设置pfSense基本适配器配置，因为在之前的章节中已经详细介绍过。一旦基本配置完成，您应该得到类似以下的结果：
- en: '![Configuring firewall1](img/7744OS_10_013.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![配置防火墙1](img/7744OS_10_013.jpg)'
- en: 'Once the IPs have been configured the settings should look like this:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦IP地址配置完成，设置应该如下所示：
- en: '![Configuring firewall1](img/7744OS_10_014.jpg)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![配置防火墙1](img/7744OS_10_014.jpg)'
- en: 'Connect to one of the networks using a BackTrack virtual machine and configure
    the following pfSense web console settings:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 使用BackTrack虚拟机连接到其中一个网络，并配置以下pfSense Web控制台设置：
- en: 'DHCP server: Enable for all interfaces on ranges X.X.X.100 X.X.X.150.'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器：启用X.X.X.100 X.X.X.150范围内的所有接口。
- en: Create a rule to allow ICMP, 80, 443, 53, 161, 25, 22, 23 and 21 TCP/UDP from
    192.168.25.0/24 (WAN) to 192.168.50.0/24 (LAN). Remove existing WAN rules.
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个规则，允许从192.168.25.0/24（WAN）到192.168.50.0/24（LAN）的ICMP、80、443、53、161、25、22、23和21
    TCP/UDP。删除现有的WAN规则。
- en: Create a rule that allows all traffic from 192.168.50.0/24 (LAN) to 192.168.75.0/24
    (OPT1).
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个规则，允许所有来自192.168.50.0/24（LAN）到192.168.75.0/24（OPT1）的流量。
- en: Allow all traffic from LAN to WAN interfaces.
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许所有来自LAN到WAN接口的流量。
- en: 'Here is an example of a work in progress of setting the Firewall1 rules for
    the LAN:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个正在进行中的工作示例，用于设置LAN的防火墙1规则：
- en: '![Configuring firewall1](img/7744OS_10_015.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![配置防火墙1](img/7744OS_10_015.jpg)'
- en: Installing additional packages in pfSense
  id: totrans-172
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在pfSense中安装额外软件包
- en: Firewall1 also had an IDS and a WAF listed. We can use the package manager that
    pfSense makes available to us to install this additional functionality on our
    system.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙1还列出了IDS和WAF。我们可以使用pfSense提供给我们的软件包管理器在系统上安装这些额外的功能。
- en: Note
  id: totrans-174
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The pfSense system will need temporary access to the Internet to be able to
    access and download these packages. This can be configured using NAT. Be sure
    to disable any of the other test machines before connecting to the Internet. Enabling
    Internet on the WAN interface will enable all of the systems using Firewall1 to
    access the Internet! Also note that the machine will need to be shut down prior
    to changing from Internal Network to NAT.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: pfSense系统需要临时访问互联网才能访问和下载这些软件包。这可以通过NAT进行配置。在连接到互联网之前，请确保禁用任何其他测试机器。启用WAN接口上的互联网将使使用防火墙1的所有系统都能访问互联网！还要注意，在从内部网络切换到NAT之前，机器需要关闭。
- en: Click on **System** | **Packages** and choose the **Available Packages** tab.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**系统** | **软件包**，选择**可用软件包**选项卡。
- en: Choose **Proxy Server with mod_security** and install it.![Installing additional
    packages in pfSense](img/7744OS_10_016.jpg)
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**带有mod_security的代理服务器**并安装。![在pfSense中安装额外软件包](img/7744OS_10_016.jpg)
- en: Select the **Snort** package and install it as well.![Installing additional
    packages in pfSense](img/7744OS_10_017.jpg)
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**Snort**软件包并安装。![在pfSense中安装额外软件包](img/7744OS_10_017.jpg)
- en: Tip
  id: totrans-179
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Take some time and familiarize yourself with the various one-click install packages
    that are available to be used in conjunction with pfSense. The ease of use and
    availability of excellent choices makes using these software installs quick and
    efficient.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 花一些时间熟悉一键安装软件包，这些软件包可与pfSense一起使用。使用这些软件安装的便利性和出色选择的可用性使得安装这些软件快速高效。
- en: Each installed package will be added to the **Services** menu in the navigation
    bar for further configuration. Update the packages and configure as you desire.
    As we do not know how the client in this fictional exercise has configured the
    WAF or IDS, we can assume that the defaults are being used until we were to perform
    initial enumeration at which point we could more closely emulate the environment
    that is being targeted.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 每个安装的软件包都将添加到**服务**菜单中，以供进一步配置。更新软件包并根据需要进行配置。由于我们不知道这个虚构练习中的客户如何配置WAF或IDS，我们可以假设默认设置正在使用，直到我们执行初始枚举时，我们可以更接近地模拟被攻击的环境。
- en: Firewall2 setup and configuration
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 防火墙2的设置和配置
- en: 'We will need to set up a M0n0wall virtual instance as follows:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要设置一个M0n0wall虚拟实例，如下所示：
- en: Firewall2
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙2
- en: M0n0Wall
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: M0n0Wall
- en: 128 MB RAM
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 128 MB RAM
- en: 200 MB HDD
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 200 MB 硬盘
- en: DHCP service
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务
- en: 'Adapter 1: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.75.0/24 内部网络名称：MyLab3
- en: 'Adapter 2: 192.168.101.0/24 Internal Network Name: MyLab4'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.101.0/24 内部网络名称：MyLab4
- en: As we have already gone over setting up M0n0wall in this chapter we will skip
    to the next machine type.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们已经在本章中讨论了如何设置M0n0wall，我们将跳过到下一个机器类型。
- en: Web1
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Web1
- en: 'Download and install Ubuntu Server 10.04 from the typical repositories. The
    virtual machine will need to be defined as follows:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 从典型的软件仓库下载并安装Ubuntu Server 10.04。虚拟机需要定义如下：
- en: Web1
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web1
- en: Ubuntu server
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu服务器
- en: 'Hostname: Web1'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主机名：Web1
- en: 512 MB RAM
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 512 MB RAM
- en: 1 GB HDD
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB 硬盘
- en: LAMP
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP
- en: OpenSSH
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenSSH
- en: 'Adapter 1: 192.168.25.0/24 Internal Network Name: MyLab1'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.25.0/24 内部网络名称：MyLab1
- en: Once the machine has been installed, updated, and configured we will need to
    install WordPress.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦机器安装、更新和配置完成，我们将需要安装WordPress。
- en: Note
  id: totrans-203
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The Ubuntu website supplies excellent resources that assist with proceeding
    with the intuitive install.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 网站提供了出色的资源，帮助进行直观的安装。
- en: Installing WordPress in Ubuntu Server can be simple; there are great instructions
    available at [http://codex.wordpress.org/Installing_WordPress#Famous_5-Minute_Install](http://codex.wordpress.org/Installing_WordPress#Famous_5-Minute_Install).
    To sum up the instructions you can simply `wget` the package at [http://wordpress.org/latest.tar.gz](http://wordpress.org/latest.tar.gz),
    unzip it and then move it to the `/var/www` directory on your server. This will
    enable you to access the WordPress install via `http://192.168.25.100/wordpress`
    if you have followed along with the previous instructions. Keep in mind that the
    goal of this exercise is to understand how to create a simulation that mimics
    what is found in a common configuration. In this case, the database is abstracted
    and stored on the FreeBSD machine. This allows more granular control of whom and
    what has access to specific data on the network. It also makes it more difficult
    for an attacker to access the machine indirectly and oftentimes is enough to prevent
    direct attacks on the machine itself (attackers will use SQL injection and other
    web application-based flaws to access and take control of the system instead of
    targeting it directly).
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在Ubuntu服务器中安装WordPress可能很简单；在[http://codex.wordpress.org/Installing_WordPress#Famous_5-Minute_Install](http://codex.wordpress.org/Installing_WordPress#Famous_5-Minute_Install)上有很好的说明。总结一下，您可以简单地`wget`包在[http://wordpress.org/latest.tar.gz](http://wordpress.org/latest.tar.gz)，解压缩然后将其移动到服务器上的`/var/www`目录。这将使您能够通过`http://192.168.25.100/wordpress`访问WordPress安装，如果您已经按照之前的说明进行操作。请记住，这个练习的目标是了解如何创建一个模拟，模拟常见配置中所发现的情况。在这种情况下，数据库是抽象的，并存储在FreeBSD机器上。这允许更精细地控制谁以及谁对网络上的特定数据有访问权限。这也使得攻击者更难以间接访问机器，并且通常足以防止对机器本身的直接攻击（攻击者将使用SQL注入和其他基于Web应用程序的缺陷来访问和控制系统，而不是直接针对它）。
- en: DB1
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DB1
- en: DB1 is a very basic install of FreeBSD 8.2 with only a MySQL server, Telnet,
    and SSH running as a service. Grab the ISO at [http://www.freebsd.org/where.html](http://www.freebsd.org/where.html)
    and install the machine using the following virtual machine settings. Please note
    that this machine is multi-homed for direct management from the administrator
    on the `192.168.101.0/24` segment. In a perfect world, you would also restrict
    direct access to this machine to only the MySQL port, Telnet port, and SSH port
    to only the administrator and the Web1 server.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: DB1是一个非常基本的FreeBSD 8.2安装，只运行MySQL服务器、Telnet和SSH作为服务。在[http://www.freebsd.org/where.html](http://www.freebsd.org/where.html)获取ISO并使用以下虚拟机设置安装机器。请注意，该机器是多宿主的，可由管理员在`192.168.101.0/24`段直接管理。在理想的情况下，您还应该将对该机器的直接访问限制为仅限管理员和Web1服务器的MySQL端口、Telnet端口和SSH端口。
- en: DB1
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DB1
- en: FreeBSD 8.2
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FreeBSD 8.2
- en: MySQL
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MySQL
- en: 256 MB RAM
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 6 GB HDD (Can be reduced if limited resources are a problem)
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 6 GB硬盘（如果资源有限，可以减少）
- en: 'Adapter 1: 192.168.50.0/24 Internal Network Name: MyLab2'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.50.0/24 内部网络名称：MyLab2
- en: 'Adapter 2: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.75.0/24 内部网络名称：MyLab3
- en: Once the system has been set up and configured it should be used as the MySQL
    database server for the Web1 and App1 instances using a `WP_production` and `WP_Test`
    database.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 系统设置和配置完成后，应将其用作Web1和App1实例的MySQL数据库服务器，使用`WP_production`和`WP_Test`数据库。
- en: App1
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: App1
- en: This is basically a clone of the Web1 server. In a typical environment, this
    machine would probably have the latest and greatest changes available which also
    means it is probably not as secure as the server located in the DMZ. This is a
    great target for further intrusion into the network as many administrators will
    not use strong passwords or the certificates used on these systems may not be
    up to par with what you see out in the wild.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 这基本上是Web1服务器的克隆。在典型的环境中，这台机器可能会有最新和最好的可用更改，这也意味着它可能不像位于DMZ中的服务器那样安全。这是进一步入侵网络的绝佳目标，因为许多管理员不会使用强密码，或者这些系统上使用的证书可能不符合野外所见的标准。
- en: App1
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: App1
- en: Ubuntu server
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu服务器
- en: 256 MB RAM
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 1 GB HDD
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB硬盘
- en: LAMP
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP
- en: 'Adapter 1: 192.168.75.0/24 Internal Network Name: MyLab3'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.75.0/24 内部网络名称：MyLab3
- en: 'Adapter 2: 192.168.101.0/24 Internal Network Name: MyLab4'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器2：192.168.101.0/24 内部网络名称：MyLab4
- en: WordPress 3.1
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WordPress 3.1
- en: Simply use the VirtualBox cloning mechanism to create this machine, rename the
    appropriate items and ensure that the adapter MAC addresses are reset. You will
    also need to assign the **Network Adapters** in VirtualBox appropriately.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 只需使用VirtualBox的克隆机制创建此机器，重命名适当的项目，并确保重置适配器MAC地址。您还需要适当地分配VirtualBox中的**网络适配器**。
- en: Admin1
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Admin1
- en: As this machine would be very likely to contain many tools and critical data
    you should be sure to include certain power tools such as Nmap, WireShark, and
    so on that are typically used by an administrator. This machine would be used
    as a management tool and island for the administrator to perform different administrative
    tasks on the network. Have fun with this one and install Ubuntu server and any
    services or software that you feel comfortable with. Ideally, at this point the
    enumeration efforts you have performed during a real test would have given you
    more information on what this system really has so that you could mimic it more
    closely. Many of the systems throughout the network will probably have rules that
    allow direct access from this system regardless of network location.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这台机器很可能包含许多工具和关键数据，因此您应该确保包括诸如Nmap、WireShark等管理员通常使用的一些强大工具。这台机器将用作管理员在网络上执行不同管理任务的管理工具和岛屿。玩得开心，并安装Ubuntu服务器和您感到舒适的任何服务或软件。理想情况下，在这一点上，您在真实测试期间进行的枚举工作将为您提供更多关于这个系统的信息，以便您可以更接近地模拟它。网络中的许多系统可能会有规则，允许从这个系统直接访问，而不管网络位置如何。
- en: 'For this example, build out an Ubuntu server that meets the following specs:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，构建一个符合以下规格的Ubuntu服务器：
- en: Admin user
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理员用户
- en: Ubuntu server
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu服务器
- en: 256 MB RAM
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 256 MB RAM
- en: 1 GB HDD
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 GB硬盘
- en: LAMP
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP
- en: 'Adapter 1: 192.168.101.0/24 Internal Network Name: MyLab4'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器1：192.168.101.0/24 内部网络名称：MyLab4
- en: Various administrative tools installed (Wireshark, Nmap, and so on)
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装了各种管理工具（Wireshark、Nmap等）
- en: By this point you should have a fully functional multi-tier environment that
    somewhat mimics those frequently found in smaller shops. To test truly secured
    networks you will also have to add additional modules and count on heavily monitored
    logs, file integrity checking, network-based antivirus scanning (try this on pfSense!!),
    and more. Regardless of how many security controls are in place, they must all
    work together to be fully functional. Through hard work and out of the box thinking
    a penetration tester will push these environments to the limits and ascertain
    if the customer is fully protected (or not…).
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您应该拥有一个功能齐全的多层环境，它在某种程度上模仿了在较小的商店中经常发现的环境。要测试真正安全的网络，您还必须添加额外的模块，并依靠严格监控的日志、文件完整性检查、基于网络的防病毒扫描（在pfSense上尝试！）等。无论有多少安全控件，它们都必须共同工作才能完全发挥作用。通过辛勤工作和开箱即用的思维，渗透测试人员将把这些环境推向极限，并确定客户是否得到了充分的保护（或者没有……）。
- en: Summary
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we reviewed setting up various types of virtual labs. It should
    be apparent that almost any type of virtual environment can be emulated using
    commonly available tools and given sufficient resources. This is especially true
    of any systems that use open source software as it is readily available and does
    not require the purchase of licenses (typically and depending on what the software
    is).
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们回顾了设置各种类型的虚拟实验室。几乎可以使用常见的可用工具和足够的资源来模拟几乎任何类型的虚拟环境。这对于使用开源软件的任何系统尤其如此，因为它是readily
    available并且不需要购买许可证（通常取决于软件是什么）。
- en: We also learned more about the capabilities of pfSense and how it can be leveraged
    to more closely emulate the types of environments we will find when testing highly
    secured networks. It is simple to install and configure WAF, IDS, IPS, and even
    reverse proxies using these technologies.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还了解了pfSense的功能以及如何利用它更紧密地模拟在测试高度安全网络时会遇到的环境类型。使用这些技术可以轻松安装和配置WAF、IDS、IPS，甚至反向代理。
- en: We also covered the installation and configuration of M0n0wall, which is perfect
    for those times when resources are at a premium and a small footprint is required.
    Some penetration testers have built test labs that spanned several host machines
    and hundreds of guests. This is probably beyond the necessity of most, but the
    fact that it can be accomplished inexpensively remains a fact.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还介绍了M0n0wall的安装和配置，这对于资源有限且需要小的占地面积时非常合适。一些渗透测试人员已经建立了跨越多台主机和数百个虚拟机的测试实验室。这对大多数人来说可能超出了必要性，但可以以低成本实现这一点的事实仍然存在。
- en: In the next chapter, we will create a very special lab that is intended to simulate
    a real life penetration test. You will need to use all of the methods discussed
    within this book (and possibly more as no book can cover everything involved in
    penetration testing!) to be able to test the fictional company from start to finish.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将创建一个非常特殊的实验室，旨在模拟真实的渗透测试。您将需要使用本书中讨论的所有方法（可能还有更多，因为没有一本书可以涵盖渗透测试中涉及的所有内容！）来测试虚构公司的始终。
- en: See you in the next chapter!
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章见！
