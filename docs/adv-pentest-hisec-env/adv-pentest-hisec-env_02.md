# 第二章。高级侦察技术

可操作的信息是进行渗透测试的关键。互联网上可用的公共数据量庞大，筛选出有用的信息可能是一项艰巨的任务。幸运的是，有可用的工具可以帮助收集和整理这些丰富的知识。在本章中，我们将回顾其中一些工具，并重点介绍如何使用这些信息来确保您的渗透测试是高效、专注和有效的。主要涵盖的关键主题包括：

+   侦察是什么，为什么我们需要它

+   侦察类型

+   使用 DNS 快速识别潜在目标

+   使用搜索引擎数据

+   利用元数据的优势

### 注意

在本章中，我们将使用由 IANA 拥有和维护的域名`example.com，example.org`和`example.net`。不要将它们用于实践目的。

这些域名用作您**拥有和/或获得使用权限**作为测试目标的代表。理想情况下，您应该建立一个分割和受控的虚拟实验室，其中包括允许您随意测试所有这些命令的 DNS 服务器。

# 介绍侦察

当进行渗透测试时，了解被测试环境是最有效的。有时，公司会向您提供这些信息，而其他时候，您需要进行侦察以了解甚至最琐碎的事项。无论哪种情况，请确保在进行任何工作之前，包括侦察在内，都要在规则中明确范围。

许多公司并不知道攻击者可以在野外找到并使用的数据类型。渗透测试人员需要将这些信息披露出来。您将为企业提供他们可以根据其风险偏好采取行动的真实数据。您能够找到的信息会因目标而异，但通常包括 IP 范围、域名、电子邮件地址、公开财务数据、组织信息、使用的技术、职位名称、电话号码等等。有时，甚至可以找到机密文件或通过互联网公开获取的私人信息。在向组织的网络发送任何数据包之前，完全可以对一家公司进行全面的概况。

被动侦察阶段的主要目标是尽可能收集可操作的数据，同时留下尽可能少的迹象表明有人搜索了这些数据。

### 注意

被动侦察避免与目标网络直接接触。

获得的信息将用于重建您预期在测试中遇到的系统类型，提供执行有效社会工程攻击或物理入侵所需的信息，并确定是否存在使用默认用户名和密码的易受外部攻击的设备，如路由器或交换机。在高度安全的环境中，事情可能不会那么容易，但在进行渗透测试时不建议做出假设。在处理支持成千上万用户的复杂网络配置时，有时会忽视一些常识性的事情。

### 注意

本书中描述的侦察最接近于 PTES 的“情报收集”类别。

我们将专注于的侦察类型包括**OSINT（开源情报）**和足迹。我们使用的所有来源都是免费的，但重要的是要注意互联网上也有付费网站可供使用。

开源情报（OSINT）：包括收集、处理和分析公开可用数据，并将其转化为可操作的信息。公开可用的数据来源包括但不限于：

+   法院、税务表格等的公开数据

+   搜索引擎

+   会议

+   学术来源

+   博客

+   研究报告

+   图片、可执行文件、文档等的元数据

+   公开可用文件

足迹：用于非侵入性地枚举网络环境。结果用于确定可能存在的漏洞位置，并提供有关目标网络上正在运行的系统、软件和服务类型的信息。在执行非侵入式足迹时可以获得的信息类型包括：

+   域名服务器

+   IP 范围

+   横幅

+   操作系统

+   确定是否使用 IDS/IPS

+   使用的技术

+   网络设备类型

这些丰富的信息在进行渗透测试时非常有用。

## 侦察工作流程

当进行程序化的侦察时，侦察最有效。在执行侦察时应遵循三个主要阶段：

![侦察工作流程](img/7744_02_01.jpg)

作为如何使用这个工作流程的示例，让我们假设我们正在进行一项涉及虚构公司的渗透测试。这家公司有关于其外部路由器的公开信息。

+   **第一阶段：**我们能够验证在初始规划阶段得到的 IP 范围实际上属于我们的客户。

+   **第二阶段：**在筛选数据时，我们发现有几台路由器配置为默认状态，并且登录凭据从未被更改。我们验证信息的准确性并继续下一个阶段。

+   **第三阶段：**根据收集到的验证信息，我们确定在网络上获得立足点的最佳方法是入侵外部路由器，然后从那里开始工作。

我们已经演示了如何使用这个工作流程的简化示例。在现实世界中，将有许多变量影响您决定攻击哪些系统。在测试的侦察阶段收集的信息将是您的渗透测试成功和彻底程度的决定因素。

# DNS 侦察

**域名系统（DNS）**在侦察阶段可以提供有价值的数据。如果您还不了解 DNS，您可能需要花些时间来了解该服务以及它的工作原理。在非常基本的水平上，DNS 用于将域名转换为 IP 地址。幸运的是，有许多可用的工具非常擅长从域名服务器中提取我们需要的数据。您可以收集的信息示例包括：

| **记录** | **描述** |
| --- | --- |
| CNAME | 别名，用于将多个名称与单个 IP 联系起来。一个 IP 地址可以有多个与之关联的 CNAME 记录。 |
| A | 用于将域名或子域名转换为 32 位 IP 地址。它还可以存储其他有用的信息。 |
| MX | 将域名与关联的邮件服务器联系起来。 |

还有其他类型的记录可以从 DNS 工具中收集；表中列出的记录是最受欢迎的，通常也是最有用的。

### 注意

DNS 侦察被认为是主动足迹，因为您需要与客户拥有的资产进行交互以获取信息。

## Nslookup — 当你需要它时它就在那里

**nslookup**是一个 DNS 查询工具，可用于从域名解析 IP 地址，或反之亦然。该工具用于查询任何给定的域名服务器以获取特定记录。虽然`nslookup`不是我们测试工具包中最强大的 DNS 工具，但您可以依赖它在需要时已安装。`nslookup`是跨平台的，并且大多数操作系统都预装了它。

### 注意

在接下来的示例中，我们修改了命令输出以最大化学习体验。

我们打算帮助您理解输出的格式和含义。在许多情况下，我们已经用`example.com/net/org`替换了原始域名，并使用了虚构的 IP 地址（通常是不可路由的 IP）。不要期望直接复制输出，而是专注于所描述的概念，然后在您有适当权限进行测试的域名和服务器上练习这些步骤。

### 默认输出

要快速查找域名`example.com`的 IP 地址，我们在 BackTrack 终端会话中输入以下内容：

```
# nslookup example.com 

```

你将会看到以下**格式**的输出：

```
Server: 8.8.8.8
Address: 8.8.8.8#53
Non-authoritative answer:
Name: example.com
Address: 127.1.72.107

```

`8.8.8.8`处的服务器是由 Google™提供的公共 DNS 服务器。在进行请求时使用的是#53 UDP 端口。上面的示例输出表明`example.com`解析为`127.1.72.107`。

### 注意

任何以 127.x.x.x 开头的 IP 地址都将被重定向到本地主机。在查看 DNS 记录和选择潜在目标时要注意这一点。

### 更改域名服务器

可以通过使用替代 DNS 域名服务器来验证结果。在下面的示例中，我们将 DNS 域名服务器更改为`156.154.70.22`，这是 Comodo Secure DNS®提供的一个域名服务器的 IP 地址，用于向公众提供安全浏览。在进行测试时，拥有几个公共可用的 DNS 服务器列表是有益的。当处理受损的 DNS 服务器时，这些可以用作一种理智检查。我们还查询与`example.com`相关的域名服务器：

```
root@bt:~# nslookup
> server
Default server: 8.8.8.8
Address: 8.8.8.8#53
Default server: 8.8.4.4
Address: 8.8.4.4#53
> server 156.154.70.22 
Default server: 156.154.70.22
Address: 156.154.70.22#53
> set type=ns
> example.com
Server: 156.154.70.22
Address: 156.154.70.22#53
Non-authoritative answer:
example.com nameserver = ns51.example.com.
example.com nameserver = ns52.example.com.

```

这个示例是通过初始化`nslookup`开始的，然后从 nslookups 命令控制台内建立变量。我们首先输入`server`，显示了当前值为`8.8.8.8`。之后，我们确定要使用不同的服务器，因此我们输入了`server 156.154.70.22`，因为我们特别关注`example.com`的域名服务器。我们通过输入`set type=ns`来定义类型为**ns**（域名服务器）。

一旦变量设置好了，我们可以通过输入名称，比如`example.com`，然后按下*Enter*键来查询无数个域名。

### 注意

要离开控制台，输入`exit`，然后按下*Enter*键。

到目前为止，我们所做的一切都可以简化为一个单一的命令行：

```
root@bt:~# nslookup -type=ns example.com 156.154.70.22 

```

我们调用了`nslookup`，使用了`type=ns`的选项来获取相关的域名服务器，提供了我们想要信息的域名`example.com`，最后，我们指定要使用`156.154.70.22`作为我们的解析 DNS 域名服务器。这将产生以下输出：

```
Server: 156.154.70.22
Address: 156.154.70.22#53
Non-authoritative answer:
example.com nameserver = ns51.example.com.
example.com nameserver = ns52.example.com.

```

### 提示

每当执行命令行工具时，输出都可以发送到文件以供以后查看。一旦开始编写自己的脚本来自动化测试，这一点尤为重要。例如，`nslookup example.com > example-resolv.txt`。

### 创建自动化脚本

如前所述，`nslookup`是一个很好的选择，因为它通常预装在所有平台上。例如，如果您正在使用一个枢纽点，您可以放心，这是一个默认可用的工具。由于`nslookup`可以从单个命令行提示符中运行，因此您可以轻松地创建一个自动化提取有关许多域名或主机名信息的脚本，然后将输出放入文本文件中。

1.  在 BackTrack 中，打开一个终端会话，输入`nano AutoM8`，然后按下*Enter*键。

1.  在 nano 编辑器中，输入以下代码，我们使用`#!/bin/sh`来启动**bourne** shell，将`DomainNames.txt`文件中的每个行项目解析为`HOSTNAME`变量，然后输出字符串"Getting `name servers for`"，接着是当前正在解析的`HOSTNAME`。然后我们使用`nslookup`命令来使用我们指定的公共域名服务器`8.8.8.8`执行域名服务器查找：

```
#!/bin/sh
for HOSTNAME in `cat DomainNames.txt``
do
echo "Getting name servers for [$HOSTNAME]"
nslookup -type=ns $HOSTNAME 8.8.8.8
done

```

1.  按下*Ctrl + O*，然后按*Enter*确认保存您的数据。

1.  按下*Ctrl + X*退出返回到终端屏幕。

1.  键入`nano DomainNames.txt`。

1.  在**nano**中输入以下内容：

### 注意

**在以下列表中使用的`example.com/net/org`域名的地方，用您有权限测试的替代域名!!!**

```
example.com
example.net
example.org

```

1.  按下*Ctrl + O*，然后按*Ctrl + X*保存文件。

1.  在终端中，我们需要通过输入以下命令使`AutoM8`文件可执行：

```
# chmod +x AutoM8 

```

1.  现在输入以下命令运行`AutoM8`脚本：

```
# ./AutoM8 

```

1.  您应该看到类似以下格式的输出：

```
root@bt:~# ./AutoM8 
"Getting name servers for [example.com]"
Server: 8.8.8.8
Address: 8.8.8.8#53
Non-authoritative answer:
example.com nameserver = ns52.example.com.
example.com nameserver = ns51.example.com.
Authoritative answers can be found from:
"Getting name servers for [example.net]"
Server: 8.8.8.8
Address: 8.8.8.8#53
Non-authoritative answer:
example.net nameserver = ns51.example.com.
example.net nameserver = ns52.example.com.
Authoritative answers can be found from:
"Getting name servers for [example.org]"
Server: 8.8.8.8
Address: 8.8.8.8#53
Non-authoritative answer:
example.org nameserver = ns52.example.com.
example.org nameserver = ns51.example.com.

```

1.  现在输入：

```
# ./AutoM8 > NameServerListing.txt
# cat NameServerListing.txt

```

您现在已经创建了一个名为`AutoM8`的简单脚本，可以用来将输出附加到任何您喜欢的文件中。我们通过使用`cat`来查看`NameServerListing.txt`文件已经验证了这一点。

### 提示

挑战自己，使以前的代码更加高效和可重用。本书中您将学到的几种工具可以以这种方式自动化。尝试使用`grep`和`awk`以更清晰的方式解析出您的结果。

理想情况下，您将使用具有 XML 输出的工具，以便结果可以轻松导入到 MagicTree 或 Dradis 中，但是在日常进行渗透测试时，您将想要知道如何为自己的特殊需求创建一些基本工具。Shell 脚本可以非常强大；对于许多渗透测试人员来说，首选工具是 Python，它甚至更好。

### 注意

每个渗透测试人员都应该至少了解一种基本的脚本语言。

## 我们学到了什么？

如果您查看各种示例的输出，您应该注意我们已经对目标有了很多了解。我们知道使用了哪些域名服务器，并且我们知道所有三个域名都使用相同的域名服务器。我们还验证了我们拥有的域名解析为某些 IP 地址。这是在渗透测试的后期阶段非常有用的数据。现在让我们继续使用我们手头的更强大的工具。

## 域信息探测器（Dig）

**域信息探测器（Dig）**是`nslookup`的一个强大替代品。它具有运行命令行选项或者可以直接将文件传送到其中进行多次查找的功能。Dig 将使用`/etc/resolve.conf`文件来循环遍历您的域名服务器，除非指定了域名服务器。Dig 有一个非常长的选项列表，可以用来准确地获取您所寻找的内容。

### 提示

有一个网站[`www.digwebinterface.com/`](http://www.digwebinterface.com/)向公众提供了 dig 功能。

### 默认输出

要启动 BackTrack 的基本命令，请在终端命令行中输入`dig example.com`。以下是在作者拥有的域上运行此命令的示例。

### 注意

您的命令输出可能会因您所针对的域而有所不同。

如果您跟随命令，您将用您拥有或有权限测试的域名替换`example.com`。

```
root@bt:~# dig example.com 
; <<>> DiG 9.7.0-P1 <<>> example.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 56376
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
;; QUESTION SECTION:
;example.com. IN A
;; ANSWER SECTION:
example.com. 78294 IN A 10.1.1.1
;; Query time: 32 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Sun *** * **:**:** ****
;; MSG SIZE rcvd: 45

```

这个冗长的输出指示了 Dig 的版本，哪些全局选项是默认选择的，是否有任何错误，当然`example.com`的`A`记录包含`10.1.1.1`。我们还了解到当前使用的域名服务器在`8.8.8.8`。此外，我们还提供了查询运行的时间，这在以后整理数据时非常有用。DNS 记录可以更改，具有 Dig 以前运行的日期戳可能很有用。

让我们深入挖掘一下。我们将提取`example.com`域的所有记录：

```
# dig +qr www.example.com any 

```

这将提取`example.com`域的所有可用 DNS 记录，因为有`any`选项，并且`+qr`开关将打印出站查询。结果将包括头部和页脚数据，如前所述，但还将列出以下记录：

```
;; QUESTION SECTION:
;www.example.com. IN ANY
;; ANSWER SECTION:
example.com. 86400 IN NS ns1.example.com.
example.com. 86400 IN MX 10 mx111.example.com.
example.com. 86400 IN A 127.208.72.107
example.com. 86400 IN NS ns2.example.com.
example.com. 86400 IN SOA ns2.example.com. hostmaster.example.com. 2011020501 28800 7200 604800 86400
example.com. 86400 IN MX 10 mx99.example.com.

```

### 使用 Dig 进行区域传输

区域传输（AXFR）将允许你一次从域名服务器中拉取整个记录集。如果成功，你将得到一个简单命令的所有关于域名服务器的信息列表。在安全环境中，区域传输几乎不可能被启用，因为它会给攻击者提供大量有关主机名和其他信息的数据。现在我们将回顾在域`example.com`上执行区域传输所需的步骤。与本书中讨论的所有内容一样，你需要有**适当的权限**来为你的客户执行这种类型的活动。

1.  打开一个 BackTrack 终端窗口。

1.  输入以下内容并按*Enter*：

```
# dig @ns1.example.com example.com axfr 

```

1.  审查结果：

```
; <<>> DiG 9.7.0-P1 <<>> @ns1.example.com example.com axfr
; (1 server found)
;; global options: +cmd
; Transfer failed.

```

我们的结果表明传输失败了。在这种情况下，域名服务器的管理员已经正确地禁用了执行区域传输的能力。现在我们将尝试同一域上的另一个域名服务器，看看它是否也禁用了区域传输。

1.  类型：

```
# dig @ns16.example.com example.com axfr 

```

1.  审查结果：

```
; <<>> DiG 9.7.0-P1 <<>> @ns16.zoneedit.com example.com axfr
; (1 server found)
;; global options: +cmd
example.com. 7200 IN SOA ns16.zoneedit.com. soacontact.zoneedit.com. 2011409732 2400 360 1209600 300
example.com. 7200 IN NS ns14.zoneedit.com.
example.com. 7200 IN NS ns16.zoneedit.com.
mail.example.com. 300 IN MX 1 mail1.example.com.
testmachine.example.com. 300 IN A 192.168.1.1
irc.example.com. 300 IN A 192.168.1.1
mail1.example.com. 300 IN A 192.168.1.1
note.example.com. 300 IN TXT "This is an example of a note"
example.com. 7200 IN SOA ns16.zoneedit.com. soacontact.zoneedit.com. 2011409732 2400 360 1209600 300
;; Query time: 383 msec
;; SERVER: 69.64.68.41#53(69.64.68.41)
;; WHEN: Wed Oct 12 16:04:17 2011
;; XFR size: 10 records (messages 10, bytes 579)

```

在审查为`example.com`拉取的记录时，我们发现了几个有趣的地方。看起来`example.com`有几个子域名指向同一个 IP 地址。如果这个站点不是严格作为一个例子设置的话，你将会得到真实的 IP 地址，可以枚举系统。此外，还有一个包含琐碎信息的 TXT 记录。此外，可以说命名约定既不一致又具有信息量。

### 注意

非常重要的是，*所有*你的域名服务器都被限制只向受信任的服务器提供区域传输，或者完全禁止区域传输。

如果你想了解更多关于区域传输的信息，我强烈建议你查看`zonetransfer.me`，它会将你重定向到[`www.digininja.org/projects/zonetransferme.php`](http://www.digininja.org/projects/zonetransferme.php)。该网站的所有者已经非常详细地介绍了区域传输的工作原理。

### Dig 的高级功能

我们已经讨论了 dig 的基本用法。现在我们将涉及这个工具的更高级用法。

#### 缩短输出

Dig 是多功能的，可以让你以许多不同的输出格式提取数据。

我们可以通过使用`+ nocmd`来消除输出的命令信息部分。它必须在域名之前才能生效。

+ noall 通知 dig 我们不希望显示标志作为命令输出的一部分。

`+ answer`可以切换为只显示答案部分。

```
root@bt:~# dig +nocmd +noall +answer example.com 

```

这将导致以下输出：

```
example.com. 44481 IN A 192.168.1.10

```

本节讨论的任何选项都可以在缩短输出结果时使用。这使得可以轻松使用诸如`awk`和`grep`之类的工具来进一步操作你的结果。

#### 列出 bind 版本

这个命令将允许你确定域名服务器正在运行的 bind 版本，除非它已经被服务器管理员专门限制或更改。记得用你有权限使用的域名服务器替换`example.com`：

```
# dig +nocmd txt chaos VERSION.BIND @ns1.example.com +noall +answer 

```

这将导致以下输出：

```
VERSION.BIND. 0 CH TXT "8.4.X"

```

我们已经确定这个特定的域名服务器正在运行 bind 8.4.X。这些信息在枚举漏洞时可能非常有价值。

#### 使用 Dig 进行反向 DNS 查找

有时需要将 IP 地址解析为域名。无需切换回`nslookup`来执行此任务，只需输入：

```
# dig +nocmd +noall +answer -x 192.168.0.1 

```

你的输出会看起来像这样：

```
10.0.0.1.in-addr.arpa. 8433 IN PTR 43-10.any.example.org.

```

前面的命令让我们确定了与`192.168.0.1`相关联的域名。

#### 多个命令

我们可以使用 dig 链式命令。在下面的例子中，我们使用我们缩短的输出格式来为我们提供`example.com`和`example.net`的`A`记录，然后请求对`192.0.43.10`进行反向查找。

```
# dig +nocmd +noall +answer example.com example.net -x 192.168.1.10 

```

结果输出如下（在此输出中，域名已被替换为`example.org`）：

```
example.com. 37183 IN A 192.168.1.10
example.net. 54372 IN A 192.168.10.11
10.0.0.1.in-addr.arpa. 6937 IN PTR 43-10.any.example.org.

```

#### 跟踪路径

如果您想查看 dig 解析域名所采取的路由，可以使用以下命令`+trace`选项：

```
# dig +trace example.com 

```

#### 使用 dig 进行批处理

不必像使用`nslookup`时那样编写循环脚本来评估文件中的域名列表，dig 可以使用`-f`选项。我们可以使用 dig 命令格式来执行这些批处理作业。

1.  我们将首先使用 BackTrack 中包含的 nano 文本编辑器创建一个新的 TXT 文件。在 BackTrack 中打开终端 shell，然后键入`nano digginIt.txt`。

1.  在 nano 中键入以下代码。请注意，每个命令都需要单独一行才能正常运行：

```
+nocmd +noall +answer example.com
+nocmd +noall +answer example.net
+nocmd +noall +answer example.org ns

```

1.  按下*Ctrl + O*保存文件。

1.  按下*Ctrl + X*退出返回到终端。

1.  使用 dig 命令调用：

```
# dig -f digginIt.txt 

```

结果将显示在屏幕上：

```
example.com. 33996 IN A 192.168.1.10
example.net. 51185 IN A 192.168.1.10
example.org. 82826 IN NS a.example.net.
example.org. 82826 IN NS b.example.net.

```

我们已成功创建并执行了一个 dig 批处理作业。这可以用于许多用途，包括创建和检查基线，从一个渗透测试到下一个执行重复任务，或者简单地跟踪用于执行您的侦察的命令。存储用于批处理作业的文本文件，以便以后验证结果。

## 使用 fierce 进行 DNS 暴力破解

在安全环境中，DNS 暴力破解很可能是确定非连续 IP 空间中使用哪些主机的最佳选择。BackTrack 包含几个工具来满足这种需求。我们将讨论由 RSnake 创建的 fierce，它在 DNS 暴力破解方面快速高效。它将从确定域的 IP 地址开始，查找相关的名称服务器，然后逐个查找您的字典单词列表。该工具提供了一个示例单词列表，可用于测试，但您应尽快用更符合您需求的字典单词替换或补充它。

### 默认命令用法

在 BackTrack 中，我们将打开一个终端会话，并切换到`fierce.pl` perl 脚本所在的目录：

```
# cd /pentest/enumeration/dns/fierce 

```

`fierce.pl`包含一个可以使用的帮助部分：

```
# ./fierce.pl -h 

```

使用 fierce 的最基本方法是使用：

```
# ./fierce.pl -dns example.com 

```

这将导致类似以下的输出：

```
DNS Servers for example.com:
ns1.example.net
ns2.example.net
Trying zone transfer first...
Testing ns1.example.net
Request timed out or transfer not allowed.
Testing ns2.example.net
Request timed out or transfer not allowed.
Unsuccessful in zone transfer (it was worth a shot)
Okay, trying the good old fashioned way... brute force
Checking for wildcard DNS...
Nope. Good.
Now performing 1895 test(s)...

```

此输出表明首先要做的是查找`example.com`域的名称服务器。下一步是检查服务器，看看是否可以执行区域传输。正如我们之前学到的，区域传输将通过一个命令从服务器提取所有已知的域信息。如果可以一次性提取整个记录集，就不需要暴力破解域名。

一些域包括通配符 DNS 记录。这将导致任何您使用的子域都会被解析，无论它是否存在。在这种情况下，没有找到通配符 DNS 条目。

运行的测试次数将取决于您提供的单词列表中有多少单词。由于在前面的示例中没有指定要使用哪个列表，默认情况下将使用 Backtrack 上`/fierce`目录中的`hosts.txt`。

在这里，`fierce.pl`用于允许区域传输的域：

```
# ./fierce.pl -dns example.com 

```

在这种情况下，工具的暴力破解功能是不必要的，因此未初始化。有关详细信息，请参阅以下结果：

```
DNS Servers for example.com:
ns14.zoneedit.com
ns16.zoneedit.com
Trying zone transfer first...
Testing ns14.zoneedit.com
Whoah, it worked - misconfigured DNS server found:
example.com. 7200 IN SOA ns16.zoneedit.com. soacontact.zoneedit.com. (
2011413884 ; Serial
2400 ; Refresh
360 ; Retry
1209600 ; Expire
300 ) ; Minimum TTL
example.com. 7200 IN NS ns14.zoneedit.com.
example.com. 7200 IN NS ns16.zoneedit.com.
example.com. 300 IN A 192.168.1.1
mail.example.com. 7800 IN MX 10 mail1.example.com.
testmachine.example.com. 300 IN A 192.168.1.1
irc.example.com. 300 IN A 192.168.1.1
mail1.example.com. 300 IN A 192.168.1.1
note.example.com. 300 IN TXT "This is an example of a DNS text record."
www.example.com. 300 IN A 192.168.1.1
There isn't much point continuing, you have everything.
Have a nice day.
Exiting...

```

查看结果，我们可以看到`fierce.pl`指示此设置是一个错误配置，这应该是另一个指示，即不建议在任何情况下允许开放的 AXFR。

### 创建自定义单词列表

如果我们已经知道要检查什么，或者我们有一个更适合的单词列表，因为我们了解正在测试的站点的命名约定，那么建议制作自定义单词列表。

1.  使用`nano myWordList.txt`打开 Nano。

1.  键入以下内容：

```
irc
mail
mail1
testmachine1
testmachine
www
www1
ns

```

1.  按下*Ctrl + O*，然后按*Enter*，将文件写入`myWordList.txt`。

1.  按下*Ctrl + X*退出返回到终端 shell。

现在我们已经创建了名为`myWordList.txt`的自定义单词列表，让我们试试：

```
# ./fierce.pl dns example.com wordlist myWordList.txt 

```

短暂延迟后，我们将看到以下输出：

```
DNS Servers for example.com:
ns14.zoneedit.com
ns16.zoneedit.com
Trying zone transfer first...
Testing ns14.zoneedit.com
Request timed out or transfer not allowed.
Testing ns16.zoneedit.com
Request timed out or transfer not allowed.
Unsuccessful in zone transfer (it was worth a shot)
Okay, trying the good old fashioned way... brute force
Checking for wildcard DNS...
Nope. Good.
Now performing 9 test(s)...
192.168.1.1 irc.example.com
192.168.1.1 mail1.example.com
192.168.1.1 testmachine.example.com
192.168.1.1 www.example.com
192.168.1.1 .example.com
Subnets found (may want to probe here using nmap or unicornscan):
192.168.1.1-255 : 5 hostnames found.
Done with Fierce scan: http://ha.ckers.org/fierce/
Found 5 entries.
Have a nice day.

```

尽管该服务器不再允许我们使用区域传输，但我们仍然能够通过良好的单词列表映射出几个子域。

当无法执行区域传输时，仍然可以使用其他方法有效地枚举网络上的子域和主机名。内部 DNS 名称服务器将能够为您提供大量信息，以后可以用来评估网络的漏洞，并最终用来利用环境。`fierce.pl`是我们渗透测试工具库中非常有用的补充，可以用来完成比简单的 DNS 暴力破解更多的工作。

# 收集和验证域和 IP 信息

当个人或公司实体注册域名时，会收集大量信息。根据注册隐私设置，您可以收集这些信息并用于验证您的 IP 空间，查找同一人或公司拥有的其他网站的信息，甚至关键员工的电话号码和地址。这种侦察被认为是被动的，因为它不直接联系客户拥有的资产来获取信息。

我们需要找到已注册域名的注册商以获取有用的信息。以下是一些顶级注册商的列表。

| AFRINIC | [`www.afrinic.net`](http://www.afrinic.net) |
| --- | --- |
| APNIC | [`www.apnic.net`](http://www.apnic.net) |
| ARIN | [`ws.arin.net`](http://ws.arin.net) |
| IANA | [`www.iana.com`](http://www.iana.com) |
| ICANN | [`www.icann.org`](http://www.icann.org) |
| LACNIC | [`www.lacnic.net`](http://www.lacnic.net) |
| NRO | [`www.nro.net`](http://www.nro.net) |
| RIPE | [`www.ripe.net`](http://www.ripe.net) |
| InterNic | [`www.internic.net`](http://www.internic.net) |

## 使用 whois 收集信息

可以使用**whois**找到域名和 IP 空间注册信息。

### 注意

在使用**whois**时，请注意您需要遵守的具体限制和规则。例如，您不允许自动化查询或将结果用于商业或个人利益。运行简单的`whois example.com`查询时，请阅读出现的法律文本标题。请注意警告并遵守规则。

whois 的最基本用法如下：

```
# whois example.com 

```

这将快速查找`example.com`域并为您提供以下信息：

+   Whois 使用协议和法律标题

+   域名

+   注册域名的注册商

+   使用的 whois 服务器

+   与域相关的主要 DNS 名称服务器

+   域名创建和到期日期

+   注册人信息，如名字、姓氏、组织、实际地址、电话号码和电子邮件地址

+   分配的域管理员信息，如名字、姓氏、组织、实际地址、电话号码和电子邮件地址

+   域账单联系信息，如名字、姓氏、组织、实际地址、电话号码和电子邮件地址

+   域技术联系人信息，如名字、姓氏、组织、实际地址、电话号码和电子邮件地址

### 指定要使用的注册商

有时您需要指定要查询的注册商。**whois**通过允许使用`-h`“连接到主机”选项来简化此过程。

```
# whois -h whois.apnic.net 192.0.43.10 

```

### 这个 IP 在世界的哪个地方？

您可以使用**whois**查找 IP 地址分配给的原始国家：

```
# whois -h whois.arin.net 192.0.43.10 | grep Country: 

```

我们在这里所做的是使用`-h`选项来指定`whois.arin.net`，以提取与`192.0.43.10`相关联的记录，因为我们特别想要与此 IP 相关的国家信息。我们使用`grep`命令来提取`Country:`行。以下是结果输出，表明该 IP 地址位于美利坚合众国：

```
Country: US

```

### 提示

您会发现输出格式会因注册商而异。花些时间熟悉不同的输出，这样您就会知道将来要在输出中搜索什么。这可能会在长远节省您大量时间。

### 防御措施

当您或您的客户注册域名时，应选择隐私选项。这些选项将限制向公众提供的信息。数据将被隐私代理提供的信息替换。如果有需要与您联系的情况，他们将联系您的代理，代理将再通知您需要解决的问题。

# 利用搜索引擎为您工作

如果不有效地使用，搜索引擎可能会产生绝对的信息过载。您不仅可以找到有关目标财务状况的信息，还可以找到有关关键员工、用户名和密码、机密文件（如网络图表）、有关您使用或已安装的软件或硬件类型的信息，甚至系统是否处于默认状态的信息。这些信息如果落入错误的手中可能会造成毁灭性的后果。作为渗透测试人员，您的重点应该是提取这类信息，并向客户展示如何利用这些信息来获取对客户最关键资产的访问权限（希望您也会告诉他们如何解决问题！）。

### 提示

有些搜索引擎会缓存信息以便快速访问，还有一些搜索引擎会存档网站和文件多年。甚至有一些搜索引擎专门关注网络设备，如无线接入点或公共路由器、交换机、服务器等。

## SHODAN

我们将继续使用**Shodan**进行足迹侦察工作。这个搜索引擎专门用于索引连接到互联网的设备提供的横幅信息。该搜索引擎主要索引端口 80 的发现，但也索引一些 Telnet、SSH 和 FTP 横幅。SHODAN 是一个网络应用程序，可以通过访问[`www.shodanhq.com`](http://www.shodanhq.com)来访问。

![SHODAN](img/7744_02_02.jpg)

使用**Shodan**，您可以找到连接到互联网的设备的信息。除了允许您按 IP 地址或主机名搜索外，它还允许您按地理位置搜索。将搜索结果导出为 XML 是一个高级功能，需要您购买积分。如果您想在决定是否花钱购买导出之前构建 MagicTree 或其他数据集中工具的转换，可以查看一个示例导出。

### 过滤器

有几个免费的过滤器可以使搜索范围缩小得更简单。大多数过滤器使用相同的格式：*searchterm filter:{filterterm}*；例如，搜索`IIS 6.0 os:"Windows 2000`"。这些过滤器也可以结合使用，以便提取一些非常有趣的结果。

以下是几个重要的过滤器列表：

+   **net:** 对于渗透测试人员来说可能是最有用的过滤器之一。您可以使用 IP/CIDR 表示法（例如，127.1.1.0/24）搜索您的 IP 范围，以查看所有设备是否按预期配置，或者是否存在迹象表明一个易受攻击的服务器或网络设备配置面向外部并准备在测试期间被攻破。

+   **city:** 这将限制搜索到所列城市。

+   **country:** 将搜索限制为所选国家的设备。这对于渗透测试非常重要，因为有时客户可能会提供您 IP 范围（您已经验证了，对吧？），然后由于位置的原因将某些资产排除在范围之外。例如，客户可能选择不针对位于新加坡的系统进行测试。

+   **port:** 将搜索限制为指定的端口。请记住，SHODAN 并不扫描和索引所有端口的横幅，只扫描和索引 80、21、22 和 23 端口的横幅。

+   **before:** 搜索指定日期之前扫描的系统。

+   **after:** 搜索在此日期之后扫描的系统。

+   **os:** 您想在搜索中包含或排除哪些操作系统？

### 理解横幅

为了在 Shodan 中进行有效的搜索，您必须了解已索引的横幅类型以及它们通常包含的信息。

FTP、Telnet 和 SSH 横幅将有所不同，但每种都将提供有用的版本信息。

#### HTTP 横幅

横幅可以通过使用`nc example.com:80`进行收集，然后输入`HEAD / HTTP/1.0`，这将导致您在 SHODAN 结果中看到的典型横幅格式。由于 HTTP 横幅通常是最难理解的，我们将介绍一些常见的部分：

```
root@bt:~# nc example.com 80
Trying 192.168.1.1...
Connected to example.com.
Escape character is '^]'.
HEAD / HTTP/1.0
HTTP/1.1 200 OK 
Content-Length: 9908
Content-Type: text/html
Last-Modified: Tue, 11 Oct 2011 02:35:17 GMT
Accept-Ranges: bytes
ETag: "6e879e69be87cc1:0"
Server: Microsoft-IIS/7.5
X-Powered-By: ASP.NET
Date: Sun, 16 Oct 2011 02:08:55 GMT
Connection: close
Connection closed by foreign host.

```

+   `HTTP/1.1 200`状态代码的突出显示将为您的查询提供响应，指示请求的状态。在这种情况下，`HEAD/ HTTP/1.0`被接受并成功处理，从而启动了`200 OK`的状态代码。

+   `Content-Length:` 表示内容的长度，以十进制的 OCTET 数表示。

+   `Content-Type:` 将列出正在发送的内容类型。可能是 image/GIF、text/HTML 或其他类型。

+   `Accept-Ranges:` 指示服务器是否接受字节范围。将其设置为 none 将让客户端知道范围请求可能被拒绝。

+   `ETag:` 为客户端提供当前实体标记值。

+   `Server:` 将为您提供用于服务请求的软件版本和类型。这是渗透测试人员最重要的横幅结果之一。客户端应该被建议隐藏这些信息。您将使用这些信息来确定可能对该机器可用的攻击类型。

+   `X-Powered-By:` 标志不是标准标头，但可以为攻击者提供有用的信息。它也可以被更改或完全禁用。

常见的状态代码包括：

| **HTTP 状态代码** | **描述** |
| --- | --- |
| 200 | 成功的查询结果显示。 |
| 301 | 文档已永久移动。 |
| 302 | 文档已暂时移动。 |
| 307 | 正在使用临时重定向。 |
| 400 | 语法错误-无法处理您的请求。 |
| 401 | 请求需要身份验证。通常表示需要登录。 |
| 403 | 请求被禁止。 |
| 404 | 服务器上找不到页面。 |
| 502 | 服务器当前不可用。无法代表客户端获取资源。 |
| 501 | 内部服务器错误导致服务器无法完成请求。-请求不受支持。 |
| 505 | 使用了不受支持的 HTTP 版本。 |

### 查找特定资产

就像大多数搜索引擎一样，该工具非常用户友好。要执行基本搜索，只需将搜索字符串输入到屏幕顶部的输入框中，然后您将看到结果列表。您可以使用我们之前讨论过的任何过滤器进行搜索，或者您可以尝试查找特定的横幅字段。

## 在网络上查找人（及其文档）

在当今这个时代，一切都在变得互相连接。人们正在使用他们的个人设备进行工作，使用个人帐户在公共拥有的邮件服务器上发送公司电子邮件，并观看大量视频。多年来出现的一个趋势是，人们对互联网变得如此舒适，以至于愿意与世界各地的未知个人和网站分享他们的信息。我们现在将讨论一些方法，您可以使用这些方法来验证您的客户是否没有无意或有意地将可操作或机密数据泄露到公共互联网上。

### Google 黑客数据库

已经有很多关于 Google 黑客的书籍，谈论细节和技巧会很快转移本书的重点。

### 提示

如果您对 Google 黑客不熟悉，请搜索 Johnny Long 并访问他的网站[`www.hackersforcharity.com`](http://www.hackersforcharity.com)，并查看原始的 Google Dorks 存储库，即 Google Hacking Database (GHDB)。

Exploit-DB 在`exploit-db.com`接管并更新了 Mr. Long 的 Google Dorks 数据库。这现在是官方的 GHDB 网站。您应该与良好的过滤器一起使用这些工具，以确保您只获取所需的数据。以下是一些示例，说明如何做到这一点。

转到[`exploit-db.com/google-dorks`](http://exploit-db.com/google-dorks)并选择一个查询。这是一个随机条目：

```
inurl:ftp "password" filetype:xls

```

将其输入`Google.com`并进行以下修改。添加`site:`选项，后面跟着您规则中的域名：

```
site:example.com inurl:ftp "password" filetype:xls

```

在这个例子中，如果找到任何结果，您已经找到了一个包含某种形式“密码”的 MS Excel 文件。请注意，结果会有所不同，而且最好的 Google 搜索查询通常集中在确定已安装软件的版本，寻找已知的易受攻击的安装，如果规则允许的话，以后将被攻击。

您还应该执行定向搜索，以查找所有主要文档类型，如`.pdf，.doc，.txt，.xls`等。但是，还有一些其他工具可以帮助我们。

### 提示

警告：不要在您的主要测试机器上打开随机文件。您应该有一台与您的网络或互联网没有连接的单独的机器，可以用来打开未知（可能有害）的文件和媒体。通过向使用漏洞打开系统的用户发送文件来访问计算机的最简单方法之一。在不受控制的环境中打开未知文件是鲁莽的。不要成为那个用户。

#### Google 过滤器

要了解在浏览 Exploit-DB 的**Google Hacking Database (GHDB)**时将看到的查询类型，您必须了解使用的操作符类型。以下是更常见的高级操作符列表：

| **过滤器** | **描述** | **示例** |
| --- | --- | --- |
| `allinurl` | 在 URL 中搜索所有术语 | `allinurl:example company` |
| `allintext` | 在页面文本中搜索所有术语 | `allintext:company name` |
| `intitle` | 在页面标题中搜索术语 | `intitle:ftp` |
| `cache` | 显示缓存页面 | `cache:example.com` |
| `phonebook` | 搜索电话簿列表 | `phonebook:CompanyName` |
| `author` | 搜索 Google Groups 中特定作者的项目（使用 Google Groups 搜索） | `author:anonymous` |
| `filetype` | 搜索特定类型的所有文档 | `filetype:pdf` |
| `site` | 限制搜索到特定站点（或域） | `site:example.com` |
| `link` | 查找所有指向指定 URL 的页面 | `link:example.com` |

### Metagoofil

Metagoofil 是由 Christian Martorella 创建的强大的元数据收集工具（[`www.edge-security.com`](http://www.edge-security.com)），可以用于自动化搜索引擎文档检索和分析。它还具有提供 MAC 地址、用户名列表等功能。

BackTrack 默认安装了 Metagoofil Blackhat Arsenal Edition。打开终端，输入以下内容：

```
# cd /pentest/enumeration/google/metagoofil 

```

Metagoofil 是一个 Python 脚本，可以通过输入以下内容来启动：

```
# ./metagoofil.py 

```

这导致以下输出：

```
*************************************
* Metagoofil Ver 2.1 - *
* Christian Martorella *
* Edge-Security.com *
* cmartorella_at_edge-security.com *
* Blackhat Arsenal Edition *
*************************************
Metagoofil 2.1:
Usage: metagoofil options
-d: domain to search
-t: filetype to download (pdf,doc,xls,ppt,odp,ods,docx,xlsx,pptx)
-l: limit of results to search (default 200)
-h: work with documents in directory (use "yes" for local analysis)
-n: limit of files to download
-o: working directory
-f: output file
Examples:
metagoofil.py -d microsoft.com -t doc,pdf -l 200 -n 50 -o microsoftfiles -f results.html
metagoofil.py -h yes -o microsoftfiles -f results.html (local dir analysis)

```

让我们在`example.com`域上尝试`metagoofil.py`：

```
# python metagoofil.py -d example.com -t doc,pdf -l 200 -n 50 -o examplefiles -f results.html 

```

作为渗透测试人员，当运行此工具时，您会想要找到一些文件，这些文件会为您提供有关客户的各种信息。我们目前在`example.com`域上没有这样的文件，因此输出如下：

```
*************************************
* Metagoofil Ver 2.1 - *
* Christian Martorella *
* Edge-Security.com *
* cmartorella_at_edge-security.com *
* Blackhat Arsenal Edition *
*************************************
['doc']
[-] Starting online search...
[-] Searching for doc files, with a limit of 200
Searching 100 results...
Searching 200 results...
Results: 0 files found
Starting to download 50 of them:
----------------------------------------
tuple index out of range
Error creating the file
[+] List of users found:
--------------------------
[+] List of software found:
-----------------------------
[+] List of paths and servers found:
---------------------------------------
[+] List of e-mails found:

```

如前面的输出所示，如果这个网站有任何可以通过谷歌搜索的信息，它将提供一个漂亮的 HTML 报告，其中包括用户名、电子邮件地址、软件、服务器和路径。所有这些都可以通过一个简单的命令序列完成。您可以更改变量以查找谷歌可以找到的任何文档类型，基于`filetype:`选项。

## 搜索互联网以寻找线索。

到目前为止，您应该有一些用户名，甚至可能还有一些电话号码和职位。如果您计划进行社会工程测试，这些信息将会很有用。

### 提示

搜索引擎如谷歌可以用来搜索企业员工在互联网上发布的信息，就像你搜索馅饼食谱一样容易。在开始之前，请确保你的客户希望你在开始之前进行员工调查，而不是之后。有许多法律保护员工的隐私，只有律师才能告诉你什么是可以接受的，什么是不可以接受的。

渗透测试中似乎有一种突出的做法，就是搜索员工在论坛和群组上发布的信息，这些信息可能涉及工作资产。大多数信息不会以恶意方式与世界分享，而是无意中。但这并不改变攻击者可以访问这些信息并可能针对目标公司使用它的事实。寻找诸如公司管理员寻求帮助配置特定防火墙类型或其他网络设备等内容。在公共论坛上发布问题的安全专业人员可能无意中提供了关于他们公司遵守哪些标准的线索。这些是给予你作为渗透测试人员以及高级攻击者所需的知识，以便渗透一个本来安全的环境。

以下是一些可以帮助您找到更多信息的工具：

| **名称** | **描述** | **位置** |
| --- | --- | --- |
| SecApps Google Hacking Database Explorer | Web 应用程序，允许您输入站点和查询修饰符以自动化您的 GHDB 查询。 | [`www.secapps.com/a/ghdb`](http://www.secapps.com/a/ghdb) |
| Site Digger 3.0 | 搜索谷歌缓存。找到各种信息。需要.NET Framework 3.5 才能运行。 | [`www.mcafee.com/us/downloads/free-tools/sitedigger.aspx`](http://www.mcafee.com/us/downloads/free-tools/sitedigger.aspx) |
| The Harvester | 从搜索引擎和 PGP 服务器中搜索子域、主机名、用户、员工电子邮件和姓名。 | 包含在 BackTrack 中或[`code.google.com/p/theharvester`](http://https://code.google.com/p/theharvester) |
| Lullar.com | 通过姓名、电子邮件或用户名搜索人员。 | [`com.lullar.com/`](http://com.lullar.com/) |
| White Pages | 查找商业信息的好地方。 | [`www.whitepages.com/`](http://www.whitepages.com/) |
| PeekYou | 通过用户名、姓氏或名字搜索人员。 | [`www.peekyou.com/`](http://www.peekyou.com/) |
| TinEye | 在网络上查找您的图片。 | [`www.tineye.com/`](http://www.tineye.com/) |
| Internet Archive | 个人最喜欢，存档网站和文件多年。 | [`www.archive.org/web/web.php`](http://www.archive.org/web/web.php) |

## 元数据收集

在本章中，当讨论`Metagoofil`时，我们已经提到了元数据。元数据对于渗透测试人员来说可以提供非常有用的信息。许多用户甚至不知道这些信息被附加到他们的文件中。一个很好的例子就是与不同图像格式相关的**Exif**数据。您可以了解使用了什么类型的相机，照片拍摄的时间，拍摄地点（如果当时有 GPS 数据可用的话，比如手机相机...）等等。图片并不是唯一具有这种大量数据的文件。PDF 文档等也是如此。**Foca**是一个具有直观用户界面的优秀程序，强烈建议使用，但它是一个 Windows 程序，在 BackTrack 上安装起来很困难（尽管绝非不可能！）。因此，我们将回顾其他预装在我们选择的渗透测试工具包 BackTrack 上的选项。

### 注意

如果您的客户使用 Windows 7 或 Windows Server 2008，请让他们知道有一个选项可以通过几次鼠标点击从某些文件类型中删除所有个人元数据。

### 使用 exiftool 从照片中提取元数据

**exiftool**已经预装在 BackTrack 5 上，可用于列出与许多文件类型相关的所有 Exif 数据。这个工具非常强大，可以让您将结果导出到许多不同的格式，写入文件元数据等。

我们将使用位于`/pentest/misc/exiftool/t/images`的`FotoStation.jpg`图片作为我们的第一个使用示例。

要启动**exiftool**，您可以打开一个终端会话并输入：

```
# cd /pentest/misc/exiftool 

```

如果运行默认的`exiftool`，将会显示工具帮助选项。内容非常丰富，所以准备好大量阅读。在这里，我们对`FotoStation.jpg`进行了简单的检查：

```
# ./exiftool t/images/FotoStation.jpg 

```

这将产生以下输出：

```
ExifTool Version Number : 8.56
File Name : FotoStation.jpg
Directory : t/images
File Size : 4.2 kB
File Modification Date/Time : 2011:04:30 05:32:11-04:00
File Permissions : rw-r--r--
File Type : JPEG
MIME Type : image/jpeg
Image Width : 8
Image Height : 8
Encoding Process : Baseline DCT, Huffman coding
Bits Per Sample : 8
Color Components : 3
Y Cb Cr Sub Sampling : YCbCr4:2:0 (2 2)
Original Image Width : 1536
Original Image Height : 1024
Color Planes : 3
XY Resolution : 38.626
Rotation : 90
Crop Left : 18.422%
Crop Top : 24.458%
Crop Right : 83.035%
Crop Bottom : 77.817%
Crop Rotation : 0
Application Record Version : 2
Edit Status : Edit Status
Urgency : 1 (most urgent)
Category : Cat
Caption-Abstract : Caption *** Local Caption *** Local Caption
Special Instructions : Special Instructions
Object Cycle : Unknown (Afternoon)
Original Transmission Reference : OTR
Object Preview File Format : Unknown (Custom Field 01)
Object Preview File Version : Custom Field 02
Object Preview Data : (Binary data 15 bytes, use -b option to extract)
Document Notes : Document Notes
Image Size : 8x8

```

我们可以看到这提供了大量的数据，但没有什么可以真正用于您的渗透测试。现在让我们尝试不同的文件格式：

```
# exiftool t/images/FlashPix.ppt 

```

这为我们提供了以下内容：

```
ExifTool Version Number : 7.89
File Name : FlashPix.ppt
Directory : ./t/images
File Size : 9.5 kB
File Modification Date/Time : 2011:04:30 05:32:11-04:00
File Type : PPT
MIME Type : application/vnd.ms-powerpoint
Title : title
Subject : subject
Author : author
Keywords : keywords
Comments : comments
Last Saved By : user name
Revision Number : 1
Software : Microsoft PowerPoint
Total Edit Time : 4.4 minutes
Create Date : 2007:02:09 16:23:23
Modify Date : 2007:02:09 16:27:49
Word Count : 4
Category : category
Presentation Target : On-screen Show
Manager : manager
Company : company
Bytes : 4610
Paragraphs : 4
Slides : 1
Notes : 0
Hidden Slides : 0
MM Clips : 0
App Version : 10 (0972)
Scale Crop : 0
Links Up To Date : 0
Shared Doc : 0
Hyperlinks Changed : 0
Title Of Parts : Times, Blank Presentation, Title
Heading Pairs : Fonts Used, 1, Design Template, 1, Slide Titles, 1
Code Page : 10000
Hyperlink Base : hyperlink base
Hyperlinks : http://owl.phy.queensu.ca/, http://www.microsoft.com/mac/#TEST, mailto:phil?subject=subject
Custom Text : customtext
Custom Number : 42
Custom Date : 2007:01:09 05:00:00
Custom Boolean : 1
Current User : user name

```

这就是您在测试时要寻找的元数据。在这个特定的例子中，出于学习目的，信息已经被清除，但一些感兴趣的字段应该包括：

+   标题

+   主题

+   作者

+   评论

+   软件

+   公司

+   经理

+   超链接

+   当前用户

当所有这些数据结合在您的数据收集和集中工具中时，就会形成一个完整的图片。您可以使用**exiftool**从 Flash、PPT 等文件中提取或写入元数据。您可以从[`www.sno.phy.queensu.ca/~phil/exiftool/#supported`](http://www.sno.phy.queensu.ca/~phil/exiftool/#supported)获取支持的文件类型的完整列表。

# 总结

在本章中，我们已经回顾了许多收集免费可用信息的专门方法。使用这些信息，我们能够对我们正在针对的网络创建一个更大的图片。

完成初始侦察后，我们应该能够确定客户提供给我们的网络空间是否准确。我们还应该能够成功确定哪些文档可以在互联网上搜索，并且能够阅读与这些文档相关的元数据。在渗透测试的这一阶段，我们应该能够对这项工作的难易程度有所了解。其中一个指标将是您从 Shodan 等搜索引擎中收集到的结果。最后，请务必勤奋地收集您找到的数据。文档记录至关重要，并将使您作为渗透测试人员的生活在长远来看更加轻松。

在下一章中，我们将开始利用我们收集到的信息。您将有机会直接枚举网络。我们还将开始建立一个功能性实验室，让您可以跟随整个过程的每一步。第三章涵盖的一些主题包括了如何何时使用 NMAP，利用 SNMP 的优势，各种避免技术等等！
