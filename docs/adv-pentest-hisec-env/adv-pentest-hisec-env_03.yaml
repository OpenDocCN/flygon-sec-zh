- en: 'Chapter 3. Enumeration: Choosing Your Targets Wisely'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章。枚举：明智地选择你的目标
- en: 'To successfully penetrate a secured environment you must have a good understanding
    of what you are facing. The enumeration data gathered will assist in determining
    target prioritization. By the end of this chapter, you should be able to choose
    which targets are ideal candidates for your initial attacks. Certain attack types
    make more "noise" than others, thus a targeted attack will be less likely to be
    noticed. Thanks to the hard work of the open source community we have a large
    selection of tools available to help us enumerate networks. In this chapter, we
    will discuss the following:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 要成功渗透一个安全的环境，你必须对你所面对的情况有很好的理解。收集到的枚举数据将有助于确定目标优先级。在本章结束时，你应该能够选择哪些目标是你初始攻击的理想候选人。某些攻击类型比其他攻击类型更“嘈杂”，因此有针对性的攻击更不容易被注意到。由于开源社区的辛勤工作，我们有大量的工具可用来帮助我们枚举网络。在本章中，我们将讨论以下内容：
- en: How to add an additional computer to our virtual lab
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何将另一台计算机添加到我们的虚拟实验室
- en: Advanced Nmap scanning techniques
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高级Nmap扫描技术
- en: Adding custom Nmap scripts to your arsenal
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向你的武器库添加自定义Nmap脚本
- en: Saving time with SNMP
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SNMP节省时间
- en: Base lining your target networks with PBNJ
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用PBNJ为你的目标网络建立基线
- en: Avoiding enumeration attempts — confusing the enemy
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免枚举尝试-混淆敌人
- en: Note
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Some examples in this chapter take advantage of firewalls and IDS logs to allow
    the reader to understand the impact certain scans and techniques have on the network.
    We will review the installation and configuration of both in later chapters.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的一些示例利用防火墙和IDS日志，让读者了解某些扫描和技术对网络的影响。我们将在后面的章节中审查它们的安装和配置。
- en: Adding another virtual machine to our lab
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向我们的实验室添加另一台虚拟机
- en: We have reached a point in the book where having an additional system in our
    lab is beneficial. In this section, we will install another machine on our network
    so that we can try out the enumeration techniques described.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经到达了书中另一台系统对我们的实验室有益的地方。在本节中，我们将在我们的网络上安装另一台机器，这样我们就可以尝试描述的枚举技术。
- en: Note
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Although beneficial, installing another virtual system at this point is not
    absolutely necessary. All examples are clearly documented in the book.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然有益，但在这一点上安装另一个虚拟系统并不是绝对必要的。所有的例子都在书中有清晰的记录。
- en: We will be using Ubuntu **10.04 LTS 64-bit** for our examples in this text.
    You can download Ubuntu 10.04 LTS from [http://www.ubuntu.com/download/ubuntu/download](http://www.ubuntu.com/download/ubuntu/download).
    Once you have grabbed a copy of the ISO we can start the installation.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们将使用Ubuntu **10.04 LTS 64位**作为示例。你可以从[http://www.ubuntu.com/download/ubuntu/download](http://www.ubuntu.com/download/ubuntu/download)下载Ubuntu
    10.04 LTS。一旦你获得了ISO的副本，我们就可以开始安装。
- en: 'Prepare a new virtual machine in VirtualBox as follows:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在VirtualBox中准备一个新的虚拟机，步骤如下：
- en: '**Name:***Ubuntu_TestMachine_1*'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名字：***Ubuntu_TestMachine_1*'
- en: '**Operating system:** *Linux*, **Version:***Ubuntu OR Ubuntu 64 (64 bit)*'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作系统：***Linux*，**版本：***Ubuntu或Ubuntu 64（64位）*'
- en: '**Memory:***512 minimum*'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内存：***最低512*'
- en: '**Create new hard disk:***VDI, Dynamically allocated, 10 GB minimum*![Adding
    another virtual machine to our lab](img/7744_03_01.jpg)'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**创建新的硬盘：***VDI，动态分配，最小10GB*![向我们的实验室添加另一台虚拟机](img/7744_03_01.jpg)'
- en: Start the **Ubuntu_TestMachine_1** virtual machine and use the **First Run Wizard**
    to select the Ubuntu ISO you have downloaded as the installation media. Follow
    the standard Ubuntu installation process using the complete Virtual Machine (VBOX
    ATA) drive.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 启动**Ubuntu_TestMachine_1**虚拟机，并使用**First Run Wizard**选择你已经下载的Ubuntu ISO作为安装媒体。按照标准的Ubuntu安装过程使用完整的虚拟机（VBOX
    ATA）驱动器。
- en: 'Choose the following settings during the install:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中选择以下设置：
- en: 'What is your name: Student'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你的名字是什么：学生
- en: 'What name do you want to use to log in: Student'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你想用什么名字登录：学生
- en: 'Choose a password: 1easyPassword'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个密码：1easyPassword
- en: 'What is the name of this computer?: Phobos'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这台计算机的名字是什么？：Phobos
- en: 'Require my password to login: Selected'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 需要我的密码登录：已选择
- en: 'Once you have successfully installed Ubuntu it will need to be updated. Open
    up a terminal window by going to the top-left menu and choosing **Applications
    | Accessories | Terminal** and typing:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你成功安装了Ubuntu，它就需要更新。打开一个终端窗口，方法是转到左上角菜单，选择**应用程序|附件|终端**，然后输入：
- en: '[PRE0]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'followed by:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 接着：
- en: '[PRE1]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: As we will be using this system as an example of what might be seen on a typical
    network we will need to install some interesting services.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们将使用这个系统作为典型网络上可能看到的示例，我们需要安装一些有趣的服务。
- en: 'Open up a terminal session and type the following command which will install
    Apache, MySQL, and PHP:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个终端会话，输入以下命令，它将安装Apache、MySQL和PHP：
- en: '[PRE2]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The installation will proceed and after some files have been downloaded, you
    will be required to enter your choice of **MySQL** password for the root user.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装将继续，在下载了一些文件之后，你将需要输入你选择的**MySQL**根用户的密码。
- en: Confirm your password and press *Enter*.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认你的密码并按*Enter*。
- en: 'The system has been updated and we have some interesting ports available for
    our scans. We can now shut down the new guest machine and use the **VM VirtualBox
    Manager Settings** icon to change the network settings to **Internal Network**
    with Name set to: **Vlab_1**. Setting the **Network adapter** to **Internal Network**
    allows our BackTrack system to share the same subnet with the newly-created Ubuntu
    machine.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 系统已经更新，我们有一些有趣的端口可以用于扫描。现在我们可以关闭新的客户机，并使用**VM VirtualBox Manager Settings**图标将网络设置更改为**内部网络**，名称设置为：**Vlab_1**。将**网络适配器**设置为**内部网络**允许我们的BackTrack系统与新创建的Ubuntu机器共享相同的子网。
- en: '![Adding another virtual machine to our lab](img/7744_03_02.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![向我们的实验室添加另一台虚拟机](img/7744_03_02.jpg)'
- en: Configuring and testing our Vlab_1 clients
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置和测试我们的Vlab_1客户端
- en: Let's start both of our virtual machines, then configure and test the network
    connectivity.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们启动我们的两台虚拟机，然后配置和测试网络连接。
- en: BackTrack Manual ifconfig
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: BackTrack手册ifconfig
- en: 'In **BT5_R1_Tester1** open up a terminal and type the following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在**BT5_R1_Tester1**中打开终端，然后键入以下内容：
- en: '[PRE3]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: We have set `eth1` which is on our virtual `VLab_1` segment to the IP address
    of `192.168.50.10`, the **network mask** to `255.255.255.0`, and the `broadcast`
    address to `192.168.50.255`. As an added bonus we have also set the device into
    **promiscuous** mode.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经将位于我们的虚拟`VLab_1`段上的`eth1`设置为IP地址`192.168.50.10`，**网络掩码**设置为`255.255.255.0`，并将`广播`地址设置为`192.168.50.255`。作为额外的奖励，我们还将设备设置为**淫乱**模式。
- en: Tip
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: In order for promiscuous mode to work, it must be enabled. The option is in
    the **VM Manager** under **Network settings**. By default this setting is disabled
    for all network adapters.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使淫乱模式工作，必须启用它。该选项位于**VM Manager**的**网络设置**下。默认情况下，此设置对所有网络适配器都禁用。
- en: Promiscuous mode allows you to monitor traffic on your network segment.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 淫乱模式允许您监视网络段上的流量。
- en: Ubuntu — Manual ifconfig
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Ubuntu——手动ifconfig
- en: Open up a terminal in the `Ubuntu_TestMachine_1` by using the top menu bar and
    clicking through **Applications | Accessories | Terminal**. Type `sudo ifconfig`
    to check your current configuration. If everything is configured correctly, you
    should not have an IP address assigned to `eth0`. We will rectify that situation
    by repeating the steps used for our BackTrack machine. This time we will use `eth0`
    rather than `eth1`, and we will not place this network adapter in promiscuous
    mode.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用顶部菜单栏并单击**应用程序|附件|终端**在`Ubuntu_TestMachine_1`中打开终端。键入`sudo ifconfig`以检查当前配置。如果一切配置正确，`eth0`应该没有分配IP地址。我们将通过重复用于我们的BackTrack机器的步骤来纠正这种情况。这次我们将使用`eth0`而不是`eth1`，并且我们不会将此网络适配器置于淫乱模式。
- en: '[PRE4]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Verifying connectivity
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 验证连接
- en: 'We will attempt to ping the machines to verify connectivity. On **BT5_R1_Tester1**
    type:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将尝试ping这些机器以验证连接。在**BT5_R1_Tester1**上键入：
- en: '[PRE5]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'On **Ubuntu_TestMachine_1** type:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在**Ubuntu_TestMachine_1**上键入：
- en: '[PRE6]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'If everything is configured correctly, you should see something along the lines
    of the following screenshot:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切配置正确，您应该看到类似以下截图的内容：
- en: '![Verifying connectivity](img/7744_03_03.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![验证连接](img/7744_03_03.jpg)'
- en: Maintaining IP settings after reboot
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 重启后保持IP设置
- en: If you would like to have the network information statically assigned without
    having to manually enter this information each time, you can edit the `/etc/network/interfaces`
    file for the appropriate Ethernet device.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望静态分配网络信息而无需每次手动输入此信息，可以编辑适当的以太网设备的`/etc/network/interfaces`文件。
- en: Tip
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The following step may be completed for both virtual machines. Be sure to use
    the proper IP and adapter information for each machine.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 可以为两台虚拟机完成以下步骤。确保为每台机器使用正确的IP和适配器信息。
- en: 'Here is an example of what you would need to change in that file for the BackTrack
    guest machine:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在BackTrack客户机中更改该文件所需更改的示例：
- en: '[PRE7]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Be sure to restart the network service after modifying this file (/etc/init.d/networking
    `restart)`.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在修改此文件后，请务必重新启动网络服务（/etc/init.d/networking `restart）。
- en: Tip
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Ubuntu users can use `ufw` (Uncomplicated Firewall) to manage the host-based
    iptables firewall. The examples in this chapter that mention the use of a host-based
    firewall are taking advantage of this fact. More information about UFW can be
    found on the Web at [https://help.ubuntu.com/10.04/serverguide/C/firewall.html](http://https://help.ubuntu.com/10.04/serverguide/C/firewall.html).
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu用户可以使用`ufw`（简化防火墙）来管理基于主机的iptables防火墙。本章中提到使用基于主机的防火墙的示例利用了这一事实。有关UFW的更多信息可以在网站[https://help.ubuntu.com/10.04/serverguide/C/firewall.html](http://https://help.ubuntu.com/10.04/serverguide/C/firewall.html)上找到。
- en: 'This firewall is easy to configure and very stable. UFW is disabled by default
    but can be enabled by simply typing: `sudo ufw enable`.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 这个防火墙很容易配置，而且非常稳定。UFW默认情况下是禁用的，但可以通过简单地键入：`sudo ufw enable`来启用。
- en: Nmap — getting to know you
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Nmap——了解你
- en: If you are reading this text, odds are that you have used Nmap before. For those
    who have not, here is a short description of this powerful enumeration tool. Nmap
    (Network Mapper) has been around since 1997, and was originally created by Gordon
    "Fyodor" Lyon. Even if you have never used the program before, you have probably
    seen its output in at least one of the many films it has been in.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在阅读本文，很可能您以前使用过Nmap。对于那些没有使用过的人，这是一个强大的枚举工具的简短描述。Nmap（网络映射器）自1997年以来一直存在，最初由Gordon“Fyodor”Lyon创建。即使您以前从未使用过该程序，您可能至少在许多出现过的电影中看到了它的输出。
- en: Nmap can be used to scan a network, monitor services, assist in system inventory
    tasks, and so on. Depending on which options are selected, Nmap will be able to
    provide operating system type, open ports, and more. As if that is not enough,
    the Nmap Scripting Engine can be used to extend base functionality even further.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap可用于扫描网络、监视服务、协助系统清单任务等。根据选择的选项，Nmap将能够提供操作系统类型、开放端口等信息。如果这还不够，Nmap脚本引擎可以用于进一步扩展基本功能。
- en: According to the [http://nmap.org](http://nmap.org) website there are now 177
    scripts included in Nmap 5\. The purpose of these scripts range from guessing
    **Apple Filing Protocol** passwords to verifying whether connectivity can be established
    to X-servers.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 根据[http://nmap.org](http://nmap.org)网站的说法，Nmap 5现在包含了177个脚本。这些脚本的目的范围从猜测**Apple
    Filing Protocol**密码到验证是否可以建立到X服务器的连接。
- en: 'The Nmap suite also includes:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap套件还包括：
- en: '**ZenMap:** Graphical user interface for Nmap.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ZenMap：**Nmap的图形用户界面。'
- en: '**Ncat:** Based on netcat, but updated with a larger feature set such as ncat
    chaining, SSL support, and more. Binaries are available.'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Ncat：**基于netcat，但更新了更大的功能集，如ncat链接、SSL支持等。二进制文件可用。'
- en: '**Ncrack:** Used to test authentication implementations and password strength.
    Has support for many commonly used protocols.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Ncrack：**用于测试认证实现和密码强度。支持许多常用协议。'
- en: '**Ndiff:** Can be used to baseline a network. Compare nmap scans against each
    other.'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Ndiff：**可用于对网络进行基线测试。将nmap扫描与彼此进行比较。'
- en: '**Nping:** Allows you to craft custom packets that can then be integrated into
    your scans. Able to perform raw packet manipulation.'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Nping：** 允许您创建自定义数据包，然后将其集成到您的扫描中。能够执行原始数据包操作。'
- en: Note
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Some examples used in the following section display sample output that required
    a combination of firewall and IDS to demonstrate certain aspects of how the tool
    behaves. Setting up these devices is fully covered in further chapters of the
    book, but is beyond the scope of this particular chapter.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 以下部分中使用的一些示例显示了需要结合防火墙和IDS来展示工具行为的某些方面的样本输出。设置这些设备在本书的后续章节中有详细介绍，但超出了本章的范围。
- en: Commonly seen Nmap scan types and options
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 常见的Nmap扫描类型和选项
- en: 'Nmap command syntax: `nmap -{type(s)} -{opt(s)} {target}`'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap命令语法：`nmap -{type(s)} -{opt(s)} {target}`
- en: '**Useful options:**'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '**有用的选项：**'
- en: '| **Scan option** | **Title** | **Function** |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| **扫描选项** | **标题** | **功能** |'
- en: '| --- | --- | --- |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `-g` | Specify source port | Uses a specified source port to send packets.
    |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| `-g` | 指定源端口 | 使用指定的源端口发送数据包。 |'
- en: '| `--spoof_mac` | Spoof Mac | Creates a fake Mac address to send packets from.
    Can randomize MAC. |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| `--spoof_mac` | 伪装Mac | 创建一个假的Mac地址来发送数据包。可以随机化MAC地址。 |'
- en: '| `-S` | Source IP address | Spoofs a source IP address or tells Nmap which
    IP to use. |'
  id: totrans-86
  prefs: []
  type: TYPE_TB
  zh: '| `-S` | 源IP地址 | 伪装源IP地址或告诉Nmap使用哪个IP。 |'
- en: '| `-e` | Choose Ethernet Interface | Determines which eth to send and receive
    packets on. |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '| `-e` | 选择以太网接口 | 确定要在哪个以太网发送和接收数据包。 |'
- en: '| `-F` | Fast scan | Reduces default scan to 100 ports in the nmap-services
    file. |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| `-F` | 快速扫描 | 将默认扫描减少到nmap-services文件中的100个端口。 |'
- en: '| `-p` | Specify port range | Determines which ports are scanned. |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| `-p` | 指定端口范围 | 确定要扫描哪些端口。 |'
- en: '| `-R` | Reverse lookup | Forces reverse lookup. |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| `-R` | 反向查找 | 强制反向查找。 |'
- en: '| `-N` | DNS resolution | Performs reverse lookup. |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| `-N` | DNS解析 | 执行反向查找。 |'
- en: '| `-n` | No DNS resolution | Does not do reverse lookup. |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `-n` | 无DNS解析 | 不进行反向查找。 |'
- en: '| `-h` | Help text | Provides Nmap help text. |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| `-h` | 帮助文本 | 提供Nmap帮助文本。 |'
- en: '| `-6` | IPv6 enable | Scans IPv6. |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| `-6` | 启用IPv6 | 扫描IPv6。 |'
- en: '| `-A` | Aggressive | Initiates many options at once such as version and script
    scanning. Use with caution. |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| `-A` | 侵略性 | 同时启动许多选项，如版本和脚本扫描。谨慎使用。 |'
- en: '| `-T(0-5)` | Timing options | Determines how aggressive you want the scan
    to be. |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| `-T(0-5)` | 定时选项 | 确定您希望扫描的侵略性。 |'
- en: '| `--scan_delay` | Add delay | Adds a delays between probes. |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| `--scan_delay` | 添加延迟 | 在探测之间添加延迟。 |'
- en: '| `-sV` | Service version | Probes for service software versions. |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| `-sV` | 服务版本 | 探测服务软件版本。 |'
- en: '**Useful types:**'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**有用的类型：**'
- en: '| **Scan types** | **Title** | **Function** |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
  zh: '| **扫描类型** | **标题** | **功能** |'
- en: '| --- | --- | --- |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `-sA` | ACK scan | Checks if ports are stateful. Useful for testing firewalls.
    |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| `-sA` | ACK扫描 | 检查端口是否有状态。用于测试防火墙。 |'
- en: '| `-sP` | Ping scan | Used for fast network discovery. |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| `-sP` | Ping扫描 | 用于快速网络发现。 |'
- en: '| `-sR` | RPC scan | Locates RPC applications. May leave initiate log entries
    on successfully scanned hosts. This is now an alias to `-sV`. |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `-sR` | RPC扫描 | 定位RPC应用程序。可能会在成功扫描的主机上留下日志条目。现在这是`-sV`的别名。 |'
- en: '| `-sS` | TCP SYN scan | Very fast and stealthy. Half-open scan. |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| `-sS` | TCP SYN扫描 | 非常快速和隐蔽。半开放扫描。 |'
- en: '| `-sT` | TCP scan | Makes full connections. Not efficient. Very noisy scan
    type that will be noticed easily. |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| `-sT` | TCP扫描 | 建立完整连接。效率低下。非常吵闹的扫描类型，容易被注意到。 |'
- en: '| `-sU` | UDP scan | Determines if certain UDP ports are open. |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| `-sU` | UDP扫描 | 确定某些UDP端口是否开放。 |'
- en: '| `-sX` | XMAS scan | Stealthy scan useful against certain firewall configurations.
    Looks for RST packets to determine if port is closed. Good for scanning UNIX systems.
    |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| `-sX` | XMAS扫描 | 对某些防火墙配置有用的隐秘扫描。查找RST数据包以确定端口是否关闭。适用于扫描UNIX系统。 |'
- en: '| `-sL` | List scan | Lists the IP addresses that will be scanned. Use `-n`
    to ensure no packets are sent on the network. |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| `-sL` | 列表扫描 | 列出将被扫描的IP地址。使用`-n`确保不会在网络上发送数据包。 |'
- en: '| `-sO` | IP protocol scan | Searches for IP protocols in use on host. |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| `-sO` | IP协议扫描 | 搜索主机上正在使用的IP协议。 |'
- en: '| `-sM` | FIN/ACK | Stealthy scan. Good against UNIX-based systems. Looks for
    RST packets. |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| `-sM` | FIN/ACK | 隐蔽扫描。对基于UNIX的系统有用。查找RST数据包。 |'
- en: '| `-sI` | Idle scan | Zombie Host Scan very stealthy scan. |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| `-sI` | 空闲扫描 | 僵尸主机扫描，非常隐蔽的扫描。 |'
- en: '| `-sW` | Window scan | Looks at RST packet TCP Window value to determine Open
    or Closed port. |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| `-sW` | 窗口扫描 | 查看RST数据包的TCP窗口值，以确定端口是开放还是关闭。 |'
- en: '**Output types:**'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '**输出类型：**'
- en: '| **Output types** | **Title** | **Function** |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| **输出类型** | **标题** | **功能** |'
- en: '| --- | --- | --- |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `-oA` | All | Grepable, Normal, XML. |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| `-oA` | 全部 | 可grep，正常，XML。 |'
- en: '| `-oG` | Grepable | Formatted for grepping. |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| `-oG` | 可grep | 格式化为grep。 |'
- en: '| `-oX` | XML | Output results to XML. |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| `-oX` | XML | 将结果输出到XML。 |'
- en: '| `-oN` | Normal | Human Readable Output. |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| `-oN` | 正常 | 人类可读的输出。 |'
- en: Basic scans — warming up
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 基本扫描 —— 热身
- en: We will begin by trying some basic scans against our **Ubuntu_TestMachine_1**
    at `192.168.50.20`. Here we will perform a simple scan to determine what ports
    are open on our target system using the `-A` option.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从对我们的**Ubuntu_TestMachine_1**在`192.168.50.20`上进行一些基本扫描开始。在这里，我们将使用`-A`选项执行简单的扫描，以确定目标系统上有哪些端口是开放的。
- en: '[PRE8]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Looking at the highlighted results we can determine that there is an open port
    at `80/tcp` running an `Apache httpd web server version 2.2.14`. We also see that
    the operating system running on the target is Linux 2.6.x. In addition, the `-A`
    flag initiated a `traceroute` command that provides us with the fact that the
    target is only one hop away.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看突出显示的结果，我们可以确定在`80/tcp`端口上有一个运行着`Apache httpd web server version 2.2.14`的开放端口。我们还看到目标上运行的操作系统是Linux
    2.6.x。此外，`-A`标志启动了一个`traceroute`命令，告诉我们目标只有一跳远。
- en: Note
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The NMAP `-A` scan is very noisy and should not be used when stealth is required.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: NMAP的`-A`扫描非常吵闹，当需要隐蔽时不应使用。
- en: That is a lot of information gained from a very simple command. Let's move on
    to some more advanced features of this awesome tool.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '这是从一个非常简单的命令中获得的大量信息。让我们继续了解这个强大工具的一些更高级的功能。 '
- en: Other Nmap techniques
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 其他Nmap技术
- en: Nmap can be used for a variety of purposes. In addition to being a fast network
    discovery tool, it can also be used to stealthily baseline your network, fingerprint
    services, map out firewall rules, and be configured to bypass IDS signatures.
    We will now try out some of the more advanced features that Nmap makes available
    to us. This information is by no means holistic, so we will be focused on the
    features that will assist us in testing secured environments.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap可用于各种目的。除了作为快速网络发现工具外，它还可以用于隐秘地基线测试您的网络、指纹服务、绘制防火墙规则，并配置为绕过IDS签名。我们现在将尝试一些Nmap为我们提供的更高级功能。这些信息绝不是全面的，因此我们将专注于能帮助我们测试安全环境的功能。
- en: Remaining stealthy
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 保持隐秘
- en: The network scanning process involves sending specially crafted packets to network
    hosts and examining the results for certain criteria. Based on these results you
    will hopefully be able to determine which hosts are on the network, what services
    they are running, and at which version level these services are. This information
    is then used to decide what types of attacks are likely to be successful. There
    are several methods we can use to try to determine this information, some are
    akin to walking down the street screaming your name, whereas others are analogous
    to creeping along in the shadows at night.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 网络扫描过程涉及向网络主机发送特制的数据包并检查特定标准的结果。基于这些结果，您有望确定网络上有哪些主机、它们正在运行什么服务以及这些服务的版本水平。然后，这些信息用于决定哪些类型的攻击可能会成功。我们可以使用几种方法来尝试确定这些信息，有些方法类似于在街上大声喊自己的名字，而其他方法则类似于在夜间悄悄行走。
- en: 'In a secured environment you are likely to be dealing with IDS''s that look
    for specific behaviors such as: how many packets were sent out and how fast they
    were sent, is the traffic unusual, and so on. Firewalls will be prone to flag
    any abnormal connection attempts. To ensure you have a slight opportunity at remaining
    undetected there are certain measures that need to be taken.'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在安全环境中，您可能会处理寻找特定行为的IDS，例如：发送了多少数据包以及发送速度如何，流量是否异常等。防火墙将倾向于标记任何异常的连接尝试。为了确保您有一点机会保持不被发现，需要采取某些措施。
- en: Taking your time
  id: totrans-133
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 花点时间
- en: 'You can change the timing of your scans by using the following nmap options:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下nmap选项更改扫描的时间：
- en: '**-T(0-5)** templates allow you to set the aggressiveness of the scan. This
    is the most simplistic method of detection avoidance. 0 is paranoid, 5 is insane
    which should be used only on a LAN. This is much faster than setting these options
    individually, but reduces the control you have of the scan.'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**-T(0-5)**模板允许您设置扫描的侵略性。这是最简单的检测规避方法。0是偏执狂，5是疯狂，应仅在局域网上使用。这比单独设置这些选项要快得多，但会减少您对扫描的控制。'
- en: '**--max-hostgroup** will limit the hosts that are scanned to only one at a
    time. You can change the value to anything you are comfortable with, but remember
    that IDS''s will combine the probes you send out when checking against their signatures
    (for example, 5 probes in 2 minutes, and so on).'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**--max-hostgroup**将限制一次只扫描一个主机。您可以更改值为您感到舒适的任何值，但请记住，IDS在检查其签名时会合并您发送的探针（例如，2分钟内的5个探针等）。'
- en: '**--max-retries:** In penetration testing this is a setting that you may not
    want to adjust unless you are very certain of the network stability. You could
    reduce this value to 0 if you are very paranoid and not concerned with missing
    a potentially vulnerable system in your scan.'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**--max-retries:**在渗透测试中，这是一个您可能不想调整的设置，除非您非常确定网络的稳定性。如果您非常偏执并且不担心在扫描中错过潜在的易受攻击的系统，可以将此值减少为0。'
- en: '**-max-parallelism** **10** would only allow 10 outstanding probes to be out
    at once. Use this to control how many probes you want out at once.'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**-max-parallelism** **10**将只允许同时有10个未完成的探测。使用此选项来控制同时发送的探测数量。'
- en: '**--scan-delay** allows you to set a pause between probes.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**--scan-delay**允许您在探测之间设置暂停。'
- en: 'Let''s try some of these options in the following command:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在以下命令中尝试一些这些选项：
- en: '[PRE9]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Retransmission caps will be hit; ports will be given up upon. By the time the
    scan completes we will know which systems are live on the 192.168.50.X subnet.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 重传上限将被触发；端口将在扫描完成时放弃。到扫描完成时，我们将知道192.168.50.X子网上有哪些系统是活动的。
- en: Note
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Do not use the `--scan_delay` option when using `--max_parallelism` as they
    are not compatible with each other.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用`--max_parallelism`时不要使用`--scan_delay`选项，因为它们彼此不兼容。
- en: Trying different scan types
  id: totrans-145
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 尝试不同的扫描类型
- en: This is the result of a typical scan from 192.168.50.10 to 192.168.75.11.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这是从192.168.50.10到192.168.75.11的典型扫描结果。
- en: '[PRE10]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: We can see from this output that 21, 79, 80, 110, and 443 are open on this host.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 从此输出中，我们可以看到21、79、80、110和443在此主机上是打开的。
- en: Note
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This scan type would be detected by most IDS's even if they are running in a
    default configuration; however, network and host-based firewalls may ignore the
    traffic by default unless specifically configured to log permitted traffic. If
    you want to see the results in action turn on UFW and use it to open and close
    specific ports. This exercise may help to fully understand the resulting output.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数IDS即使在默认配置下也会检测到此扫描类型；但是，网络和基于主机的防火墙可能会默认忽略流量，除非特别配置以记录允许的流量。如果您想看到结果，请打开UFW并使用它来打开和关闭特定端口。此练习可能有助于充分理解结果输出。
- en: 'Were you to try this scan with a stateful host-based firewall blocking traffic
    to port 79 and 21 you would see traffic similar to the following:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您尝试使用有状态的基于主机的防火墙阻止到端口79和21的流量进行扫描，您将看到类似以下的流量：
- en: '[PRE11]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: By reviewing the highlighted code closely we can see that the port state is
    `filtered` for ports `21` and `79`. Although we were not able to establish if
    the ports are open, we do know that they exist on the target machine in some context.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 通过仔细审查突出显示的代码，我们可以看到端口状态为`filtered`，端口为`21`和`79`。尽管我们无法确定端口是否打开，但我们知道它们以某种方式存在于目标机器上。
- en: SYN scan
  id: totrans-155
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: SYN扫描
- en: 'Using `-sS` against a wide open host at 192.168.50.10 from 192.168.75.11 we
    see the following:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-sS`对192.168.50.10的一个完全开放的主机进行扫描，从192.168.75.11我们看到以下结果：
- en: '[PRE13]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Just as in the preceding example, this indicates that we have at least five
    open and/or filtered ports available. Be sure to use different scan types when
    attempting enumeration of the target network or you may miss out on something
    that could make a huge difference in your testing efforts!
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 就像前面的例子一样，这表明我们至少有五个开放或被过滤的端口可用。在尝试枚举目标网络时，一定要使用不同的扫描类型，否则你可能会错过一些对你的测试工作有重大影响的东西！
- en: Null scan
  id: totrans-160
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 空扫描
- en: 'If the only scan we had attempted had been the null scan, we would have been
    very disappointed:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们尝试的唯一扫描是空扫描，我们会非常失望：
- en: '[PRE15]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: This tells us that all of the ports are `open|filtered`. We can assume we have
    some firewall action, but we did not actually learn anything immediately useful.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉我们所有的端口都是`open|filtered`。我们可以假设有一些防火墙的动作，但我们并没有立即学到任何有用的东西。
- en: ACK scan
  id: totrans-165
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: ACK扫描
- en: As we did not find anything on our Null scan, we proceed to use the ACK scan
    type.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们在空扫描中没有找到任何东西，我们继续使用ACK扫描类型。
- en: '[PRE17]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: At least this scan provided us with one unfiltered port. If we really wanted
    to perform testing we would need all of the open ports, not just one!
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 至少这次扫描为我们提供了一个未经过滤的端口。如果我们真的想要进行测试，我们需要所有的开放端口，而不仅仅是一个！
- en: Conclusion
  id: totrans-170
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 结论
- en: Using different scan types might draw more attention to you, but sometimes it's
    necessary to gather the data you need. Ideally, you would begin by scanning with
    the least noticeable scan types and work your way up based on the type of information
    you are gathering. Always double-check before you move on to the next subnet,
    especially if you have good reason to believe that there are some valuable ports
    available that are just not showing up.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 使用不同的扫描类型可能会更容易引起注意，但有时需要收集你需要的数据。理想情况下，你应该从最不引人注意的扫描类型开始扫描，然后根据你收集的信息类型逐步提升。在继续下一个子网之前一定要仔细检查，特别是如果你有充分的理由相信有一些有价值的端口可用但没有显示出来。
- en: Shifting blame — the zombies did it!
  id: totrans-172
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 推卸责任——是僵尸干的！
- en: Since the odds of remaining undetected are slim, we will need to try to deflect
    the blame. We can use an idle scan to have a zombie take all of the credit for
    our scan.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 由于保持不被发现的几率很小，我们需要试图转移责任。我们可以使用空闲扫描让僵尸主机承担我们扫描的所有责任。
- en: Tip
  id: totrans-174
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The `nmap.org` site has a very detailed and thorough description of how an idle
    scan works. Take a look at [http://nmap.org/book/idlescan.html](http://nmap.org/book/idlescan.html)
    for a full overview of how these work.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '`nmap.org`网站对空闲扫描的工作原理有非常详细和全面的描述。请查看[http://nmap.org/book/idlescan.html](http://nmap.org/book/idlescan.html)以获取关于这些工作原理的完整概述。'
- en: An important item to remember about idle scanning (`-s`I) is that you will need
    to find a zombie host that has a good **TCP Sequence Prediction** rating. The
    idle scan is aptly named, as the machine being used as our scapegoat must be as
    close to idle as possible. Many in the industry suggest network enabled printers
    as perfect zombies because they typically do not have constant traffic, and their
    sequence prediction difficulty ratings are usually very low.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 关于空闲扫描（-sI）的一个重要事项是，你需要找到一个具有良好的TCP序列预测评级的僵尸主机。空闲扫描的名字很贴切，因为我们用作替罪羊的机器必须尽可能地空闲。许多行业人士建议使用网络打印机作为完美的僵尸主机，因为它们通常没有持续的流量，它们的序列预测难度评级通常非常低。
- en: 'The first step of an idle scan is to locate possible zombies. You can find
    the TCP Sequence Prediction ratings by performing the following (verbose, OS detection,
    no ping, no name resolution):'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 空闲扫描的第一步是找到可能的僵尸主机。你可以通过执行以下操作（详细模式、操作系统检测、无ping、无名称解析）来找到TCP序列预测评级：
- en: '[PRE19]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The section of the output that you will want to focus on is as follows:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要关注的输出部分如下：
- en: '[PRE20]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The system above is not ideal, but should be able to be used as a zombie. The
    higher the difficulty rating is, the more likely your attempt to use this machine
    as a zombie will fail. Also, the fact that generation is sequential will improve
    the likelihood that the scan will be successful.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的系统并不理想，但应该可以用作僵尸主机。难度评级越高，你尝试使用这台机器作为僵尸的可能性就越小。此外，生成是顺序的事实将提高扫描成功的可能性。
- en: 'Let''s review the concept of an idle scan:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下空闲扫描的概念：
- en: Send SYN/ACK to zombie which in turn provides an RST with a fragment identification
    number (IPID).
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向僵尸主机发送SYN/ACK，然后僵尸主机会返回一个带有片段标识号（IPID）的RST。
- en: A specially crafted packet with the IP address of the zombie host is sent to
    the target machine.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个特制的数据包带有僵尸主机的IP地址被发送到目标机器。
- en: A closed port on the target machine will cause a RST to be sent to the zombie
    in which case nothing happens. An open port on the other hand will cause the target
    machine to respond to the IP address of our forged packet with a SYN/ACK which
    in turn caused our zombie machine to send the target a RST once it realizes there
    is no valid connection. The IPID has now been incremented!
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目标机器上的关闭端口会导致向僵尸主机发送一个RST，此时什么也不会发生。另一方面，打开的端口会导致目标机器用我们伪造的数据包的IP地址回复一个SYN/ACK，这又会导致我们的僵尸主机向目标机器发送一个RST，一旦它意识到没有有效的连接。IPID现在已经增加了！
- en: We close the loop by sending our zombie another SYN/ACK and checking to see
    if the IPID has increased by 2 once for our RST and once for the target machines
    RST.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们通过向僵尸主机发送另一个SYN/ACK并检查IPID是否增加了2次来关闭循环，一次是为了我们的RST，一次是为了目标机器的RST。
- en: Repeat until all target machine ports have been probed!
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复直到所有目标机器的端口都被探测到！
- en: When looking at how the zombie scan works, it is easy to see that the proper
    usage of an idle scan can be useful in slowing down members of the blue team (defensive
    security professionals).
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 当看到僵尸扫描是如何工作的时候，很容易看出空闲扫描的正确使用可以有助于减缓蓝队（防御安全专业人员）的速度。
- en: 'So, what is the syntax of this command anyhow? With this much power it has
    to be super difficult right? You might be pleasantly surprised when looking at
    the following command structure:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，这个命令的语法是什么？有这么大的能力，肯定很难吧？当您查看以下命令结构时，您可能会感到惊喜：
- en: '[PRE21]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Here we used `-p` to initiate a scan of TCP ports that we already know are
    opened; we also indicated we did not want to ping (which would give us away) with
    `-Pn`, and then initiated an idle scan (-sI) using `192.168.1.88` as our zombie
    and `192.168.1.111` as our target. This results in the following output on this
    sample network:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用了`-p`来启动对我们已知已打开的TCP端口的扫描；我们还指示我们不想进行ping（这会暴露我们）使用`-Pn`，然后使用`192.168.1.88`作为我们的僵尸和`192.168.1.111`作为我们的目标启动了一个空闲扫描（-sI）。这在这个示例网络上产生了以下输出：
- en: '[PRE22]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: If we look at the output from Wireshark we can see some strange activity going
    on coming from `192.168.1.88` to `192.168.1.111:`
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们查看Wireshark的输出，我们可以看到一些奇怪的活动来自`192.168.1.88`到`192.168.1.111`：
- en: '![Shifting blame — the zombies did it!](img/7744_03_04.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: 责任转嫁——僵尸做了这件事！
- en: Looking at the Wireshark results, we see that the previous Nmap command initiated
    a lot of traffic from `192.168.1.88` to `192.168.1.111` on our network. This traffic
    is what will initiate the activity needed to increase the IPID that tells us that
    the target system has open ports.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 从Wireshark的结果来看，我们看到之前的Nmap命令在我们的网络上从`192.168.1.88`到`192.168.1.111`发起了大量的流量。这种流量将启动所需的活动，以增加告诉我们目标系统具有开放端口的IPID。
- en: IDS rules, how to avoid them
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: IDS规则，如何避免它们
- en: The only way to truly avoid an IDS rule is to know what they are, and to test
    your attacks in a virtual environment. We will dedicate an entire chapter of this
    book to avoiding detection. Be prepared to take the time to understand what an
    IDS looks for and use the methods we have already described to manage your scans
    to perform detection avoidance.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 要真正避免IDS规则的唯一方法是了解它们是什么，并在虚拟环境中测试您的攻击。我们将在本书的一个整章中致力于避免检测。请准备花时间了解IDS寻找什么，并使用我们已经描述的方法来管理您的扫描以执行检测规避。
- en: Using decoys
  id: totrans-198
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用诱饵
- en: The use of Nmap decoys can be an interesting concept. We tell Nmap to add additional
    hosts to the scan. You will not get any response from these decoys, but they will
    make it more difficult for an administrator to determine which IP is actively
    scanning, and which IP is just there to muddy the water so to speak. Ideally,
    you would be initiating a scan that will have enough LIVE decoys to drive down
    the detection capability of the targets administrators.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap诱饵的使用可能是一个有趣的概念。我们告诉Nmap向扫描中添加额外的主机。您将不会从这些诱饵中得到任何响应，但它们会使管理员更难以确定哪个IP正在主动扫描，哪个IP只是在那里搅浑水。理想情况下，您将启动一个扫描，其中有足够多的活动诱饵来降低目标管理员的检测能力。
- en: Note
  id: totrans-200
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Use live decoys when scanning. This will make it more difficult to determine
    which system is actively scanning. Live decoys are IPs that are currently active
    on the network.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在扫描时使用活动诱饵。这将使确定哪个系统正在主动扫描变得更加困难。活动诱饵是当前在网络上活动的IP。
- en: An item of note is that you are able to perform many of the scan types when
    using decoys. You will not be restricted and can use all of your tricks without
    hesitation.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，在使用诱饵时，您可以执行许多扫描类型。您不会受到限制，可以毫不犹豫地使用所有技巧。
- en: 'Let''s give this a try in our virtual lab:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在我们的虚拟实验室中尝试一下：
- en: '[PRE23]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Here we invoke Nmap followed by the `-D` switch that will cause us to perform
    a decoy scan. We follow this command with a listing of decoys of our choice, all
    of which are live machines in this case. Once again we do not want to send out
    a ping request so we stop this action by using `-Pn`. The chosen port range was
    set with `-p` as `80,21,22,25`, and `443`.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们调用Nmap，然后跟随`-D`开关，这将导致我们执行诱饵扫描。我们接着这个命令使用我们选择的诱饵列表，这些诱饵在这种情况下都是活动的机器。再次，我们不想发送ping请求，所以我们使用`-Pn`来停止这个动作。所选的端口范围是使用`-p`设置为`80,21,22,25`和`443`。
- en: Tip
  id: totrans-206
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '`ME` can be used instead of typing your localhost IP address.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '`ME`可以用来代替键入本地主机IP地址。'
- en: 'Here are the results of this scan:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 这次扫描的结果如下：
- en: '[PRE24]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Nothing new here; we have once again determined which ports are opened, filtered,
    or closed. The real magic occurred on the wire. Let''s take a look at what is
    seen by a network-based firewall:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 这里没有什么新的；我们再次确定了哪些端口是打开的、过滤的或关闭的。真正的魔术发生在电线上。让我们来看看网络防火墙看到了什么：
- en: '![Using decoys](img/7744_03_05.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: 使用诱饵
- en: If you take a look at the source field you should notice that the decoys we
    have used are now populating the firewall filter that has been set to record all
    traffic. Using enough decoys, you could create a storm of sorts and thus fully
    confuse and delay the administrator of the network while you are performing your
    enumeration.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您查看源字段，您应该注意到我们使用的诱饵现在正在填充已设置为记录所有流量的防火墙过滤器。使用足够的诱饵，您可以创建一种风暴，从而完全混淆和延迟网络管理员在执行枚举时。
- en: Tip
  id: totrans-213
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Wireshark can be used on the BackTrack machine if you want to look at this scan
    in action. We also fully cover adding firewalls to the lab in later chapters.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想要查看此扫描的实际操作，可以在BackTrack机器上使用Wireshark。我们还将在后面的章节中完全涵盖将防火墙添加到实验室中。
- en: Adding custom Nmap scripts to your arsenal
  id: totrans-215
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将自定义Nmap脚本添加到您的武器库
- en: The Nmap scripting engine allows you to create and use custom scripts that perform
    many different functions. As previously mentioned, Nmap comes with many of these
    scripts already packaged for you. The fully detailed guide to the Nmap Scripting
    Engine is available at [http://nmap.org/book/nse.html](http://nmap.org/book/nse.html).
    By using the `--script` option you are able to invoke your own scripts, or pick
    and choose from the vast repository of scripts that are already available.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap脚本引擎允许您创建和使用执行许多不同功能的自定义脚本。如前所述，Nmap已经为您打包了许多这些脚本。Nmap脚本引擎的完整详细指南可在[http://nmap.org/book/nse.html](http://nmap.org/book/nse.html)上找到。通过使用`--script`选项，您可以调用自己的脚本，或者从已经可用的大量脚本库中进行选择。
- en: Note
  id: totrans-217
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Make sure that you **fully** understand any script that you run. NSE is very
    powerful and could potentially cause damage if you do not understand each step
    of the process! Do not just blindly run all scripts you find or you may end up
    regretting it later.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您**完全**了解您运行的任何脚本。NSE非常强大，如果您不了解每个步骤，可能会造成损害！不要盲目运行您找到的所有脚本，否则您可能会后悔。
- en: How to decide if a script is right for you
  id: totrans-219
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何决定脚本是否适合您
- en: 'Using Nmap''s `--script-help` option will allow you to display several helpful
    fields of a particular script without actually running it. For instance, if we
    looked at BackTracks nmap''s script folder at `/usr/local/share/nmap/scripts`
    and performed an `ls -lah` we see a long list of unknowns:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Nmap的`--script-help`选项将允许您显示特定脚本的几个有用字段，而无需实际运行它。例如，如果我们查看BackTracks nmap的脚本文件夹`/usr/local/share/nmap/scripts`并执行`ls
    -lah`，我们会看到一长串未知的内容：
- en: '[PRE25]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: This list continues much further than what is displayed in this book and is
    constantly being updated. Not too long ago, Fyodor provided a great presentation
    on the Nmap Scripting Engine at the Defcon 18 conference and the number of penetration
    testers and developers who have been adding their scripts to the repository has
    been rising.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 此列表比本书中显示的内容要多得多，并且正在不断更新。不久前，Fyodor在Defcon 18会议上提供了关于Nmap脚本引擎的精彩演讲，添加到存储库中的脚本数量一直在增加。
- en: 'So what if we want to learn about `banner.nse?` This script looks interesting
    and we can make assumptions based on the name, but it would be better to look
    at the description provided by the author by typing:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如果我们想了解`banner.nse`呢？这个脚本看起来很有趣，我们可以根据名称做出假设，但最好查看作者提供的描述，方法是键入：
- en: '[PRE27]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'This results in the following output:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 这导致以下输出：
- en: '[PRE28]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: So, in this case our assumption was more than likely correct. Not only do we
    learn that the `banner.nse` file is used to connect to open TCP ports for banner
    grabbing, but also that it is considered to fall under the category of `discovery`
    and `safe`, both of which are categories that you can call when using the script
    option from the command line. You can also visit [http://nmap.org/nsedoc/](http://nmap.org/nsedoc/)
    for easy access to script information.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在这种情况下，我们的假设很可能是正确的。我们不仅了解到`banner.nse`文件用于连接到开放的TCP端口进行横幅抓取，而且它被认为属于`发现`和`安全`类别，这两个类别在使用命令行的脚本选项时可以调用。您还可以访问[http://nmap.org/nsedoc/](http://nmap.org/nsedoc/)以便轻松获取脚本信息。
- en: We do not yet have anything that `banner.nse` would work on in our lab, but
    let's go ahead and run the 50+ scripts that are initiated by the simple `-sC`
    option. If you have not already looked at the Nmap NSE website to see which scripts
    these are, you may want to give it a quick visit to ensure you fully understand
    the scripts that are being initiated before this is tried on a production network.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的实验室中还没有`banner.nse`可以使用的内容，但让我们继续运行由简单的`-sC`选项启动的50多个脚本。如果您还没有查看Nmap NSE网站以查看这些脚本，您可能希望快速访问一下，以确保在尝试在生产网络上运行之前，您完全了解正在启动的脚本。
- en: Note
  id: totrans-230
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The Ubuntu machine in the virtual lab has been updated to make interesting services
    available for this example. Your output will most likely be different.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟实验室中的Ubuntu机器已更新，以便为本示例提供有趣的服务。您的输出很可能会有所不同。
- en: 'Take a look at the output produced by the following command:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下命令产生的输出：
- en: '[PRE29]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '[PRE30]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The `-sC` option provides us with many details that the other scan types just
    did not manage to present. There is a cost associated with this. Many of the scripts
    that you have just seen run are very noticeable on the network and/or on the host
    they are being run on. Taking a look at the previous output we can now see that
    not only is `pop3` open at `port 110`, but also that it has `capa` and `APOP`
    capabilities. We also know now that this system will support connections to `SSLv2`
    which is a known vulnerable protocol that we can possibly exploit to our advantage.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: '`-sC`选项为我们提供了许多其他扫描类型无法呈现的细节。这是有代价的。您刚刚看到的许多脚本在网络和/或正在运行的主机上非常明显。通过查看先前的输出，我们现在可以看到不仅`port
    110`上打开了`pop3`，而且它还具有`capa`和`APOP`功能。我们现在也知道该系统将支持连接到`SSLv2`，这是一个已知的易受攻击的协议，我们可能可以利用它来获取优势。'
- en: Adding a new script to the database
  id: totrans-236
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 向数据库添加新脚本
- en: All of these preloaded scripts are great, but what if you want to add additional
    scripts to your arsenal, either because you wrote them yourself or because someone
    you trust has provided you with the latest and greatest thing they have developed
    and you want to take advantage of it when performing your penetration tests? This
    can be very simple!
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些预加载的脚本都很棒，但是如果您想要将其他脚本添加到您的工具库中，无论是因为您自己编写了它们，还是因为您信任的某人提供了最新和最棒的东西，并且您想在执行渗透测试时利用它，那么这可能非常简单！
- en: Add the `script .nse` file to the directory where the other Nmap NSE scripts
    are located.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`script .nse`文件添加到其他Nmap NSE脚本所在的目录中。
- en: 'Run the following command to update the database that bundles the scripts via
    categories:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以更新通过类别捆绑脚本的数据库：
- en: '[PRE31]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Now you can use your new scripts via the nmap `--script "scriptname.nse`" or
    by using the categorical grouping that the script was associated with.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您可以通过nmap `--script "scriptname.nse`"或使用脚本关联的分类分组来使用新脚本。
- en: 'SNMP: A goldmine of information just waiting to be discovered'
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SNMP：一个等待被发现的信息宝库。
- en: '**Simple Network Management Protocol (SNMP)** is commonly mismanaged by busy
    administrators and developers. Frequently, you will see default community strings,
    or community strings that are reused throughout the entire organization you are
    testing. You will want to ensure that your clients are using the most secure version
    of SNMP and that you cannot simply walk in to a building, unplug a phone, and
    sniff the community string. Newer versions of SNMP include strong encryption to
    avoid such flaws.'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: '**简单网络管理协议（SNMP）**通常由繁忙的管理员和开发人员管理不善。经常会看到默认的community字符串，或者在测试的整个组织中重复使用的community字符串。您将希望确保您的客户端使用最安全的SNMP版本，并且您不能简单地走进建筑物，拔掉电话，然后嗅探community字符串。较新版本的SNMP包括强加密以避免此类缺陷。'
- en: SNMPEnum
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SNMPEnum
- en: Luckily for us there are many tools available that make testing for SNMP simple.
    We will start off by using SNMPEnum which is a Perl script that can be found in
    BackTrack 5 R1 in the `/pentest/enumeration/snmp/snmpenum` directory.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，有许多可用的工具可以简化对SNMP的测试。我们将首先使用SNMPEnum，这是一个Perl脚本，可以在BackTrack 5 R1的`/pentest/enumeration/snmp/snmpenum`目录中找到。
- en: 'If you would like to follow along with these examples you can either skip ahead
    a few chapters and follow the pfSense installation and configuration walkthroughs
    or the Ubuntu machine could be set up to use SNMP. This can be done as follows:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想跟随这些示例，您可以跳过几章并跟随pfSense安装和配置演练，或者可以设置Ubuntu机器以使用SNMP。可以按以下步骤操作：
- en: For this example a firewall virtual appliance has been set up and SNMP has been
    enabled with the very weak community string of "public".
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，已设置了防火墙虚拟设备，并启用了非常薄弱的community字符串"public"的SNMP。
- en: Here we will display what type of information it will disclose to a penetration
    tester using `snmpenum.pl`.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将展示`snmpenum.pl`向渗透测试人员披露的信息类型。
- en: '[PRE32]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'This command invokes the `snmpenum.pl` Perl script and passes on the target
    IP `192.168.121.252` and the selected community string `public. linux.txt` which
    is found in the working directory of the `snmpenum` tool, in the given import
    file. We have specified that the output is to be placed in `myFW.txt` as there
    is such a wealth of information provided by a successful connection to a SNMP
    daemon. Here are a few of the more interesting sections of what we have just learned:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令调用了`snmpenum.pl` Perl脚本，并传递了目标IP`192.168.121.252`和选定的community字符串`public.
    linux.txt`，该字符串在`snmpenum`工具的工作目录中找到，给定导入文件中。我们已经指定输出放在`myFW.txt`中，因为成功连接到SNMP守护程序提供了如此丰富的信息。以下是我们刚刚学到的一些更有趣的部分：
- en: '[PRE33]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'WOW! We have managed to get all of the open ports for this device by simply
    sending ONE simple request to the SNMP daemon running on this router/firewall.
    In this case we could simply skip trying to run Nmap (which is a shame as we have
    learned so much about it in this chapter!) and just start our banner grabbing
    exercises. There is much more to be in the `myFW.txt` file however:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 哇！我们仅仅通过向运行在这个路由器/防火墙上的SNMP守护程序发送一个简单的请求，就已经成功获取了这个设备的所有开放端口。在这种情况下，我们可以简单地跳过尝试运行Nmap（这很遗憾，因为我们在本章中已经学到了很多关于它！），并开始我们的横幅抓取练习。然而，在`myFW.txt`文件中还有更多内容：
- en: '[PRE34]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Now we also know what exactly this machine is named, what its purpose is (a
    quick check on `google.com` will tell you all about pfSense) and which operating
    system and version we are dealing with.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们还知道这台机器的确切名称，它的用途是什么（快速检查`google.com`将告诉您有关pfSense的一切），以及我们正在处理的操作系统和版本。
- en: What else can we get out of the SNMP scan we ran?
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以从我们运行的SNMP扫描中得到什么？
- en: '[PRE35]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: If there are flaws to be taken advantage of during your testing, at this point
    you have everything you would ever need. I encourage you to visit the manufacturers'
    sites and familiarize yourself with the type of information you can obtain via
    SNMP. If used properly, it can be extremely beneficial to an organization; however,
    if not configured properly SNMP is a potential epic fail.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在测试过程中存在可以利用的缺陷，那么此时您拥有了您所需的一切。我鼓励您访问制造商的网站，并熟悉您可以通过SNMP获取的信息类型。如果使用正确，它对组织非常有益；但是，如果未正确配置SNMP，则可能会导致失败。
- en: SNMPCheck
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SNMPCheck
- en: Another great tool included with BackTrack is `snmpcheck`, which was provided
    by Matteo Cantoni from `Nothink.org`. This Perl script allows you to enumerate
    the SNMP devices and places the output in a very human readable friendly format.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: BackTrack中包含的另一个很棒的工具是`snmpcheck`，由`Nothink.org`的Matteo Cantoni提供。这个Perl脚本允许您枚举SNMP设备，并将输出放在非常易于阅读的友好格式中。
- en: '[PRE36]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'This command assumes that the device will respond to the `public` community
    string, but you can easily change which string to use by adding the `-c` switch.
    On a successful scan the output will be similar to the following:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令假设设备将响应于`public` community字符串，但您可以通过添加`-c`开关轻松更改要使用的字符串。在成功扫描时，输出将类似于以下内容：
- en: '[PRE37]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The preceding output has been shortened tremendously, but what we have provided
    here should give an idea of the type of data that this tool makes available to
    a penetration tester.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的输出已经大大缩短，但我们在这里提供的内容应该可以让您了解到这个工具向渗透测试人员提供的数据类型。
- en: Note
  id: totrans-264
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '`snmpcheck` has been ported over to Metasploit and can be used directly from
    within that framework.'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '`snmpcheck`已经移植到了Metasploit，并可以直接从该框架中使用。'
- en: When the SNMP community string is NOT "public"
  id: totrans-266
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 当SNMP community字符串不是"public"时
- en: More than likely you will not find many community strings that are set at default.
    That is when you must dig into your toolset and earn your pay. There are many
    utilities that assist in actions such as brute forcing SNMP community names. One
    of my favorites is called `onesixtyone`. This scanner is fast and efficient and
    will send requests in parallel to speed things up.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能您不会找到许多设置为默认的community字符串。那时，您必须深入了解您的工具集，并赚取您的报酬。有许多实用程序可协助执行诸如暴力破解SNMP
    community名称之类的操作。我最喜欢的之一就是`onesixtyone`。这个扫描程序速度快且高效，将并行发送请求以加快速度。
- en: Tip
  id: totrans-268
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Please keep the following in mind when testing: just because a tool is very
    functional for most tasks doesn''t mean it will be functional for all. There is
    the possibility that you may have to reach back into your toolbox and try something
    different. The more you know about how a tool functions, the more likely you are
    to be successful in your testing. For instance, onesixtyone is looking for a particular
    value when it makes the SNMP request. The firewall used in my virtual lab probably
    does not use this value and therefore, it is invisible to the tool. After seeing
    the wealth of knowledge we obtained in the preceding section, would it not be
    horrible to miss out on this information just because we only used one tool for
    the task at hand?'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试时，请记住以下几点：仅因为某个工具对大多数任务非常有效，并不意味着它对所有任务都有效。有可能您需要回到您的工具箱并尝试其他方法。您了解工具功能的越多，您在测试中成功的可能性就越大。例如，onesixtyone在进行SNMP请求时正在寻找特定值。我虚拟实验室中使用的防火墙可能不使用此值，因此对该工具来说是不可见的。在看到我们在前面部分获得的丰富知识后，仅仅因为我们只使用了一个工具就错过这些信息，这不是很糟糕吗？
- en: 'The command syntax for onesixtyone is straightforward:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: onesixtyone的命令语法很简单：
- en: '[PRE38]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Where we have onesixtyone use the provided `dict.txt` file to check against
    `192.168.50.10` which results in the following on my virtual network:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 我们让onesixtyone使用提供的`dict.txt`文件来检查`192.168.50.10`，在我的虚拟网络上结果如下：
- en: '[PRE39]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Looking at these results, we notice that the host we scanned uses a Ubuntu
    Linux operating system and has the previously unknown community string of public.
    Let''s change this on the host and see how we fare when using the same command:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 查看这些结果，我们注意到我们扫描的主机使用的是Ubuntu Linux操作系统，并且具有先前未知的公共社区字符串。让我们在主机上更改这个，并看看在使用相同命令时我们的表现如何：
- en: '[PRE40]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: As expected, since we no longer had the community name in our list we were unable
    to find it. We can create our own `dict.txt` file, or add to the one that is already
    provided to us.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 正如预期的那样，由于我们的列表中不再有社区名称，我们无法找到它。我们可以创建我们自己的`dict.txt`文件，或者添加到已经提供给我们的文件中。
- en: Note
  id: totrans-277
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When dealing with dictionary files, it is better to have several available to
    meet specific needs. It would be a good idea to have at least three available
    just for SNMP purposes. One with many defaults, another with popular names that
    people use for community names, and lastly a large file with many names that can
    be customized to your client based on company names, usernames, and so on.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 处理字典文件时，最好有几个可用来满足特定需求。最好至少有三个可用于SNMP目的。一个具有许多默认值，另一个具有人们用于社区名称的常用名称，最后一个是一个包含许多名称的大文件，可以根据公司名称、用户名等定制给您的客户。
- en: Creating network baselines with scanPBNJ
  id: totrans-279
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用scanPBNJ创建网络基线
- en: When performing a penetration test it is important to know when and what changed
    over a period of time. Administrators are typically overworked and will probably
    still need to get work completed while you are doing your testing. One method
    of ensuring that you are not playing on an ever changing field is to grab a baseline
    of the network you are testing. PBNJ is very capable of this task. The website
    for scanPBNJ is located at [http://pbnj.sourceforge.net](http://pbnj.sourceforge.net)
    and the tool is also available as part of the BackTrack 5 R1 distribution. The
    key item of note about `scanPBNJ` is that it uses Nmap to scan the network and
    then stores the results in a database for you along with timestamps of when the
    scan had been performed.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 进行渗透测试时，了解在一段时间内发生了什么以及发生了什么变化是很重要的。管理员通常工作繁忙，可能仍需要在您进行测试时完成工作。确保您不是在一个不断变化的领域上进行测试的一种方法是抓取您正在测试的网络的基线。PBNJ非常擅长这项任务。scanPBNJ的网站位于[http://pbnj.sourceforge.net](http://pbnj.sourceforge.net)，该工具也作为BackTrack
    5 R1发行版的一部分提供。关于`scanPBNJ`的关键注意事项是它使用Nmap扫描网络，然后将结果与扫描执行时间戳一起存储到数据库中。
- en: Setting up MySQL for PBNJ
  id: totrans-281
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置MySQL用于PBNJ
- en: BackTrack comes with MySQL preinstalled. We will take advantage of this and
    have PBNJ deposit our scan findings into a MySQL database that will prepare.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: BackTrack预装了MySQL。我们将利用这一点，让PBNJ将我们的扫描结果存储到一个MySQL数据库中进行准备。
- en: Starting MySQL
  id: totrans-283
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启动MySQL
- en: 'Type the following at the command line:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 在命令行中键入以下内容：
- en: '[PRE41]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: The service should be started. You can also use `service stop` or `service restart`
    in the same manner.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 服务应该已经启动。您也可以使用相同的方式使用`service stop`或`service restart`。
- en: Preparing the PBNJ database
  id: totrans-287
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 准备PBNJ数据库
- en: 'Prepare the PBNJ database using the following steps:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 准备PBNJ数据库，按以下步骤进行：
- en: '[PRE42]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '[PRE43]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '[PRE44]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '[PRE45]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '[PRE46]'
  id: totrans-293
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '[PRE47]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '[PRE48]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '[PRE49]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: '[PRE50]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: We have created a database named `BTpbnj`, added a user named `tester` with
    a password of `password`, granted that user full database access, and exited the
    database.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经创建了一个名为`BTpbnj`的数据库，添加了一个名为`tester`的用户，密码为`password`，授予该用户完整的数据库访问权限，并退出了数据库。
- en: Now we need to edit the PBNJ configuration file to use our newly-create database.
    Make a directory under root named `.pbnj-2.0/` (mkdir `-p .pbnj-2.0)` and then
    change to that hidden directory. Perform the following command to copy your `mysql.yaml`
    configuration file to `config.yaml:`
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要编辑PBNJ配置文件以使用我们新创建的数据库。在根目录下创建一个名为`.pbnj-2.0/`的目录（mkdir `-p .pbnj-2.0)`，然后切换到该隐藏目录。执行以下命令将您的`mysql.yaml`配置文件复制到`config.yaml`：
- en: '[PRE51]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Once the file has been copied, we need to edit several items using nano:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 文件复制后，我们需要使用nano编辑几个项目：
- en: '[PRE52]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: '[PRE53]'
  id: totrans-303
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'The following fields in `config.yaml` that are highlighted need to be changed
    to the match following:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 需要更改`config.yaml`中突出显示的以下字段以匹配以下内容：
- en: 'db: **mysql**'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库：**mysql**
- en: 'database: **BTpbnj**'
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库：**BTpbnj**
- en: 'user: **"tester**"'
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户：**"tester**"
- en: 'password: **"password**"'
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码：**"password**"
- en: 'host: **"127.0.0.1**"'
  id: totrans-309
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主机：**"127.0.0.1**"
- en: 'port: **"3306**"'
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口：**"3306**"
- en: Exit out of nano by first saving your work with *CTRL + O* followed by *Enter*,
    and then *CTRL + X* to exit.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 通过首先使用*CTRL + O*保存您的工作，然后使用*CTRL + X*退出nano。
- en: First scan
  id: totrans-312
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第一次扫描
- en: Here we scan `192.168.75.0/24:`
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里我们扫描`192.168.75.0/24：`
- en: '[PRE54]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: This command initiates `scanpbnj` and uses the `-a` flag to use one of the now
    familiar Nmap flags. We targeted the `192.168.75.0/24` network in this example.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令启动了`scanpbnj`，并使用`-a`标志使用了现在熟悉的Nmap标志之一。在这个示例中，我们针对了`192.168.75.0/24`网络。
- en: Note
  id: totrans-316
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If following along with the examples replace `192.168.75.0/24` with the IP range
    of your lab or network.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 如果按照示例进行操作，请用您的实验室或网络的IP范围替换`192.168.75.0/24`。
- en: 'Once the scan is complete you will see something along the lines of the following
    output appear on your screen:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描完成后，您将在屏幕上看到以下输出的类似内容：
- en: '[PRE55]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: That's all there is to it. We now have a record of what is on our `192.168.75.0/24`
    network sitting in a database ready for our review.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 就是这样。我们现在在数据库中记录了我们`192.168.75.0/24`网络上的内容，准备好供我们审查。
- en: Note
  id: totrans-321
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The default scan settings will perform Nmap's very verbose Operating System
    Detection, SYN scan, on the first 1025 ports excluding the little used port 0.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 默认扫描设置将在前1025个端口上执行Nmap的非常详细的操作系统检测，SYN扫描，排除了很少使用的端口0。
- en: Reviewing the data
  id: totrans-323
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 审查数据
- en: 'Information is in the database now, but how can we review it? Well, because
    we have decided to use MySQL we can rely on our previous MySQL knowledge to perform
    any type of query we like! Here are some examples:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 现在信息已经在数据库中，但我们如何审查它呢？因为我们决定使用MySQL，所以我们可以依赖于我们以前的MySQL知识来执行任何我们喜欢的类型的查询！以下是一些示例：
- en: 'Log in to the database and tell it to use the `BTpbnj` database:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 登录数据库，并告诉它使用`BTpbnj`数据库：
- en: '[PRE56]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: '[PRE57]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '[PRE58]'
  id: totrans-328
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '[PRE59]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Once we have logged in let''s try some queries:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们登录，让我们尝试一些查询：
- en: '[PRE60]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: '[PRE61]'
  id: totrans-332
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: There are two tables in the MySQL `BTpbnj` database.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL`BTpbnj`数据库中有两个表。
- en: '[PRE62]'
  id: totrans-334
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: '[PRE63]'
  id: totrans-335
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: Now we have some fields that we can base our next query on. Notice the `created_on`
    and `machine_created` fields. These timestamps come in handy when performing your
    baselines.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有一些字段可以基于它们进行下一个查询。注意`created_on`和`machine_created`字段。当执行基线时，这些时间戳非常有用。
- en: '[PRE64]'
  id: totrans-337
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: We have selected the `ip,os`, and `created_on` fields from our database. Now
    let's move on to some more interesting information.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从数据库中选择了`ip,os`和`created_on`字段。现在让我们继续了解一些更有趣的信息。
- en: '[PRE66]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '[PRE67]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Looking at this information we can see that we are now able to pull queries
    not just for one host, but for all hosts at once. Also, the output from this database
    could be in XML and then transferred to whichever tool we are using to track our
    penetration testing results.
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看这些信息，我们可以看到我们现在能够一次性查询所有主机，而不仅仅是一个主机。此外，这个数据库的输出可以是XML格式，然后传输到我们用来跟踪渗透测试结果的任何工具。
- en: Tip
  id: totrans-343
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: MySQL commands can be run from the command line so that output can be exported
    into the format of your choice. Use the `-X` or `-H` switches when invoking the
    MySQL command to save to each respective file type. Most penetration testers will
    need a good understanding of MySQL command syntax to be fully effective.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL命令可以从命令行运行，以便将输出导出到您选择的格式。在调用MySQL命令时使用`-X`或`-H`开关，以保存到各自的文件类型。大多数渗透测试人员需要对MySQL命令语法有很好的理解才能发挥其作用。
- en: 'Let''s see what type of data was collected in our simple scan:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看我们的简单扫描收集了什么类型的数据：
- en: '[PRE68]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '[PRE69]'
  id: totrans-347
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Using a database to store your findings is very efficient and highly recommended.
    Scan your virtual lab and test some of the different methods of extracting your
    data. By using this data wisely it is possible to quickly determine the network
    environment, standard software versions, and other information that will be critical
    to determining which targets you should focus on during the next stages of the
    penetration test.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 使用数据库存储您的发现非常高效，强烈建议。扫描您的虚拟实验室，并测试一些不同的提取数据的方法。通过明智地使用这些数据，可以快速确定网络环境、标准软件版本和其他对于确定下一阶段渗透测试中应该关注的目标至关重要的信息。
- en: Enumeration avoidance techniques
  id: totrans-349
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 枚举避免技术
- en: As seen in the content of this chapter, an attacker can gain a lot of critical
    infrastructure information by using freely available tools and techniques. As
    penetration testers we cannot simply focus on the attacking of the network, we
    must also understand the mitigating controls sufficiently to be able to offer
    advice and guidance to our customers. There are several methods that can be used
    by a corporation that will make it more difficult for an attacker to gain the
    information necessary to make a stealthy, successful attack on the customer's
    assets.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 正如本章内容所示，攻击者可以利用免费提供的工具和技术获得大量关键基础设施信息。作为渗透测试人员，我们不能仅仅专注于攻击网络，我们还必须充分了解足以提供建议和指导给我们的客户的缓解控制措施。公司可以使用几种方法，使攻击者更难以获取必要的信息，以便对客户的资产进行隐蔽、成功的攻击。
- en: Naming conventions
  id: totrans-351
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 命名约定
- en: 'Administrators should be encouraged to use naming schemes that do not give
    away information about the devices. For instance, if you were to use your Nmap-Fu
    or DNS-Fu to pull the hostnames and find that the machines are labeled as follows:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员应该被鼓励使用不透露有关设备信息的命名方案。例如，如果您使用您的Nmap-Fu或DNS-Fu来提取主机名，并发现机器被标记如下：
- en: '`dns1.example.com`'
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dns1.example.com`'
- en: '`mail.example.com`'
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mail.example.com`'
- en: '`domainserver`'
  id: totrans-355
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`domainserver`'
- en: '`devserver`'
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`devserver`'
- en: '`administratorspivotpoint`'
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理员枢纽点
- en: '`rogueWAP`'
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流氓WAP
- en: This would instantly give you an idea of which systems you would want to target
    first. A better method of naming could be along the lines of some tokenization
    such as ST1 = DNS server, or that all development servers have 71 as part of the
    name. This would make things more difficult to understand for an intruder, and
    at the same time would allow a valid administrator to quickly identify assets
    for what they are.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 这将立即让您了解您想要首先定位的系统。更好的命名方法可能是一些标记化，比如ST1 = DNS服务器，或者所有开发服务器的名称中都包含71。这将使入侵者更难理解，同时也允许有效的管理员快速识别资产的用途。
- en: Port knocking
  id: totrans-360
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 端口敲击
- en: Frequently, administrators can chose to use **port knocking** to avoid port
    enumeration attempts. The concept can be as simple as requiring someone to connect
    to a secret port prior to connecting to a valid management port such as SSH.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 经常情况下，管理员可以选择使用**端口敲击**来避免端口枚举尝试。这个概念可以很简单，就是要求某人在连接到有效的管理端口（如SSH）之前，先连接到一个秘密端口。
- en: A more advanced usage of port knocking would be to set up a telnet server and
    have your host-based firewall fire off rules that temporarily block an IP from
    connecting to any port on the system once it touches the telnet port.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 更高级的端口敲击用法是设置一个telnet服务器，并让基于主机的防火墙触发规则，暂时阻止IP连接到系统上的任何端口，一旦它触及telnet端口。
- en: Intrusion detection and avoidance systems
  id: totrans-363
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 入侵检测和规避系统
- en: Although these do not provide the perfect security that vendors often claim,
    a properly configured Intrusion Detection System (host-based OR network-based)
    can make a big difference in detecting enumeration attempts. These devices should
    be used as part of the corporation's defense in depth strategy and should be properly
    managed, monitored, and updated to provide the most benefit to the security posture
    of the corporation in question.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这些并不能提供供应商经常声称的完美安全性，但正确配置的入侵检测系统（基于主机或基于网络）可以在检测枚举尝试方面产生重大影响。这些设备应该作为公司深度防御策略的一部分，并且应该得到适当的管理、监控和更新，以提供对公司安全状况最大的益处。
- en: Trigger points
  id: totrans-365
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 触发点
- en: Strategically placed systems that issue alerts when accessed can be used as
    an early warning system similar to using a perimeter motion detector in physical
    security. An administrator can set up a system on a segment that automatically
    sends alerts or initiates certain actions when devious connection attempts are
    made.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 策略性地放置系统，当被访问时发出警报，可以用作类似于在物理安全中使用周界运动探测器的早期警报系统。管理员可以在一个段上设置一个系统，当进行恶意连接尝试时自动发送警报或启动某些操作。
- en: Administrators should avoid trying to "sweeten the deal" by opening up as many
    ports as possible on this system, as this may give away the purpose of the system.
    One item of note is that if such systems are used in the environment, it is critical
    that they are maintained with the same diligence as other systems on the network.
    Having an unpatched system on your network would definitely make an inviting target
    for an attacker; however, giving said attacker a quick method of gaining a foothold
    within your network is NOT a good idea. Once a pivot point has been established
    the attacker's job is much easier, and by the time you can respond to your trigger
    point alerts, the attacker may have already set up backdoors into your network
    on other systems.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员应避免试图通过在系统上尽可能开放更多的端口来“增加吸引力”，因为这可能会泄露系统的用途。需要注意的一点是，如果在环境中使用这样的系统，就必须像网络上的其他系统一样保持同样的勤勉。在您的网络上有一个未打补丁的系统肯定会成为攻击者的目标；然而，给攻击者一个快速获得网络内立足点的方法绝对不是一个好主意。一旦建立了一个枢纽点，攻击者的工作就变得更容易了，而在您能够对触发点警报做出反应的时候，攻击者可能已经在其他系统上为您的网络设置了后门。
- en: SNMP lockdown
  id: totrans-368
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SNMP锁定
- en: Ensure that the administrators use SNMP in a secured manner. As previously demonstrated,
    SNMP can be used to gain a wealth of knowledge and in the hands of an attacker,
    this would basically become the end game. SNMP should be using the latest security
    mechanisms available such as encryption. Use the latest version of SNMP that is
    available if you have vetted it to be secure. It should also be locked down and
    restricted to only be accessible to certain hosts. Most important is that the
    public community should be removed.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 确保管理员以安全的方式使用SNMP。如前所示，SNMP可以被用来获取大量的信息，在攻击者手中，这基本上就成了终极目标。SNMP应该使用最新的可用安全机制，如加密。如果您已经验证了安全性，应该使用最新版本的SNMP。它还应该被锁定并限制只能被某些主机访问。最重要的是，公共社区应该被移除。
- en: Note
  id: totrans-370
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: There may be times that your clients are unable to use the latest versions of
    SNMP for various reasons. In these cases attempt to secure the protocol as much
    as possible. For example, you could advise they lock SNMP down to specific hosts.
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，由于各种原因，您的客户可能无法使用最新版本的SNMP。在这种情况下，尽量保护协议的安全性。例如，您可以建议他们将SNMP锁定到特定主机。
- en: Summary
  id: totrans-372
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: At this point we have discussed several methods necessary to enumerate a network.
    We have created an additional machine to add to our virtual lab so that we can
    test these methods and gain the experience necessary to perform these actions
    on live networks.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经讨论了枚举网络所需的几种方法。我们创建了一个额外的机器，加入到我们的虚拟实验室中，以便我们可以测试这些方法，并获得在实际网络上执行这些操作所需的经验。
- en: You should have a good understanding of the tools and techniques available to
    you such as onesixtyone for SNMP brute forcing, or Nmap for network scanning.
    With the power of PBNJ data we determined that it is simple to get a baseline
    of the network in MySQL format, and then use that data to quickly select the right
    targets for the next stage of our penetration testing.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该对可用的工具和技术有很好的了解，比如用于SNMP暴力破解的onesixtyone，或用于网络扫描的Nmap。通过PBNJ数据的力量，我们确定了以MySQL格式获取网络基线的简单方法，然后使用这些数据快速选择下一阶段渗透测试的正确目标。
- en: In the next chapter, we will dive into the topic of exploitation. You will be
    introduced to compiling or rewriting proof of concept (POC) exploit code from
    the Web, using Metasploit, cracking passwords, and manual exploitation of remote
    vulnerabilities.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将深入探讨利用的主题。您将学习从网络上编译或重写概念验证（POC）利用代码，使用Metasploit，破解密码，以及手动利用远程漏洞。
