# 第一章：高级基础设施渗透测试简介

安全是所有规模、所有行业的企业和组织的关键关注点。信息安全是一套流程、工具、政策和系统，用于保护免受可能损害或破坏信息资产的内部和外部威胁。本书是实践性的，旨在带领您掌握真实世界的技术，使您能够获得所需和高度需求的技能，从而进入新的渗透测试职业水平。每一章都设计得不仅让您学习模拟黑客攻击的方法、工具和技术，还让您拥有新的思维方式。在本章中，您将介绍最新的渗透测试策略和技术。它将详细介绍每个必要的步骤，以进行高效的渗透测试，并且能够基于行业公认的指标评估渗透测试报告。完成本章后，您将具备交付高标准和良好文档化的渗透测试报告的技能，通过练习收集任何目标信息的技术，甚至在深网中，超越自动化工具。

# 信息安全概述

在深入渗透测试之前，让我们先了解一些信息安全中的重要术语。信息安全的核心原则是机密性、可用性和完整性。这些原则构成了我们所谓的 CIA 三角。

# 机密性

机密性断言所有信息和数据只能被授权访问的人员访问。确保信息不会被未经授权的人披露是非常重要的。**个人可识别信息**（**PII**）的盗窃是机密性攻击的一个例子。

# 完整性

完整性的目标是保护信息免受未经授权的修改；换句话说，数据的可信度。这意味着在每个信息处理过程中，数据必须保持一致、准确和可信。必须采取一些保护方法来检测数据的任何变化。

# 可用性

可用性旨在确保信息在需要时由授权用户可用。**拒绝服务**（**DoS**）是可用性攻击的一个例子。高可用性集群和备份副本是用于对抗可用性攻击的一些缓解系统。

目前有许多信息安全定义。前面的定义是基于 ISO/IEC 27001 信息安全管理标准的。

# 最小权限和需要知道

*最小权限和需要知道*描述了授权用户在工作期间应被授予的最小访问和授权量。*需要知道*意味着用户必须有合法理由访问信息。

# 深度防御

深度防御，或分层安全，是一种使用多层安全线和控制的安全方法，一个*深度防御*方法的例子是使用来自不同供应商的多个防火墙来提高系统的安全性。

# 风险分析

信息安全专业人员的主要角色是评估企业资产（需要保护的资源）的风险，并实施安全控制以防范这些风险。分析风险是非常重要的技能，因为良好的判断力将使我们选择最佳的安全控制和保护机制，包括部署这些保障所需的财务资源。换句话说，一个错误的决定将会给企业带来巨额损失，甚至更糟糕的是客户数据的丢失。如果不了解威胁和漏洞，我们无法以定量方式计算风险。威胁是对我们的资产构成潜在危险的可能危险。漏洞是允许威胁采取负面行动的弱点。这两个术语及其之间的联系由公式`风险=威胁*漏洞`描述。

为了评估威胁和漏洞，您需要在一到五的范围内分配一个数字，例如。也可以使用另一个范围。有时，我们可以添加另一个名为影响的因素，它描述了造成的损害的影响。在其他情况下，它被表达为描述该影响成本的金额，因此公式可以表达为`风险=威胁*漏洞*影响`。

为了进行定性和定量风险分析，我们可以使用**澳大利亚/新西兰 4360 标准**（**AS/NZS 4360**）上的风险分析矩阵。

信息安全专业人员需要根据两个指标对风险进行分类：发生频率和事故严重程度。这种分类的结果将决定下一步的行动计划。因此，如果风险很高，他们必须通知高级管理人员。下一步是制定一项路线图，尽可能将每个风险降低到最低，如下所示：

![](img/00005.jpeg)

# 信息保障

**信息保障**（**IA**）指的是保证信息的机密性、完整性和可用性，并确保在信息处理的不同阶段中所有系统都受到保护。政策、指南、确定资源需求、确定漏洞和培训都是信息保障的形式。

# 信息安全管理计划

信息安全管理计划的主要目标是确保企业在降低风险的环境中运营。这意味着在整个过程中组织和运营方之间进行协作。**信息安全管理框架**（**ISMF**）是一个以业务为驱动的框架（政策、程序、标准和指南），它帮助信息安全专业人员建立良好的安全水平。

# 黑客概念和阶段

黑客指的是未经授权访问系统以披露数据，在信息系统中利用漏洞。在本节中，我们将讨论黑客类型和黑客阶段。

# 黑客类型

我们可以根据黑客的意图将其分类。如果黑客的目的是损害或窃取信息，那么他们被归类为**黑帽黑客**。如果是安全专业人员的目标是保护系统的安全，那么他们被归类为**白帽黑客**。描述如下：

+   **黑帽黑客**：这些是利用其计算机技能以恶意技术获取信息的个人或团体，出于各种原因，例如经济利益。

+   **白帽黑客**：这些是信息安全专业人员。他们的主要角色是保护信息系统免受黑帽黑客的攻击。

+   **灰帽黑客**：这些人既进行攻击又进行防御。

+   **脚本小子**：通常是使用工具和脚本的技术不熟练的个人，不知道它们是如何工作的。

+   **黑客活动分子**：这些是具有政治议程或捍卫某一事业的黑客。

# 黑客攻击阶段

要使黑客攻击成功，操作必须遵循一系列阶段。

# 侦察

在这第一阶段，在采取任何行动之前，攻击者必须通过对目标进行信息收集来做好准备。攻击者从多个来源收集每一条公开可用的敏感信息，如目标客户、员工和网络信息。在此阶段结束时，黑客将清楚地了解网络（域名、IP 范围、TCP/UDP 服务和认证机制）、系统（用户/组名称、系统横幅和系统架构）和组织信息（员工详细信息、新闻发布和位置）。侦察或足迹留下有两种类型。

# 被动侦察

被动侦察涉及在不直接与目标交互的情况下获取有关目标的信息，例如搜索公共信息。

# 主动侦察

主动侦察涉及与目标的互动，例如，致电技术支持以获取一些敏感信息。

侦察不仅仅是技术性的，它也是竞争情报的重要武器。了解目标的一些财务方面可能意味着攻击成功。

# 扫描

在收集了大量关于目标的信息后，黑客必须对其进行扫描，以揭示有关系统的有用信息，并将此信息用于下一阶段（*获取访问权限*阶段）。在此过程中，黑客将寻找不同类型的信息，并为此使用不同类型的扫描。

# 端口扫描

端口扫描是向目标发送数据包的过程，旨在通过已知端口号了解更多信息。端口扫描分为两类：TCP 扫描和 UDP 扫描。建议使用 Nmap 进行端口扫描，它是一个开源端口扫描器和网络探测工具。

# 网络扫描

网络扫描描述了定位网络上所有活动主机的过程。扫描一系列 IP 地址是一种网络扫描。发现活动主机的基本技术是 ping 扫描。它简单地向一系列 IP 地址的多个主机发送 ICMP 回显请求。`Hping2`是一个用于 TCP/IP 协议的简单命令行网络扫描器。

# 漏洞扫描

在此子阶段，攻击者试图识别目标的弱点。这种类型扫描的主要目的是找到潜在的系统利用方式。有各种漏洞扫描工具，如 Nessus、Nexpose 和许多其他扫描器。

# 获取访问权限

在此阶段，攻击者已经具备发动攻击所需的一切，包括 IP 范围、已识别的系统、服务、用户列表、安全漏洞和流量。现在他们只需要绕过安全控制来获取系统访问权限，使用多种技术，如破解密码、社会工程或权限提升，并获取其他用户权限。

# 保持访问

大多数情况下，黑客攻击的目的不仅仅是通过未经授权的访问获取信息，还包括保持这种访问。每天，攻击者都在想出新的方法来保持访问。最著名的技术是隐藏文件，以避免被系统所有者和用户发现。

# 清除痕迹

每次成功的黑客攻击的最后阶段是清除痕迹。在获取访问权限并滥用网络后，黑客必须清除痕迹以避免被追踪和抓捕。为此，黑客清除与攻击相关的所有日志和恶意软件。在此阶段，黑客将禁用审计并清除和操纵日志。黑客攻击的阶段顺序如下：

![](img/00006.jpeg)

# 渗透测试概述

根据定义，渗透测试是模拟外部和内部攻击。渗透测试的主要目标是增强组织的安全位置。

# 渗透测试类型

渗透测试分为三类：

+   白盒渗透测试

+   黑盒渗透测试

+   灰盒渗透测试

# 白盒渗透测试

在白盒渗透测试期间，或者有时被称为完全知识测试，组织会给渗透测试人员所有必要的信息。当组织希望对其安全性进行全面审计并最大化测试时间时，会使用这种类型的渗透测试。可以在任何时候进行以检查其安全位置。在进行渗透测试之前提供的信息可能包括但不限于以下内容：

+   **网络信息**：网络拓扑和图表，IP 地址，入侵检测系统，防火墙和访问信息

+   **基础设施**：渗透测试人员可以获得硬件和软件信息

+   **政策**：这非常重要，因为每个渗透测试人员都必须确保渗透测试方法与组织的政策一致

+   当前安全状态，包括以前的渗透测试报告

# 黑盒渗透测试

在黑盒渗透测试会话中，渗透测试人员模拟真实世界的攻击以获取对系统或 IT 基础设施的访问权限。因此，他选择了一种没有关于组织的信息和基础设施的先验知识的渗透测试方法。这种类型的渗透测试非常有效，因为渗透测试人员戴着黑帽子，并使用黑帽骇客的技术来绕过组织的安全防护。它是从黑帽骇客的角度进行的。因此，他们使用指纹识别技术来发现有关组织的一切。

# 灰盒渗透测试

灰盒渗透测试涉及模拟内部人员的攻击。渗透测试人员只能获得部分和有限的信息，就像普通用户一样。这种测试介于黑盒和白盒渗透测试之间。

# 渗透测试团队

红队评估和蓝队评估是受军事战略启发的两个概念。

# 红队

红队的角色很明确。他们通常有一个特定的任务，即测试组织的物理和数字安全的当前状态。红队的成员具有攻击性的心态。他们试图攻击特定的区域。

# 蓝队评估

蓝队是防御层。他们的任务是防御红队的攻击。一般来说，他们是内部安全团队。

# 紫队

为了确保有效的渗透测试，创建了一个名为紫队的新团队。这个团队有一种有效的方法，可以使红队和蓝队之间的沟通更清晰，如下图所示：

![](img/00007.gif)

渗透测试和红队评估之间存在区别。红队评估类似于渗透测试，但其范围更大，在红队评估任务中，目的不是发现所有的漏洞，而是找到能让他们实现目标的正确漏洞

# 渗透测试标准和指导方针

在深入研究渗透测试标准和指南之前，我们需要定义一些重要的术语，以避免对四个不同术语：政策、标准、程序和指导方针产生任何混淆或误解。所有这些术语在信息安全管理中都起着重要作用，但清楚理解它们之间的区别对于避免错误使用它们是至关重要的。

# 政策

政策是高级管理层成员编写的文件，指定组织中每个个人的责任和所需行为。一般来说，政策很简短，不指定操作系统和供应商等技术方面。如果组织很大，政策可以分为子政策。其中一个知名的信息安全政策是 COBIT 5 信息安全政策集，如下所示：

！[](img/00008.gif)

# 标准

标准是组织如何执行政策的低级描述。换句话说，它们用于维护最低有效网络安全水平。它们也是强制性的。

# 程序

程序是详细文件，描述了特定任务中所需的每个步骤，比如创建新用户或重置密码。每个步骤都是强制性的。这些程序必须与组织的政策保持一致。

# 指导

指导或指南是一组来自实践经验丰富的人和机构的推荐提示和有用建议。渗透测试人员遵循许多标准和指南。以下是一些知名的标准或指南，以及每个标准或指南所需的步骤。

# 开放源安全测试方法手册

开放源安全测试方法手册（OSSTMM）是由 Pete Herzog 发布的一份全面文件，并由安全和开放方法学院（ISECOM）分发。根据 OSSTMM，每次渗透测试都应包括信息、流程、互联网技术（端口扫描、防火墙等）、通信、无线和物理环境的安全测试。

# 信息系统安全评估框架

信息系统安全评估框架（ISSAF）是一种方法，渗透测试人员在模仿黑客步骤的同时进行一些额外的阶段。它经历以下阶段：

+   信息收集

+   网络映射

+   漏洞识别

+   渗透

+   获取访问权限和特权升级

+   进一步列举

+   妥协远程用户/站点

+   保持访问

+   覆盖踪迹

# 渗透测试执行标准

渗透测试执行标准（PTES）是一组技术部分。它通过以下七个部分帮助渗透测试人员提供有效的渗透测试报告：

+   前期互动

+   情报收集

+   威胁建模

+   漏洞分析

+   利用

+   后期利用

+   报告

# 支付卡行业数据安全标准

支付卡行业数据安全标准（PCI DSS）是计划与主要信用卡品牌合作的组织的重要参考。它于 2014 年发布。它用于确保信用卡持有人数据的安全，并避免欺诈。合规性每年由 PCI 安全标准委员会提供的合格安全评估员进行，或者对于小数据量情况，由内部进行。PCI DSS 经历以下四个阶段：

+   前期参与

+   参与：渗透测试

+   后期参与

+   报告和文档

# 渗透测试步骤

渗透测试基本上经历了多个步骤，根据所选择的方法论。在我们的情况下，我们将根据 PTES 研究每个阶段。

# 前期参与

在进行渗透测试之前，渗透测试人员和客户之间应该建立预先交流。这是一个非常重要的阶段，因为你可以将渗透测试视为一个信息技术项目。像任何 IT 项目一样，它需要很强的规划能力。渗透测试不是一系列技术步骤，而是需要许多管理和组织技能。有效的渗透测试将从与客户的会议开始，以充分了解他们所有的需求和愿景。作为会议的结果，将制定一个测试计划。它将详细描述渗透测试的进行方式。在预先交流阶段需要注意许多重要的事项。

# 目标和范围

它详细说明了渗透测试的目标，包括范围（IP 地址和主机）。一般来说，它还包括要测试的资产和禁止测试的内容。预先交流还必须包括渗透测试任务的时间段。

# 脱离监狱卡

黑客行为是非法的，所以你需要确保所有的工作都是合法进行的。通常由高级经理签署的“脱离监狱卡”就足以让你摆脱麻烦。这里的“卡”是双方之间应该解决法律问题的合同。

# 紧急联系信息

为了避免在发现严重问题时出现恐慌情况，预先定义的联系信息列表是一个很好的主意，可以确保在需要时有一个快速有效的沟通渠道。例如，如果由于密集的自动化工具而出现了网络流量过大的问题，你需要联系网络工程师。

为了避免这种不便，最好在进行渗透测试之前与利益相关者讨论在这种情况下的支持可用性。

# 付款信息

付款信息指示了渗透测试的付款条款。在讨论测试的时间表时，渗透测试人员还应该讨论付款安排。在谈判过程中，可以讨论付款结构，例如在交付最终报告后付款，进行渗透测试之前预付一半金额，或者根据付款计划进行付款。协议中也可以添加非付款惩罚。

# 保密协议

签署**保密协议**（NDA）的目的是让渗透测试人员承诺保护所有机密信息和发现。在渗透测试期间，你将接触到不同分类等级的一定数量的数据。因此，签署文件以向高层管理层保证所有收集到的信息都是受保护的是明智的决定。

# 情报收集

情报收集阶段是指渗透测试人员从公共来源搜索有关组织的所有可用信息的阶段。在这个阶段结束时，他将清楚地了解网络（域名、IP 范围、TCP/UDP 服务和认证机制）、系统（用户/组名称、系统横幅和系统架构）以及组织信息（员工详细信息、新闻发布和位置）。这取决于渗透测试的类型（黑盒、白盒或灰盒）。实施良好的情报收集方法将有助于后续步骤的工作。

情报收集的燃料是从不同来源获取公开可用的信息。情报收集对于信息安全和渗透测试并不重要，但对于国家安全至关重要，许多概念受到军事战略的启发，在网络安全领域，情报收集也受到战场的启发。但在渗透测试的情境中，这个阶段的所有技术都应该是合法的，因为良好的意图并不意味着违法，这就是为什么我们说**公开**可用的信息。如果不是，这种情况将被视为工业间谍行为。根据国际贸易委员会的估计，由于企业间谍活动，美国工业每年的损失超过 700 亿美元。

情报收集不仅有助于提高组织的安全地位，而且使管理者对竞争有了更清晰的认识，并导致更好的商业决策。基本上，每个情报收集操作都是按照结构化的方法进行的。

# 公开情报

公开情报是收集有关目标的所有可能信息的过程，使用公开可用的来源，不仅搜索，还归档。这个术语通常被政府机构用于国家安全行动。渗透测试人员也应该采用这种思维方式，并获得收集和分类信息所需的技能。在大量数据的时代，从中提取有用信息的能力是必不可少的。

# 社会工程攻击

社会工程攻击是指员工或其他人在心理上被欺骗以提供敏感信息。社会工程是操纵人们以获取有关用户的信息，以确定敏感信息，如登录凭据或机密信息的艺术。以一种欺骗性的方式利用人类的信任等人类品质总是表明人类是信息安全中最薄弱的层面。社会工程技术之一是网络钓鱼，这是社会工程的一种技术方法。众所周知，网络钓鱼是发送一封看似来自合法机构的电子邮件或短信，诱使用户输入其登录凭据。针对性网络钓鱼是相同的技术，但范围更具体，例如向高调联系人的短名单发送网络钓鱼邮件

# 物理分析

在信息安全领域，物理安全非常关键。识别物理设备在情报收集中起着重要作用。

# 信息系统和网络分析

这种技术搜索有关目标的信息，包括网络服务、设备、域和信息系统信息。

有许多情报收集类别：人类情报、信号情报、公开情报、图像情报和地理空间情报。

# 人类情报

**人类情报**（**HUMINT**）是收集有关人类目标的信息的过程，无论是否与他们互动，都使用许多技术，如拍照和录像。人类情报有三种模式：

+   **定向收集**：这是一个特定的定位操作。通常，所有资源都旨在收集有关唯一目标的信息

+   **主动情报收集**：这个过程更具体，需要更少的投资，针对特定环境。

+   **被动情报收集**：这是**人类**情报的基础。信息是通过机会方式收集的，如通过走访或推荐。因此，除了收集信息并试图找到一些东西外，没有特定的目标。

![](img/00009.jpeg)

# 信号情报

**信号情报**（**SIGINT**）是通过拦截电子信号和通信来收集信息的操作。它可以分为两个子类别：**通信情报**（**COMINT**）和**电子情报**（**ELINT**）。

# 开源情报

**开源情报**（**OSINT**），顾名思义，涉及使用在线可用的来源查找有关特定目标的信息。可以使用许多技术来完成：

+   在许多搜索引擎中进行搜索查询

+   从社交媒体网络中获取信息

+   在*深网*目录和隐藏维基中进行搜索

+   使用论坛和讨论板

例如，如果你想搜索特定的员工，你可以使用 theHarvester 工具，它将帮助找到关于这个人的所有公开信息。

你可以从 GitHub 仓库中获取 theHarvester，使用你的控制台输入以下命令：

```
git clone https://github.com/laramies/theHarvester 
```

然后，输入`./theHarvester`来运行脚本。

例如，如果你想使用 Google 搜索收集关于`targetwebsite`的信息，只需运行以下命令：

```
theharvester -d   targetwebsite.org  -l 100 -b google 
```

这里，`-l`选项是结果的有限数量，`-b`表示搜索引擎。在我们的情况下，我们使用了 Google 搜索引擎：

![](img/00010.jpeg)

你知道已知的网络只占互联网的 4%。还有另一个空间叫做**深网**。它包含 7500 太字节的信息，意味着超过 5000 亿页。

从隐藏网络中收集信息是一个优势，不仅用于侦察目的，还用于竞争情报。要访问深网，你只需从其官方网站[`www.torproject.org/`](https://www.torproject.org/)下载 Tor 浏览器并安装它。打开浏览器，点击连接以访问网络：

![](img/00011.jpeg)

现在，你正在浏览*隐藏的网络*。你可以使用隐藏维基上的 Tor 网站，从这个链接[`wiki5kauuihowqi5.onion`](http://wiki5kauuihowqi5.onion)（它们表示为`DomainName.onion`），或者简单地使用 DuckDuckGo 搜索引擎：

![](img/00012.jpeg)

不仅可以搜索个人可识别信息，还可以搜索在线设备甚至工业控制系统。例如，你可以检查[www.shodan.io.](http://www.shodan.io) 这个搜索引擎将帮助你找到在线设备。以下截图是通过[Shodan.io](https://shodan.io/)搜索到的关于风力涡轮机的公开信息：

![](img/00013.jpeg)

为了发现 Shodan 搜索引擎的巨大潜力，让我们来一窥这个巨人的力量。首先，去[www.shodan.io](http://www.shodan.io)创建一个新账户：

![](img/00014.jpeg)

使用搜索栏输入搜索查询，或者你可以简单地点击预定义的类别：Netcams、默认密码、dreambox、工业控制系统等。这是最受欢迎的搜索标签的一部分：

![](img/00015.jpeg)

让我们以 Netcams 为例进行演示。根据以下截图，搜索引擎至少找到了 8632 个公开可用的 Netcam 信息源，包括它们的 IP 地址和关于它们的详细描述：

![](img/00016.jpeg)

此外，你可以使用实时地图来搜索在线设备，比如路由器：

![](img/00017.jpeg)

# 图像情报

在战场上，**图像情报**（**IMINT**）是分析来自不同来源和设备的图像和视频的过程，比如电子显示图像和红外摄像头。在渗透测试中，图像情报也是以同样的方式工作，它是使用来自不同公共资源的不同照片和视频来识别有关目标的信息的操作：

+   社交媒体（Facebook、LinkedIn 等）视频

+   为其他版本反向搜索照片

+   直播流

有许多图像分析工具可以用来从图像中提取数据。其中之一是 ExifTool。它是一个小工具，用于提取有关指定图像的有趣信息。就像下面的图表一样，只需从此链接下载 ExifTool，[`www.sno.phy.queensu.ca/~phil/exiftool/`](https://www.sno.phy.queensu.ca/~phil/exiftool/)，然后键入`./exiftool image.png`：

![](img/00018.jpeg)

# 地理空间情报

**地理空间情报**（**GEOINT**）是利用和分析图像和地理空间信息来描述、评估和可视化指定区域。地理空间情报这个术语已经与信息安全和渗透测试联系在一起。识别和收集有关组织的信息将使渗透测试人员能够预测组织的物理入侵。因此，渗透测试人员的角色是确保数据和敏感信息免受外部威胁。

有许多可用的来源可用于检查地理空间信息。Google 地图是谷歌提供的免费地理空间服务。以下是使用 Google 地图查询的结果：

![](img/00019.jpeg)

# 威胁建模

威胁建模是一种安全方法，用于识别针对组织基础设施的威胁。在信息安全领域，建模和量化总是明智的决定，特别是在渗透测试中。以真实的方式衡量威胁将有助于渗透测试人员做出良好的决策。这种结构化方法的目标是使用与组织业务需求一致的方法，识别和排名威胁和资产，然后对其进行映射。

为了进行有效的威胁建模，渗透测试人员需要经历五个分析步骤。

# 业务资产分析

在业务资产分析期间，渗透测试人员通过收集与资产相关的任何文件，并在其他情况下，在组织内进行采访来聚焦资产。这可能包括以下信息：

+   基础设施设计

+   系统配置

+   用户帐户凭据

+   特权用户帐户凭据

有关技术资产的信息不足以获得有效的建模。渗透测试人员应收集有关组织的所有政策和程序的信息，有时还需要组织计划。

# 业务流程分析

业务是信息安全的中心。明智的信息安全分析肯定会确保组织以适当的方式运作并产生收入。与业务流程有关的所有资产都需要被映射和分析，从最关键的资产开始。以下是资产：

+   信息资产

+   人力资产

+   第三方资产

# 威胁代理分析

在这种类型的分析中，基于位置度量的所有威胁都被映射。我们可以将威胁分为两类——内部和外部威胁。组织的员工，包括高层管理人员，也是这一分类的一部分，因为在信息安全方面，人类是最薄弱的层。

# 威胁能力分析

在对威胁代理有清晰的理解之后，现在是时候检查是否有任何可用的工具、利用和当前可能用于针对组织基础设施的通信机制的有效载荷。

# 动机建模

渗透测试人员可以对攻击背后的动机进行建模。在竞争激烈的环境和不稳定的业务中，动机建模应该被添加到渗透测试人员的检查表中。

# 漏洞分析

威胁对人们和组织来说是一个严重的问题。对漏洞分析有清晰的理解对于确保采取明智的管理决策并建立安全环境至关重要，以正确识别和减轻潜在威胁。不幸的是，这对信息专业人员来说仍然是一个具有挑战性的领域，因为威胁变得越来越复杂，每天都很难检测到。漏洞评估是识别、衡量和分类信息系统中的漏洞的过程。漏洞分析是每个渗透测试人员的关键技能。

在进行漏洞评估时存在一个很大的误解。许多渗透测试人员将漏洞分析与渗透测试混淆。事实上，渗透测试是模拟攻击，而漏洞评估旨在识别特定领域的漏洞。您可以将其视为扫描操作。

漏洞管理生命周期经历以下六个主要阶段：

+   **识别和发现**：在此阶段，渗透测试人员试图识别讨论范围内的所有资产，包括开放服务和操作系统，并尝试使用自动化工具和漏洞扫描程序检测信息系统中的常见潜在漏洞。

+   **优先级和分类**：渗透测试人员根据敏感性标准或类别对资产进行优先级排序。您还可以使用排名系统对漏洞进行优先级排序，例如使用**通用漏洞评分系统**（**CVSS**）评分**通用漏洞和暴露**（**CVE**）漏洞。

+   **评估**：这涉及记录分析的风险。渗透测试人员必须在评估过程后对风险接受做出决定。在进行漏洞评估时，您需要验证每个发现的漏洞。使用漏洞扫描程序检测潜在漏洞非常重要，但渗透测试人员需要验证每一个漏洞，以避免误报和错误标记。

+   **报告**：在此阶段，渗透测试人员展示了进行的漏洞评估的结果，包括问题数量和趋势，以及获得的图形表示。

+   **修复**：这是一个包括建议和修复漏洞所需的步骤的详细路线图，不仅在技术上，还可能包括预算、时间段、排名等。

+   **验证**：最后一步涉及在跟进检查后验证修复的漏洞：

![](img/00020.jpeg)

# 使用 Nexpose 进行漏洞评估

目前有许多漏洞管理工具可供选择，可以帮助渗透测试人员进行漏洞评估任务，例如 Beyond Security、Qualys、Core Security 等工具。其中最著名的漏洞管理工具之一是 Rapid7 的 Nexpose。Nexpose 评估了定义基础设施中的漏洞。

# 安装 Nexpose

您可以按照以下步骤安装 Nexpose：

+   从官方网站下载社区版，[`www.rapid7.com/products/nexpose/`](https://www.rapid7.com/products/nexpose/)

+   为了演示，我们安装了 Windows 64 版的 Nexpose。您也可以使用 Linux 版：

![](img/00021.jpeg)

+   填写所需信息并进行下一步：

![](img/00022.jpeg)

# 开始 Nexpose

要使用 Nexpose，只需转到`http://localhost:3780`并输入您的凭据。

# 开始扫描

要开始 Nexpose 扫描，打开一个项目，点击“创建”并选择站点，然后输入目标 IP 或 IP 范围开始扫描：

![](img/00023.jpeg)

扫描完成后，您可以生成扫描报告：

![](img/00024.jpeg)

# 利用

到了这个阶段，渗透测试人员已经拥有了发动攻击所需的一切。现在他只需要绕过安全控制来获得对基础设施系统的访问权限。在这个阶段，渗透测试人员戴上黑帽子，试图从恶意黑客的角度获得对基础设施的访问权限。经过良好的威胁分析，现在是利用每一个漏洞的时候了。为了利用这些漏洞，你可以使用各种自动化工具和手动测试。最著名的利用工具是 Metasploit，这是每个渗透测试人员必备的武器。

![](img/00025.jpeg)

要探索漏洞，用户可以使用`show exploits`命令。

# 后期利用

获得 root 权限并不是终点。正如之前讨论的，保持访问权限是黑客方法论中的一个重要阶段，因此后期利用不仅需要保持访问权限，还需要扩散到基础设施中，进一步威胁系统。这个阶段至关重要；渗透测试人员模拟了一次高级攻击；因此，在进行后期利用之前应该达成一致的规则。这显示并支持了第一个渗透测试阶段（前期约定）的重要性，以保护你的客户，当然也是为了保护自己。

根据渗透测试执行标准，后期利用阶段应该经过六个部分。

# 基础设施分析

网络是每个现代组织和机构的支柱。因此，基础设施分析将从识别以下内容开始：

+   在范围内的每个网络接口

+   路由信息

+   DNS 服务器和缓存的 DNS 查询

+   代理服务器

+   ARP 条目

不仅是网络信息，还有识别网络服务也是至关重要的。它们包括以下内容：

+   监听服务

+   VPN 连接

+   使用诸如思科发现协议和链路层发现协议等协议绘制邻居设备的地图

# 掠夺

根据定义，掠夺是从系统中收集所有可能的信息。比如，知道数据的位置可以帮助预测枢纽技术。为了进行有效的渗透测试，你需要收集所有，而不仅仅是以下信息：安装的软件和服务：

+   打印机共享和安全服务

+   数据库服务器

+   目录服务器

+   证书颁发机构服务

+   代码管理服务器

+   虚拟化服务

大多数这些服务的利用将在接下来的章节中详细讨论。

# 高级别目标

从黑客的角度来看，高级别的目标非常令人向往。作为渗透测试人员，你的工作是把他们列为首要目标，因为攻击高级别可能会导致业务部门的受损。不要忘记，好奇心和挑战精神是黑客的动机。这就是为什么 C 级别的人物成为高度被攻击的目标。

# 数据外泄

在数据外泄期间，渗透测试人员会绘制所有外泄路径。这一步的目的是确保没有数据以隐秘的方式离开组织。分析数据流是至关重要的，因为数据是黑客关注的中心。

# 持久性

后门和 meterpreter 是确保持久性的常见技术，即使在系统重新启动后也是如此。此外，创建具有复杂密码的新帐户将为你赢得一些存在时间。

# 进一步渗透基础设施

好奇心是一把双刃剑。它是我们作为人类的一部分。对于一个饥饿的黑客来说，持续的攻击还不够。因此，渗透测试人员将寻找进一步的技术来威胁更多的系统和基础设施，以获得更多的访问权限。其中一些技术包括：

+   Ping 扫描

+   内部 DNS 枚举

+   安装上传程序

+   服务枚举

+   端口转发

+   VPN 到内部网络的枢纽

# 清理

最后，渗透测试人员必须清理受损系统中使用的脚本、二进制文件、新帐户和配置，这是在先前的后渗透步骤中进行的。

# 报告

渗透测试的最后阶段是报告。这是一个可交付的文件，包括渗透测试任务期间进行的所有发现和过程。这一步非常重要，有很多原因。渗透测试人员需要编写一份清晰的报告，以便每个细节都可以在另一个时间重新测试。此外，它应该能够被管理层理解。每份报告都必须对技术和非技术方面都非常清晰和有意义。为了为不同类型的人获得良好的渗透测试报告，它应包含以下部分。

# 执行摘要

本节对发现进行了高层次的概述，并指定了渗透测试的主要目标。本节的目标受众是高层管理人员，因为他们更关心组织的安全，而不是技术细节。这就是为什么在执行摘要中不建议提及发现的技术规格。执行摘要包括以下内容：

+   **背景**解释了渗透测试的目的，并解释了一些技术术语，如果需要的话，供高层管理人员参考。高层管理人员在阅读背景后，将对渗透测试的目标和预期结果有清晰的了解。

+   **整体位置**，涉及测试的有效性，通过突出一些安全问题，例如根据 PTES 标准，企业缺乏有效的补丁管理流程。

+   **风险评分**是基于预定义评分系统在预先参与阶段的风险排名的概述。通常，我们使用高/低评分指标或数字刻度。

+   **建议摘要**指定了解决前述安全问题所需的步骤和方法。

+   **战略路线图**指示了一个基于有序目标的详细的短期到长期的路线图，以增强组织的安全性。

# 技术报告

本节是为技术经理和信息技术人员准备的。它包括有关所有已执行步骤和操作的详细信息。它的结构如下：

+   介绍

+   信息收集

+   漏洞评估

+   漏洞确认

+   后渗透

+   风险/暴露

+   总结以对测试进行最终概述

# 渗透测试的限制和挑战

渗透测试在信息安全领域面临许多挑战。渗透测试的有限范围和时间空间限制使其成为一项艰巨的任务，特别是在生产环境中工作时。与客户缺乏沟通可能会使其变得更加困难。在进行渗透测试时可能会出现一些常见的问题和挑战：

+   渗透测试的时间限制

+   在渗透测试期间，无法覆盖所有的漏洞和威胁

+   受限区域的存在

+   由于大量扫描和自动化工具导致的突发和意外的技术事件

在进行渗透测试时，范围模糊可能会成为一个问题。因此，尽量在一个方便的范围内工作。

# 渗透测试的成熟度和评分模型

像任何系统方法论一样，渗透测试需要评估，以提供关于所用方法的可靠性的有用见解。一个设计良好的渗透测试方法和良好的评估策略应该基于量化的批准标准，以快速确定测试的深度和质量。行业领袖们都知道所有众所周知的渗透测试方法，但由于一些理解上的困难，许多公司正在使用自己的方法。有效的渗透测试计划确保了您的渗透测试计划的目标得到了满足，而不会产生误解、误解或虚假期望。成熟度模型需要确保渗透测试方法满足组织的需求；您可以为您的组织需求构建最合适的成熟度模型。您可以受到 voodoo security 制作的渗透测试模型的启发。它旨在给出这样的模型的一个想法。

渗透测试成熟度模型基于三个主要标准。每个标准有五个问题需要以是或否回答。如果是，总体得分将增加一分，否则将不增加。根据您对所有问题的回答，总体得分将定义您的渗透测试的评估。

# 现实性

这个指标用于评估渗透测试是否真实，并且它旨在模拟真实世界的攻击。以是或否回答以下问题：

+   你是否使用了黑盒方法？

+   你是否避免被检测到？

+   你使用了社会工程学吗？

+   你是否使用了外泄的数据？

+   你模拟了恶意软件吗？

# 方法论

这个指标是基于方法论本身，以及在进行渗透测试时每个步骤中使用的工具。以是或否回答以下问题：

+   所用的方法论已经存在还是定制的？

+   所有步骤都是以连贯的方式完成的吗？

+   你是否同时使用了手动和自动化工具？

+   你是否实际利用了目标？

+   是否允许枢纽？

# 报告

这个指标评估了结果报告，因为它是渗透测试中的一个重要步骤，而且是为多个受众编写的。以是或否回答以下问题：

+   你是否删除了虚假阳性？

+   您的步骤是否可重复？

+   评估的漏洞是否用于上下文风险？

+   结果是否符合业务需求？

+   补救计划是否适合组织？

根据获得的分数，您可以评估您的渗透测试，并使用以下等级划分：

+   **0-5**：低成熟度水平

+   **6-10**：中等成熟度水平

+   **11-15**：高成熟度水平

为了更好的展示，你可以使用图表：

![](img/00026.jpeg)

# 总结

在本章中，我们涵盖了不同的渗透测试方法和进行全面、高价值和可重复的渗透测试所需的步骤，以及获得评估这些方法所需的技能。此外，在下一章中，旅程将继续。您将暴露 Linux 基础架构中的弱点，不仅学习如何保护 Linux 机器，还将检测漏洞并在内核级别利用它们。
