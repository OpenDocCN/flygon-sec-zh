# 第十章：不安全的 VPN 利用

**虚拟私人网络**（**VPN**）在安全传输数据方面非常有用。VPN 可以实现信息安全，但仍然容易受到黑客的高风险。如果你想学习如何保护 VPN，本章将从密码学的基本知识开始，帮助你获得保护 VPN 所需的技能。

本章将涵盖以下主题：

+   密码学

+   VPN 基础知识

+   不安全的 VPN 利用

# 密码学

在密码学艺术中，我们有两种不同的科学：密码学和密码分析。密码学基于数学算法保护信息，而密码分析则处理密码系统创建的密文。这两种科学并存。简单来说，密码学处理隐藏信息，而密码分析则破解密码系统以揭示隐藏信息。密码学并不是一门新科学，它很古老。有一些经典的密码学技术，比如苏美尔楔形文字、埃及象形文字、斯塞塔利、维吉尼亚密码、凯撒密码和 ROT13 密码。

# 密码系统

加密技术的实施被称为密码系统；有时也被称为密码系统。以下图表描述了一个简单的密码系统。发送者使用加密算法对明文进行加密，这是一个使用加密密钥的数学过程。该操作的输出生成一个密文，接收者将使用解密算法和解密密钥对其进行解密，使密文可读为明文：

![](img/00307.jpeg)

# 密码

密码是加密的消息。密码可能会被攻击者拦截。我们有两种主要类型的密码：经典和现代。让我们逐一发现它们。

# 经典密码

这种类型存在于计算机时代之前，有以下两个分支：

+   **置换**：它使用排列。明文被重新排列成另一种格式。字符仍然相同，但位置不同。

+   **替换**：它使用字符替换，换句话说，用另一个字符替换一个字符，比如用*M*替换*O*。替换算法应该由发送者和接收者知道。ROT13 和凯撒密码是替换密码的两个例子。

ROT13 是一种替换密码，其中明文中字符的位置向后移动了 13 个位置。因此，如果明文是*HELLO*，那么密文应该是*URYYB*，如下所示：

*![](img/00308.gif)*

凯撒密码是由**朱利叶斯·凯撒**使用的替换密码，其中明文消息的每个字符都向前移动了预定义的位置数。举个例子，假设移动的数字是**2**，那么*HELLO*的密文将是*JGNNQ*，如下所示。这种密码很容易被破解，你可以尝试最多 25 次移位，直到找到可读的文本：

![](img/00309.gif)

# 现代密码

现代密码再次分为两种类型：

+   **分组密码**：这些按块处理信息。每个块将分别进行加密和解密。**数据加密标准**（**DES**）是最常用的分组密码之一，基于费斯特尔密码，由 IBM 研究员 Horst Feistel 开发，试图构建实现克劳德·香农的**替换-置换**（**S-P**）网络的理想分组密码结构。以下图表说明了费斯特尔结构：

![](img/00310.jpeg)

+   **流密码**：这些按位或按字节处理信息，在加密和解密中。例如，要加密一条消息，会使用一个与消息大小相同的种子密钥生成一个密钥流，然后进行加密。以下图表说明了两种密码类别：

![](img/00311.jpeg)

# 克尔克霍夫密码系统原则

为了检查您是否拥有一个良好和安全的加密系统，一位名为奥古斯特·克克霍夫的荷兰密码学家提出了一套用于设计安全加密系统的法律和原则。这些文章发表在 1883 年的一篇文章中，*军事密码学*。如果您想阅读完整的文本，请查看奥古斯特·克克霍夫，《军事密码学》，《军事科学杂志》，第九卷，第 5-38 页 II，军事密码学的 Desiderata，1883 年 1 月。克克霍夫的密码系统六原则如下：

![](img/00312.gif)

以下是六个原则的英文翻译：

+   加密系统在实际上应该是不可破解的，即使在数学上不可破解

+   加密系统落入入侵者手中不应导致系统的任何妥协，从而不会给用户带来任何不便

+   密钥应该易于传达、记忆和更改

+   密文应该可以通过电报传输，这是一个不安全的渠道

+   加密设备和文件应该是便携的，并且可以由一个人操作

+   最后，系统必须易于使用，既不需要精神紧张，也不需要长串规则的知识来遵守

# 加密系统类型

在加密系统方面，我们有基于加密-解密密钥的两个主要类别——对称和非对称加密系统。如果系统同时使用相同的密钥进行加密和解密，那么它将是一个对称加密系统，否则，加密系统是非对称的，因为加密中使用的密钥与解密中使用的密钥不同。

# 对称加密系统

各种类型的对称加密系统如下：

+   **数据加密标准（DES）**：这是由 IBM 开发的。它最初是 Lucifer 加密，后来由**国家标准与技术研究所**（**NIST**）发布。这种加密使用 56 位密钥：

![](img/00313.gif)

轮函数在以下工作流程中描述：

![](img/00314.gif)

密钥生成使用以下工作流程完成：

![](img/00315.gif)

初始和最终置换由两个逆置换盒（P 盒）完成：

![](img/00316.gif)

+   **三重 DES（3DES）**：这种加密是 DES 的增强版本。它使用 168 位密钥，因为用户生成三个密钥，k1、k2 和 k3。第一个密钥 k1 用于加密单个 DES。第二个密钥 k2 用于解密第一步的输出。最后一个密钥 k3 用于加密上一步的单个 DES：

![](img/00317.gif)

+   **高级加密标准（AES）**：AES 是 DES 的替代品。它更快（大约快六倍）和更强大。它使用 Rijndael 密码：

![](img/00318.jpeg)

+   **Rivest Cipher 5 (RC5)**：这是由麻省理工学院教授罗纳德·里维斯特开发的非对称加密系统。RC5 由以下三个主要组成部分组成：

+   密钥扩展算法

+   加密算法：

>![](img/00319.gif)

+   +   解密算法：

![](img/00320.gif)

RC6 是从 RC5 派生而来，块大小为 128 位，密钥大小灵活。

# 非对称加密系统

以下是非对称加密系统的算法：

+   **Rivest-Shamir-Adleman（RSA）**：RSA 是互联网上最广泛使用的加密系统之一。它是由麻省理工学院的 Ron Rivest、Adi Shamir 和 Leonard Adleman 开发的。在使用 RSA 时，将生成一对密钥，即私钥和公钥。

+   **Diffie-Hellman 密钥交换**：Diffie-Hellman 密钥交换是一种在此操作期间创建密钥而无需共享和交换信息的方法。

基本思想是这样的：

1.  1.  选择两个素数，*g*和*p*

1.  计算*ga mod p*并发送输出

1.  另一个键计算*gb mod p*并发送输出**B**

1.  计算*Ba mod p*

1.  另一个键上的相同计算*Ab mod p*

![](img/00321.jpeg)

+   **El Gamal**：El Gamal 是基于 Diffie-Hellman 密钥交换的加密系统

# 哈希函数和消息完整性

哈希函数是数学函数，它接受任意大小的输入字符串，并生成固定大小的输出，称为哈希值或消息摘要。一个好的哈希函数

应该容易计算哈希；计算给定的明文将非常困难

哈希，对于两个不同的输入，它不会生成相同的哈希，除非在罕见情况下。

![](img/00322.jpeg)

现在有许多知名的哈希函数；它们如下：

+   **散列消息认证码**

+   **消息摘要**（**MD2**）

+   **消息摘要**（**MD4**）

+   **消息摘要**（**MD5**），如果您想加密或解密明文，可以使用[`md5decrypt.net/en/`](http://md5decrypt.net/en/)如下所示：

![](img/00323.jpeg)

+   **安全哈希算法**（**SHA**）

+   **Whirlpool**

+   **HAVAL**

+   **RIPEMD**

# 数字签名

数字签名的主要目标是验证消息或文档的真实性和完整性。您可以将其视为电子指纹。以下图表显示了签署文件的步骤：

![](img/00324.jpeg)

# 隐写术

隐写术是将消息隐藏在人类可读的媒介中的艺术，如图像文件、视频、文本等。这些变化在视觉上应该是不可察觉的，以掩盖承载文件后面的消息。隐写术有两种类型：

+   文本隐写术：

+   行移编码

+   词移编码

+   特征编码

+   图像隐写术：

+   **最低有效位**（**LSB**）：在 8 位图像的每个像素中隐藏 1 位数据，在 24 位图像的每个像素中隐藏 3 位数据。您可以使用`steglsb`执行 LSB 隐写术：

![](img/00325.jpeg)

+   +   **扩频图像隐写术（SSIS）**

+   **F5 算法**

# 密钥管理

密钥管理是保护加密密钥的过程。为了确保这种保护，必须维护一个生命周期，如下所示：

+   密钥创建

+   密钥保护和监管

+   密钥轮换

+   密钥销毁

+   密钥托管

![](img/00326.gif)

# 密码攻击

为了检索信息的明文，攻击者和密码分析师使用了许多技术：

+   **穷举攻击（BFA）**：在此攻击期间，攻击者将尝试所有密钥组合以检索密钥

+   **字典攻击**：在此攻击中，攻击者使用准备好的字典并尝试其中的单词

+   **生日攻击**：在生日攻击中，攻击者使用哈希碰撞

+   **仅密文攻击（COA）**：在此攻击中，攻击者拥有密文，他只需要确定密钥

+   **已知明文攻击（KPA）**：攻击者使用我们称之为线性密码分析来从密码中检索缺失的明文，同时他知道密码的部分明文

+   **已选择明文攻击（CPA）**：攻击者在选择密文和明文后使用差分密码分析来检索密钥

+   **侧信道攻击（SCA）**：攻击者使用硬件攻击密码系统，利用功耗或 CPU 周期来利用密码系统物理实现的弱点

+   **时序攻击**：攻击者分析加密算法的计算时间

+   **功率分析攻击**：这与时序攻击相同，但攻击者分析的是功耗

+   **故障分析攻击**：攻击者研究密码系统中的错误以收集更多信息

# VPN 基础知识

当涉及信息技术时，加密在保护不同状态的信息方面发挥着重要作用。各种技术应用每天都在使用加密，如磁盘加密、电子邮件安全和通信。VPN 就是其中之一。按定义，VPN 是两个站点之间的逻辑网络。VPN 的流量是加密的。

在加密中，我们有以下两种模式：

+   **链路加密**：在这种模式下，所有信息都被加密，消息应该在每一跳中解密。在这种情况下，路由器应该解密消息，以便了解路由信息，然后再次加密并转发到下一跳。

+   **端到端加密**：在这种模式下，所需头部中的信息不被加密，因此路由器等不需要解密它们，因为路由信息是清晰的：

![](img/00327.gif)

# 隧道协议

VPN 中使用的两种技术是 SSL 和**Internet Protocol Security**（**IPSec**）。我们将详细和全面地讨论这两种技术，但现在让我们看看不同的隧道协议：

+   **点对点隧道协议**（**PPTP**）

+   **第二层隧道协议**（**L2TP**）

# IPSec

IPSec 是一种协议套件，它能够在系统之间提供安全性，我所说的安全性是指信息安全第一章中讨论的三个基本支柱之一：保密性和完整性，以及身份验证和防重放保护。IPSec 使用以下两种协议：

+   **认证头（AH）协议**：此协议用于对流量进行身份验证而不加密。使用哈希函数（MD5 或 SHA1）进行身份验证。

+   **封装安全载荷（ESP）协议**：此协议也用于身份验证，但它也支持加密。

IPSec 在以下两种不同模式下运行：

+   **隧道模式**：在这种模式下，整个数据包被封装并转发。它在 VPN 中被广泛使用。在原始 IP 头部上添加了一个新的 IP 头部。

+   **传输模式**：这种模式用于系统之间的端到端加密。AH 头部被添加到 IP 头部中：

![](img/00328.gif)

以下图示了两种不同的协议和不同的模式：

![](img/00329.gif)

# 安全套接字层/传输层安全

**安全套接字层**（**SSL**）是一种应用层协议。如果您在安全模式下使用现代浏览器，那么您的浏览器与 Web 服务器之间的连接将由 SSL 保护。更安全的 SSL 版本是**传输层安全**（**TLS**）。如果网站由 SSL 证书保护，那么在您的 URL 栏中将出现 HTTPS 标志：

![](img/00330.gif)

SLL/TLS 操作如下所示：

![](img/00331.gif)

# SSL 攻击

本节将讨论多年来发生的主要 SSL 攻击。

# DROWN 攻击（CVE-2016-0800）

DROWN 攻击是一种破解加密的技术。当攻击被发现时，他们发现超过 33%的 HTTPS 服务器是容易受攻击的。仍然支持 SSLv2 的服务器容易受到这种攻击。在 DROWN 攻击中，攻击者发送具有相同私钥的探测包来解密 TLS 通信。因此，所有信息都会暴露出来。不仅支持 SSLv2 的服务器容易受到攻击，攻击者还可以使用另一个支持 SSLv2 的服务器的私钥来发动攻击。

要测试您的服务器是否容易受到 DROWN 攻击，您可以使用[`pentest-tools.com/network-vulnerability-scanning/drown-ssl-scanner`](https://pentest-tools.com/network-vulnerability-scanning/drown-ssl-scanner)：

![](img/00332.jpeg)

为了防御 DROWN 攻击，建议您在服务器上禁用 SSLv2；确保私钥不被用于允许 SSLv2 连接的任何其他服务，并升级 OpenSSL 加密库。

# POODLE 攻击（CVE-2014-3566）

**向下兼容的遗留加密填充口令**（**POODLE**）攻击于 2014 年被发现。这种攻击利用了许多服务器一方面支持 SSLv3，另一方面存在块填充漏洞的事实。以下图示了 POODLE 攻击：

![](img/00333.gif)

通常，作为第一步，客户端发送支持的 TLS 版本。在这种情况下，攻击者拦截流量进行中间人攻击，并模拟服务器，直到连接降级为 SSLv3。如果连接建立，攻击者利用密码块链接漏洞，通过操纵填充字节执行 POODLE 攻击。

如果您想测试您的服务器是否容易受到 POODLE 攻击，您可以使用`ssl-poodle` nmap 脚本，或者简单地在线测试使用之前的网站：

![](img/00334.jpeg)

要防御 POODLE 攻击，您需要在服务器上禁用 SSLv3 并升级客户端，因为升级的客户端使用 TLS 回退**信号密码套件值**（**SCSV**）以防止协议降级攻击。

# BEAST 攻击（CVE-2011-3389）

**浏览器针对 SSL/TLS 的利用**（**BEAST**）攻击于 2011 年被发现。在 BEAST 攻击中，攻击者利用 TLS 中的密码块链接漏洞进行 CPA，通过进行中间人攻击。要防御 BEAST 攻击，升级 TLS 版本。

# CRIME 攻击（CVE-2012-4929）

在**压缩比例信息泄漏简化**（**CRIME**）攻击中，攻击者利用 TLS 压缩中的漏洞。以下图表演示了 CRIME 攻击：

![](img/00335.gif)

这种压缩基本上是可选的，用于使用 DEFLATE 算法等减少带宽。要防御此攻击，请确保您的浏览器是最新的。

# BREACH 攻击（CVE-2013-3587）

在**通过自适应压缩的浏览器侦察和泄露**（**BREACH**）攻击中，攻击者利用 HTTP 压缩。

# 心脏出血攻击

在心脏出血攻击中，攻击者利用 OpenSSL 库中的 TLS 心跳扩展。该扩展用于始终确保两个系统之间的连接是活动的。请求有效载荷由数据和其大小组成。攻击者利用这种格式迫使服务器从内存泄漏的数据中发送请求的大小：

![](img/00336.gif)

为了测试您的服务器，请尝试通常的网站：

![](img/00337.jpeg)

# Qualys SSL 实验室

要测试您的服务器是否容易受到 SSL 攻击，您可以尝试 Qualys SSL 实验室。要尝试，请访问[`ssllabs.com/`](https://ssllabs.com/):

![](img/00338.jpeg)

点击测试您的服务器并输入您的网站：

![](img/00339.jpeg)

该网站将扫描与输入的网站相关的地址：

![](img/00340.jpeg)

将生成一份报告，为您提供详细的 SSL 报告和总体评分：

>![](img/00341.jpeg)

# 总结

在本章中，您学会了如何保护 VPN。与每一章一样，我们从基础知识开始，从密码学技术到 VPN，因为对技术的各个方面有清晰的理解将使渗透测试人员更清晰地了解如何保护该技术。

在下一章中，我们将讨论交换机和路由器中可能存在的常见安全漏洞，并提供有关保持网络设备安全的建议。
