# 利用 Git 和持续集成服务器

**持续集成**（**CI**）和**持续交付**（**CD**）正在成为现代软件开发的两个重要部分。本章是一个了解如何保护 CI 服务器的绝佳机会。我们将从头开始学习软件开发方法和 CI 的构建。除了学习如何从头开始构建 CI 环境，我们还将了解如何保护 CI 和 CD 流水线需要做些什么。

# 软件开发方法论

像任何项目一样，软件项目需要经历明确定义的步骤才能得到良好的管理。为了确保高效的项目管理，软件开发项目需要一系列步骤：

1.  **需求**

1.  **设计**

1.  **实施**

1.  **验证**

1.  **维护**

步骤如下：

![](img/00177.jpeg)

根据业务需求，先前的步骤通过不同的方法进行。有许多开发方法论：

+   瀑布方法论：这是一种线性和顺序的方法论；在其中不能回头。

+   **原型方法论**：在这种方法论中，产品被反复构建和测试。

+   **螺旋方法论**：这种方法论是有风险和成本高昂的，因为它通过迭代开发过程（目标识别、替代方案、约束和规划）来完成。

+   **敏捷方法论：**敏捷方法论是基于迭代和增量的方法，创造了一个灵活和快速适应的环境。有许多著名的敏捷方法，例如：

+   **水晶：**这种方法论基于人员的沟通和互动。

+   **Scrum**：这是一种敏捷方法论（甚至有一些专家认为它是敏捷运动的重要组成部分，而不是一种敏捷方法论），用于将软件开发项目分解为在特定时间段内进行的**冲刺**。

+   **极限编程**（**XP**）：包括短期开发周期，并与客户需求保持一致。

+   **特征驱动开发**（**FDD**）：这是一种以特征和客户为中心的方法论。

敏捷开发方法论比其他经典方法论风险较小。以下图表显示了敏捷开发周期：

![](img/00178.jpeg)

# 持续集成

CI 是一种软件开发实践，开发人员有机会在项目结束之前每天多次集成他们的代码。如今，CI 是每个软件项目中的关键实践。这些频繁的检查解决了经典的集成问题，并使开发人员和 CI 采用者获得以下好处：

+   在短时间内检测错误

+   轻松检测和定位问题

+   更快地交付软件产品

CI 采用是避免紧张集成的重要一步，并且它能够及时交付软件，因为不准确的时间和工作量估计是项目失败的主要原因，另外还有各个层面缺乏有效沟通。CI 基于自动化。自动化是 CI 的一个重要方面。因此，测试的自动化将确保更快的开发和产品上市时间。

# 测试类型

如前所述，自动化任务在 CI 中是必不可少的。您可以执行许多类型的测试，而不一定要一次执行所有测试。根据 Mike Cohn 介绍的测试自动化策略，测试可以用以下金字塔表示：

![](img/00179.gif)

**单元测试**范围狭窄，通常验证单个方法或函数的行为。

**集成测试**确保多个组件正确地一起运行。这可能涉及多个类，以及与其他服务的集成测试。

**验收测试**类似于集成测试，但它们侧重于业务案例而不是组件本身。

**UI 测试**将确保应用程序从用户角度正确运行。

以下是 CI 环境的总结：

![](img/00180.jpeg)

# 持续集成与持续交付

**CI**是**CD**的一个子集。在 CD 过程中，我们添加了一个额外的层，用于在发布过程中自动化交付。这个额外的步骤确保即使在产品发布和交付给客户之后，您也可以根据预定的时间表（每天、每周、每月等）根据业务需求快速进行新的更改。如果所有测试都成功，新的更改将被自动部署，从而以高效的方式加快产品向客户的发布。

为了加快流程，您可以添加一个称为持续部署的进一步步骤。以下图表显示了三个操作：

![](img/00181.jpeg)

# DevOps

**DevOps**是一种增强的实践，它在整个产品生命周期中使开发人员和运营经理之间能够进行协作。这是一组工具和思维原则，用于成功地建立两方之间的沟通渠道。通过查看以下图表，您可以更清楚地了解：

![](img/00182.jpeg)

# 使用 GitHub 和 Jenkins 进行持续集成

我们已经概述了开发方法和不同的产品生命周期过程。现在让我们学习如何使用 GitHub 和 Jenkins CI 服务器构建真实的 CI 环境，如下所示：

![](img/00183.jpeg)

Jenkins 是一个开源的自动化服务器。由于它具有自动化任务的能力，它可以执行 CI。您可以从[`jenkins.io/:`](https://jenkins.io/)下载它。

![](img/00184.jpeg)

# 安装 Jenkins

在演示中，我们将使用 Ubuntu 16.04 机器。要安装 Jenkins，您需要添加存储库密钥，使用`echo`命令将 Jenkins Debian 软件包存储库添加到`sources.list`文件，并通过输入以下内容来更新`sources.list`文件：

```
apt-get update
```

![](img/00185.jpeg)

现在，使用`apt-get install Jenkins`命令安装 Jenkins：

![](img/00186.jpeg)

您可以通过输入以下内容来检查 Jenkins 服务是否正在运行：

```
sudo service --status-all
```

![](img/00187.jpeg)

通过输入`sudo ufw allow 8080`来为 Jenkins 打开端口`8080`。

访问`https://www.<your domain/IP here>.com:8080`并完成所需的配置：

![](img/00188.jpeg)

选择您的插件模式：

![](img/00189.jpeg)

创建一个管理员用户，保存，然后我们完成了：

![](img/00190.jpeg)

大功告成！

![](img/00191.jpeg)

创建一个新项目并完成配置：

![](img/00192.jpeg)

# 持续集成攻击

像任何现代组织一样，宝贵的资产、持续集成和 CD 服务器是高度的目标，因为它们代表着入侵生产系统的良好入口点。有许多危险的攻击威胁 CI 服务器。以下是一些 CI/CD 服务器攻击的示例：

+   使用 CI 进行反向 shell

+   未经授权提交到主分支

+   Jenkins-CI 脚本控制台 Java 执行

# 持续集成服务器渗透测试

保护 CI 和 CD 服务器至关重要。建立安全控制对于保护流水线至关重要，因为它们是源代码和生产服务器之间的桥梁。

# Rotten Apple 项目用于测试持续集成或持续交付系统的安全性

Rotten Apple 项目是一个开源项目，旨在为开发人员和渗透测试人员在测试 CI 服务器时提供简单高效的体验，通过提供各种功能和能力。

您可以通过输入`sudo git clone https://github.com/claudijd/rotten_apple`来从其 GitHub 存储库克隆项目。

# 使用 Zed Attack Proxy 进行持续安全性

**Zed Attack Proxy**（**ZAP**），如图所示，是一个著名的开源安全工具。它具有各种对渗透测试人员有用的功能。ZAP 可以作为额外的 CI 安全层发挥重要作用。换句话说，它可以成为 Web 应用程序的持续安全层。ZAP 和 Jenkins 提供了体验额外组件的可能性。然后，您不仅仅是按时交付软件项目，而是增强了 CI/DI 管道的安全性：

![](img/00193.jpeg)

感谢 ZAP Jenkins 插件，您可以增强 CI 环境的安全性。测试后，ZAP 将以不同格式（XHTML、XML 和 JSON）生成报告。

要安装 ZAP 插件，可以使用 Web 界面：转到“管理 Jenkins -> 管理插件”。

使用过滤栏搜索 ZAP，如下面的屏幕截图所示：

![](img/00194.jpeg)

单击“无需重启安装”：

![](img/00195.jpeg)

转到作业并在构建选项中选择运行 OWASP ZAP 代理：

![](img/00196.jpeg)

完成所需的配置，最后构建作业：

>![](img/00197.jpeg)

# 摘要

本章概述了 CI 服务器的潜在力量及其对企业的好处。因此，我们了解了如何逐步构建 CI 环境，并了解了保护 CI/CD 服务器所需的步骤。下一章将带您进行一次深入的旅程，您将了解如何使用 Metasploit 和 PowerShell 来攻击组织基础设施。
