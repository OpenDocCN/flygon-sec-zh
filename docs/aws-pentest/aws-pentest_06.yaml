- en: '*Chapter 4*: Exploiting S3 Buckets'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第4章*：利用S3存储桶'
- en: S3 buckets are one of the primary resources that AWS uses to hold data. S3 buckets
    are great ways to hold objects such as data and metadata. However, much like other
    file storage solutions, S3 buckets can be easily exploited through simple misconfigurations.
    These misconfigurations can lead to data leaks and other serious security issues.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: S3存储桶是AWS用来存储数据的主要资源之一。S3存储桶是存储对象（如数据和元数据）的好方法。然而，与其他文件存储解决方案一样，S3存储桶可以通过简单的配置错误轻松被利用。这些配置错误可能导致数据泄露和其他严重的安全问题。
- en: In this chapter, we are going to take a dive into S3 buckets, their functionality,
    and how to exploit issues with public buckets and misconfigured buckets. We will
    also discuss real-world scenarios and how vulnerabilities in S3 buckets have become
    a common global issue for many corporations.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将深入研究S3存储桶、它们的功能以及如何利用公共存储桶和配置错误的存储桶。我们还将讨论现实世界的情景，以及S3存储桶中的漏洞如何成为许多公司普遍的全球问题。
- en: 'In this chapter, we''ll cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: AWS Regions and Availability Zones
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS区域和可用区
- en: Manipulating S3 buckets
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作S3存储桶
- en: S3 bucket policies
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S3存储桶策略
- en: Understanding public buckets
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解公共存储桶
- en: Scripts to find private buckets
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于查找私有存储桶的脚本
- en: A goal-based pentesting scenario
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个基于目标的渗透测试场景
- en: Discovering buckets with Grayhat Warfare
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Grayhat Warfare发现存储桶
- en: Building a local S3 environment
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建本地S3环境
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To follow along with the instructions in this chapter, you will need the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 要按照本章的说明进行操作，您需要以下内容：
- en: The AWS CLI (covered in [*Chapter 1*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*,
    Building Your AWS Environment*)
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS CLI（在[*第1章*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*中介绍，构建您的AWS环境*）
- en: Bash
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Bash
- en: 'The code used in this chapter is available at the following links:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中使用的代码可在以下链接找到：
- en: '[https://github.com/PacktPublishing/AWS-Penetration-Testing/tree/master/Chapter%204:%20Exploiting%20S3](https://github.com/PacktPublishing/AWS-Penetration-Testing/tree/master/Chapter%204:%20Exploiting%20S3)'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/PacktPublishing/AWS-Penetration-Testing/tree/master/Chapter%204:%20Exploiting%20S3](https://github.com/PacktPublishing/AWS-Penetration-Testing/tree/master/Chapter%204:%20Exploiting%20S3)'
- en: '[https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)'
- en: '[https://github.com/kromtech/s3-inspector](https://github.com/kromtech/s3-inspector)'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/kromtech/s3-inspector](https://github.com/kromtech/s3-inspector)'
- en: '[https://github.com/minio/minio](https://github.com/minio/minio)'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/minio/minio](https://github.com/minio/minio)'
- en: '[https://realpython.com/python-boto3-aws-s3/](https://realpython.com/python-boto3-aws-s3/)'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://realpython.com/python-boto3-aws-s3/](https://realpython.com/python-boto3-aws-s3/)'
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/3mJdY89](https://bit.ly/3mJdY89)'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频以查看代码的实际操作：[https://bit.ly/3mJdY89](https://bit.ly/3mJdY89)
- en: AWS Regions and Availability Zones
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS区域和可用区
- en: There are a few things we should discuss before getting started with S3\. It
    is essential to understand how AWS houses data because knowing the how and why
    helps us to understand the fundamentals a little better. Having a fundamental
    understanding allows us to further understand what we already know and go from
    there. To help us understand this a little better, let's discuss the infrastructure
    a bit before diving into S3\.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始使用S3之前，我们应该讨论一些事情。了解AWS如何存储数据至关重要，因为了解如何和为什么有助于我们更好地理解基本原理。具有基本的理解能够让我们进一步理解我们已经知道的内容并从中发展。为了帮助我们更好地理解这一点，让我们在深入研究S3之前先讨论一下基础设施。
- en: 'Just like local servers are typically stored on-premises, near your business
    or organization, it''s prudent to host information held in AWS as close to you
    as possible. What I mean is using systems that are geographically located near
    you to help support your mission with cloud-based resources. Well, this is where
    AWS Regions come into play in allowing you to geographically allocate resources
    based on your needs and locations. These geographically located areas known as
    **Regions** can be found in AWS. You can look at the regions by selecting them
    in the top-right corner of the AWS console. The current region that we are using
    throughout this book is **Oregon**:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 就像本地服务器通常存储在您的业务或组织附近一样，将存储在AWS中的信息尽可能地靠近您进行托管是明智的。我的意思是使用地理位置靠近您的系统来帮助支持您的云资源任务。这就是AWS区域发挥作用的地方，它允许您根据您的需求和位置地理分配资源。这些地理位置区域称为**区域**，可以在AWS中找到。您可以通过在AWS控制台右上角选择它们来查看区域。本书中我们一直在使用的当前区域是**俄勒冈**：
- en: '![Figure 4.1 – List of AWS Regions'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: ！[图4.1 - AWS区域列表
- en: '](img/Figure_4.01_B15630.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.01_B15630.jpg)'
- en: Figure 4.1 – List of AWS Regions
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.1 - AWS区域列表
- en: 'AWS Regions are various geographical locations that AWS uses to host its data,
    and its infrastructure. Thankfully, they are hosted globally with regions in major
    countries, allowing you to select a region that is closest to you. Choosing an
    infrastructure close to you means less latency for yourself or your end users.
    Currently, there are a few regions you can select from. The following screenshot
    was pulled directly from Amazon and highlights all the regions and the local zones
    that you can select:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: AWS区域是AWS用来托管数据和基础设施的各种地理位置。幸运的是，它们在全球范围内托管，各个主要国家都设有区域，允许您选择离您最近的区域。选择离您最近的基础设施意味着您或最终用户的延迟更小。目前，您可以选择几个区域。以下截图直接来自亚马逊，突出显示了所有区域和您可以选择的本地区域：
- en: '![Figure 4.2 – Longer list of AWS Regions'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: ！[图4.2 - AWS区域的更长列表
- en: '](img/Figure_4.02_B15630.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.02_B15630.jpg)'
- en: Figure 4.2 – Longer list of AWS Regions
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2 - AWS区域的更长列表
- en: You can see that there are numerous regions you can choose from here. As has
    already been said, ensure you select the one closest to you. This will ensure
    the best use of resources since they will be located nearest to you.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到这里有许多区域可供选择。正如已经提到的，确保选择离您最近的区域。这将确保最佳资源利用，因为它们将位于您附近。
- en: Now that we have learned about AWS Regions, let's look at some best practices.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了AWS区域，让我们来看一些最佳实践。
- en: AWS Region best practices
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: AWS区域最佳实践
- en: 'When looking at regions, there are a few housekeeping tips you will need to
    remember. These housekeeping tips help you to maintain better use of your cloud
    systems and to optimize speed. These best practices apply more on an enterprise-level
    but are still essential to understand:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在查看区域时，有一些日常维护的提示你需要记住。这些日常维护提示可以帮助你更好地使用你的云系统并优化速度。这些最佳实践更适用于企业级，但仍然是理解的关键：
- en: Choose the closest region to you to minimize latency.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择离你最近的区域以最小化延迟。
- en: Some newer services may not be able to host the services you need, so ensure
    that the region you select has the services you desire. If not, choose the next
    closest region that supports the services required.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些较新的服务可能无法承载你需要的服务，所以确保你选择的区域具有你需要的服务。如果没有，选择下一个最接近支持所需服务的区域。
- en: I can't stress this one enough – *compliance*! Ensure that, whatever you're
    doing, it is compliant with your region. Different countries have different laws,
    so ensure you're up to date on protocols within that region.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我无法再次强调这一点——*合规性*！确保无论你在做什么，都符合你所在地区的法规。不同的国家有不同的法律，所以确保你了解该地区内的协议。
- en: Now that we understand what regions are, let's take a look at the services hosted
    inside regions. These services are known as **Availability Zones**.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了区域是什么，让我们来看看区域内托管的服务。这些服务被称为**可用区**。
- en: Availability Zones
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可用区
- en: Availability Zones are fantastic for minimizing redundancy and downtime if an
    EC2 Instance were to go offline. Availability Zones are created to allow you to
    distribute an EC2 instance across multiple zones so that if your instance fails
    in one zone, it can still be accessed in another. Of course, this all happens
    in the background, and you, the user, don't notice it! If you need a quick refresher
    on EC2 instances, head back to [*Chapter 1*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*,
    Building Your AWS Environment*, and give it a quick review.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 可用区非常适合最小化冗余和停机时间，如果一个EC2实例宕机。可用区被创建用于允许你在多个区域分布EC2实例，这样如果你的实例在一个区域失败，它仍然可以在另一个区域访问。当然，这一切都是在后台发生的，你作为用户并没有注意到！如果你需要快速回顾一下EC2实例，回到[*第1章*](B15630_01_Final_ASB_ePub.xhtml#_idTextAnchor025)*，构建你的AWS环境*，并快速复习一下。
- en: 'Moving forward, let''s look at the next diagram. The diagram illustrates how
    AWS utilizes Availability Zones within each region. Throughout this book, we will
    be using the Oregon `us-west-2` **Availability Zone**:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 继续前进，让我们看看下一个图表。该图表说明了AWS如何在每个区域内利用可用区。在本书中，我们将使用俄勒冈`us-west-2`的**可用区**：
- en: '![Figure 4.3 – Redundancy with Availability Zones'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.3 – 可用区的冗余'
- en: '](img/Figure_4.03_B15630.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.03_B15630.jpg)'
- en: Figure 4.3 – Redundancy with Availability Zones
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.3 – 可用区的冗余
- en: It's extremely important that you take redundancy into account because when
    a service goes down, redundancy is a fault check that ensures that those services
    stay up. In a production or business case, a system going down can mean millions,
    or sometimes billions, of dollars lost!
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑冗余非常重要，因为当一个服务宕机时，冗余是一个故障检查，确保这些服务保持运行。在生产或商业案例中，系统宕机可能意味着损失数百万，甚至数十亿美元！
- en: Important note
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'You can find more information about Availability Zones here: [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions)'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这里找到更多关于可用区的信息：[https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions)
- en: Now that we have a better idea of how our resources can be spread out over Availability
    Zones, let's start looking at services that may use these zones. The first service
    that we are going to discuss is S3 and its storage solution, S3 buckets.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对资源如何分布在可用区有了更好的了解，让我们开始看看可能使用这些区域的服务。我们要讨论的第一个服务是S3及其存储解决方案S3存储桶。
- en: Connecting and manipulating S3 buckets
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 连接和操作S3存储桶
- en: Central file storage is conventional for organizations to secure and store data.
    If you have worked in IT, chances are you have had your fair share of run-ins
    with setting up **Server Message Block** (**SMB**) shares over Windows to allow
    file sharing between multiple hosts. Allowing files to be centrally resourced
    is a great way to collaborate and share information, as well as allowing personnel
    to access data remotely from another system. Setting up a file server, where data
    is stored – and retrieved – is nothing new. What is new is how we can store data
    in this same method, only now we can store it in the cloud using technology known
    as **S3** – or **Simple Storage Service** if you want to spell it out.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 中央文件存储对于组织来说是传统的，用于保护和存储数据。如果你在IT领域工作过，很可能你曾经设置过**服务器消息块**（**SMB**）共享在Windows上，以允许多个主机之间进行文件共享。允许文件集中资源化是协作和共享信息的好方法，同时也允许人员从另一个系统远程访问数据。设置文件服务器，存储和检索数据并不新鲜。新鲜的是我们如何可以使用同样的方法存储数据，只是现在我们可以使用被称为**S3**的技术在云中存储数据，或者如果你想拼出来的话，叫做**简单存储服务**。
- en: So, what is S3? S3 is a simple storage system (as the name implies) and allows
    users to store data in the cloud. Just like how we store data on a file server,
    we can store data in what is known as an S3 bucket, which will hold the contents
    of our data. You can store copious amounts of data in these buckets and retrieve
    it any time you like.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，什么是S3？S3是一个简单的存储系统（顾名思义），允许用户在云中存储数据。就像我们在文件服务器上存储数据一样，我们可以将数据存储在所谓的S3存储桶中，这将保存我们数据的内容。你可以在这些存储桶中存储大量的数据，并随时检索它。
- en: In this section, we will be learning about S3 buckets, their usage, and how
    to create and upload files to S3\. Let's first understand what S3 stands for.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我们将学习关于S3存储桶的使用，以及如何创建和上传文件到S3。让我们首先了解一下S3代表什么。
- en: Understanding S3 buckets
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 了解S3存储桶
- en: 'As mentioned, S3 is a simple storage service that allows users to store their
    data in the cloud. The storage solution is secure by default; however, users and
    administrators put policies around the storage that makes it vulnerable to attacks.
    We aren''t going to worry about attacks and vulnerabilities on S3 buckets just
    yet, because we need to understand the basics first. Before we dive into attacking,
    let''s break down some questions about the storage solution:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前面提到的，S3是一个简单的存储服务，允许用户将他们的数据存储在云中。这种存储解决方案默认是安全的；然而，用户和管理员对存储设置了一些策略，使其容易受到攻击。我们暂时不会担心S3存储桶的攻击和漏洞，因为我们需要先了解基础知识。在我们深入攻击之前，让我们先解答一些关于存储解决方案的问题：
- en: How is information stored?
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 信息是如何存储的？
- en: Where does it go?
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它去哪了？
- en: How much can we store, and how durable is it?
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以存储多少，它有多耐用？
- en: 'S3 stores your data in what''s called an **object**, also known as **object
    storage**. Object storage allows you to store data such as pictures, videos, files,
    and any data associated with them in the form of an object. There are various
    storage classes we aren''t going to go over, but you can find out more about them
    here: https://aws.amazon.com/s3/features/.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: S3将您的数据存储在所谓的**对象**中，也被称为**对象存储**。对象存储允许您以对象的形式存储诸如图片、视频、文件以及与它们相关的任何数据。有各种存储类别我们不打算详细介绍，但您可以在这里了解更多：https://aws.amazon.com/s3/features/。
- en: S3 is designed for the "11 9's" model, meaning it takes data durability and
    it automatically creates and stores copies of all S3 objects across multiple systems.
    However, this does not imply that S3 objects will be stored in an operating system.
    S3 is not like EC2 instances and is unable to host operating systems such as Windows
    or Linux.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: S3被设计为“11 9's”模型，这意味着它具有数据耐久性，并且会自动在多个系统上创建和存储所有S3对象的副本。然而，这并不意味着S3对象将存储在操作系统中。S3不像EC2实例，无法托管Windows或Linux等操作系统。
- en: S3 is also highly scalable and allows you to store what would seem like an infinite
    amount of storage; however, nothing is infinite, right? Making S3 storage unlimited
    adds on to the "11 9's!" model, driving success for safe and reliable storage.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: S3也具有高度可扩展性，允许您存储看似无限的存储量；然而，没有什么是无限的，对吧？使S3存储无限增加了“11 9's！”模型，为安全可靠的存储带来成功。
- en: Now, let's begin to take a look the usage of S3 and its real-world principles
    in an enterprise.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们开始看一下S3的使用以及在企业中的实际原则。
- en: Using S3 buckets
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用S3存储桶
- en: 'It''s important that we understand the reasons why we use cloud storage. It
    provides a critical service for companies to store data and be able to access
    it. As mentioned, S3 stores the following types of data:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是，我们要理解为什么要使用云存储。它为公司提供了存储数据并能够访问数据的关键服务。正如前面提到的，S3存储以下类型的数据：
- en: Pictures
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 图片
- en: Videos
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 视频
- en: Files
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件
- en: Documents containing sensitive data, and so on
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含敏感数据的文件等
- en: While we understand the types of data that can be stored, how is S3 used? It's
    more than loading up a new text document – it's about redundancy and backing up
    data!
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们了解可以存储的数据类型，但S3是如何使用的呢？它不仅仅是加载一个新的文本文档 - 它涉及冗余和备份数据！
- en: One of the primary reasons for S3 solutions in an enterprise is to back up and
    archive data that would otherwise be stored in backup locations such as hot sites,
    warm sites, and cold sites. S3 is like a hot site because the data is readily
    available and accessible at any time. Having S3 as a backup storage solution is
    also an excellent implementation of disaster recovery. If your primary filesystem
    goes down unexpectedly, your data will still be available in the cloud with S3\.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在企业中使用S3解决方案的主要原因之一是备份和归档数据，否则这些数据将存储在备份位置，如热站点、温站点和冷站点。S3就像一个热站点，因为数据随时可用和可访问。将S3作为备份存储解决方案也是灾难恢复的一个很好的实施。如果您的主文件系统意外崩溃，您的数据仍然可以在云中通过S3访问。
- en: 'S3 can also act as a central location to store and distribute data amongst
    users in a business. Remember: S3 is about scaling and storing, so being able
    to access data globally is extremely important for productivity.'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: S3也可以作为一个中央位置，用于在企业用户之间存储和分发数据。记住：S3是关于扩展和存储，因此能够全球访问数据对于生产力非常重要。
- en: Now that we have a better understanding of S3 and all it entails, it is time
    that we started looking at S3 buckets and how we can possibly exploit them.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对S3及其所包含的内容有了更好的理解，是时候开始看看S3存储桶以及我们如何可能利用它们了。
- en: S3 buckets
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: S3存储桶
- en: We now have a good grasp of what S3 is and how it works concerning storing information
    and backing up data for an enterprise. As stated previously, S3 is a simple storage
    service that stores data as objects. These **objects** are stored in what is known
    as a **bucket**. Simply put, a bucket is a basic container that is hosted in S3
    and stores your data objects. Let's take a brief look at what all this means,
    then set up a bucket of our very own.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对S3是什么以及它是如何工作的有了很好的理解，涉及存储信息和为企业备份数据。正如之前所述，S3是一个简单的存储服务，将数据存储为对象。这些**对象**存储在所谓的**存储桶**中。简单来说，存储桶是S3中托管您的数据对象的基本容器。让我们简要了解一下这意味着什么，然后设置我们自己的存储桶。
- en: Important note
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Remember, S3 is a local filesystem in the cloud!
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，S3是云中的本地文件系统！
- en: As stated before, S3 buckets essentially act similar to a simple file server
    that you would find within a local filesystem but are stored in the cloud instead
    of locally. A bucket stores objects that can be uploaded and downloaded at any
    time. Some resources will be stored in public buckets, while others will be stored
    internally and be available only to users that have access to them.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，S3存储桶基本上类似于您在本地文件系统中找到的简单文件服务器，但它们存储在云中而不是在本地。存储桶存储可以随时上传和下载的对象。一些资源将存储在公共存储桶中，而其他资源将存储在内部，并且只有具有访问权限的用户才能使用。
- en: 'To give brevity to S3 attributes, here is a list of things to keep in mind
    with S3:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简洁地介绍S3属性，这里有一些需要记住的事项：
- en: S3 bucket names are unique and cannot be the same as someone else's. These names
    are specific to a particular bucket within a certain area. We'll take a look at
    that in just a bit.
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S3存储桶名称是唯一的，不能与其他人相同。这些名称特定于特定区域内的特定存储桶。我们稍后会看一下这一点。
- en: You can create up to 100 buckets! This will give you plenty of practice and
    storage.
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您最多可以创建100个存储桶！这将为您提供充分的练习和存储空间。
- en: Buckets are assigned by region. It's important to remember what regions you
    store your buckets in – that's how you access them!
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储桶是按区域分配的。重要的是要记住您将存储桶存储在哪些区域 – 这是您访问它们的方式！
- en: They are reliable and sufficient for all your storage needs.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们可靠且足够满足您所有的存储需求。
- en: S3 has a universal namespace where buckets are created.
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S3具有一个通用的命名空间，用于创建存储桶。
- en: They can be accessed virtually or via a path – we will talk about this once
    we have created a bucket.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们可以通过虚拟方式或通过路径访问 – 我们将在创建存储桶后讨论这一点。
- en: Now you should have a good grasp of what S3 is and how it works. However, don't
    fret if you're still unsure – more understanding will arise as we move through
    this chapter and we will apply more theory with hands-on practice as we move further
    through the book.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您应该对S3是什么以及它是如何工作有了很好的理解。但是，如果您仍然不确定，不要担心 – 随着我们在本章中的深入学习，您将会更多地理解，并且随着我们在本书中的进一步学习，我们将应用更多的理论和实践。
- en: Next, let's build an S3 bucket and then look at some common security issues
    and how to exploit them. We will be using Kali Linux as our host operating system
    to interact with S3 – ensure that you have your local AWS Kali Linux image up
    to date and the AWS CLI installed, as mentioned in the *Technical requirements*
    section of this chapter.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们创建一个S3存储桶，然后看一些常见的安全问题以及如何利用它们。我们将使用Kali Linux作为我们的主机操作系统来与S3进行交互 – 确保您的本地AWS
    Kali Linux镜像是最新的，并且已安装AWS CLI，如本章的*技术要求*部分所述。
- en: Creating S3 buckets
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建S3存储桶
- en: Let's begin applying all our theory of S3 by putting it to practical use and
    start by logging into the AWS console. Once logged in, let's pin the S3 service
    icon to our main page. We are going to be using it quite a bit, so it's good practice
    to keep it on the main page.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始将我们对S3的理论应用到实践中，并开始登录AWS控制台。登录后，让我们将S3服务图标固定到我们的主页上。我们将会经常使用它，所以将其保留在主页上是一个好的做法。
- en: 'Let''s go ahead and create a bucket by following these steps:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们按照以下步骤创建一个存储桶：
- en: To begin, click on the thumbtack icon toward the top of the screen. Once you
    click on it, an extensive list of resources is displayed to you. Click and drag
    the **S3** icon to the top:![Figure 4.4 – List of AWS services
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，点击屏幕顶部的图钉图标。一旦您点击它，您将看到一个广泛的资源列表。点击并拖动**S3**图标到顶部：![图4.4 – AWS服务列表
- en: '](img/Figure_4.04_B15630.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.04_B15630.jpg)'
- en: Figure 4.4 – List of AWS services
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.4 – AWS服务列表
- en: You'll have something that looks like the following. Notice the **S3** icon
    at the top of your screen:![Figure 4.5 – S3 icon added as a service shortcut
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您的屏幕顶部应该有以下内容。注意您屏幕顶部的**S3**图标：![图4.5 – S3图标添加为服务快捷方式
- en: '](img/Figure_4.05_B15630.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.05_B15630.jpg)'
- en: Figure 4.5 – S3 icon added as a service shortcut
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.5 – S3图标添加为服务快捷方式
- en: Now you can click on the S3 icon and be directed to the S3 buckets page. This
    is where we will begin creating our buckets! Click on the icon that says **Create
    bucket** to start:![Figure 4.6 – S3 buckets dashboard
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您可以点击S3图标，然后转到S3存储桶页面。这就是我们开始创建存储桶的地方！点击上面写着**创建存储桶**的图标开始：![图4.6 – S3存储桶仪表板
- en: '](img/Figure_4.06_B15630.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.06_B15630.jpg)'
- en: Figure 4.6 – S3 buckets dashboard
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.6 – S3存储桶仪表板
- en: 'On the next screen, you''ll need to enter a name and a region for the bucket:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕上，您需要为存储桶输入名称和区域：
- en: Important note
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Use the region closest to you. Make sure your bucket uses a globally unique
    name. For example, you can't have two buckets named `AWSBucket`.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 使用离您最近的区域。确保您的存储桶使用全球唯一的名称。例如，您不能有两个名为`AWSBucket`的存储桶。
- en: '![Figure 4.7 – S3 buckets dashboard (creation and naming)'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.7 – S3存储桶仪表板（创建和命名）'
- en: '](img/Figure_4.07_B15630.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.07_B15630.jpg)'
- en: Figure 4.7 – S3 buckets dashboard (creation and naming)
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.7 – S3存储桶仪表板（创建和命名）
- en: The next screen will display the **Configure options**. In an enterprise environment,
    this is the start of where you will want to begin thinking about securing your
    buckets by assigning encryption and logging. However, for this, we will just leave
    everything unchecked:![Figure 4.8 – S3 bucket configuration options
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕将显示**配置选项**。在企业环境中，这是您开始考虑通过分配加密和日志记录来保护您的存储桶的起点。但是，对于此操作，我们将保持所有内容未选中：![图4.8
    – S3存储桶配置选项
- en: '](img/Figure_4.08_B15630.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.08_B15630.jpg)'
- en: Figure 4.8 – S3 bucket configuration options
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8 – S3存储桶配置选项
- en: Next, we will want to make the bucket public. If this were a real-world scenario,
    we would stray away from setting up a bucket like this; however, we want to make
    sure the bucket is public for our lab purposes. Public buckets are what lead to
    the majority of attacks where S3 is the primary vulnerability. By unchecking **Block
    all public access**, you'll be making the bucket public for anyone to access:![Figure
    4.9 – S3 bucket configuration options
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将希望将存储桶设为公开。如果这是一个真实的场景，我们会避免设置一个这样的存储桶；然而，我们希望确保存储桶对我们的实验目的是公开的。公开的存储桶是导致S3成为主要漏洞的攻击的大多数来源。通过取消**阻止所有公共访问**，你将使存储桶对任何人都是公开的：![图4.9
    – S3存储桶配置选项
- en: '](img/Figure_4.09_B15630.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.09_B15630.jpg)'
- en: Figure 4.9 – S3 bucket configuration options
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.9 – S3存储桶配置选项
- en: 'Check all your configurations and click **Create bucket**:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查所有你的配置并点击**创建存储桶**：
- en: '![Figure 4.10 – S3 bucket review'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.10 – S3存储桶审查'
- en: '](img/Figure_4.10_B15630.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.10_B15630.jpg)'
- en: Figure 4.10 – S3 bucket review
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.10 – S3存储桶审查
- en: Great job! You just created your first S3 bucket! This bucket will act as a
    vulnerable storage solution throughout this book, so make sure that you don't
    delete it.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 干得好！你刚刚创建了你的第一个S3存储桶！这个存储桶将作为本书中易受攻击的存储解决方案，所以确保你不要删除它。
- en: Now let's look at ways to upload data and see how the methods for pentesting
    S3 buckets can retrieve information. Before we get started, let's make an admin
    user that will give us an access ID and a secret that we can use to connect to
    our AWS S3 environment.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看上传数据的方法，并了解渗透测试S3存储桶的方法如何检索信息。在开始之前，让我们创建一个管理员用户，这个用户将给我们一个访问ID和一个密钥，我们可以用它来连接到我们的AWS
    S3环境。
- en: Quick detour – making IAM users
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 快速绕道 - 创建IAM用户
- en: 'It''s essential to have a user to access S3, so head over to the following
    area in the AWS console and get started: https://console.aws.amazon.com/iam/home?#/users.'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个用户访问S3是至关重要的，所以前往AWS控制台的以下区域并开始：https://console.aws.amazon.com/iam/home?#/users。
- en: 'Once you get to the **Identity and Access Management (IAM)** page, follow the
    next steps to create a user that we can use to access our S3 bucket:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你到达**身份和访问管理（IAM）**页面，按照下面的步骤创建一个用户，我们可以用它来访问我们的S3存储桶：
- en: Click **Add User** in the top-left corner.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左上角的**添加用户**。
- en: Give your user a name.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给你的用户取一个名字。
- en: 'Check off the following options:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 勾选以下选项：
- en: --**AWS Management Console access**
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: --**AWS管理控制台访问**
- en: '**--Programmatic access**'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '**--程序化访问**'
- en: Click **Next**.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。
- en: Skip adding tags.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 跳过添加标签。
- en: Review and create a **User**!
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查并创建一个**用户**！
- en: 'After that, you will get an **Access key ID**, **Secret access key**, and **Password**.
    Save these and store them in a secure place:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，你将得到一个**访问密钥ID**、**秘密访问密钥**和**密码**。保存这些并将它们存放在一个安全的地方：
- en: '![Figure 4.11 – Successful IAM user creation'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.11 – 成功创建IAM用户'
- en: '](img/Figure_4.11_B15630.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.11_B15630.jpg)'
- en: Figure 4.11 – Successful IAM user creation
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.11 – 成功创建IAM用户
- en: Now that we understand how users are created, let's look at how we can configure
    them for our AWS environment and copy and upload data to S3 buckets.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了如何创建用户，让我们看看如何配置它们用于我们的AWS环境，并将数据复制和上传到S3存储桶。
- en: Copying and uploading to S3
  id: totrans-134
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 复制并上传到S3
- en: Great – now we have a user that we can use to access our S3 bucket. Uploading
    files to S3 buckets is the most essential use for handling S3 buckets. It is how
    we get our information into the cloud safely and securely.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 太好了 - 现在我们有一个用户可以用来访问我们的S3存储桶。上传文件到S3存储桶是处理S3存储桶最基本的用途。这是我们将信息安全地和安全地传输到云端的方式。
- en: 'There are two ways that data can be uploaded to S3:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 数据可以上传到S3的两种方式：
- en: Using a web browser
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Web浏览器
- en: Using the AWS CLI
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用AWS CLI
- en: 'We are going to use both, but rely on the CLI for our pentesting methods. While
    having a **graphical user interface** (**GUI**) is a great option to have, it''s
    always better to use a CLI when available – this typically allows you more options
    and will be stable if and when a GUI fails. This user has administrator permissions,
    meaning it has **read** and **write** access. Let''s take a look at how we can
    upload a file to S3 via the CLI:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将两者都使用，但依赖CLI进行我们的渗透测试方法。虽然拥有**图形用户界面**（**GUI**）是一个很好的选择，但在可用时最好使用CLI - 这通常会给你更多的选择，并且在GUI失败时会更加稳定。这个用户拥有管理员权限，这意味着它有**读**和**写**权限。让我们看看我们如何通过CLI上传文件到S3：
- en: 'Connect to your AWS environment with the **Access key ID** and **Secret access
    key** from the user you created:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你创建的用户的**访问密钥ID**和**秘密访问密钥**连接到你的AWS环境：
- en: '[PRE0]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Enter the ID and secret from your user. When prompted, leave the region and
    output format blank. You should now be all set and connected. Now let''s check
    out the buckets and verify the contents by listing out the contents of the S3
    bucket:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你的用户的ID和密钥。在提示时，将区域和输出格式留空。现在你应该已经设置好并连接上了。现在让我们来检查一下存储桶，并通过列出S3存储桶的内容来验证内容：
- en: '[PRE1]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now you should be able to see the bucket that you created listed out in a Linux-type
    format. Before we move forward, let''s break down the command, so we understand
    what each parameter does:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该能够看到你创建的存储桶以Linux类型的格式列出。在我们继续之前，让我们分解这个命令，这样我们就能理解每个参数的作用：
- en: '`aws`: This command allows you to interact with your AWS environment.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`aws`：这个命令允许你与你的AWS环境进行交互。'
- en: '`s3`: This parameter will enable you to access your `s3` buckets. There are
    other commands that we can put here that we will discover later.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`s3`：这个参数将使你能够访问你的`s3`存储桶。我们可以在这里放其他命令，我们稍后会发现。'
- en: '`ls`: We mentioned this before. `ls` allows the user to list out the contents
    of a filesystem. We can use this in various operating systems, and with `s3` filesystems.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ls`：我们之前提到过这个。`ls`允许用户列出文件系统的内容。我们可以在各种操作系统和`s3`文件系统中使用它。'
- en: '`s3://`: Simply put, this allows you to access the filesystem via `s3`. This
    syntax is similar to other syntax to access local filesystem, such as SMB or FTP.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`s3://`：简单地说，这允许你通过`s3`访问文件系统。这种语法类似于其他访问本地文件系统的语法，比如SMB或FTP。'
- en: Now that you understand what the command is doing, let's keep moving forward
    and create a file that we can upload to the bucket. We found the directory that
    we created; the next move is to list out any contents that could be in the directory.
    In this case, we won't have any.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您了解了命令的作用，让我们继续前进并创建一个可以上传到存储桶的文件。我们找到了我们创建的目录；下一步是列出可能在目录中的任何内容。在这种情况下，我们不会有任何内容。
- en: 'The following will allow us to make a file:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 以下将允许我们创建一个文件：
- en: 'Type in the following command to list out the contents of the target bucket:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令以列出目标存储桶的内容：
- en: '[PRE2]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now we create a file in the Terminal that can later be uploaded:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在在终端中创建一个稍后可以上传的文件：
- en: '[PRE3]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Make sure that contents were written to the file correctly:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保文件内容被正确写入：
- en: '[PRE4]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Now upload the contents of the file:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在上传文件的内容：
- en: '[PRE5]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Verify the file:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证文件：
- en: '[PRE6]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Congrats, you successfully uploaded a file from the AWS command line! You can
    also check for your file in the AWS web console, which should have the contents
    look like this:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜，您已成功从AWS命令行上传了一个文件！您还可以在AWS Web控制台中检查您的文件，其内容应该如下所示：
- en: '![Figure 4.12 – Text file view from the AWS console'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.12 - 从AWS控制台查看文本文件'
- en: '](img/Figure_4.12_B15630.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.12_B15630.jpg)'
- en: Figure 4.12 – Text file view from the AWS console
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.12 - 从AWS控制台查看文本文件
- en: 'To recap, here are the steps we went through to get our S3 bucket live:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾一下，这是我们完成S3存储桶上线的步骤：
- en: Created an IAM user
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建了IAM用户
- en: Configured and connected to your AWS environment
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置并连接到您的AWS环境
- en: Listed out the contents of the S3 bucket
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出了S3存储桶的内容
- en: Created a file and copied it to the bucket
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建了一个文件并将其复制到存储桶中
- en: Now that we have created a bucket, let's look at some common misconfigurations
    that are seen when pentesting S3.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经创建了一个存储桶，让我们看看在进行S3渗透测试时可能会看到的一些常见配置错误。
- en: Bucket policies and ACLs
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存储桶策略和ACL
- en: Bucket policies and **access control lists** (**ACLs**) are used for access
    control – acting as the front line to allow and deny access to S3 resources in
    your AWS environment. Both ACL and buckets use JSON or YAML to write out their
    policies, which can make things difficult or easy, depending on how you look at
    it.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 存储桶策略和**访问控制列表**（**ACLs**）用于访问控制 - 作为允许和拒绝对AWS环境中S3资源访问的第一道防线。ACL和存储桶都使用JSON或YAML来编写它们的策略，这可能会使事情变得困难或容易，这取决于您的观点。
- en: Now let's move forward as we take a look at how these policies are created!
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们继续向前看看这些策略是如何创建的！
- en: Public bucket policies
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 公共存储桶策略
- en: When pentesting S3, one of the first things you'll want to do is look and see
    what the policies are for an S3 bucket. The following takes a look at a simple
    bucket policy that we'll create and how we can start interacting with buckets
    based on that policy.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行S3渗透测试时，您首先要做的事情之一是查看S3存储桶的策略是什么。以下是一个简单的存储桶策略的示例，我们将创建它，并且如何根据该策略开始与存储桶进行交互。
- en: 'Follow these steps to create a bucket and then list out its policy:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤创建一个存储桶，然后列出其策略：
- en: Go to the S3 bucket page and click on the bucket that we created.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到S3存储桶页面，点击我们创建的存储桶。
- en: Next, click on the **Permissions** tab.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，点击**权限**选项卡。
- en: Ensure that you have everything unchecked on **Block all public access**:![Figure
    4.13 – S3 bucket access view
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保在**阻止所有公共访问**上没有选中任何内容：![图4.13 - S3存储桶访问视图
- en: '](img/Figure_4.13_B15630.jpg)'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.13_B15630.jpg)'
- en: Figure 4.13 – S3 bucket access view
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.13 - S3存储桶访问视图
- en: Next, go to the **Bucket Policy** section and click **Policy Generator**, located
    near the bottom left of the page.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，转到**存储桶策略**部分，点击**策略生成器**，位于页面左下角附近。
- en: 'From here, you''ll want the following parameters to be set:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，您将希望设置以下参数：
- en: '--**Select Type of Policy**: **S3 Bucket Policy**'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: --**选择策略类型**：**S3存储桶策略**
- en: '--**Effect**: **Allow**'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: --**效果**：**允许**
- en: '--**Principal**: ***** – Putting *** annotates that we are selecting "all"'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: --**主体**：***** – 放置***注释表示我们选择了“全部”
- en: '--**AWS Service**: **Amazon S3**'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: --**AWS服务**：**Amazon S3**
- en: '--**Actions**: **All Actions**'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: --**操作**：**所有操作**
- en: '--**ARN**: **The ARN of your bucket**'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: --**ARN**：**您的存储桶的ARN**
- en: 'You''ll be able to create a policy and upload it:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将能够创建策略并上传它：
- en: '![Figure 4.14 – S3 bucket policy'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.14 - S3存储桶策略'
- en: '](img/Figure_4.14_B15630.jpg)'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.14_B15630.jpg)'
- en: Figure 4.14 – S3 bucket policy
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.14 - S3存储桶策略
- en: 'Now that we have updated the policy, let''s take a look at how we can read
    it from the AWS CLI:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经更新了策略，让我们看看如何从AWS CLI中读取它：
- en: '[PRE7]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'This will give us the results of the bucket policy; however, we can make the
    format a little more legible using the following command, which `json tool` to
    output the information:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 这将给我们提供存储桶策略的结果；但是，我们可以使用以下命令使格式更加易读，使用`json工具`输出信息：
- en: '[PRE8]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The following screenshot shows the output of the preceding command:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了前面命令的输出：
- en: '![Figure 4.15 – Getting an S3 bucket policy via the Terminal'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.15 - 通过终端获取S3存储桶策略'
- en: '](img/Figure_4.15_B15630.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.15_B15630.jpg)'
- en: Figure 4.15 – Getting an S3 bucket policy via the Terminal
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.15 - 通过终端获取S3存储桶策略
- en: As you can see, we have successfully listed out the policy of our bucket in
    a more legible format.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，我们已成功以更易读的格式列出了我们存储桶的策略。
- en: Understanding policy attributes
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 了解策略属性
- en: 'It''s essential to understand what each portion of the policy means and what
    it is doing. You don''t need to understand JSON to know what the policy is doing.
    Let''s dissect the policy we just made and look at what each attribute means.
    Let''s take a look at what some of the basic attributes that we will take a look
    at are:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 了解策略的每个部分意味着什么以及它的作用是至关重要的。您不需要了解JSON就知道策略在做什么。让我们解剖刚刚制作的策略，并看看每个属性的含义。让我们看看我们将要查看的一些基本属性是什么：
- en: '`ID`: Used as a reference number.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ID`：用作参考号。'
- en: '`Version`: Tells the users what version of the policy is being used.'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`版本`：告诉用户正在使用的策略版本。'
- en: '`Action`: This tells you what type of resource is being used. In our case for
    this chapter, we are using S3\.'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`操作`：这告诉您正在使用的资源类型。在本章中，我们使用的是S3。'
- en: '`Effect`: This portion of the policy will either "deny" or "allow" access to
    the resource.'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`效果`：策略的这部分将“拒绝”或“允许”访问资源。'
- en: '`Resource`: ARN is placed here and tells the policy what resource the policy
    is being applied to.'
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`资源`：ARN放在这里，告诉策略策略被应用到哪个资源。'
- en: Writing bucket policies for policy bypassing
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 编写策略绕过策略
- en: Now let's take a look at writing a new bucket policy. For this exercise, use
    the policy generator built into the AWS console. For this, we will make a new
    bucket; only this time, we'll create a bucket with more strict policies. It should
    have `Effect` set to `Deny` instead of `Allow`.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们来看看如何编写一个新的存储桶策略。在这个练习中，使用内置在AWS控制台中的策略生成器。为此，我们将创建一个新的存储桶；只是这一次，我们将创建一个具有更严格策略的存储桶。它的`效果`应该设置为`拒绝`而不是`允许`。
- en: 'Here is what the policy of your new bucket should look like:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 你的新存储桶的策略应该是这样的：
- en: '[PRE9]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Moving forward, let''s take a look at how we can upload files to our S3 bucket:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 继续前进，让我们看看如何上传文件到我们的S3存储桶：
- en: 'List out the contents of the bucket:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出存储桶的内容：
- en: '[PRE10]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Now that we know which buckets to target, let''s make a file and upload it
    to the bucket:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道要针对哪些存储桶，让我们制作一个文件并上传到存储桶中：
- en: '![Figure 4.16 – Listing out the contents of the bucket and copying the file
    to the bucket'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.16 - 列出存储桶的内容并将文件复制到存储桶中'
- en: '](img/Figure_4.16_B15630.jpg)'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.16_B15630.jpg)'
- en: Figure 4.16 – Listing out the contents of the bucket and copying the file to
    the bucket
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.16 - 列出存储桶的内容并将文件复制到存储桶中
- en: 'Now we''ve confirmed that we can upload files to the bucket, this gives us
    a hint that we should be able to upload just about any file to the bucket. Next,
    let''s take our policy and change one line that will allow us to make any action
    on the S3 bucket:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们已经确认我们可以上传文件到存储桶，这给了我们一个暗示，我们应该能够上传几乎任何文件到存储桶。接下来，让我们拿出我们的策略，改变一行，这将允许我们对S3存储桶进行任何操作：
- en: '[PRE11]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'It''s as simple as that. We now need to upload this to our bucket. Save the
    new policy as `policy.json`, and upload it using the following command:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 就是这么简单。现在我们需要将这个上传到我们的存储桶。将新策略保存为`policy.json`，并使用以下命令上传它：
- en: '[PRE12]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Now you'll have a more **overly** permissive policy put in place that allows
    you much more control. This can be dangerous on an enterprise-level – it will
    enable users to change policies as they wish without proper authorization.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你将有一个更过度宽松的策略，允许你更多的控制。这在企业级别上可能是危险的——它将使用户能够在没有适当授权的情况下随意更改策略。
- en: Now that we understand how to make a bucket policy, let's keep moving forward
    and start to look at the dangers of public buckets.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了如何制定存储桶策略，让我们继续前进，开始看看公共存储桶的危险。
- en: Public buckets
  id: totrans-227
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 公共存储桶
- en: 'Public buckets are one of the largest health risks to AWS and S3\. Large amounts
    of data leaks have been reported due to misconfigurations in S3 due to a poor
    security posture. Some of the issues that have been reported are as follows:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 公共存储桶是AWS和S3最大的安全风险之一。由于S3的配置错误导致了大量数据泄漏。一些已经报告的问题如下：
- en: A lack of monitoring of S3 buckets. Without monitoring, there really isn't a
    stable way to check access to your S3 environments.
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对S3存储桶的监控不足。没有监控，确实没有稳定的方法来检查对S3环境的访问。
- en: A lack of testing and auditing of S3 environments proves to be a security issue.
    Something as simple as a vulnerability assessment or even a simple pentest would
    help highlight issues that can be easily fixed.
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对S3环境的测试和审计不足，这证明是一个安全问题。像漏洞评估或者简单的渗透测试这样简单的事情都会帮助发现可以轻松修复的问题。
- en: Relaxed policies are another issue. If policies let too many users access S3
    resources, issues could arise if those accounts become compromised.
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 宽松的策略是另一个问题。如果策略允许太多用户访问S3资源，如果这些帐户被攻破，问题可能会出现。
- en: Popular opinions revolving around the security of S3 highlights that monitoring
    will heighten the security posture of S3; however, monitoring is only half the
    battle. As we saw, having an overly permissive policy can also allow users to
    make changes that would be thought of as "unauthorized." The word unauthorized
    is used lightly because the policy technically says it's allowed, but good practices
    advise against it.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 围绕S3安全的普遍观点强调，监控将提高S3的安全姿态；然而，监控只是战斗的一半。正如我们所看到的，过度宽松的策略也可以允许用户进行被认为是“未经授权”的更改。未经授权这个词被轻描淡写地使用，因为策略在技术上说是允许的，但是良好的做法建议不要这样做。
- en: Now let's start to move forward and look at a public misconfiguration within
    a bucket.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们开始继续前进，看看存储桶中的公共配置错误。
- en: Bucket misconfigurations
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 存储桶配置错误
- en: Just like local filesystems, misconfigurations can be the be-all and end-all
    for guarding networks. It's essential to look for simple and tiny details that
    could be used as leverage. S3 comes "preconditioned" with security in mind, meaning
    it is secured by default. The misconfigurations that you will see in this book
    and in the real world typically involve having misconfigured policies that allow
    too much access to a particular resource, or permissions that can easily be bypassed.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 就像本地文件系统一样，配置错误可能是保护网络的全部和终极目标。重要的是要寻找可以被利用的简单和微小的细节。S3是以安全为前提的，这意味着它是默认安全的。在这本书和现实世界中，你将看到的配置错误通常涉及到配置错误的策略允许对特定资源过多的访问，或者可以轻松绕过的权限。
- en: While we do create vulnerable buckets in this chapter and look at weak issues
    overall throughout this entire book, it's essential to make sure that you secure
    all your resources so that they aren't able to be exploited.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在本章中我们创建了容易受攻击的存储桶，并在整本书中总体上看了一些弱点问题，但是确保你保护所有资源以防止它们被利用是至关重要的。
- en: We've already discussed how to look for misconfigured policies, in the *Writing
    Bucket Policies for Policy Bypassing* section. Now let's take a look at how we
    would search for data in a public bucket within our AWS environment.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经讨论了如何查找配置错误的策略，在“编写策略绕过策略”部分。现在让我们看看在AWS环境中如何搜索公共存储桶中的数据。
- en: 'To get started, let''s go ahead and authenticate using our **Access key ID**
    and **Secret access key**.Once authenticated to the environment, let''s use the
    following steps to find a public bucket:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始，使用我们的**访问密钥ID**和**秘密访问密钥**进行认证。一旦在环境中进行了认证，让我们使用以下步骤来查找公共存储桶：
- en: 'List out the buckets within the AWS environment:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出AWS环境中的存储桶：
- en: '[PRE13]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The next command will show us whether there is any public access allowed to
    the bucket:'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一条命令将向我们显示存储桶是否允许任何公共访问：
- en: '[PRE14]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'After running the command, we will see some output that will list out all the
    access control lists set to false. Having the ACL set to false means that all
    access is public, and the bucket has no authorization controls placed around it:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 运行命令后，我们将看到一些输出，列出了所有设置为false的访问控制列表。将ACL设置为false意味着所有访问都是公开的，存储桶没有授权控制围绕它放置：
- en: '![Figure 4.17 – Output from the public bucket, awspublicpackt'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.17 - 公共存储桶awspublicpackt的输出'
- en: '](img/Figure_4.17_B15630.jpg)'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.17_B15630.jpg)'
- en: Figure 4.17 – Output from the public bucket, awspublicpackt
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.17 - 公共存储桶awspublicpackt的输出
- en: As we can see from the command's output, we can confirm that the bucket is public.
    If we were to discover this during a pentest, it would need to be logged and we
    would need to advise the client that public access should be denied, unless the
    bucket is public for a business reason. Additionally, if the bucket needed to
    remain public, users would need to be advised not to store any information in
    the bucket deemed sensitive.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 从命令的输出中可以看出，我们可以确认存储桶是公开的。如果在渗透测试中发现了这一点，就需要记录下来，并告知客户应拒绝公共访问，除非存储桶出于业务原因是公开的。此外，如果存储桶需要保持公开，就需要告知用户不要在被视为敏感的存储桶中存储任何信息。
- en: In this next section, we are going to go onto a slightly different topic. We
    are going to discuss scripting and using scripting for security regarding S3 buckets.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将讨论一个略有不同的主题。我们将讨论脚本编写以及如何在S3存储桶的安全方面使用脚本。
- en: Scripts to find private buckets
  id: totrans-249
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找私有存储桶的脚本
- en: Scripting is a highly sought-after skill when it comes to cybersecurity because
    having the knowledge and ability to script tasks allows you to automate and provide
    results at a much more efficient rate while also executing another task. Scripting
    is also a great way to solve problems that may be unique – in this case, finding
    buckets that may not have a common name. Buckets can only have one unique name
    and no bucket is the same, so having a dictionary list of known buckets won't
    assist you directly. What that means is you'll need to make a modified version
    of the bucket names and place those in a text file that can be used to discover
    bucket names.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本编写在网络安全领域是一项备受追捧的技能，因为拥有脚本任务的知识和能力可以让你以更高效的速度自动化并提供结果，同时执行另一个任务。脚本编写也是解决可能是独特的问题的好方法
    - 在这种情况下，查找可能没有常见名称的存储桶。存储桶只能有一个唯一的名称，没有一个存储桶是相同的，所以拥有已知存储桶的字典列表对你没有直接帮助。这意味着你需要制作存储桶名称的修改版本，并将其放在一个文本文件中，以便用于发现存储桶名称。
- en: 'Now that we have a vast amount of knowledge on S3, let''s take a look at a
    couple of scripts that you could use on your next pentest engagement. We will
    look at two popular languages: Python and Bash.'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对S3有了大量的知识，让我们来看看你可以在下一次渗透测试中使用的一些脚本。我们将看两种流行的语言：Python和Bash。
- en: Python scripting
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Python脚本
- en: Python is a standard programming language in the security community due to its
    simplicity and usability. Lots of security engineers use it because it allows
    you to create, automate, and monitor everything on the fly! Recall that we set
    up PyCharm in [*Chapter 2*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*,
    Pentesting and Ethical Hacking*, and wrote a simple program to get an overview
    of how Python works.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: Python是安全社区中的标准编程语言，因为它简单易用。许多安全工程师使用它，因为它允许你即时创建、自动化和监控一切！回想一下，我们在[*第2章*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)*，渗透测试和道德黑客*中设置了PyCharm，并编写了一个简单的程序来了解Python的工作原理。
- en: Note that this is not a Python course, so we will not be going over the internal
    workings of Python; however, there are copious amounts of Python books offered
    by **Packt Publishing**. It is always encouraged to go out and read more about
    the material not covered in this book.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这不是一门Python课程，所以我们不会讨论Python的内部工作原理；然而，**Packt Publishing**提供了大量的Python书籍。鼓励大家去阅读本书未涉及的材料。
- en: We need to install the Boto3 SDK for AWS. **SDK** is the acronym for **Software
    Development Kit** and, in this case, you can use Boto3 to allow you to directly
    create, update, and delete AWS resources from your Python scripts.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要安装AWS的Boto3 SDK。**SDK**是**软件开发工具包**的缩写，在这种情况下，你可以使用Boto3直接从你的Python脚本中创建、更新和删除AWS资源。
- en: Important note
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Boto3 is an AWS **Software Development Kit** (**SDK**) that is used for Python
    and allows developers to write code that can make use of services such as S3 and
    EC2\.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: Boto3是AWS的**软件开发工具包**（**SDK**），用于Python，允许开发人员编写可以利用S3和EC2等服务的代码。
- en: 'The following steps will assist you in executing this correctly:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助你正确执行这一过程：
- en: 'Open up a Terminal and type the following command to install `boto3`:'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开终端并输入以下命令来安装`boto3`：
- en: '[PRE15]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Now you have the SDK that will allow you to build S3 buckets using Python!
    Let''s create a file that we can store our credentials in:'
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你有了允许你使用Python构建S3存储桶的SDK！让我们创建一个文件，我们可以在其中存储我们的凭据：
- en: '[PRE16]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'This will create a file that you can store your credentials in. Open the file
    using a file editor and input the following parameters:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将创建一个文件，你可以在其中存储你的凭据。使用文件编辑器打开文件，并输入以下参数：
- en: '[PRE17]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Now you are all set to use `boto3` and Python to interact with your S3 buckets!
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经准备好使用`boto3`和Python与你的S3存储桶进行交互了！
- en: There are lots of ways to interact with S3 and Python – this book's intention
    is to show the basics of doing that, however, please use this book as a primer
    and "stay curious" and look at more resources for scripting with Python.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多与S3和Python交互的方式 - 本书的目的是展示这样做的基础知识，但是，请将本书作为入门指南，并“保持好奇”，查看更多有关Python脚本编写的资源。
- en: 'Here is a great resource to use now that you have boto3 set up: https://docs.ceph.com/docs/master/radosgw/s3/python/'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经设置了boto3，这是一个很好的资源：https://docs.ceph.com/docs/master/radosgw/s3/python/
- en: 'Now let''s create a script that can help us find buckets that will allow us
    to look for buckets in an S3 environment. You can use the Python Terminal to write
    the following script:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们创建一个脚本，可以帮助我们查找允许我们在S3环境中查找存储桶的脚本。您可以使用Python终端来编写以下脚本：
- en: We create a file with the `.py` extension at the end – for example, `myBucket.py`.
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们在末尾使用`.py`扩展名创建一个文件 - 例如，`myBucket.py`。
- en: 'Whichever way you choose to use it, the following script will help you find
    buckets:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 无论您选择使用哪种方式，以下脚本都将帮助您查找存储桶：
- en: '[PRE18]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: It's highly recommended to place this script in PyCharm, where you can use it
    later – or expand it with more capabilities. Placing it within PyCharm also allows
    you to edit the file in PyCharm by default, making PyCharm your primary workspace.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 强烈建议将此脚本放在PyCharm中，以便以后使用 - 或者扩展它的功能。在PyCharm中编辑文件也可以成为默认操作，使PyCharm成为您的主要工作空间。
- en: Now that we've seen how we can make a simple script to find buckets, let's take
    a look at some **Bash** scripting.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经看到了如何制作一个简单的脚本来查找存储桶，让我们来看看一些**Bash**脚本。
- en: Bash scripting
  id: totrans-274
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Bash脚本
- en: '**Bash** is a scripting language that supports automating a task, and in our
    case, helps us reach our goals with testing S3\. The **Bourne Again SHell**, or
    **Bash** for short, is a shell process that often comes built into operating systems
    – like our Kali Linux distro that we are using throughout this book.'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '**Bash**是一种支持自动化任务的脚本语言，在我们的情况下，它帮助我们实现测试S3的目标。**Bourne Again SHell**，或者简称**Bash**，是一个经常内置于操作系统中的shell进程
    - 就像我们在整本书中都在使用的Kali Linux发行版一样。'
- en: 'To ensure you have **Bash** set up in your environment, type out the following
    command in your Kali Linux Terminal:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保您的环境中已经设置了**Bash**，请在Kali Linux终端中键入以下命令：
- en: '[PRE19]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Now that you have verified that you have **Bash** set up on your machine, let''s
    create a script that can be used to find buckets that may not have such a common
    name. Follow these steps:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经验证了您的机器上是否设置了**Bash**，让我们创建一个可以用来查找可能没有常见名称的存储桶的脚本。按照以下步骤进行：
- en: 'Open a new file using the `vi` text editor:'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`vi`文本编辑器打开一个新文件：
- en: '[PRE20]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: You should have the `vi` editor open. Now, input the following text in the Terminal.
    You'll need to press *Shift* **+** *I*together to begin typing.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该已经打开了`vi`编辑器。现在，在终端中输入以下文本。您需要同时按下*Shift* **+** *I*开始输入。
- en: 'The following script is written to discover potential buckets:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 以下脚本是用来发现潜在存储桶的：
- en: '![Figure 4.18 – Bash script'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.18 - Bash脚本'
- en: '](img/Figure_4.18_B15630.jpg)'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.18_B15630.jpg)'
- en: Figure 4.18 – Bash script
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.18 - Bash脚本
- en: When you're finished, hit *Esc* and then type `:wq` to save and close the Terminal.
    That command will allow you to save and quit the program.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，按*Esc*，然后输入`:wq`保存并关闭终端。该命令将允许您保存并退出程序。
- en: 'If you want to verify that the script saved correctly, you can `cat` out of
    the file and should see the following code:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想要验证脚本是否保存正确，您可以从文件中使用`cat`命令，应该会看到以下代码：
- en: '[PRE21]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Once you have the script ready to go, use the ARN of your bucket and scan the
    bucket.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您准备好脚本，使用您的存储桶的ARN并扫描存储桶。
- en: Now we are going to take all the knowledge that we have learned so far and do
    something very important with it – use it in a pentest scenario that you can walk
    through. This walk-through helps aid and highlight real potential ways a pentest
    with AWS could be executed.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将利用到目前为止学到的所有知识，并且做一些非常重要的事情 - 在渗透测试场景中使用它。这个演练有助于突出AWS渗透测试可能执行的真实潜在方式。
- en: Goal-based pentesting scenarios
  id: totrans-291
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于目标的渗透测试场景
- en: Now let's start to move forward and look at some real scenarios that are relatively
    common when pentesting S3 in a real-life environment. While it may not seem like
    typical "pentesting," because AWS pentesting does not use a typical pentesting
    methodology, it does still serve the mission of finding issues and leveraging
    them to your advantage. Goal-based pentesting entails testing a target with a
    "goal" in mind. In this case, we are looking for issues and mishaps that may be
    in an S3 bucket. Oftentimes, organizations will want to know how vulnerable a
    specific resource is, and how the path that leads to the vulnerability could be
    exploited.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们开始向前迈进，看一些在现实环境中相对常见的渗透测试S3的真实场景。虽然它可能看起来不像典型的“渗透测试”，因为AWS渗透测试不使用典型的渗透测试方法，但它仍然可以实现发现问题并利用它们的任务。基于目标的渗透测试意味着以“目标”为目标测试一个目标。在这种情况下，我们正在寻找可能存在于S3存储桶中的问题和失误。通常，组织希望了解特定资源的脆弱性以及导致脆弱性的路径如何被利用。
- en: 'For this example, we will look at how an unsecured bucket leads us to delete
    an important document and then upload a document with the same name. We will be
    using an "assumed model," meaning that we already have some type of access to
    the system. Before we walk through the exercise, let''s take a look at what we
    will be doing:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将看看一个不安全的存储桶是如何导致我们删除一个重要文档，然后上传一个同名文档的。我们将使用一个“假设模型”，这意味着我们已经对系统有某种类型的访问。在我们进行练习之前，让我们看看我们将要做什么：
- en: We will need to access the S3 environment – we will use our credentials. Since
    we are acting on an assumed model, this means we will be operating as a near-sider.
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要访问S3环境 - 我们将使用我们的凭据。由于我们是在一个假设的模型上操作，这意味着我们将作为一个近端操作。
- en: Next, we will pull information about the objects in the bucket.
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将获取存储桶中对象的信息。
- en: Then we will delete the object and make our own object to upload – then upload
    the object to the bucket.
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后我们将删除对象并创建自己的对象进行上传 - 然后将对象上传到存储桶中。
- en: 'Now that we have what we need, let''s execute this plan and move forward. The
    following is the step-by-step process of how to execute this properly:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了需要的东西，让我们执行这个计划并继续前进。以下是如何正确执行这一步骤的逐步过程：
- en: Use `AWS configure` to enter your environment. Remember, because we are using
    an "assumed" model, we are acting like someone who already has access to the environment.
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`AWS configure`进入你的环境。记住，因为我们使用的是“假设”模型，我们就像已经有权限访问环境的人一样行事。
- en: 'Once you''re configured and connected, the next move is to list out the contents
    of the buckets:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你配置并连接好了，下一步就是列出存储桶的内容：
- en: '[PRE22]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Now that we see the buckets, let''s take a look at the `test` bucket:'
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 既然我们看到了存储桶，让我们来看看`test`存储桶：
- en: '[PRE23]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Hmm, it looks like we have a secret file that someone must have left behind.
    Unfortunately, the bucket was made public and made quickly, so security was an
    afterthought. Next, let''s go and grab the secret file:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 嗯，看起来我们有一个秘密文件，肯定是有人留下的。不幸的是，存储桶是公开的，并且很快就被创建，所以安全性是事后考虑的。接下来，让我们去获取这个秘密文件：
- en: '[PRE24]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Great, now we have the file! Using our Kali Linux machine, let''s take a look
    at the contents of the file:'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 很好，现在我们有了文件！使用我们的Kali Linux机器，让我们看看文件的内容：
- en: '[PRE25]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![Figure 4.19 – Listing out files of the bucket'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.19 - 列出存储桶的文件'
- en: '](img/Figure_4.19_B15630.jpg)'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.19_B15630.jpg)'
- en: Figure 4.19 – Listing out files of the bucket
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.19 - 列出存储桶的文件
- en: 'We can take a deeper look and see who owns the object. In a real pentest, this
    could be useful information for spoofing or social engineering attacks:'
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以深入研究并查看谁拥有这个对象。在真正的渗透测试中，这可能是欺骗或社会工程攻击的有用信息：
- en: '[PRE26]'
  id: totrans-311
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![Figure 4.20 – Listing out the contents of the object'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.20 - 列出对象的内容'
- en: '](img/Figure_4.20_B15630.jpg)'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.20_B15630.jpg)'
- en: Figure 4.20 – Listing out the contents of the object
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.20 - 列出对象的内容
- en: It looks like this wasn't meant for us; however, because we are pentesting,
    it's crucial that we illustrate to clients the importance of security. In order
    for us to do that, we will need to remove the file and upload a new artifact.
    Ensure that you keep the original so that the client can have the file returned.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来这不是为我们准备的；然而，因为我们正在进行渗透测试，向客户说明安全性的重要性是至关重要的。为了做到这一点，我们需要删除文件并上传一个新的文件。确保你保留原文件，以便客户可以拿回文件。
- en: Important note
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: If this were a real pentest and the file contained sensitive data, then you
    would immediately stop the pentest and inform your client before continuing.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这是一次真正的渗透测试，并且文件包含敏感数据，那么你会立即停止渗透测试，并在继续之前通知客户。
- en: 'Moving forward with our testing, let''s see if we can delete the file:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 继续我们的测试，让我们看看是否可以删除文件：
- en: 'So, we have our file, now let''s delete that file:'
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所以，我们有了我们的文件，现在让我们删除那个文件：
- en: '[PRE27]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Create a new file:'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新文件：
- en: '[PRE28]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Upload the file:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上传文件：
- en: '[PRE29]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: We have successfully removed the old file and uploaded a new file of our very
    own! As you can see, leaving public buckets open is a massive issue that can be
    easily mitigated by setting proper access controls that deny unauthorized users
    access to files containing data not meant for them.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 我们成功删除了旧文件，并上传了我们自己的新文件！正如你所看到的，留下公开的存储桶是一个严重的问题，可以通过设置适当的访问控制来轻松解决，从而拒绝未经授权的用户访问包含不适合他们的数据的文件。
- en: Now that we understand a little better how to find buckets in a real-life penetration
    test situation, let's look at another tool that you can use through a browser
    of your choice. The web tool called **Grayhat Warfare** allows you to discover
    buckets by making queries through its search engine.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对如何在现实的渗透测试情况下找到存储桶有了更好的理解，让我们看看另一个你可以通过自己选择的浏览器使用的工具。这个名为**Grayhat Warfare**的Web工具允许你通过其搜索引擎进行查询来发现存储桶。
- en: Discovering buckets with Grayhat Warfare
  id: totrans-327
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Grayhat Warfare发现存储桶
- en: The next tool we are going to mention in this chapter is a personal favorite
    of mine. It makes discovering open S3 buckets easy and efficient. The web-based
    tool **Grayhat Warfare** allows users to find open buckets quickly with a simple
    query, and it also allows us to find other documents quickly by searching various
    file types.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 我们接下来要提到的工具是我个人最喜欢的。它使发现开放的S3存储桶变得简单高效。基于Web的工具**Grayhat Warfare**允许用户通过简单的查询快速找到开放的存储桶，并且还允许我们通过搜索各种文件类型快速找到其他文档。
- en: Let's go over a quick example that will look for files under the `packtpub.com`
    domain.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速看一个例子，它将在`packtpub.com`域下查找文件。
- en: 'To start, first, open your web browser and go to [https://buckets.grayhatwarfare.com/](https://buckets.grayhatwarfare.com/):'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，打开你的网络浏览器，然后转到[https://buckets.grayhatwarfare.com/](https://buckets.grayhatwarfare.com/)：
- en: Next, search [packtpub.com](http://packtpub.com) in the **Keywords** section
    of the tool. Once you have the name in the **Keywords** box, click **Search**:![Figure
    4.21 – Searching packtpub.com with Grayhat Warfare
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在工具的**关键词**部分搜索[packtpub.com](http://packtpub.com)。一旦在**关键词**框中输入名称，点击**搜索**：![图4.21
    - 使用Grayhat Warfare搜索packtpub.com
- en: '](img/Figure_4.21_B15630.jpg)'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.21_B15630.jpg)'
- en: Figure 4.21 – Searching packtpub.com with Grayhat Warfare
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.21 - 使用Grayhat Warfare搜索packtpub.com
- en: You'll see a banner saying **Results for "packtpub com"**. Under the banner,
    you will see a list of buckets. In our case, with this example, we only discovered
    one bucket, however, that may change over time and by the time you complete this
    exercise:![Figure 4.22 – Discovering packtpub.com buckets with Grayhat Warfare
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你会看到一个横幅，上面写着**“packtpub com”的结果**。在横幅下面，你会看到一个存储桶列表。在我们的例子中，我们只发现了一个存储桶，但是随着时间的推移，你完成这个练习时可能会发生变化：![图4.22
    - 使用Grayhat Warfare发现packtpub.com存储桶
- en: '](img/Figure_4.22_B15630.jpg)'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_4.22_B15630.jpg)'
- en: Figure 4.22 – Discovering packtpub.com buckets with Grayhat Warfare
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.22 - 使用Grayhat Warfare发现packtpub.com存储桶
- en: From here, you can click on the buckets and download the objects within the
    bucket if you choose to. This example focuses more on the methodology rather than
    executing the full tool.
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，你可以点击存储桶并下载存储桶内的对象，如果你选择的话。这个例子更多地关注方法论，而不是执行完整的工具。
- en: When using **Grayhat Warfare**, ensure that you are using best practices and
    only use the tool for ethical purposes. What does that mean? It means that while
    using the tool is 100% legal, you should advise any company if you discover a
    leaky bucket associated with their domain.
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用**Grayhat Warfare**时，请确保您使用最佳实践，并且仅出于道德目的使用该工具。这是什么意思？这意味着虽然使用该工具是100%合法的，但如果您发现与其域关联的泄漏的存储桶，您应该通知任何公司。
- en: Important note
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: A leaky bucket is an S3 bucket that is open to the internet and is leaking sensitive
    information. If you discover a leaky bucket, contact the owner and notify them
    immediately!
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 泄漏的存储桶是一个向互联网开放并泄漏敏感信息的S3存储桶。如果发现泄漏的存储桶，请立即联系所有者并通知他们！
- en: It also means not using the tool for unethical reasons such as using discovered
    data to harm an organization.
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 这也意味着不要出于不道德的原因使用该工具，例如使用发现的数据来伤害组织。
- en: Moving forward, let's start to wrap up this chapter. We have learned a great
    deal about S3 environments and how to manipulate and exploit S3 buckets. Next,
    let's discuss a couple of extras about S3 and then start wrapping up.
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 继续前进，让我们开始结束本章。我们已经学到了很多关于S3环境以及如何操纵和利用S3存储桶。接下来，让我们讨论一些关于S3的额外内容，然后开始结束。
- en: S3 Burp Suite extensions
  id: totrans-343
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: S3 Burp Suite扩展
- en: 'Burp Suite is a tool commonly used for web application testing. We aren''t
    going to get deep into the details of how Burp Suite works, however, please stop
    by the PortSwigger website for more details: https://portswigger.net/burp.'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: Burp Suite是一个常用于Web应用程序测试的工具。我们不打算深入了解Burp Suite的工作原理，但是请访问PortSwigger网站以获取更多详细信息：https://portswigger.net/burp。
- en: With an enormous amount of available extensions, `aws-extender`. The extension
    allows you to scan for misconfigurations in S3 buckets.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 有了大量可用的扩展，`aws-extender`。该扩展允许您扫描S3存储桶中的配置错误。
- en: Before we begin, we need to ensure we have the most up-to-date Python package
    installed.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始之前，我们需要确保安装了最新的Python软件包。
- en: 'Download it here: [https://github.com/jythontools/jython](https://github.com/jythontools/jython).'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里下载：[https://github.com/jythontools/jython](https://github.com/jythontools/jython)。
- en: 'Now let''s move forward and retrieve a copy of the tool:'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们继续并获取该工具的副本：
- en: 'Start by retrieving a copy of the package:'
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先获取软件包的副本：
- en: '[PRE30]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Follow the instructions provided on the website and continue once complete.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 按照网站上提供的说明继续。
- en: 'After installing the new `jython` package, go ahead and clone the tool to your
    machine from this repository: [https://github.com/VirtueSecurity/aws-extender.git](https://github.com/VirtueSecurity/aws-extender.git):'
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装新的`jython`软件包后，从此存储库将该工具克隆到您的计算机：[https://github.com/VirtueSecurity/aws-extender.git](https://github.com/VirtueSecurity/aws-extender.git)：
- en: '[PRE31]'
  id: totrans-353
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Once you''re done, you''ll need to move onto the extensions and use `pip` to
    install the requirements:'
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，您需要转到扩展并使用`pip`安装要求：
- en: '[PRE32]'
  id: totrans-355
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: This portion may take a moment, so give it some time.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分可能需要一些时间，所以请耐心等待。
- en: Now you'll need to load the extension into Burp Suite. You can find `burpsuite`
    into a Terminal and the application will start up. Once you have the application
    started, go to the `aws-extender` Python program directory.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您需要将扩展加载到Burp Suite中。您可以在终端中找到`burpsuite`，然后启动该应用程序。启动应用程序后，转到`aws-extender`
    Python程序目录。
- en: We are going to move in a different direction really quickly and look at something
    really interesting – creating a local S3 lab that you can use for practice!
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将迅速转向另一个方向，看一些非常有趣的东西 - 创建一个本地S3实验室，供您练习使用！
- en: Creating a local S3 lab
  id: totrans-359
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个本地S3实验室
- en: There will be times where you may want to test S3 without having to set up a
    filesystem in the cloud. Due to S3 only allowing unique names, finding "test"
    names can become cumbersome, and creating a test environment can be tedious. However,
    that shouldn't hinder you from being able to set up a local lab where you can
    learn more about S3\.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 有时您可能希望在不设置云中的文件系统的情况下测试S3。由于S3只允许唯一名称，因此查找“测试”名称可能变得麻烦，并且创建测试环境可能会很繁琐。但是，这不应妨碍您能够设置一个本地实验室，以便更多地了解S3。
- en: '**MinIO** is a local storage system that can be used to house data that you
    would want in the cloud. The reason we mention it here in the book is because
    it is a great way to learn about S3 storage on your local network, without being
    restricted to only using names available in AWS. However, one of the drawbacks
    of MinIO is that policy setup can be a little bit of a learning curve or odd if
    you''re used to typical policy generation with AWS.'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: '**MinIO**是一个本地存储系统，可用于存储您希望在云中使用的数据。我们在书中提到它的原因是因为它是学习本地网络上的S3存储的一个很好的方式，而不仅仅局限于使用AWS中可用的名称。然而，MinIO的一个缺点是，如果您习惯于使用AWS进行典型策略生成，那么策略设置可能会有点学习曲线或奇怪。'
- en: 'Now you can do just that – set up a local S3 lab that you can use at your disposal
    with a program called **MinIO**, as per their statement:'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以这样做 - 设置一个本地S3实验室，您可以使用一个名为**MinIO**的程序，根据他们的说法：
- en: '*MinIO is High-Performance Object Storage released under Apache License v2.0\.
    It is API compatible with Amazon S3 cloud storage service. Using MinIO build high-performance
    infrastructure for machine learning, analytics and application data workloads.*'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: '*MinIO是根据Apache许可证v2.0发布的高性能对象存储。它与Amazon S3云存储服务兼容。使用MinIO构建用于机器学习、分析和应用数据工作负载的高性能基础设施。*'
- en: '*- MinIO*'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '*- MinIO*'
- en: 'You can locate more about the MinIO project here: [https://github.com/minio/minio](https://github.com/minio/minio).'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在这里找到有关MinIO项目的更多信息：[https://github.com/minio/minio](https://github.com/minio/minio)。
- en: Important note
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'You can find a full walk-through on how to set up MinIO here: [https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1](mailto:https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1).'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在这里找到有关如何设置MinIO的完整演练：[https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1](mailto:https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1)。
- en: I highly suggest looking through the documentation and setting up a local lab
    that you can use for testing and building your S3 skill sets, with the ease of
    using your local lab.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 我强烈建议查阅文档，并建立一个本地实验室，用于测试和构建您的S3技能，方便使用您的本地实验室。
- en: Summary
  id: totrans-369
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we learned quite a bit about S3 buckets and some ways to exploit
    common public bucket issues. We also learned more about AWS Regions and Availability
    Zones and what they are in relation to S3 buckets and AWS in general. The chapter
    also went over various scripting languages such as Python and Bash, and how we
    can use Python and Bash to scan S3 buckets.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学到了很多关于S3存储桶以及一些利用常见公共存储桶问题的方法。我们还了解了更多关于AWS区域和可用区域以及它们与S3存储桶和AWS的关系。本章还介绍了各种脚本语言，如Python和Bash，以及我们如何使用Python和Bash来扫描S3存储桶。
- en: To finish off, we took a look at a "real-world" scenario by applying proof of
    concept to a public S3 bucket that we made. It's encouraged that you create your
    own scenarios and execute them – while staying within the legal bounds of AWS
    practices and policies.
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们通过将概念验证应用于我们创建的公共S3存储桶，来看了一个“现实世界”的场景。鼓励您创建自己的场景并执行它们-同时要遵守AWS实践和政策的法律范围。
- en: Finally, we took a look at some other projects that can help us dive more into
    S3, without having to use AWS. Technology such as MinIO is a great resource to
    use if you're looking to set up a local S3 bucket lab.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们看了一些其他项目，可以帮助我们更深入地了解S3，而无需使用AWS。像MinIO这样的技术是一个很好的资源，如果您想要建立一个本地S3存储桶实验室。
- en: In the next chapter, we will go over what RDS is by discussing some key points
    and setting up an RDS database using MySQL.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论RDS的概念，讨论一些关键点，并使用MySQL设置RDS数据库。
- en: Further reading
  id: totrans-374
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'Public bucket tool: [https://github.com/Moos1e/Recon-Public-Buckets/tree/master](https://github.com/Moos1e/Recon-Public-Buckets/tree/master)'
  id: totrans-375
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公共存储桶工具：[https://github.com/Moos1e/Recon-Public-Buckets/tree/master](https://github.com/Moos1e/Recon-Public-Buckets/tree/master)
- en: 'MinIO setup in EC2: [https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1](mailto:https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1)'
  id: totrans-376
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: EC2中的MinIO设置：[https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1](mailto:https://medium.com/@jonathanchelmus/creating-an-s3-lab-on-an-ec2-instance-95ffd8ac6c1)
- en: 'More about S3: [https://aws.amazon.com/s3/features/](https://aws.amazon.com/s3/features/)'
  id: totrans-377
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于S3的更多信息：[https://aws.amazon.com/s3/features/](https://aws.amazon.com/s3/features/)
- en: 'Creating buckets: [https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html](https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html)'
  id: totrans-378
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建存储桶：[https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html](https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html)
- en: 'More about boto3: [https://realpython.com/python-boto3-aws-s3/](https://realpython.com/python-boto3-aws-s3/)'
  id: totrans-379
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于boto3的更多信息：[https://realpython.com/python-boto3-aws-s3/](https://realpython.com/python-boto3-aws-s3/)
