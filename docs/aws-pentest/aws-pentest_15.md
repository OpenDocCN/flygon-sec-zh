# 第十二章：AWS 的其他项目

为了结束这本书，我想简要提及另外两个不同的项目，这些项目值得注意并深入研究。在整本书中，我们已经从高层次和低层次（实际操作部分）来创建了对渗透测试的一致理解以及它对 AWS 的意义。本章将讨论一个开源框架，该框架由红队人员、渗透测试人员和道德黑客使用，使企业能够测试其组织上的真实对手战术和方法，以最终通过发现弱点来改进控制和防御。最后，我们将以一个有趣的练习结束，这个练习源自我在 2019 年提出的一个钓鱼项目，我们将学习如何利用 EC2 快速设置并产生影响的钓鱼练习，您可以在经授权的组织中使用。

在本章中，我们将涵盖以下主题：

+   理解 MITRE ATT&CK 框架

+   使用 AWS 进行钓鱼

# 技术要求

本章的技术要求如下：

+   MITRE ATT&CK Navigator：[`mitre-attack.github.io/attack-navigator/enterprise/`](https://mitre-attack.github.io/attack-navigator/enterprise/)

+   Kali Linux

+   本章使用的钓鱼程序：[`github.com/thelinuxchoice/blackeye`](https://github.com/thelinuxchoice/blackeye)

# 理解 MITRE ATT&CK 框架

根据范围的不同，渗透测试可能会变成一个庞大而繁琐的工作，可能会严重影响渗透测试的质量。在渗透测试时，我们希望能够提供创造性和现实的场景，以便与我们的客户和客户网络和系统进行互动。在渗透测试期间，我们称我们的行动和方法为**TTPs** - 其含义如下：

+   战术

+   技术

+   程序

这三个词构成了我们进行渗透测试的很大一部分；然而，如果我们不真正理解它们的含义，那么我们就无法利用它们。为了更好地理解它们，我们可以将它们应用到一个名为 MITRE ATT&CK 框架的开放知识库中，并通过将它们应用到现实场景中来讨论这些术语。

MITRE ATT&CK 框架使我们能够开发自己的方法和行动，以 TTPs 的形式实现对客户的质量承诺。该框架是一个庞大的知识库，充满了真实的对手战术，我们可以利用它来创建威胁模型和现实的渗透测试路线图。

MITRE ATT&CK 框架的另一个重要好处是，它让您模仿现实威胁场景，我们将在*发现 MITRE ATT&CK Navigator*部分中更详细地了解。在我们开始使用 MITRE 创建攻击路径之前，我们需要了解如何将其用于 AWS 渗透测试。接下来的部分将讨论 AWS 矩阵，该矩阵通过 MITRE ATT&CK 框架展示了战术和技术。

## 了解 AWS 矩阵中的 TTPs

MITRE ATT&CK 框架中的 AWS 矩阵使我们能够通过查看真实技术并将其应用于我们的渗透测试方法来推动我们的限制和攻击路径。由于渗透测试的方式有很多种，而且有很多不同的场景，AWS 矩阵使我们能够通过提供源自真实攻击的真实场景来少思考多行动。

要查看矩阵，请访问[`attack.mitre.org/matrices/enterprise/cloud/aws/`](https://attack.mitre.org/matrices/enterprise/cloud/aws/)。

让我们来看看矩阵及其在设置攻击方面的真正含义。以下截图显示了 AWS 矩阵的菜单：

![图 12.1 - MITRE ATT&CK](img/Figure_12.01_B15630.jpg)

图 12.1 - MITRE ATT&CK

这看起来像是一个非常复杂的 Excel 表格，但实际上并没有看起来那么复杂。它真正做的是分解我们在渗透测试过程中使用的攻击步骤 - 唯一的区别是这是使用真实世界的方法，而不是理论方法，所以让我们分解一下这些主题，以便我们可以简明地理解在对 AWS 进行渗透测试时它们的含义：

+   **初始访问**详细说明了我们可以获得允许访问面向用户的服务（如 S3、EC2、Lambda 等）的凭据的各种方式。这些凭据可以通过攻击路径以不同方式访问；然而，更常见的方式是通过暴露的 GitHub 和 GitLab。如果你访问以下链接，它显示了一个真正的**高级持续威胁**（**APT**）是如何通过使用受损的 Office 365 帐户收集凭据的：[`attack.mitre.org/techniques/T1078/004/`](https://attack.mitre.org/techniques/T1078/004/)。

以下是描述的屏幕截图：

![图 12.2 - APT33](img/Figure_12.02_B15630.jpg)

图 12.2 - APT33

请注意，它引用了一个真实的威胁行为者。这意味着我们可以使用这个属性来创建一个攻击客户的“真实”路径，以验证他们是否容易受到这种类型的攻击。

+   **持久性**包括维持对系统的访问。我们在*第九章*中做过这个，*使用 Metasploit 和更多进行现实生活的渗透测试*，当处理不同的 Metasploit 场景时。通常，我们可以创建帐户或使用我们拥有的有效帐户来保持持久性。**提升权限**的方式与此类似，涉及发现具有更高权限的有效 AWS 帐户，或者在受损帐户上执行垂直权限提升。

+   **防御规避**有各种技术可以执行，以帮助绕过防御，如 AWS 环境中的防火墙和其他检测服务。如果我们看一下**云计算基础设施**技术之一，我们会看到一个创建云实例的子技术。这是一个有趣的概念，因为在渗透测试期间，我们创建一个成为环境一部分并且可以在渗透测试期间用作流氓服务器的新实例。

+   关于这个过程的另一个重要部分是**发现阶段**。在这个阶段，对手 - 在这种情况下是渗透测试团队 - 使用各种技术来通过侦察和枚举收集有关目标网络的信息。我们通过使用各种工具发现 EC2、S3、Lambda 和开放信息来进行了相当多的侦察和发现。

+   接下来，一旦我们发现了目标，我们就朝着**收集**和**外泄**网络外的数据的方向前进。这意味着我们可以使用技术和程序将信息从网络中拉出并传输到我们的网络中。在对手的方法中，有访问 AWS 环境的威胁或恶意黑客会收集数据并将其推送到位于代理服务器后面的他们的服务器。

重要说明

代理服务器充当目标和攻击者服务器之间的中间主机。代理服务器用于“隐藏”攻击者服务器。

+   另一个值得一提的部分是 MITRE ATT&CK 框架的最后一部分涉及威胁的**影响**。影响可以是破坏网站或网页服务器，通过**DDoS**或**DoS**使服务中断。这些类型的攻击很常见，如果在渗透测试期间发生了什么，或者更糟糕的是，如果实际威胁或 APT 造成了大规模影响，这可能会对组织造成真正的伤害！

重要说明

要更多地了解 MITRE ATT&CK 框架，请查看完整的框架：[`attack.mitre.org/`](https://attack.mitre.org/)。

现在我们已经讨论了 MITRE ATT&CK 框架，让我们开始看看 MITRE ATT&CK Navigator - 一个让我们在高层次上映射和说明攻击的工具。

## 发现 MITRE ATT&CK Navigator

在本节中，我们将快速看一下如何在高层次上使用该工具，以及运营商（红队员）和渗透测试人员如何使用这种插图类型的工具来揭示特定攻击。在这个例子中，我们将看一下 APT33 使用的一些攻击，APT33 是一个被怀疑的伊朗威胁组织，自 2013 年以来一直进行着行动。APT33 的目标包括美国、沙特阿拉伯和韩国等国家，他们对航空领域感兴趣。您可以在这里找到有关 APT33 的更多信息：[`attack.mitre.org/groups/G0064/`](https://attack.mitre.org/groups/G0064/)。

让我们从这里开始导航器：[`mitre-attack.github.io/attack-navigator/enterprise/`](https://mitre-attack.github.io/attack-navigator/enterprise/)。

在导航器上，按照以下步骤创建 APT33 路线图：

1.  在**部分工具**部分点击**多选**，并在**威胁组**部分向下滚动，直到找到**APT33**。找到后，点击**选择**：![图 12.3 - MITRE 导航器中的下拉菜单](img/Figure_12.03_B15630.jpg)

图 12.3 - MITRE 导航器中的下拉菜单

1.  现在我们已经选择了**APT33**，我们已经选择了它的所有技术。现在，让我们通过点击**技术控件**下的油漆桶来突出显示这些技术。在这个例子中，我们选择了**红色**作为颜色：![图 12.4 - 使用颜色突出显示攻击方法](img/Figure_12.04_B15630.jpg)

图 12.4 - 使用颜色突出显示攻击方法

1.  选择颜色后，您的屏幕应该开始填充您选择的颜色。这些颜色突出显示了**APT33**使用的策略和技术，以及您的渗透测试团队如何执行这些攻击。这也是向高层管理人员展示攻击者如何针对其他 AWS 环境的方式，并允许就如何防范这类攻击进行公开讨论。以下是来自 ATT&CK Navigator 的**APT33**的攻击路线图的插图：

![图 12.5 - 完整的突出显示的攻击路径](img/Figure_12.05_B15630.jpg)

图 12.5 - 完整的突出显示的攻击路径

这就是本章的导航器部分。正如你所看到的，**导航器**是一个很棒的、简单而简洁的工具，它将帮助我们向高层管理人员和我们的渗透测试团队说明我们的攻击路径，并允许我们在保持在轨道上的同时执行我们的渗透测试。

现在我们了解了如何将 MITRE ATT&CK 与我们的渗透测试结合使用，让我们来看看攻击者和渗透测试人员如何通过钓鱼手段和方法获得初始访问权限。

# 通过钓鱼上钩

钓鱼是一种网络攻击，占受害组织遭受的入侵的约 70%。这种不太技术性的欺骗技术通常涉及攻击者制作某种类型的有效负载，然后将其发送给一个或多个受害者。有效负载包括一封带有某种恶意软件或链接的电子邮件，诱使用户点击它们。这是通过欺骗和借口的艺术来使用的，通常有一种诱饵用于诱使目标。

现在，让我们继续看看如何在教育环境中应用钓鱼。这样做的目的是帮助您，读者，了解一个简单而有效的钓鱼网站可以如何执行**基本**的技术属性。

## 使用 AWS 执行钓鱼

现在我们了解了什么是网络钓鱼，让我们来看一个快速但非常有趣的例子，使用我们的 AWS Kali Linux 机器来执行网络钓鱼攻击的练习。在开始之前，您需要确保您的 Kali Linux 机器已经启动并运行。一旦您的 Kali Linux 机器运行起来，通过其公共 IP 地址 SSH 连接到它。一旦您登录到 Kali 机器，按照以下步骤进行：

1.  从 GitHub 获取 BlackEye 的副本：

```
$ git clone https://github.com/thelinuxchoice/blackeye
```

1.  接下来，切换到该工具的目录：

```
$ cd blackeye
```

1.  启动应用程序：

```
$ bash blackeye
```

1.  启动应用程序后，您将被提示选择要克隆用于网络钓鱼攻击的网站。在这种情况下，我们将选择**Linkedin**，选择选项**13**：![图 12.6 – BlackEye 主屏幕](img/Figure_12.06_B15630.jpg)

图 12.6 – BlackEye 主屏幕

1.  在选择选项**13**后，确保将**公共 DNS**作为本地 IP。这将确保该工具绑定到我们的本地 DNS 名称以进行路由。

现在站点已经运行并等待目标访问，或者它在网络钓鱼邮件中，让用户点击链接。

要查看页面，请将公共 DNS 输入到您首选浏览器的 URL 栏中：

![图 12.7 – 钓鱼 LinkedIn 网站](img/Figure12.07_B15630.jpg)

图 12.7 – 钓鱼 LinkedIn 网站

正如我们所看到的，该网站看起来很正常；然而，我们可以看到在顶部附近的搜索栏中的 URL 不同。对于一个警觉的用户来说，这将是一个明显的指示，表明这是一个网络钓鱼计划；然而，一个不太警觉的用户可能会被欺骗并输入他们的信息。

尝试向应用程序输入一些凭据。请勿使用您的合法 LinkedIn 凭据！

一旦您输入您的凭据，点击**登录**，就像您通常会做的那样。您应该会被重定向到真正的 LinkedIn 页面。发生的事情是 BlackEye 工具收集了您的凭据，并将您重定向到实际的 LinkedIn 页面再次尝试登录。普通用户可能会将此视为潜在错误，然后再次尝试登录。然而，如果我们查看后台并返回到我们的 Kali 终端，我们会注意到另一件事——我们的凭据已经被收集并保存了！

![图 12.8 – 被盗的凭据](img/Figure_12.08_B15630.jpg)

图 12.8 – 被盗的凭据

正如我们所看到的，我们有可以用来访问 LinkedIn 的凭据。当然，这些并不是合法的；然而，在现实生活中的网络钓鱼计划中，收集到的凭据可能会导致很多麻烦，比如欺诈、身份盗用和数据泄露。

重要提示

关于这个主题的有趣互动视频，请查看*Simply Cyber*，以了解使用这个工具的精彩现场演示！

[`www.youtube.com/watch?time_continue=2&v=aa7e7oLPyp4&feature=emb_logo`](https://www.youtube.com/watch?time_continue=2&v=aa7e7oLPyp4&feature=emb_logo)

# 总结

在本章中，我们通过分析和讨论 MITRE ATT&CK 框架，学习了一些攻击技术，然后通过一个有趣的互动练习结束了本章，该练习利用 AWS 进行 AWS 网络钓鱼活动。

这一章结束了。我希望您和我一样喜欢阅读它！

# 进一步阅读

关于 AWS 上真实攻击的文章：[`www.darkreading.com/cloud/hackers-use-public-cloud-features-to-breach-persist-in-business-networks/d/d-id/1332618`](https://www.darkreading.com/cloud/hackers-use-public-cloud-features-to-breach-persist-in-business-networks/d/d-id/1332618)
