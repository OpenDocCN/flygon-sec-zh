# *第一章*：构建您的 AWS 环境

**亚马逊网络服务**（**AWS**）是一个不断发展的云技术提供商，许多公司使用它来帮助存储他们的数据。AWS 起源于 2006 年底的华盛顿西雅图，正逐渐成为最重要的服务提供商。由于其易用性和用户友好的界面，AWS 被超过 80 万家公司使用，占据了 65%或更多的云基础设施空间。本书将经常讨论一些较为知名的服务，如 S3、Lambda 和 EC2，并且这些服务在现实世界中被广泛使用。

本章将介绍 AWS 的基础知识，并指导您设置 AWS 账户。我们学习如何配置和准备 AWS 账户的基础知识非常重要，这样在设置账户后就不需要进行额外的管理。设置账户后，我们将设置几个具有不同操作系统版本的 EC2 实例，并查看这些操作系统中的易受攻击的服务。鼓励您在完成本章后，查看如何在您的环境中构建更多的 EC2 实例，使用其他操作系统。

在本章中，我们将通过以下主题探索 AWS：

+   探索亚马逊网络服务

+   了解测试环境

+   配置环境

+   探索易受攻击的服务

+   攻击漏洞

+   AWS 命令行界面

# 技术要求

要按照本章的说明进行操作，您需要以下内容：

+   您选择的浏览器（Chrome，Firefox，Edge）

+   PuTTY: [`www.chiark.greenend.org.uk/~sgtatham/putty/`](https://www.chiark.greenend.org.uk/~sgtatham/putty/)（安装步骤在*使用 PuTTY 连接*部分有介绍）。

查看以下视频以查看代码的实际操作：[`bit.ly/3kPrVkh`](https://bit.ly/3kPrVkh)

# 探索亚马逊网络服务（AWS）

AWS 是由西雅图科技公司亚马逊提供的云服务。AWS 全面而易于设置，非常受小型初创公司和大型企业的青睐。它通过允许公司和企业在亚马逊的物理资源之外设置他们的基础设施来运作。这种服务称为**基础设施即服务**，它将云计算作为一个整体服务交付。随着我们在本书中设置我们的实验室，您将看到在 AWS 中自动化和构建是多么容易。然而，您也会注意到一些可能经常被忽视的问题，比如安全性。

AWS 并不完全对公司的数据和安全负责。事实上，亚马逊发布了一个*共享责任模型*，确保双方了解他们在客户数据方面的权利和责任。毕竟，亚马逊是一个以“以客户为中心”而闻名的公司。

## AWS 安全和渗透测试

当您阅读本书时，您将接触到一些以前可能没有讨论过的不同概念。这是因为 AWS 渗透测试是一个相对新的主题，在信息技术安全领域越来越受欢迎。这件好事是它允许主题专家帮助创建围绕 AWS 的渗透测试文化，并为在 AWS 和系统安全中执行渗透测试提供新的想法。

接下来，您将深入了解 AWS，并创建自己的账户。之后，我们将开始创建我们自己的云渗透测试游乐场，我们将在其中设置一个易受攻击的主机，以便以后进行测试。

# 了解我们的测试环境

了解我们将要部署的所有系统及其在本书中的用途至关重要。构建实验室有助于安全研究，因为它允许您执行与真正黑客相同的策略和技术，而无需担心违反任何法律。对于我们的实验室，我们将设置各种主机，模拟您在企业中看到的真实系统。唯一的区别是我们将使用一些较旧版本的软件和操作系统。使用较旧的系统的目的是因为它们通常比最新版本更容易受到攻击，这样学习渗透测试就更容易 - 也更有趣！

我们希望确保我们学习一点点所有内容，因此我们将使用基于 Windows 和 Unix 的操作系统。这些系统构建方式大不相同，但是在现实的渗透测试情况下，您将会遇到这些系统。

此外，我们将使用一个名为“Kali Linux”的操作系统作为我们的黑客操作系统。Kali Linux 是一个非常受欢迎的黑客操作系统，主要用于渗透测试社区，主要是因为它预装了各种黑客工具套件，并由攻击性安全维护。

# 配置您的环境

配置您的环境是本书中最重要的任务。没有它，您将无法测试您的技能！构建环境将教会您如何配置实例，向其添加资源，并连接到它们。

## 设置账户

要开始创建自己的 AWS 账户，请按照以下步骤进行：

1.  请打开您选择的浏览器，并转到位于[`aws.amazon.com/`](https://aws.amazon.com/)的 AWS 首页。

您将被迎接一个登陆页面，并会看到一个名为**创建免费账户**的按钮。只需点击**创建免费账户**开始创建您的个人资料：

![图 1.1 – AWS 账户创建](img/Figure_1.01_B15630.jpg)

图 1.1 – AWS 账户创建

1.  点击按钮后，您将看到如何创建 AWS 账户。根据信息填写表格。如果您使用学生邮箱地址，您可以获得额外的好处：![图 1.2 – 账户创建表格](img/Figure_1.02_B15630.jpg)

图 1.2 – 账户创建表格

1.  填写完表格后，点击**继续**，您将收到一封电子邮件，其中会有问候语并欢迎您加入 AWS：

![图 1.3 – AWS 账户创建后的电子邮件](img/Figure_1.03_B15630.jpg)

图 1.3 – AWS 账户创建后的电子邮件

恭喜，您现在拥有自己的账户，可以在本书的其余部分中使用。在继续之前，随意了解 AWS 中所有可用的资源。AWS 充满了您可以随时使用的资源和信息。一旦准备好，继续下一节，学习如何创建您自己的 EC2 实例。

重要提示

在设置账户时，尽可能使用.edu 地址。您可以使用 AWS 账户的其他优惠。本章末尾将提供有关学生福利的更多信息的链接。

下一节将讨论如何在您的新 AWS 账户中创建您自己的 EC2 实例。

## 设置 EC2 实例

**EC2**（弹性计算云）实例基本上取代了硬件的需求，通过在亚马逊云中提供可伸缩的计算。将 EC2 实例视为没有操作系统的计算机。这是有益的，因为它允许组织扩展其系统，几乎没有额外开销！然而，虽然拥有这样一个简单的解决方案是有益的，但缺点可能表现为常见的管理不善。部署 EC2 实例非常容易，但管理员可能会忽视它。但是那台计算机是别人的计算机，您正在租用它。请记住，一台计算机只是一台计算机，因此您需要在上面安装操作系统。

在我们开始讨论我们正在创建的实例之前，让我们简要提一下为什么我们要设置这些实例。作为渗透测试人员，理解系统的设置方式是很重要的。通常，渗透测试人员来自开发和系统管理员背景，并且对系统工作原理有基本的理解。我们正在设置各种操作系统，并首次查看 EC2 实例和操作系统中实现的常见问题。让我们看看本章中我们将要创建的内容。

我们将创建三个具有不同镜像的 EC2 实例。这样做将使我们了解如何访问每个系统与其他系统不同。我们将安装的第一个操作系统将是**CentOS 7**。

CentOS 是一个非常流行的基于 Unix 的操作系统，它将允许我们更深入地探索 Linux 文件系统的工作原理。在学习渗透测试时，暴露于各种系统是至关重要的，因为在这个领域，你可能会有各种目标需要进行渗透测试。

## 使用 CentOS 设置 EC2 实例

如果你还没有，请登录你的 AWS 账户。一旦你登录你的账户，你将进入**AWS 管理控制台**。这是我们将开始为本章创建 EC2 实例的地方。以下步骤介绍了如何部署 EC2 实例：

1.  从主控制台中，你会看到**计算**下面的**EC2**。点击它开始创建 EC2 实例的过程：![图 1.4–AWS 管理控制台](img/Figure_1.04_B15630.jpg)

图 1.4–AWS 管理控制台

1.  点击它后，你会看到左下角有一个标有**启动实例**的按钮。左侧下拉窗格中还有**实例**选项。点击**启动实例**开始构建你的第一个 EC2 实例：

![图 1.5–EC2 启动](img/Figure_1.05_B15630.jpg)

图 1.5–EC2 启动

点击**启动实例**后，你需要在你的 EC2 实例中配置一个主机操作系统。对于本练习，我们将选择最小的 CENTOS 7 安装作为我们的主机操作系统。这个操作系统将是 EC2 实例中的“生存者”。

现在我们已经设置好了 AWS 账户，我们将逐步分解所需的步骤来构建 EC2 实例。如前所述，EC2 实例是我们的操作系统所在的地方。我建议你熟悉这个过程，因为在本书中你将经常构建实例。要开始设置一些实例，请按照提供的步骤开始。这些步骤是按顺序构建 EC2 实例的。如果你错过了某一步，请确保在继续之前回过头来补上这一步：

1.  选择 Amazon 机器镜像：前往 Amazon 市场搜索一个镜像来安装在你的 EC2 实例上。如前所述，我们将使用**CentOS 7**作为示例：![图 1.6–EC2 操作系统](img/Figure_1.06_B15630.jpg)

图 1.6–EC2 操作系统

1.  选择实例类型：确保使用免费套餐以避免收费。如果你忘记了，亚马逊将会按月向你收取超出计划的任何使用费用。但是，如果你愿意，可以随意使用付费套餐。对于本练习，我们将使用免费套餐，因为它足够使用。

1.  之后，你将需要创建一个新的**虚拟私有云**（**VPC**）网络，你的 EC2 实例可以驻留在其中。VPC 充当一个允许 VPC 内其他实例之间进行安全通信的网络。它还允许通过 VPN 连接 VPC 之外的连接：![图 1.7–创建 VPC](img/Figure_1.07_B15630.jpg)

图 1.7–创建 VPC

1.  之后，你需要创建一个子网，让你的主机可以连接到。确保你记住 VPC 和子网，以备设置其他实例时使用：![图 1.8–创建 VPC 第 2 部分](img/Figure_1.08_B15630.jpg)

图 1.8–创建 VPC 第 2 部分

1.  接下来，您将被提示关于操作系统的存储。分配的存储空间将足够进行练习：![图 1.9 – 存储设置](img/Figure_1.09_B15630.jpg)

图 1.9 – 存储设置

1.  接下来，我们将为实例配置路由。路由将允许或禁止流量在实例的某些端口上进出。在本练习中，请设置如下所示的路由：

```
SSH : TCP : 22 : ANYWHERE //Allowing any connections over port 22
Custom UDP : UDP : 0 - 65535 : ANYWHERE // Allowing any conections of all UDP Ports
Custom TCP : TCP : 0 - 65535 : ANYWHERE // Allowing any conntections over any TCP ports
```

以下截图突出显示了我们正在进行和输入的更改：

![图 1.10 – 创建安全组](img/Figure_1.10_B15630.jpg)

图 1.10 – 创建安全组

1.  您需要创建一个密钥对，以便连接到您的实例。确保将密钥对保存在一个不会丢失的地方。您需要使用该密钥来访问实例。以下截图说明了命名密钥为`AWS Pentest`。随意命名您喜欢的内容：![图 1.11 – 创建密钥对](img/Figure_1.11_B15630.jpg)

图 1.11 – 创建密钥对

1.  一旦您命名了密钥对，下载并将其保存在安全的地方。确保保存密钥，并在原始密钥丢失时制作副本。您将无法从实例中检索密钥。![图 1.12 – 运行 EC2 实例的仪表板](img/Figure_1.12_B15630.jpg)

图 1.12 – 运行 EC2 实例的仪表板

1.  完成后，单击**运行实例**以检查您的实例。我们将在本书后面讨论如何通过 SSH 连接到它。

您现在已经设置了第一个实例！如果您在连接时遇到权限错误等问题，请不要感到压力；确保您已经为实例的密钥设置了正确的权限。右键单击实例，然后单击**连接**以获得如何设置权限的建议。我们稍后将讨论连接到实例。现在，先发现 AWS 控制台中提供了什么。我们将会谈论很多内容，但先看一看并了解一下也无妨。准备好后，继续下一节。

## 设置 Windows 主机

接下来的部分将讨论如何在 AWS 中设置 Windows 主机。设置主机将与设置 CentOS 7 服务器非常相似，但也有一些不同之处。重要的是，我们要了解 Windows 系统的工作原理以及如何在 AWS 中设置它们。随着您进行渗透测试的旅程，您会发现许多企业在其 AWS 环境和现场设备中使用 Windows。

让我们设置主机：

1.  让我们回到 AWS 管理控制台，并选择**启动实例**以启动另一个实例，就像之前一样。

1.  转到 AWS 市场并选择**Windows Server 2008 R2 Base**。

重要提示

我们希望使用旧版本，而不是新版本，因为在旧版本中安全问题更容易被利用。由于本书的目的是学习，我们希望能够轻松地利用通常在旧版本中发现的已知问题，而不是试图利用加固的新操作系统。确保选择与之前相同的 VPC 设置。这样做可以确保所有 VM，如您的 CentOS 7 和 Windows 主机，都在同一网络上。这将有助于我们在后面进行渗透测试时，因为我们将在同一虚拟网络上工作，使实例之间更容易进行通信。

在市场上看起来是这样的：

![图 1.13 – Windows 2008 EC2](img/Figure_1.13_B15630.jpg)

图 1.13 – Windows 2008 EC2

1.  与之前一样，我们需要确保打开正确的端口。请注意`3389`端口是打开的。端口`3389`是与**RDP**相关联的端口。正确设置这一点可以确保您以后可以连接到 Windows 主机：![图 1.14 – Windows 2008 EC2 开放端口](img/Figure_1.14_B15630.jpg)

图 1.14 – Windows 2008 EC2 开放端口

1.  现在我们已经准备好主机，我们需要连接到它。由于这是一个 Windows 主机，我们无法像传统方式那样通过 SSH 连接到它。这是因为主机使用端口`3389`上的远程桌面协议，而不是使用端口`22`上的 SSH。我们不需要获取密钥，而是需要获取存储在 Windows 主机上的密码。

1.  要获取密码，只需右键单击 Windows 实例，然后选择**获取 Windows 密码**。如果刚刚设置了 Windows 主机，可能需要最多 4 分钟才能解密密码：![图 1.15 - Windows 2008 EC2 密码检索](img/Figure_1.15_B15630.jpg)

图 1.15 - Windows 2008 EC2 密码检索

1.  通过输入加密密码来解密密码，如图所示。在字段中放入密码后，单击**解密密码**：![图 1.16 - 解密 Windows 密码](img/Figure_1.16_B15630.jpg)

图 1.16 - 解密 Windows 密码

1.  完成后，您将收到一个**用户名**和**密码**的提示，以访问您的主机。与以前一样，请确保将这些凭据保存在安全的地方，以免丢失。但是，只要您拥有加密密码，就可以恢复它们。存储加密密码可以像将其存储在密码保险库中那样简单，或者将其存储在云存储空间中，例如 S3 存储桶中。确保只有您可以访问存储位置。为了获得最佳结果，实施基于用户的文件系统访问控制：

![图 1.17 - 用户名和密码](img/Figure_1.17_B15630.jpg)

图 1.17 - 用户名和密码

要测试连接，请在主机上打开远程桌面客户端，并使用 EC2 实例的公共 DNS。如果一切顺利，您应该能够登录到桌面！

## 攻击者设置 - 设置 Kali 实例

在本节中，我们将设置一个可以充当攻击主机的**Kali Linux**镜像。Kali Linux 是安全专业人员用来测试其系统和应用程序的流行操作系统。这在很大程度上是因为操作系统预装了可以帮助枚举和利用的工具！Kali Linux 将作为我们主要主机之一，并将成为您在渗透测试中使用的工具！

由于我们已经知道如何设置 EC2 实例，我们将只专注于如何使用名为**PuTTY**的工具连接我们的 Kali 主机。PuTTY 是一种允许管理员远程访问其系统的工具，正如我们将在本章后面所做的那样。在设置 Kali 机器时，请确保使用与其他机器相同的 VPC 和子网设置：

1.  首先，转到**AWS Marketplace**并检索 Kali Linux 的实例。然后继续创建 EC2 实例，就像您在之前的练习中所做的那样：![图 1.18 - Kali Linux EC2 实例](img/Figure_1.18_B15630.jpg)

图 1.18 - Kali Linux EC2 实例

与以前一样，请确保创建一个新的密钥对并使用新名称。

重要提示

最好为每个实例创建新的密钥，并且不要在实例之间共享密钥。在现实世界的情况下，如果一个密钥被泄露，*所有*主机都使用相同的密钥，那么可以假定所有主机都将被泄露。这将成为所有主机之间的“共享秘密”。

窗口如下所示：

![图 1.19 - Kali 秘钥](img/Figure_1.19_B15630.jpg)

图 1.19 - Kali 秘钥

1.  现在我们有了密钥对，我们需要连接到 Kali 机器。从控制台右键单击实例，然后按照连接说明连接到您的实例：

```
$ chmod 400 "Kali - AWS - Pentest.pem"
$ ssh -i "Kali - AWS - Pentest.pem" ec2-user@<AWS instance>
```

以下截图显示了这些命令的步骤及其含义，以帮助理解这些命令在做什么：

![图 1.20 - Kali 信息](img/Figure_1.20_B15630.jpg)

图 1.20 - Kali 信息

正如您在截图中所看到的，提示突出显示了在访问 EC2 实例之前需要进行的一些日常事务步骤。

1.  打开 SSH 客户端。在我们的情况下，我们将使用 PuTTY 进行连接，并将在下一节中看看如何连接。

1.  找到我们刚保存的`.pem`文件。`.pem`文件充当秘钥，允许你对 EC2 实例进行身份验证。

1.  我们需要使用`chmod`命令更改密钥的权限。

1.  分配给我们实例的公共 DNS 名称是连接到实例的资源名称。

1.  最后，该命令向我们展示了如何使用预先安装在我们的 Linux 机器上的 SSH 命令，使用秘钥和用户名`root`连接到我们的云资源。

接下来，我们将看看如何使用 PuTTY 连接到实例。

## 使用 PuTTY 连接

PuTTY 是一个工具，允许用户从各种端口连接到主机。与终端或命令行不同，PuTTY 提供了一个界面，允许用户通过鼠标点击与主机交互，而不是必须通过终端连接。我们必须了解连接到我们实例的各种方式，PuTTY 是连接到真实环境中的 EC2 实例的常用资源。

我们可以使用 PuTTY 或 SSH 连接到我们在自己实验室中设置的任何实例。本节的目的是引导你完成从分配给 EC2 实例的私钥创建 SSH 密钥的步骤：

1.  首先确保 PuTTY 已安装在你的计算机上。你可以在这里下载适合你的客户端([`www.chiark.greenend.org.uk/~sgtatham/putty/`](https://www.chiark.greenend.org.uk/~sgtatham/putty/))。安装完成后，继续转换私钥。

1.  启动一个名为`.pem`文件的程序。我们之前也使用我们的 CentOS 7 实例创建了`.pem`文件。一旦将密钥加载到`.ppk`中：![图 1.21 - PuTTY 密钥生成器](img/Figure_1.21_B15630.jpg)

图 1.21 - PuTTY 密钥生成器

1.  现在你已经创建了一个`.ppk`文件，是时候启动 PuTTY 并测试你的连接了。转到**连接** > **SSH** > **Auth**，加载你在上一步创建的新密钥：

![图 1.22 - PuTTY 密钥配置](img/Figure_1.22_B15630.jpg)

图 1.22 - PuTTY 密钥配置

一旦密钥准备就绪，就可以输入启动连接到实例所需的具体数据了。以下步骤将指导你完成这个过程：

1.  返回 PuTTY 中的**会话**选项卡。在会话选项卡中，输入你要连接的实例的**主机名**。主机名是你可以在 AWS 控制台中找到的公共 DNS 记录。你也可以点击你的实例上的**连接**来获取公共 DNS 名称。

1.  一旦主机名配置好，确保端口设置为`22`以进行**SSH**连接：![图 1.23 - PuTTY 连接](img/Figure_1.23_B15630.jpg)

图 1.23 - PuTTY 连接

1.  现在我们准备连接到我们的实例。点击`.ppk`文件：![图 1.24 - PuTTY 终端](img/Figure_1.24_B15630.jpg)

图 1.24 - PuTTY 终端

1.  现在你以`ec2-user`用户登录。这个用户权限不是很高，所以可以随意通过以下命令切换到 root 账户来更改权限：

```
$ sudo su 
```

这些特权允许用户在基于 Linux 的操作系统上更改、读取和执行任何文件。这些高特权用户可以在文件路径`/etc/sudoers`中找到。恭喜，你现在已成功使用 PuTTY 连接到你的实例。

完成了这一部分，做得很好！现在你应该可以轻松地在 AWS 中设置 EC2 实例，也了解了配置各种操作系统的基础知识。正如所述，你理解这些差异非常重要，因为在渗透测试中，你将接触到许多操作系统，如基于 Windows 和 Unix 的系统。

接下来，我们将继续查看易受攻击的服务，以及如何利用我们的知识在渗透测试环境中设置易受攻击的服务。

# 探索易受攻击的服务

如果不打补丁，有漏洞的服务可能是系统的软肋。 这意味着漏洞如果不打补丁，会在公司的系统中留下严重的弱点，可以让恶意黑客获取访问权限。 漏洞被归类为系统中的问题，如果不修复，可能会在成为攻击向量时造成严重问题。 漏洞有许多变种，可以以过时的操作系统、开放端口、未经授权的访问等形式出现。 为了修复已知的漏洞并保护系统免受攻击，必须相应地安装补丁和更新。 这样做有助于解决您将看到的大多数主要问题。

## 发现有漏洞的服务

现在我们知道了漏洞是什么，让我们提一下渗透测试发现漏洞的典型方式：

1.  确保您有一个目标列表。 目标被分类为主机-我们可以将 EC2 实例视为主机。

1.  一旦您有主机列表，您将需要扫描它们并从中枚举信息。 扫描可以使用各种工具，我们将在*第九章**，使用 Metasploit 和更多进行真实渗透测试*中使用更多。

1.  然后，您会创建与扫描和枚举时发现的漏洞相关的风险。 风险通常被标记为**低**、**中**、**高**或**关键**-**关键**具有最大的影响。

1.  在扫描时，您可能还会发现“低挂果实”。 低挂果实是易于利用的漏洞，允许您快速利用目标。

1.  发现的漏洞应立即报告，以便可以正确修补它们。 通常，另一个团队被指定来修复这些问题并对系统应用补丁。

这是在渗透测试环境中发现漏洞的基础。 现在让我们从管理员的角度看一下如何创建有漏洞的服务。

## 创建有漏洞的服务

在这个简短的示例中，我们将在我们的 CentOS 7 机器上安装`vsftpd`并启用匿名登录。 匿名登录是相当多 FTP 客户端的默认功能，并允许任何人使用以下凭据连接到 FTP：

+   用户名：`匿名`

+   密码：`匿名`

正如您可能已经猜到的那样，允许任何人如此轻松地访问您的服务器会带来巨大的安全风险。 我们将学习如何将服务器设置为有漏洞，然后稍后将学习一些我们可以采取的安全控制措施来锁定 FTP 服务器：

1.  `ssh`进入我们设置的 CentOS 7 服务器。 您需要以用户**ec2-user**登录，而不是**root**。

1.  登录到服务器后，运行以下命令来更新服务器并安装`vsftp`服务：

```
$ sudo yum update
```

1.  接下来运行以下命令：

```
sudo su to switch over to the root user account. This will allow you to run all commands as the root user.
```

1.  通过输入`sudo service vsftpd status`来验证服务是否正在运行。 现在`vsftpd`已安装，我们需要确保匿名登录已启用。 运行以下命令访问`vsftpd`配置文件：

```
anonymous_enabled=YES
```

它将看起来像以下的屏幕截图：

![图 1.25-安装 Metasploit](img/Figure_1.25_B15630.jpg)

图 1.25-安装 Metasploit

现在您的服务器已设置为匿名登录。 本书的后面，在*第三章**，探索渗透测试和 AWS*中，我们将讨论如何从本地和远程连接到服务，以及如何从环境中的其他实例进行扫描。

我们现在对漏洞是什么以及如何自己复制它们有了一些了解。了解我们将在本书中进行的技术属性的全部范围是很重要的。关于漏洞，请注意，发现漏洞并不等同于攻击它们。在发现漏洞时，您将被指派发现、评估和评估任何发现的漏洞。渗透测试通过手动和自动利用进一步攻击和利用这些漏洞。

让我们继续讨论攻击漏洞的内容。

# 攻击漏洞

攻击漏洞是网络安全中更有趣的方面之一。发现并修补您可能发现的问题是一回事，但实际攻击它则需要您的技能达到另一个水平！攻击漏洞是渗透测试与其他安全职业的区别所在。大多数安全职位只是发现和补救，而渗透测试则攻击和利用发现的问题。这样做可以揭示一个系统的安全姿态有多真实或不真实。您将听到的更流行的工具之一是 Metasploit。

## 探索 Metasploit

在渗透测试社区中，一个流行的工具是被称为**Metasploit Framework**的框架。也被称为**Metasploit**，这个自动化软件预装在 Kali Linux 上，具有可以配置和启动在易受攻击主机上的漏洞和有效载荷。它还具有适用于各种操作系统的漏洞和各种类型的有效载荷。这些漏洞被称为模块，并且是用**Ruby**创建的。

其中一个更常见的漏洞是`443`。监听器可以设置为在端口`443`上监听，并在执行 Web 漏洞后建立连接。我们将在*第九章**，使用 Metasploit 进行真实渗透测试和更多!*中看到更多使用 Metasploit 的方法。

我们需要学会走路才能跑，所以现在让我们来看看如何在我们的 Kali Linux 主机上设置 Metasploit。接下来的部分将给您一个练习，让您启动和运行 Metasploit。

对于这个练习，我们只是要连接到 Kali Linux 主机并更新 Metasploit。新的漏洞不断上传到 Metasploit，因此经常更新是很重要的。

1.  这就是我们将如何更新 Metasploit。通过之前使用 PuTTY 方法设置的 Kali 实例连接到它。如果需要，可以查看连接部分。一旦连接，您将希望切换到`sudo su`。

1.  现在您是**root**用户，让我们将 Metasploit 更新到当前版本。我们希望确保 Metasploit 更新了最新的漏洞和模块进行测试。要更新工具，请输入以下命令：

```
$ apt install metasploit-framework
```

屏幕截图显示了在我们的 Kali Linux 终端中执行的命令：

![图 1.26 – 安装 Metasploit](img/Figure_1.26_B15630.jpg)

图 1.26 – 安装 Metasploit

1.  一旦连接，您将能够启动一个全新的数据库中充满了漏洞的 Metasploit。在以前的几年里，您必须在启动 Metasploit 之前在后台启动数据库。然而，现在，以下命令将在后台启动一个运行的数据库启动 Metasploit：

```
$ msfdb run
```

随意熟悉 Metasploit。有大量的资源可以学习有关这个流行的渗透测试工具的所有内容。我们将在本书中大量使用这个工具，所以如果您不想在互联网和书籍中寻找更多信息，也不用担心。

在本节中，我们学到了关于什么是一个易受攻击的服务以及如何设置它的一些知识。我们还简要介绍了攻击这些漏洞意味着什么，并学到了一些关于 Metasploit 的知识-这是渗透测试社区中非常流行的工具。

接下来，我们将学习 AWS 命令行界面以及如何安装它并使用它。

# AWS 命令行界面（CLI）

AWS CLI 是一个很棒的命令行工具，可以让您与 AWS 技术进行交互，比如 S3 存储桶，与 EC2 实例等进行交互。我们将开始看到在*第四章**，利用 S3 存储桶*中更深入地实施 AWS CLI 的实际用例。AWS CLI 是一个很好的学习和熟悉使用类似终端的界面的方式，因为它允许您与 AWS 环境中的一切进行交互。对于渗透测试来说，熟悉使用命令行和/或终端总是很好的，因为您永远不知道 GUI 何时会不起作用。想象一下，当您进行渗透测试时，您的工具界面冻结了，或者应用程序的前端出现错误并停止工作。这就是理解命令行的好处所在。

## 安装 AWS CLI

现在我们需要继续在我们的 Kali Linux 机器上安装 AWS CLI。这将是我们在本书中使用的命令行，以与我们的 AWS 环境进行交互：

1.  首先，让我们检查一下 AWS CLI 是否已经安装在我们的机器上：

```
$ aws --version
```

1.  如果您有旧版本，您应该查看您有哪个版本。如果您有一段时间没有使用它，最好重新安装：

```
$ apt-get remove awscli -y
$ apt-get install awscli -y
```

1.  通过再次运行`--version`开关来确保您的命令行界面已成功安装。

现在您的主机已经设置好，可以与 AWS 中的资源进行交互并覆盖本书中的内容。随意尝试并熟悉命令行界面。这是您在阅读本书并与 AWS 在现实世界中进行交互时需要习惯的东西。

## 探索基本的 AWS CLI 命令

现在我们将看一些基本的 AWS CLI 命令，现在已经对 AWS CLI 是什么以及它是如何工作有了一个基本的了解。以下显示了您将在本书中看到的一些命令。这些命令旨在与各种服务进行交互，如 S3、EC2 和 Lambda。

一旦您配置了 AWS CLI，使用以下命令获取命令列表：

```
$ aws help
```

以下命令对描述 EC2 服务器的属性非常有用：

```
$ aws ec2 describe instance
```

下一个命令将列出 S3 环境中的存储桶：

```
$ aws s3 ls s3://
```

我们将提到的最后一个命令用于列出 Lambda 中的函数：

```
$ aws lambda list-functions –-region <<region>>
```

正如您所看到的，有很多服务可以通过 AWS CLI 进行交互。随着我们在本书中继续进行更多练习，您将越来越熟悉与这些服务进行交互。现在我们已经讨论了本章的最后一个主题，让我们总结一下！

# 总结

在本章中，我们学会了如何创建一个 AWS 账户，这将允许我们为我们创建一个主机并在本书中的后续部分进行渗透测试。我们必须了解如何在 AWS 中创建实验室是至关重要的，主要是因为这是我们在本书中进行测试的唯一方式，以及在现实生活中的情况下。我们学到了什么是 EC2 实例，以及如何使用各种操作系统设置实例，帮助我们理解在现实世界的渗透测试情况下我们将看到的各种操作系统的重要性。我们学到了如何在我们的主机中设置易受攻击的服务，以及关于渗透测试和 AWS 安全方面的漏洞的含义。最后，我们学会了如何快速设置 AWS CLI 以便与我们的 AWS 资源进行交互。

在下一章中，我们将更多地了解 Kali Linux，它的一些历史，以及我们将如何在整本书中使用它，以及它与渗透测试的关系。

# 更多阅读

+   您可以在这里找到 AWS CLI 的文件：[`github.com/aws/aws-cli`](https://github.com/aws/aws-cli)

+   有关 AWS Educate 的更多信息：[`aws.amazon.com/about-aws/whats-new/2015/05/aws-educate-students-and-educators-can-access-aws-technology-cloud-courses-training-and-collaboration-tools/`](https://aws.amazon.com/about-aws/whats-new/2015/05/aws-educate-students-and-educators-can-access-aws-technology-cloud-courses-training-and-collaboration-tools/)

+   PuTTY 用户指南可以在这里找到：[`docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html`](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html)

+   有关 S3 的更多信息：[`docs.aws.amazon.com/cli/latest/reference/s3/`](https://docs.aws.amazon.com/cli/latest/reference/s3/)

+   有关 Metasploit 的更多信息：[`www.metasploit.com/`](https://www.metasploit.com/)
